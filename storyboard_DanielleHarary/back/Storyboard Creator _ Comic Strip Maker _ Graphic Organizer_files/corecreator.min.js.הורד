(function(g){g.support.touch="ontouchend" in document;if(!g.support.touch){return}var h=g.ui.mouse.prototype,j=h._mouseInit,f;function i(b,c){if(b.originalEvent.touches.length>1){return}b.preventDefault();var d=b.originalEvent.changedTouches[0],a=document.createEvent("MouseEvents");a.initMouseEvent(c,true,true,window,1,d.screenX,d.screenY,d.clientX,d.clientY,false,false,false,false,0,null);b.target.dispatchEvent(a)}h._touchStart=function(b){var a=this;if(f||!a._mouseCapture(b.originalEvent.changedTouches[0])){return}f=true;a._touchMoved=false;i(b,"mouseover");i(b,"mousemove");i(b,"mousedown")};h._touchMove=function(a){if(!f){return}this._touchMoved=true;i(a,"mousemove")};h._touchEnd=function(a){if(!f){return}i(a,"mouseup");i(a,"mouseout");if(!this._touchMoved){i(a,"click")}f=false};h._mouseInit=function(){var a=this;a.element.bind("touchstart",g.proxy(a,"_touchStart")).bind("touchmove",g.proxy(a,"_touchMove")).bind("touchend",g.proxy(a,"_touchEnd"));j.call(a)}})(jQuery);window.Modernizr=(function(D,g,B){var C="2.6.2",r={},h=true,f=g.documentElement,p="modernizr",q=g.createElement(p),s=q.style,m,A={}.toString,u=" -webkit- -moz- -o- -ms- ".split(" "),t={svg:"http://www.w3.org/2000/svg"},z={},n={},b={},d=[],x=d.slice,j,l=function(M,F,K,O){var N,L,J,H,G=g.createElement("div"),E=g.body,I=E||g.createElement("body");if(parseInt(K,10)){while(K--){J=g.createElement("div");J.id=O?O[K]:p+(K+1);G.appendChild(J)}}N=["&#173;",'<style id="s',p,'">',M,"</style>"].join("");G.id=p;(E?G:I).innerHTML+=N;I.appendChild(G);if(!E){I.style.background="";I.style.overflow="hidden";H=f.style.overflow;f.style.overflow="hidden";f.appendChild(I)}L=F(G,M);if(!E){I.parentNode.removeChild(I);f.style.overflow=H}else{G.parentNode.removeChild(G)}return !!L},a=({}).hasOwnProperty,k;if(!o(a,"undefined")&&!o(a.call,"undefined")){k=function(E,F){return a.call(E,F)}}else{k=function(E,F){return((F in E)&&o(E.constructor.prototype[F],"undefined"))}}if(!Function.prototype.bind){Function.prototype.bind=function c(H){var G=this;if(typeof G!="function"){throw new TypeError()}var E=x.call(arguments,1),F=function(){if(this instanceof F){var I=function(){};I.prototype=G.prototype;var K=new I();var J=G.apply(K,E.concat(x.call(arguments)));if(Object(J)===J){return J}return K}else{return G.apply(H,E.concat(x.call(arguments)))}};return F}}function v(E){s.cssText=E}function w(E,F){return v(u.join(E+";")+(F||""))}function o(E,F){return typeof E===F}function e(E,F){return !!~(""+E).indexOf(F)}function y(I,H,E){for(var F in I){var G=H[I[F]];if(G!==B){if(E===false){return I[F]}if(o(G,"function")){return G.bind(E||H)}return G}}return false}z.touch=function(){var E;if(("ontouchstart" in D)||D.DocumentTouch&&g instanceof DocumentTouch){E=true}else{l(["@media (",u.join("touch-enabled),("),p,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(F){E=F.offsetTop===9})}return E};z.webworkers=function(){return !!D.Worker};z.svg=function(){return !!g.createElementNS&&!!g.createElementNS(t.svg,"svg").createSVGRect};z.inlinesvg=function(){var E=g.createElement("div");E.innerHTML="<svg/>";return(E.firstChild&&E.firstChild.namespaceURI)==t.svg};z.svgclippaths=function(){return !!g.createElementNS&&/SVGClipPath/.test(A.call(g.createElementNS(t.svg,"clipPath")))};for(var i in z){if(k(z,i)){j=i.toLowerCase();r[j]=z[i]();d.push((r[j]?"":"no-")+j)}}r.addTest=function(E,G){if(typeof E=="object"){for(var F in E){if(k(E,F)){r.addTest(F,E[F])}}}else{E=E.toLowerCase();if(r[E]!==B){return r}G=typeof G=="function"?G():G;if(typeof h!=="undefined"&&h){f.className+=" "+(G?"":"no-")+E}r[E]=G}return r};v("");q=m=null;(function(V,H){var O=V.html5||{};var P=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i;var Q=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i;var T;var I="_html5shiv";var K=0;var J={};var U;(function(){try{var W=H.createElement("a");W.innerHTML="<xyz></xyz>";T=("hidden" in W);U=W.childNodes.length==1||(function(){(H.createElement)("a");var Y=H.createDocumentFragment();return(typeof Y.cloneNode=="undefined"||typeof Y.createDocumentFragment=="undefined"||typeof Y.createElement=="undefined")}())}catch(X){T=true;U=true}}());function E(X,W){var Y=X.createElement("p"),Z=X.getElementsByTagName("head")[0]||X.documentElement;Y.innerHTML="x<style>"+W+"</style>";return Z.insertBefore(Y.lastChild,Z.firstChild)}function L(){var W=N.elements;return typeof W=="string"?W.split(" "):W}function M(X){var W=J[X[I]];if(!W){W={};K++;X[I]=K;J[K]=W}return W}function G(Y,Z,W){if(!Z){Z=H}if(U){return Z.createElement(Y)}if(!W){W=M(Z)}var X;if(W.cache[Y]){X=W.cache[Y].cloneNode()}else{if(Q.test(Y)){X=(W.cache[Y]=W.createElem(Y)).cloneNode()}else{X=W.createElem(Y)}}return X.canHaveChildren&&!P.test(Y)?W.frag.appendChild(X):X}function F(ab,X){if(!ab){ab=H}if(U){return ab.createDocumentFragment()}X=X||M(ab);var W=X.frag.cloneNode(),Z=0,Y=L(),aa=Y.length;for(;Z<aa;Z++){W.createElement(Y[Z])}return W}function S(X,W){if(!W.cache){W.cache={};W.createElem=X.createElement;W.createFrag=X.createDocumentFragment;W.frag=W.createFrag()}X.createElement=function(Y){if(!N.shivMethods){return W.createElem(Y)}return G(Y,X,W)};X.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+L().join().replace(/\w+/g,function(Y){W.createElem(Y);W.frag.createElement(Y);return'c("'+Y+'")'})+");return n}")(N,W.frag)}function R(X){if(!X){X=H}var W=M(X);if(N.shivCSS&&!T&&!W.hasCSS){W.hasCSS=!!E(X,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")}if(!U){S(X,W)}return X}var N={elements:O.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:(O.shivCSS!==false),supportsUnknownElements:U,shivMethods:(O.shivMethods!==false),type:"default",shivDocument:R,createElement:G,createDocumentFragment:F};V.html5=N;R(H)}(this,g));r._version=C;r._prefixes=u;r.testStyles=l;f.className=f.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(h?" js "+d.join(" "):"");return r})(this,this.document);(function(C,E,G){function H(b){return"[object Function]"==S.call(b)}function I(b){return"string"==typeof b}function J(){}function K(b){return !b||"loaded"==b||"complete"==b||"uninitialized"==b}function L(){var b=T.shift();U=1,b?b.t?Q(function(){("c"==b.t?F.injectCss:F.injectJs)(b.s,0,b.a,b.x,b.e,1)},0):(b(),L()):U=0}function M(b,g,h,m,n,p,q){function s(a){if(!v&&K(t.readyState)&&(x.r=v=1,!U&&L(),t.onload=t.onreadystatechange=null,a)){"img"!=b&&Q(function(){X.removeChild(t)},50);for(var c in ac[g]){ac[g].hasOwnProperty(c)&&ac[g][c].onload()}}}var q=q||F.errorTimeout,t=E.createElement(b),v=0,w=0,x={t:h,s:g,e:n,a:p,x:q};1===ac[g]&&(w=1,ac[g]=[]),"object"==b?t.data=g:(t.src=g,t.type=b),t.width=t.height="0",t.onerror=t.onload=t.onreadystatechange=function(){s.call(this,w)},T.splice(m,0,x),"img"!=b&&(w||2===ac[g]?(X.insertBefore(t,W?null:R),Q(s,q)):ac[g].push(t))}function N(e,g,h,i,j){return U=0,g=g||"j",I(e)?M("c"==g?Z:Y,e,g,this.i++,h,i,j):(T.splice(this.i++,0,e),1==T.length&&L()),this}function O(){var b=F;return b.loader={load:N,i:0},b}var P=E.documentElement,Q=C.setTimeout,R=E.getElementsByTagName("script")[0],S={}.toString,T=[],U=0,V="MozAppearance" in P.style,W=V&&!!E.createRange().compareNode,X=W?P:R.parentNode,P=C.opera&&"[object Opera]"==S.call(C.opera),P=!!E.attachEvent&&!P,Y=V?"object":P?"script":"img",Z=P?"script":Y,aa=Array.isArray||function(b){return"[object Array]"==S.call(b)},ab=[],ac={},ad={timeout:function(c,d){return d.length&&(c.timeout=d[0]),c}},D,F;F=function(c){function d(h){var h=h.split("!"),i=ab.length,j=h.pop(),l=h.length,j={url:j,origUrl:j,prefixes:h},o,p,q;for(p=0;p<l;p++){q=h[p].split("="),(o=ad[q.shift()])&&(j=o(j,q))}for(p=0;p<i;p++){j=ab[p](j)}return j}function e(b,l,o,p,q){var r=d(b),s=r.autoCallback;r.url.split(".").pop().split("?").shift(),r.bypass||(l&&(l=H(l)?l:l[b]||l[p]||l[b.split("/").pop().split("?")[0]]),r.instead?r.instead(b,l,o,p,q):(ac[r.url]?r.noexec=!0:ac[r.url]=1,o.load(r.url,r.forceCSS||!r.forceJS&&"css"==r.url.split(".").pop().split("?").shift()?"c":G,r.noexec,r.attrs,r.timeout),(H(l)||H(s))&&o.load(function(){O(),l&&l(r.origUrl,q,p),s&&s(r.origUrl,q,p),ac[r.url]=2})))}function f(g,o){function p(b,h){if(b){if(I(b)){h||(s=function(){var i=[].slice.call(arguments);t.apply(this,i),u()}),e(b,s,o,0,q)}else{if(Object(b)===b){for(w in v=function(){var a=0,i;for(i in b){b.hasOwnProperty(i)&&a++}return a}(),b){b.hasOwnProperty(w)&&(!h&&!--v&&(H(s)?s=function(){var i=[].slice.call(arguments);t.apply(this,i),u()}:s[w]=function(i){return function(){var a=[].slice.call(arguments);i&&i.apply(this,a),u()}}(t[w])),e(b[w],s,o,w,q))}}}}else{!h&&u()}}var q=!!g.test,r=g.load||g.both,s=g.callback||J,t=s,u=g.complete||J,v,w;p(q?g.yep:g.nope,!!r),r&&p(r)}var k,m,n=this.yepnope.loader;if(I(c)){e(c,0,n,0)}else{if(aa(c)){for(k=0;k<c.length;k++){m=c[k],I(m)?e(m,0,n,0):aa(m)?F(m):Object(m)===m&&f(m,n)}}else{Object(c)===c&&f(c,n)}}},F.addPrefix=function(c,d){ad[c]=d},F.addFilter=function(b){ab.push(b)},F.errorTimeout=10000,null==E.readyState&&E.addEventListener&&(E.readyState="loading",E.addEventListener("DOMContentLoaded",D=function(){E.removeEventListener("DOMContentLoaded",D,0),E.readyState="complete"},0)),C.yepnope=O(),C.yepnope.executeStack=L,C.yepnope.injectJs=function(b,f,g,h,m,n){var p=E.createElement("script"),q,r,h=h||F.errorTimeout;p.src=b;for(r in g){p.setAttribute(r,g[r])}f=n?L:f||J,p.onreadystatechange=p.onload=function(){!q&&K(p.readyState)&&(q=1,f(),p.onload=p.onreadystatechange=null)},Q(function(){q||(q=1,f(1))},h),m?p.onload():R.parentNode.insertBefore(p,R)},C.yepnope.injectCss=function(b,f,h,k,l,m){var k=E.createElement("link"),n,f=m?L:f||J;k.href=b,k.rel="stylesheet",k.type="text/css";for(n in h){k.setAttribute(n,h[n])}l||(R.parentNode.insertBefore(k,R),Q(f,0))}})(this,document);Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};(function(a){a.touchyOptions={useDelegation:false,longpress:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,msThresh:800,triggerStartPhase:false,data:{startDate:null},proxyEvents:["TouchStart","TouchEnd"]},drag:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,msHoldThresh:100,data:{startPoint:null,startDate:null,movePoint:null,moveDate:null,held:false},proxyEvents:["TouchStart","TouchMove","TouchEnd"]},pinch:{preventDefault:{start:true,move:true,end:true},requiredTouches:2,pxThresh:0,data:{startPoint:null,startDate:null,movePoint:null,moveDate:null},proxyEvents:["TouchStart","TouchMove","GestureChange","TouchEnd"]},rotate:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,data:{},proxyEvents:["TouchStart","TouchMove","GestureChange","TouchEnd"]},swipe:{preventDefault:{start:true,move:true,end:true},requiredTouches:1,velocityThresh:1,triggerOn:"touchmove",data:{startPoint:null,startDate:null,movePoint:null,moveDate:null},proxyEvents:["TouchStart","TouchMove","TouchEnd"]}};var d={handleTouchStart:function(k){var m=this.context,h=getTarget(k,m);if(h){var l=k.originalEvent,q=l.targetTouches,i="touchy"+m.charAt(0).toUpperCase()+m.slice(1),j=h.data(i),o=j.settings;if(o.preventDefault.start){l.preventDefault()}if(l.touches.length===o.requiredTouches){switch(m){case"drag":f(j,q,k.timeStamp);var p=j.startPoint;h.trigger("touchy-drag",["start",h,{movePoint:p,lastMovePoint:p,startPoint:p,velocity:0}]);break;case"swipe":g(j,q,k.timeStamp);break;case"pinch":var n=getTwoTouchPointData(k);if(n){j.startPoint={x:n.centerX,y:n.centerY};j.startDistance=Math.sqrt(Math.pow((n.x2-n.x1),2)+Math.pow((n.y2-n.y1),2));j.startXOffset=n.x2-n.x1;j.startYOffset=n.y2-n.y1;h.trigger("touchy-pinch",["start",h,{scale:1,previousScale:1,currentPoint:j.startPoint,startPoint:j.startPoint,startDistance:j.startDistance,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2,startXOffset:j.startXOffset,startYOffset:j.startYOffset,currentXOffset:j.startXOffset,currentYOffset:j.startYOffset}])}break;case"longpress":j.startPoint={x:q[0].pageX,y:q[0].pageY};j.startDate=k.timeStamp;if(o.triggerStartPhase){h.trigger("touchy-longpress",["start",h])}j.timer=setTimeout(a.proxy(function(){h.trigger("touchy-longpress",["end",h])},this),o.msThresh);break;case"rotate":if(q.length===1){b(j,q,k.timeStamp)}else{var n=getTwoTouchPointData(k);j.startPoint={x:n.centerX,y:n.centerY};j.startDate=k.timeStamp}var p=j.startPoint;h.trigger("touchy-rotate",["start",h,{startPoint:p,movePoint:p,lastMovePoint:p,velocity:0,degrees:0}]);break}}}},handleTouchMove:function(p){var r=this.context,h=getTarget(p,r);if(h){var q=p.originalEvent,G=q.targetTouches,i="touchy"+r.charAt(0).toUpperCase()+r.slice(1),l=h.data(i),D=l.settings;if(D.preventDefault.move){q.preventDefault()}if(q.touches.length===D.requiredTouches){switch(r){case"drag":if(q.touches.length===l.settings.requiredTouches){f(l,G,p.timeStamp);var x=l.movePoint,u=l.lastMovePoint,o=x.x===u.x&&x.y===u.y?0:Math.sqrt(Math.pow((x.x-u.x),2)+Math.pow((x.y-u.y),2)),y=l.moveDate-l.lastMoveDate,H=y===0?0:o/y;if(l.held){h.trigger("touchy-drag",["move",h,{movePoint:x,lastMovePoint:u,startPoint:l.startPoint,velocity:H}])}}break;case"swipe":g(l,G,p.timeStamp);if(!l.swipeExecuted&&l.swiped&&D.triggerOn==="touchmove"){l.swipeExecuted=true;e(l,h)}break;case"pinch":var z=getTwoTouchPointData(p);if(z){l.currentPoint={x:z.centerX,y:z.centerY};l.previousXOffset=l.currentXOffset||l.startXOffset;l.previousYOffset=l.currentYOffset||l.startYOffset;l.currentXOffset=z.x2-z.x1;l.currentYOffset=z.y2-z.y1;if(c()){var w=Math.sqrt(Math.pow((z.x2-z.x1),2)+Math.pow((z.y2-z.y1),2)),A=l.previousScale=l.scale||1,E=l.startDistance,C=l.scale=w/E,k=C*E;if(k>D.pxThresh){h.trigger("touchy-pinch",["move",h,{scale:C,previousScale:A,currentPoint:l.currentPoint,startPoint:l.startPoint,startDistance:E,x1:z.x1,x2:z.x2,y1:z.y1,y2:z.y2,startXOffset:l.startXOffset,startYOffset:l.startYOffset,currentXOffset:l.currentXOffset,currentYOffset:l.currentYOffset}])}}}break;case"rotate":var u,t,x,v,t,o,y,H,F,j,B,n,s,m;u=l.lastMovePoint=l.movePoint||l.startPoint;t=l.lastMoveDate=l.moveDate||l.startDate;x=l.movePoint={x:G[0].pageX,y:G[0].pageY};v=l.moveDate=p.timeStamp;if(G.length===1){F=l.targetPageCoords=l.targetPageCoords||getViewOffset(p.target);j=l.centerCoords=l.centerCoords||{x:F.x+(h.width()*0.5),y:F.y+(h.height()*0.5)}}else{var z=getTwoTouchPointData(p);j=l.centerCoords={x:z.centerX,y:z.centerY};if(hasGestureChange()){break}}B=Math.atan2(x.y-j.y,x.x-j.x);s=l.lastDegrees=l.degrees;n=l.degrees=B*(180/Math.PI);m=s?n-s:0;y=v-t;H=l.velocity=y===0?0:m/y;h.trigger("touchy-rotate",["move",h,{startPoint:l.startPoint,startDate:l.startDate,movePoint:x,lastMovePoint:u,centerCoords:j,degrees:n,degreeDelta:m,velocity:H}]);break}}}},handleGestureChange:function(o){var q=this.context,h=getTarget(o,q);if(h){var h=a(o.target),p=o.originalEvent,x=p.touches,i="touchy"+q.charAt(0).toUpperCase()+q.slice(1),l=h.data(i);if(l.preventDefault.move){p.preventDefault()}switch(q){case"pinch":var t=l.previousScale=l.scale||1,u=l.scale=p.scale,w=l.startPoint,k=l.currentPoint||w,v=l.startDistance,j=u*v;if(j>l.settings.pxThresh){h.trigger("touchy-pinch",[h,{scale:u,previousScale:t,currentPoint:k,startPoint:w,startDistance:v}])}break;case"rotate":var r=l.lastDegrees=l.degrees,n=l.degrees=p.rotation,m=r?n-r:0,s=l.moveDate-l.lastMoveDate,y=l.velocity=s===0?0:m/s;h.trigger("touchy-rotate",["move",h,{startPoint:l.startPoint,startDate:l.startDate,movePoint:l.movePoint,lastMovePoint:l.lastMovePoint,centerCoords:l.centerCoords,degrees:n,degreeDelta:m,velocity:y}]);break}}},handleTouchEnd:function(m){var o=this.context,h=getTarget(m,o);if(h){var n=m.originalEvent,i="touchy"+o.charAt(0).toUpperCase()+o.slice(1),j=h.data(i),s=j.settings;if(s.preventDefault.end){n.preventDefault()}switch(o){case"drag":if(j.held){var q=j.movePoint||j.startPoint,p=j.lastMovePoint||j.startPoint,l=q.x===p.x&&q.y===p.y?0:Math.sqrt(Math.pow((q.x-p.x),2)+Math.pow((q.y-p.y),2)),r=j.moveDate-j.lastMoveDate,t=r===0?0:l/r;h.trigger("touchy-drag",["end",h,{movePoint:q,lastMovePoint:p,startPoint:j.startPoint,velocity:t}])}a.extend(j,{startPoint:null,startDate:null,movePoint:null,moveDate:null,lastMovePoint:null,lastMoveDate:null,held:false});break;case"swipe":if(j.swiped&&s.triggerOn==="touchend"){e(j,h)}a.extend(j,{startPoint:null,startDate:null,movePoint:null,moveDate:null,lastMovePoint:null,lastMoveDate:null,swiped:false,swipeExecuted:false});break;case"pinch":a.extend(j,{startPoint:null,startDistance:0,currentPoint:null,pinched:false,scale:1,previousScale:null});h.trigger("touchy-pinch",["end",h,{}]);break;case"longpress":clearTimeout(j.timer);a.extend(j,{startDate:null});break;case"rotate":var k=j.lastDegrees?j.degrees-j.lastDegrees:0;h.trigger("touchy-rotate",["end",h,{startPoint:j.startPoint,startDate:j.startDate,movePoint:j.movePoint,lastMovePoint:j.lastMovePoint,degrees:j.degrees,degreeDelta:k,velocity:j.velocity}]);a.extend(j,{startPoint:null,startDate:null,movePoint:null,moveDate:null,lastMovePoint:null,lastMoveDate:null,targetPageCoords:null,centerCoords:null,degrees:null,lastDegrees:null,velocity:null});break}}}},f=function(h,l,k){b(h,l,k);var i=h.moveDate||h.startDate,j=k;if(h.held||(j-i)>h.settings.msHoldThresh){a.extend(h,{held:true,lastMoveDate:i,lastMovePoint:h.movePoint&&h.movePoint.x?h.movePoint:h.startPoint,moveDate:j,movePoint:{x:l[0].pageX,y:l[0].pageY}})}else{a.extend(h,{held:false,lastMoveDate:0,lastMovePoint:h.startPoint,moveDate:0,movePoint:h.startPoint})}},g=function(h,r,q){b(h,r,q);var n=h.settings,o=h.startDate,p=h.startPoint,j=h.moveDate||h.startDate,k=q,l={x:r[0].pageX,y:r[0].pageY},i=l.x-p.x,s=l.y-p.y,m=k-j;a.extend(h,{lastMoveDate:j,lastMovePoint:h.movePoint&&h.movePoint.x?h.movePoint:h.startPoint,moveDate:k,movePoint:l,hDistance:i,vDistance:s});if(!h.swiped&&(Math.abs(i)/m>n.velocityThresh||Math.abs(s)/m>n.velocityThresh)){h.swiped=true}},e=function(i,h){var n=i.movePoint,m=i.lastMovePoint,k=n.x===m.x&&n.y===m.y?0:Math.sqrt(Math.pow((n.x-m.x),2)+Math.pow((n.y-m.y),2)),o=i.moveDate-i.lastMoveDate,q=o===0?0:k/o,l=i.hDistance,p=i.vDistance,j;if(q>i.settings.velocityThresh){if(Math.abs(l)>Math.abs(p)){j=l>0?"right":"left"}else{j=p>0?"down":"up"}h.trigger("touchy-swipe",[h,{direction:j,movePoint:n,lastMovePoint:m,startPoint:i.startPoint,velocity:q}])}},b=function(h,j,i){if(!h.startPoint){h.startPoint={x:j[0].pageX,y:j[0].pageY}}if(!h.startDate){h.startDate=i}},c=function(){if(window.ongesturechange==null){return true}if(window.ongesturechange==undefined){return true}return false};hasGestureChange=function(){return(typeof window.ongesturechange=="object")},getTwoTouchPointData=function(h){var i=false,j=h.originalEvent.touches;if(j.length===2){i={x1:j[0].pageX,y1:j[0].pageY,x2:j[1].pageX,y2:j[1].pageY};i.centerX=(i.x1+i.x2)/2;i.centerY=(i.y1+i.y2)/2;return i}return i},getTarget=function(k,l){var h,j=false,m=0,n=boundElems[l].length;if(a.touchyOptions.useDelegation){for(;m<n;m+=1){h=a(boundElems[l][m]).has(k.target);if(h.length>0){j=h;break}}}else{if(boundElems[l]&&boundElems[l].index(k.target)!=-1){j=a(k.target)}}return j},getViewOffset=function(j,k){function h(n,l,t){var o=n.offsetParent;l.x+=n.offsetLeft-(o?o.scrollLeft:0);l.y+=n.offsetTop-(o?o.scrollTop:0);if(o){if(o.nodeType==1){var r=t.getComputedStyle(o,"");if(r.position!="static"){l.x+=parseInt(r.borderLeftWidth);l.y+=parseInt(r.borderTopWidth);if(o.localName=="TABLE"){l.x+=parseInt(r.paddingLeft);l.y+=parseInt(r.paddingTop)}else{if(o.localName=="BODY"){var s=t.getComputedStyle(n,"");l.x+=parseInt(s.marginLeft);l.y+=parseInt(s.marginTop)}}}else{if(o.localName=="BODY"){l.x+=parseInt(r.borderLeftWidth);l.y+=parseInt(r.borderTopWidth)}}var q=n.parentNode;while(o!=q){l.x-=q.scrollLeft;l.y-=q.scrollTop;q=q.parentNode}h(o,l,t)}}else{if(n.localName=="BODY"){var s=t.getComputedStyle(n,"");l.x+=parseInt(s.borderLeftWidth);l.y+=parseInt(s.borderTopWidth);var m=t.getComputedStyle(n.parentNode,"");l.x-=parseInt(m.paddingLeft);l.y-=parseInt(m.paddingTop)}if(n.scrollLeft){l.x+=n.scrollLeft}if(n.scrollTop){l.y+=n.scrollTop}var u=n.ownerDocument.defaultView;if(u&&(!k&&u.frameElement)){h(u.frameElement,l,u)}}}var i={x:0,y:0};if(j){h(j,i,j.ownerDocument.defaultView)}return i},boundElems={},contexts={};a.each(a.touchyOptions,function(i,j){if(i!=="useDelegation"){var h=i.charAt(0).toUpperCase()+i.slice(1);boundElems[i]=a([]);contexts[i]=new (function(){this.context=i})();a.event.special["touchy-"+i]={setup:function(k,m,l){boundElems[i]=boundElems[i].add(this);a(this).data("touchy"+h,a.extend({},a.touchyOptions[i].data));a(this).data("touchy"+h).settings=a.extend({},a.touchyOptions[i]);delete a(this).data("touchy"+h).settings.data;if(boundElems[i].length===1){a.each(a.touchyOptions[i].proxyEvents,function(n,o){a(document).bind(o.toLowerCase()+".touchy."+i,a.proxy(d["handle"+o],contexts[i]))})}},teardown:function(k){boundElems[i]=boundElems[i].not(this);a(this).removeData("touchy"+h);if(boundElems[i].length===0){a.each(a.touchyOptions[i].proxyEvents,function(l,m){a(document).unbind(m.toLowerCase()+".touchy."+i)})}},add:function(k){a.extend(a(this).data("touchy"+h).settings,k.data);var l=k.handler;k.handler=function(m){return l.apply(this,arguments)}}}}})})(jQuery);var UndoManager=function(){var b=[],e=-1,f=false,a;function d(g){if(!g){return}f=true;g.f.apply(g.o,g.p);f=false}function c(m,k,n,l,i,g,j,h){return{undo:{o:m,f:k,p:n,m:l},redo:{o:i,f:g,p:j,m:h}}}return{register:function(m,k,n,l,i,g,j,h){if(f){return}b.splice(e+1,b.length-e);b.push(c(m,k,n,l,i,g,j,h));e=b.length-1;if(a){a()}},setCallback:function(g){a=g},undo:function(){var g=b[e];if(!g){return}d(g.undo);e-=1;if(a){a()}},redo:function(){var g=b[e+1];if(!g){return}d(g.redo);e+=1;if(a){a()}},clear:function(){var g=b.length;b=[];e=-1;if(a&&(g>0)){a()}},hasUndo:function(){return e!==-1},hasRedo:function(){return e<(b.length-1)}}};/*
 * jQuery blockUI plugin
 * Version 2.61.0-2013.06.06
 * @requires jQuery v1.7 or later
 *
 * Examples at: http://malsup.com/jquery/block/
 * Copyright (c) 2007-2013 M. Alsup
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Thanks to Amir-Hossein Sobhi for some excellent contributions!
 */
(function(){function a(b){b.fn._fadeIn=b.fn.fadeIn;var k=b.noop||function(){};var j=/MSIE/.test(navigator.userAgent);var g=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent);var i=document.documentMode||0;var p=b.isFunction(document.createElement("div").style.setExpression);b.blockUI=function(r){h(window,r)};b.unblockUI=function(r){n(window,r)};b.growlUI=function(x,t,w,v){var r=b('<div class="growlUI"></div>');if(x){r.append("<h1>"+x+"</h1>")}if(t){r.append("<h2>"+t+"</h2>")}if(w===undefined){w=3000}var s=function(y){y=y||{};b.blockUI({message:r,fadeIn:typeof y.fadeIn!=="undefined"?y.fadeIn:700,fadeOut:typeof y.fadeOut!=="undefined"?y.fadeOut:1000,timeout:typeof y.timeout!=="undefined"?y.timeout:w,centerY:false,showOverlay:false,onUnblock:v,css:b.blockUI.defaults.growlCSS})};s();var u=r.css("opacity");r.mouseover(function(){s({fadeIn:0,timeout:30000});var y=b(".blockMsg");y.stop();y.fadeTo(300,1)}).mouseout(function(){b(".blockMsg").fadeOut(1000)})};b.fn.block=function(s){if(this[0]===window){b.blockUI(s);return this}var r=b.extend({},b.blockUI.defaults,s||{});this.each(function(){var t=b(this);if(r.ignoreIfBlocked&&t.data("blockUI.isBlocked")){return}t.unblock({fadeOut:0})});return this.each(function(){if(b.css(this,"position")=="static"){this.style.position="relative";b(this).data("blockUI.static",true)}this.style.zoom=1;h(this,s)})};b.fn.unblock=function(r){if(this[0]===window){b.unblockUI(r);return this}return this.each(function(){n(this,r)})};b.blockUI.version=2.6;b.blockUI.defaults={message:"<h1>"+pleaseWaitMessage+"</h1>",title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:0.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:0.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:false};var l=null;var m=[];function h(A,M){var x,P;var E=(A==window);var K=(M&&M.message!==undefined?M.message:undefined);M=b.extend({},b.blockUI.defaults,M||{});if(M.ignoreIfBlocked&&b(A).data("blockUI.isBlocked")){return}M.overlayCSS=b.extend({},b.blockUI.defaults.overlayCSS,M.overlayCSS||{});x=b.extend({},b.blockUI.defaults.css,M.css||{});if(M.onOverlayClick){M.overlayCSS.cursor="pointer"}P=b.extend({},b.blockUI.defaults.themedCSS,M.themedCSS||{});K=K===undefined?M.message:K;if(E&&l){n(window,{fadeOut:0})}if(K&&typeof K!="string"&&(K.parentNode||K.jquery)){var L=K.jquery?K[0]:K;var y={};b(A).data("blockUI.history",y);y.el=L;y.parent=L.parentNode;y.display=L.style.display;y.position=L.style.position;if(y.parent){y.parent.removeChild(L)}}b(A).data("blockUI.onUnblock",M.onUnblock);var R=M.baseZ;var H,I,J,N;if(j||M.forceIframe){H=b('<iframe class="blockUI" style="z-index:'+(R++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+M.iframeSrc+'"></iframe>')}else{H=b('<div class="blockUI" style="display:none"></div>')}if(M.theme){I=b('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+(R++)+';display:none"></div>')}else{I=b('<div class="blockUI blockOverlay" style="z-index:'+(R++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>')}if(M.theme&&E){N='<div class="blockUI '+M.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(R+10)+';display:none;position:fixed">';if(M.title){N+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(M.title||"&nbsp;")+"</div>"}N+='<div class="ui-widget-content ui-dialog-content"></div>';N+="</div>"}else{if(M.theme){N='<div class="blockUI '+M.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(R+10)+';display:none;position:absolute">';if(M.title){N+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(M.title||"&nbsp;")+"</div>"}N+='<div class="ui-widget-content ui-dialog-content"></div>';N+="</div>"}else{if(E){N='<div class="blockUI '+M.blockMsgClass+' blockPage" style="z-index:'+(R+10)+';display:none;position:fixed"></div>'}else{N='<div class="blockUI '+M.blockMsgClass+' blockElement" style="z-index:'+(R+10)+';display:none;position:absolute"></div>'}}}J=b(N);if(K){if(M.theme){J.css(P);J.addClass("ui-widget-content")}else{J.css(x)}}if(!M.theme){I.css(M.overlayCSS)}I.css("position",E?"fixed":"absolute");if(j||M.forceIframe){H.css("opacity",0)}var G=[H,I,J],r=E?b("body"):b(A);b.each(G,function(){this.appendTo(r)});if(M.theme&&M.draggable&&b.fn.draggable){J.draggable({handle:".ui-dialog-titlebar",cancel:"li"})}var B=p&&(!b.support.boxModel||b("object,embed",E?null:A).length>0);if(g||B){if(E&&M.allowBodyStretch&&b.support.boxModel){b("html,body").css("height","100%")}if((g||!b.support.boxModel)&&!E){var O=q(A,"borderTopWidth"),F=q(A,"borderLeftWidth");var D=O?"(0 - "+O+")":0;var C=F?"(0 - "+F+")":0}b.each(G,function(z,S){var T=S[0].style;T.position="absolute";if(z<2){if(E){T.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+M.quirksmodeOffsetHack+') + "px"')}else{T.setExpression("height",'this.parentNode.offsetHeight + "px"')}if(E){T.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"')}else{T.setExpression("width",'this.parentNode.offsetWidth + "px"')}if(C){T.setExpression("left",C)}if(D){T.setExpression("top",D)}}else{if(M.centerY){if(E){T.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"')}T.marginTop=0}else{if(!M.centerY&&E){var U=(M.css&&M.css.top)?parseInt(M.css.top,10):0;var t="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+U+') + "px"';T.setExpression("top",t)}}}})}if(K){if(M.theme){J.find(".ui-widget-content").append(K)}else{J.append(K)}if(K.jquery||K.nodeType){b(K).show()}}if((j||M.forceIframe)&&M.showOverlay){H.show()}if(M.fadeIn){var u=M.onBlock?M.onBlock:k;var v=(M.showOverlay&&!K)?u:k;var w=K?u:k;if(M.showOverlay){I._fadeIn(M.fadeIn,v)}if(K){J._fadeIn(M.fadeIn,w)}}else{if(M.showOverlay){I.show()}if(K){J.show()}if(M.onBlock){M.onBlock()}}c(1,A,M);if(E){l=J[0];m=b(M.focusableElements,l);if(M.focusInput){setTimeout(e,20)}}else{d(J[0],M.centerX,M.centerY)}if(M.timeout){var Q=setTimeout(function(){if(E){b.unblockUI(M)}else{b(A).unblock(M)}},M.timeout);b(A).data("blockUI.timeout",Q)}}function n(u,x){var s;var w=(u==window);var r=b(u);var t=r.data("blockUI.history");var y=r.data("blockUI.timeout");if(y){clearTimeout(y);r.removeData("blockUI.timeout")}x=b.extend({},b.blockUI.defaults,x||{});c(0,u,x);if(x.onUnblock===null){x.onUnblock=r.data("blockUI.onUnblock");r.removeData("blockUI.onUnblock")}var v;if(w){v=b("body").children().filter(".blockUI").add("body > .blockUI")}else{v=r.find(">.blockUI")}if(x.cursorReset){if(v.length>1){v[1].style.cursor=x.cursorReset}if(v.length>2){v[2].style.cursor=x.cursorReset}}if(w){l=m=null}if(x.fadeOut){s=v.length;v.fadeOut(x.fadeOut,function(){if(--s===0){o(v,t,x,u)}})}else{o(v,t,x,u)}}function o(x,u,y,v){var r=b(v);x.each(function(w,A){if(this.parentNode){this.parentNode.removeChild(this)}});if(u&&u.el){u.el.style.display=u.display;u.el.style.position=u.position;if(u.parent){u.parent.appendChild(u.el)}r.removeData("blockUI.history")}if(r.data("blockUI.static")){r.css("position","static")}if(typeof y.onUnblock=="function"){y.onUnblock(v,y)}var s=b(document.body),z=s.width(),t=s[0].style.width;s.width(z-1).width(z);s[0].style.width=t}function c(s,t,w){var v=t==window,r=b(t);if(!s&&(v&&!l||!v&&!r.data("blockUI.isBlocked"))){return}r.data("blockUI.isBlocked",s);if(!v||!w.bindEvents||(s&&!w.showOverlay)){return}var u="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";if(s){b(document).bind(u,w,f)}else{b(document).unbind(u,f)}}function f(s){if(s.keyCode&&s.keyCode==9){if(l&&s.data.constrainTabKey){var t=m;var u=!s.shiftKey&&s.target===t[t.length-1];var r=s.shiftKey&&s.target===t[0];if(u||r){setTimeout(function(){e(r)},10);return false}}}var v=s.data;var w=b(s.target);if(w.hasClass("blockOverlay")&&v.onOverlayClick){v.onOverlayClick()}if(w.parents("div."+v.blockMsgClass).length>0){return true}return w.parents().children().filter("div.blockUI").length===0}function e(r){if(!m){return}var s=m[r===true?m.length-1:0];if(s){s.focus()}}function d(r,A,B){var v=r.parentNode,w=r.style;var u=((v.offsetWidth-r.offsetWidth)/2)-q(v,"borderLeftWidth");var z=((v.offsetHeight-r.offsetHeight)/2)-q(v,"borderTopWidth");if(A){w.left=u>0?(u+"px"):"0"}if(B){w.top=z>0?(z+"px"):"0"}}function q(r,s){return parseInt(b.css(r,s),10)||0}}if(typeof define==="function"&&define.amd&&define.amd.jQuery){define(["jquery"],a)}else{a(jQuery)}})();var qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}return function(){qq(a).detach(c,b)}},detach:function(c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}return this},contains:function(b){if(a===b){return true}if(a.contains){return a.contains(b)}else{return !!(b.compareDocumentPosition(a)&8)}},insertBefore:function(b){b.parentNode.insertBefore(a,b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){if(b.opacity!==null){if(typeof a.style.opacity!=="string"&&typeof(a.filters)!=="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b);return this},hasClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},addClass:function(b){if(!qq(a).hasClass(b)){a.className+=" "+b}return this},removeClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(c){var b,d=[];if(a.querySelectorAll){return a.querySelectorAll("."+c)}b=a.getElementsByTagName("*");qq.each(b,function(e,f){if(qq(f).hasClass(c)){d.push(f)}});return d},children:function(){var c=[],b=a.firstChild;while(b){if(b.nodeType===1){c.push(b)}b=b.nextSibling}return c},setText:function(b){a.innerText=b;a.textContent=b;return this},clearText:function(){return qq(a).setText("")}}};qq.log=function(b,a){if(window.console){if(!a||a==="info"){window.console.log(b)}else{if(window.console[a]){window.console[a](b)}else{window.console.log("<"+a+"> "+b)}}}};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.isFunction=function(a){return typeof(a)==="function"};qq.isString=function(a){return Object.prototype.toString.call(a)==="[object String]"};qq.trimStr=function(a){if(String.prototype.trim){return a.trim()}return a.replace(/^\s+|\s+$/g,"")};qq.isFileOrInput=function(a){if(window.File&&a instanceof File){return true}else{if(window.HTMLInputElement){if(a instanceof HTMLInputElement){if(a.type&&a.type.toLowerCase()==="file"){return true}}}else{if(a.tagName){if(a.tagName.toLowerCase()==="input"){if(a.type&&a.type.toLowerCase()==="file"){return true}}}}}return false};qq.isBlob=function(a){return window.Blob&&Object.prototype.toString.call(a)==="[object Blob]"};qq.isXhrUploadSupported=function(){var a=document.createElement("input");a.type="file";return(a.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof(new XMLHttpRequest()).upload!=="undefined")};qq.isFolderDropSupported=function(a){return(a.items&&a.items[0].webkitGetAsEntry)};qq.isFileChunkingSupported=function(){return !qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice!==undefined||File.prototype.webkitSlice!==undefined||File.prototype.mozSlice!==undefined)};qq.extend=function(b,c,a){qq.each(c,function(d,e){if(a&&qq.isObject(e)){if(b[d]===undefined){b[d]={}}qq.extend(b[d],e,true)}else{b[d]=e}})};qq.indexOf=function(a,b,c){if(a.indexOf){return a.indexOf(b,c)}c=c||0;var d=a.length;if(c<0){c+=d}for(;c<d;c+=1){if(a.hasOwnProperty(c)&&a[c]===b){return c}}return -1};qq.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=Math.random()*16|0,d=a=="x"?b:(b&3|8);return d.toString(16)})};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.safari=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.firefox=function(){return(navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor==="")};qq.windows=function(){return navigator.platform==="Win32"};qq.android=function(){return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}}());qq.each=function(c,a){var b,d;if(c){for(b in c){if(Object.prototype.hasOwnProperty.call(c,b)){d=a(b,c[b]);if(d===false){break}}}}};qq.obj2url=function(d,g,f){var b,c,h=[],e="&",a=function(k,j){var l=g?(/\[\]$/.test(g))?g:g+"["+j+"]":j;if((l!=="undefined")&&(j!=="undefined")){h.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!f&&g){e=(/\?/.test(g))?(/\?$/.test(g))?"":"&":"?";h.push(g);h.push(qq.obj2url(d))}else{if((Object.prototype.toString.call(d)==="[object Array]")&&(typeof d!=="undefined")){for(b=-1,c=d.length;b<c;b+=1){a(d[b],b)}}else{if((typeof d!=="undefined")&&(d!==null)&&(typeof d==="object")){for(b in d){if(d.hasOwnProperty(b)){a(d[b],b)}}}else{h.push(encodeURIComponent(g)+"="+encodeURIComponent(d))}}}if(g){return h.join(e)}else{return h.join(e).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(c,b,a){if(!b){b=new FormData()}qq.each(c,function(d,e){d=a?a+"["+d+"]":d;if(qq.isObject(e)){qq.obj2FormData(e,b,d)}else{if(qq.isFunction(e)){b.append(d,e())}else{b.append(d,e)}}});return b};qq.obj2Inputs=function(c,a){var b;if(!a){a=document.createElement("form")}qq.obj2FormData(c,{append:function(d,e){b=document.createElement("input");b.setAttribute("name",d);b.setAttribute("value",e);a.appendChild(b)}});return a};qq.setCookie=function(d,e,b){var a=new Date(),c="";if(b){a.setTime(a.getTime()+(b*24*60*60*1000));c="; expires="+a.toGMTString()}document.cookie=d+"="+e+c+"; path=/"};qq.getCookie=function(e){var f=e+"=",b=document.cookie.split(";"),a;for(var d=0;d<b.length;d++){a=b[d];while(a.charAt(0)==" "){a=a.substring(1,a.length)}if(a.indexOf(f)===0){return a.substring(f.length,a.length)}}};qq.getCookieNames=function(c){var b=document.cookie.split(";"),a=[];qq.each(b,function(f,d){d=qq.trimStr(d);var e=d.indexOf("=");if(d.match(c)){a.push(d.substr(0,e))}});return a};qq.deleteCookie=function(a){qq.setCookie(a,"",-1)};qq.areCookiesEnabled=function(){var b=Math.random()*100000,a="qqCookieTest:"+b;qq.setCookie(a,1);if(qq.getCookie(a)){qq.deleteCookie(a);return true}return false};qq.parseJson=function(json){if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(json)}else{return eval("("+json+")")}};qq.DisposeSupport=function(){var a=[];return{dispose:function(){var b;do{b=a.shift();if(b){b()}}while(b)},attach:function(){var b=arguments;this.addDisposer(qq(b[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(b){a.push(b)}}};qq.supportedFeatures=(function(){var i,c,f,d,g,j,h,e;function k(){var m=true,n;try{n=document.createElement("input");n.type="file";qq(n).hide();if(n.disabled){m=false}}catch(l){m=false}return m}function b(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)!==undefined}function a(){return qq.chrome()&&navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)!==undefined}i=k();c=i&&qq.isXhrUploadSupported();f=c&&b();d=c&&qq.isFileChunkingSupported();g=c&&d&&qq.areCookiesEnabled();j=c&&a();h=i&&(window.postMessage!==undefined||c);e=c;return{uploading:i,ajaxUploading:c,fileDrop:c,folderDrop:f,chunking:d,resume:g,uploadCustomHeaders:c,uploadNonMultipart:c,itemSizeValidation:c,uploadViaPaste:j,progressBar:c,uploadCors:h,deleteFileCors:e}}());qq.Promise=function(){var f,c,e,b,a,d=0;return{then:function(h,g){if(d===0){e=h;b=g}else{if(d===-1&&g){g(c)}else{if(h){h(f)}}}return this},done:function(g){if(d===0){a=g}else{g()}return this},success:function(g){d=1;f=g;if(e){e(g)}if(a){a()}return this},failure:function(g){d=-1;c=g;if(b){b(g)}if(a){a()}return this}}};qq.UploadButton=function(d){var c,b=new qq.DisposeSupport(),e={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(f){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};function a(){var f=document.createElement("input");if(e.multiple){f.setAttribute("multiple","multiple")}if(e.acceptFiles){f.setAttribute("accept",e.acceptFiles)}f.setAttribute("type","file");f.setAttribute("name",e.name);qq(f).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});e.element.appendChild(f);b.attach(f,"change",function(){e.onChange(f)});b.attach(f,"mouseover",function(){qq(e.element).addClass(e.hoverClass)});b.attach(f,"mouseout",function(){qq(e.element).removeClass(e.hoverClass)});b.attach(f,"focus",function(){qq(e.element).addClass(e.focusClass)});b.attach(f,"blur",function(){qq(e.element).removeClass(e.focusClass)});if(window.attachEvent){f.setAttribute("tabIndex","-1")}return f}qq.extend(e,d);qq(e.element).css({position:"relative",overflow:"hidden",direction:"ltr"});c=a();return{getInput:function(){return c},reset:function(){if(c.parentNode){qq(c).remove()}qq(e.element).removeClass(e.focusClass);c=a()}}};qq.PasteSupport=function(c){var d,a;d={targetElement:null,callbacks:{log:function(h,g){},pasteReceived:function(g){}}};function b(g){return g.type&&g.type.indexOf("image/")===0}function e(){qq(d.targetElement).attach("paste",function(h){var g=h.clipboardData;if(g){qq.each(g.items,function(j,k){if(b(k)){var i=k.getAsFile();d.callbacks.pasteReceived(i)}})}})}function f(){if(a){a()}}qq.extend(d,c);e();return{reset:function(){f()}}};qq.FineUploaderBasic=function(a){var b=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},paramsInBody:true,customHeaders:{},forceMultipart:true,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:true},callbacks:{onSubmit:function(c,d){},onSubmitted:function(c,d){},onComplete:function(c,e,f,d){},onCancel:function(c,d){},onUpload:function(c,d){},onUploadChunk:function(d,e,c){},onResume:function(e,d,c){},onProgress:function(c,e,d,f){},onError:function(c,e,f,d){},onAutoRetry:function(d,e,c){},onManualRetry:function(c,d){},onValidateBatch:function(c){},onValidate:function(c){},onSubmitDelete:function(c){},onDelete:function(c){},onDeleteComplete:function(c,e,d){},onPasteReceived:function(c){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(c){if(c.length>33){c=c.slice(0,19)+"..."+c.slice(-14)}return c},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false},blobs:{defaultName:"misc_data",paramNames:{name:"qqblobname"}},paste:{targetElement:null,defaultName:"pasted_image"}};qq.extend(this._options,a,true);this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._netUploadedOrQueued=0;this._netUploaded=0;this._paramsStore=this._createParamsStore("request");this._deleteFileParamsStore=this._createParamsStore("deleteFile");this._endpointStore=this._createEndpointStore("request");this._deleteFileEndpointStore=this._createEndpointStore("deleteFile");this._handler=this._createUploadHandler();this._deleteHandler=this._createDeleteHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}if(this._options.paste.targetElement){this._pasteHandler=this._createPasteHandler()}this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(b,a){if(this._options.debug&&(!a||a==="info")){qq.log("[FineUploader] "+b)}else{if(a&&a!=="info"){qq.log("[FineUploader] "+b,a)}}},setParams:function(b,a){if(a==null){this._options.request.params=b}else{this._paramsStore.setParams(b,a)}},setDeleteFileParams:function(b,a){if(a==null){this._options.deleteFile.params=b}else{this._deleteFileParamsStore.setParams(b,a)}},setEndpoint:function(a,b){if(b==null){this._options.request.endpoint=a}else{this._endpointStore.setEndpoint(a,b)}},getInProgress:function(){return this._filesInProgress.length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var a;while(this._storedIds.length){a=this._storedIds.shift();this._filesInProgress.push(a);this._handler.upload(a)}},clearStoredFiles:function(){this._storedIds=[]},retry:function(a){if(this._onBeforeManualRetry(a)){this._netUploadedOrQueued++;this._handler.retry(a);return true}else{return false}},cancel:function(a){this._handler.cancel(a)},cancelAll:function(){var b=[],a=this;qq.extend(b,this._storedIds);qq.each(b,function(c,d){a.cancel(d)});this._handler.cancelAll()},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset();this._paramsStore.reset();this._endpointStore.reset();this._netUploadedOrQueued=0;this._netUploaded=0;if(this._pasteHandler){this._pasteHandler.reset()}},addFiles:function(c,e,a){var f=this,g=[],d,b;if(c){if(!window.FileList||!(c instanceof FileList)){c=[].concat(c)}for(d=0;d<c.length;d+=1){b=c[d];if(qq.isFileOrInput(b)){g.push(b)}else{f.log(b+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Processing "+g.length+" files or inputs...");this._uploadFileOrBlobDataList(g,e,a)}},addBlobs:function(b,d,c){if(b){var a=[].concat(b),f=[],e=this;qq.each(a,function(h,g){if(qq.isBlob(g)&&!qq.isFileOrInput(g)){f.push({blob:g,name:e._options.blobs.defaultName})}else{if(qq.isObject(g)&&g.blob&&g.name){f.push(g)}else{e.log("addBlobs: entry at index "+h+" is not a Blob or a BlobData object","error")}}});this._uploadFileOrBlobDataList(f,d,c)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(a){return this._handler.getUuid(a)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(a){return this._handler.getSize(a)},getName:function(a){return this._handler.getName(a)},getFile:function(a){return this._handler.getFile(a)},deleteFile:function(a){this._onSubmitDelete(a)},setDeleteFileEndpoint:function(a,b){if(b==null){this._options.deleteFile.endpoint=a}else{this._deleteFileEndpointStore.setEndpoint(a,b)}},_createUploadButton:function(b){var c=this;var a=new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.supportedFeatures.ajaxUploading,acceptFiles:this._options.validation.acceptFiles,onChange:function(d){c._onInputChange(d)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){a.dispose()});return a},_createUploadHandler:function(){var a=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,totalFileSizeParamName:this._options.request.totalFileSizeName,cors:this._options.cors,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(c,b){a.log(c,b)},onProgress:function(b,d,c,e){a._onProgress(b,d,c,e);a._options.callbacks.onProgress(b,d,c,e)},onComplete:function(b,c,d,e){a._onComplete(b,c,d,e);a._options.callbacks.onComplete(b,c,d,e)},onCancel:function(b,c){a._onCancel(b,c);a._options.callbacks.onCancel(b,c)},onUpload:function(b,c){a._onUpload(b,c);a._options.callbacks.onUpload(b,c)},onUploadChunk:function(c,d,b){a._options.callbacks.onUploadChunk(c,d,b)},onResume:function(c,d,b){return a._options.callbacks.onResume(c,d,b)},onAutoRetry:function(b,c,d,e){a._preventRetries[b]=d[a._options.retry.preventRetryResponseProperty];if(a._shouldAutoRetry(b,c,d)){a._maybeParseAndSendUploadError(b,c,d,e);a._options.callbacks.onAutoRetry(b,c,a._autoRetries[b]+1);a._onBeforeAutoRetry(b,c);a._retryTimeouts[b]=setTimeout(function(){a._onAutoRetry(b,c,d)},a._options.retry.autoAttemptDelay*1000);return true}else{return false}}})},_createDeleteHandler:function(){var a=this;return new qq.DeleteFileAjaxRequestor({maxConnections:this._options.maxConnections,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(c,b){a.log(c,b)},onDelete:function(b){a._onDelete(b);a._options.callbacks.onDelete(b)},onDeleteComplete:function(b,d,c){a._onDeleteComplete(b,d,c);a._options.callbacks.onDeleteComplete(b,d,c)}})},_createPasteHandler:function(){var a=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:function(c,b){a.log(c,b)},pasteReceived:function(b){var c=a._options.callbacks.onPasteReceived,d=c(b);if(d&&d.then){d.then(function(e){a._handlePasteSuccess(b,e)},function(e){a.log("Ignoring pasted image per paste received callback.  Reason = '"+e+"'")})}else{a._handlePasteSuccess(b)}}}})},_handlePasteSuccess:function(a,c){var b=a.type.split("/")[1],d=c;if(d==null){d=this._options.paste.defaultName}d+="."+b;this.addBlobs({name:d,blob:a})},_preventLeaveInProgress:function(){var a=this;this._disposeSupport.attach(window,"beforeunload",function(b){if(!a._filesInProgress.length){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(a,b){this._netUploadedOrQueued++;if(this._options.autoUpload){this._filesInProgress.push(a)}},_onProgress:function(a,c,b,d){},_onComplete:function(a,b,c,d){if(!c.success){this._netUploadedOrQueued--}else{this._netUploaded++}this._removeFromFilesInProgress(a);this._maybeParseAndSendUploadError(a,b,c,d)},_onCancel:function(a,b){this._netUploadedOrQueued--;this._removeFromFilesInProgress(a);clearTimeout(this._retryTimeouts[a]);var c=qq.indexOf(this._storedIds,a);if(!this._options.autoUpload&&c>=0){this._storedIds.splice(c,1)}},_isDeletePossible:function(){return(this._options.deleteFile.enabled&&(!this._options.cors.expected||qq.supportedFeatures.deleteFileCors))},_onSubmitDelete:function(a){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(a)!==false){this._deleteHandler.sendDelete(a,this.getUuid(a))}}else{this.log("Delete request ignored for ID "+a+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onDelete:function(a){},_onDeleteComplete:function(a,d,b){var c=this._handler.getName(a);if(b){this.log("Delete request for '"+c+"' has failed.","error");this._options.callbacks.onError(a,c,"Delete request failed with response code "+d.status,d)}else{this._netUploadedOrQueued--;this._netUploaded--;this.log("Delete request for '"+c+"' has succeeded.")}},_removeFromFilesInProgress:function(a){var b=qq.indexOf(this._filesInProgress,a);if(b>=0){this._filesInProgress.splice(b,1)}},_onUpload:function(a,b){},_onInputChange:function(a){if(qq.supportedFeatures.ajaxUploading){this.addFiles(a.files)}else{this.addFiles(a)}this._button.reset()},_onBeforeAutoRetry:function(a,b){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+b+"...")},_onAutoRetry:function(a,b,c){this.log("Retrying "+b+"...");this._autoRetries[a]++;this._handler.retry(a)},_shouldAutoRetry:function(a,b,c){if(!this._preventRetries[a]&&this._options.retry.enableAuto){if(this._autoRetries[a]===undefined){this._autoRetries[a]=0}return this._autoRetries[a]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(b){var c=this._options.validation.itemLimit;if(this._preventRetries[b]){this.log("Retries are forbidden for id "+b,"warn");return false}else{if(this._handler.isValid(b)){var a=this._handler.getName(b);if(this._options.callbacks.onManualRetry(b,a)===false){return false}if(c>0&&this._netUploadedOrQueued+1>c){this._itemError("retryFailTooManyItems","");return false}this.log("Retrying upload for '"+a+"' (id: "+b+")...");this._filesInProgress.push(b);return true}else{this.log("'"+b+"' is not a valid file ID","error");return false}}},_maybeParseAndSendUploadError:function(b,c,d,e){if(!d.success){if(e&&e.status!==200&&!d.error){this._options.callbacks.onError(b,c,"XHR returned response code "+e.status,e)}else{var a=d.error?d.error:this._options.text.defaultResponseError;this._options.callbacks.onError(b,c,a,e)}}},_uploadFileOrBlobDataList:function(c,e,b){var d,f=this._getValidationDescriptors(c),a=this._isBatchValid(f);if(a){if(c.length>0){for(d=0;d<c.length;d++){if(this._validateFileOrBlobData(c[d])){this._upload(c[d],e,b)}else{if(this._options.validation.stopOnFirstInvalidFile){return}}}}else{this._itemError("noFilesError","")}}},_upload:function(a,e,b){var c=this._handler.add(a);var d=this._handler.getName(c);if(e){this.setParams(e,c)}if(b){this.setEndpoint(b,c)}if(this._options.callbacks.onSubmit(c,d)!==false){this._onSubmit(c,d);this._options.callbacks.onSubmitted(c,d);if(this._options.autoUpload){this._handler.upload(c)}else{this._storeForLater(c)}}},_storeForLater:function(a){this._storedIds.push(a)},_isBatchValid:function(e){var b,c=this._options.validation.itemLimit,d=this._netUploadedOrQueued+e.length,a=this._options.callbacks.onValidateBatch(e)!==false;if(a){if(c===0||d<=c){a=true}else{a=false;b=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,d).replace(/\{itemLimit\}/g,c);this._batchError(b)}}return a},_validateFileOrBlobData:function(a){var d,b,c;d=this._getValidationDescriptor(a);b=d.name;c=d.size;if(this._options.callbacks.onValidate(d)===false){return false}if(qq.isFileOrInput(a)&&!this._isAllowedExtension(b)){this._itemError("typeError",b);return false}else{if(c===0){this._itemError("emptyError",b);return false}else{if(c&&this._options.validation.sizeLimit&&c>this._options.validation.sizeLimit){this._itemError("sizeError",b);return false}else{if(c&&c<this._options.validation.minSizeLimit){this._itemError("minSizeError",b);return false}}}}return true},_itemError:function(b,f){var d=this._options.messages[b],a=[],g=[].concat(f),e=g[0],c,h;function i(j,k){d=d.replace(j,k)}qq.each(this._options.validation.allowedExtensions,function(k,j){if(qq.isString(j)){a.push(j)}});c=a.join(", ").toLowerCase();i("{file}",this._options.formatFileName(e));i("{extensions}",c);i("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit));i("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit));h=d.match(/(\{\w+\})/g);if(h!==null){qq.each(h,function(j,k){i(k,g[j])})}this._options.callbacks.onError(null,e,d);return d},_batchError:function(a){this._options.callbacks.onError(null,null,a)},_isAllowedExtension:function(b){var a=this._options.validation.allowedExtensions,c=false;if(!a.length){return true}qq.each(a,function(f,d){if(qq.isString(d)){var e=new RegExp("\\."+d+"$","i");if(b.match(e)!=null){c=true;return false}}});return c},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+this._options.text.sizeSymbols[b]},_wrapCallbacks:function(){var c,b;c=this;b=function(g,e,d){try{return e.apply(c,d)}catch(f){c.log("Caught exception in '"+g+"' callback - "+f.message,"error")}};for(var a in this._options.callbacks){(function(){var e,d;e=a;d=c._options.callbacks[e];c._options.callbacks[e]=function(){return b(e,d,arguments)}}())}},_parseFileOrBlobDataName:function(a){var b;if(qq.isFileOrInput(a)){if(a.value){b=a.value.replace(/.*(\/|\\)/,"")}else{b=(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name}}else{b=a.name}return b},_parseFileOrBlobDataSize:function(a){var b;if(qq.isFileOrInput(a)){if(!a.value){b=(a.fileSize!==null&&a.fileSize!==undefined)?a.fileSize:a.size}}else{b=a.blob.size}return b},_getValidationDescriptor:function(b){var c,d,a;a={};c=this._parseFileOrBlobDataName(b);d=this._parseFileOrBlobDataSize(b);a.name=c;if(d!==undefined){a.size=d}return a},_getValidationDescriptors:function(b){var c=this,a=[];qq.each(b,function(e,d){a.push(c._getValidationDescriptor(d))});return a},_createParamsStore:function(c){var a={},b=this;return{setParams:function(e,d){var f={};qq.extend(f,e);a[d]=f},getParams:function(d){var e={};if(d!=null&&a[d]){qq.extend(e,a[d])}else{qq.extend(e,b._options[c].params)}return e},remove:function(d){return delete a[d]},reset:function(){a={}}}},_createEndpointStore:function(c){var a={},b=this;return{setEndpoint:function(d,e){a[e]=d},getEndpoint:function(d){if(d!=null&&a[d]){return a[d]}return b._options[c].endpoint},remove:function(d){return delete a[d]},reset:function(){a={}}}}};qq.DragAndDrop=function(f){var g,c,b=[],a=new qq.DisposeSupport();g={dropZoneElements:[],hideDropZonesBeforeEnter:false,allowMultipleItems:true,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks()};qq.extend(g,f,true);h();function k(l){g.callbacks.dropLog("Grabbed "+l.length+" dropped files.");c.dropDisabled(false);g.callbacks.processingDroppedFilesComplete(l)}function j(m){var l,n,o=new qq.Promise();if(m.isFile){m.file(function(p){b.push(p);o.success()},function(p){g.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+p.code+".","error");o.failure()})}else{if(m.isDirectory){l=m.createReader();l.readEntries(function(p){var q=p.length;for(n=0;n<p.length;n+=1){j(p[n]).done(function(){q-=1;if(q===0){o.success()}})}if(!p.length){o.success()}},function(p){g.callbacks.dropLog("Problem parsing '"+m.fullPath+"'.  FileError code "+p.code+".","error");o.failure()})}}return o}function d(l){var o,p,m,q=[],n=new qq.Promise();g.callbacks.processingDroppedFiles();c.dropDisabled(true);if(l.files.length>1&&!g.allowMultipleItems){g.callbacks.processingDroppedFilesComplete([]);g.callbacks.dropError("tooManyFilesError","");c.dropDisabled(false);n.failure()}else{b=[];if(qq.isFolderDropSupported(l)){p=l.items;for(o=0;o<p.length;o+=1){m=p[o].webkitGetAsEntry();if(m){if(m.isFile){b.push(p[o].getAsFile())}else{q.push(j(m).done(function(){q.pop();if(q.length===0){n.success()}}))}}}}else{b=l.files}if(q.length===0){n.success()}}return n}function i(l){c=new qq.UploadDropZone({element:l,onEnter:function(m){qq(l).addClass(g.classes.dropActive);m.stopPropagation()},onLeaveNotDescendants:function(m){qq(l).removeClass(g.classes.dropActive)},onDrop:function(m){if(g.hideDropZonesBeforeEnter){qq(l).hide()}qq(l).removeClass(g.classes.dropActive);d(m.dataTransfer).done(function(){k(b)})}});a.addDisposer(function(){c.dispose()});if(g.hideDropZonesBeforeEnter){qq(l).hide()}}function e(l){var m;qq.each(l.dataTransfer.types,function(n,o){if(o==="Files"){m=true;return false}});return m}function h(){var l=g.dropZoneElements;qq.each(l,function(n,m){i(m)});if(l.length&&(!qq.ie()||qq.ie10())){a.attach(document,"dragenter",function(m){if(!c.dropDisabled()&&e(m)){qq.each(l,function(o,n){qq(n).css({display:"block"})})}})}a.attach(document,"dragleave",function(m){if(g.hideDropZonesBeforeEnter&&qq.FineUploader.prototype._leaving_document_out(m)){qq.each(l,function(o,n){qq(n).hide()})}});a.attach(document,"drop",function(m){if(g.hideDropZonesBeforeEnter){qq.each(l,function(o,n){qq(n).hide()})}m.preventDefault()})}return{setupExtraDropzone:function(l){g.dropZoneElements.push(l);i(l)},removeDropzone:function(m){var n,l=g.dropZoneElements;for(n in l){if(l[n]===m){return l.splice(n,1)}}},dispose:function(){a.dispose();c.dispose()}}};qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(a){},dropError:function(a,b){qq.log("Drag & drop error code '"+a+" with these specifics: '"+b+"'","error")},dropLog:function(b,a){qq.log(b,a)}}};qq.UploadDropZone=function(i){var j,f,k,e,c=new qq.DisposeSupport();j={element:null,onEnter:function(l){},onLeave:function(l){},onLeaveNotDescendants:function(l){},onDrop:function(l){}};qq.extend(j,i);f=j.element;function d(){return qq.safari()||(qq.firefox()&&qq.windows())}function b(l){if(!e){if(d){c.attach(document,"dragover",function(m){m.preventDefault()})}else{c.attach(document,"dragover",function(m){if(m.dataTransfer){m.dataTransfer.dropEffect="none";m.preventDefault()}})}e=true}}function h(m){if(qq.ie()&&!qq.ie10()){return false}var n,l=m.dataTransfer,o=qq.safari();n=qq.ie10()?true:l.effectAllowed!=="none";return l&&n&&(l.files||(!o&&l.types.contains&&l.types.contains("Files")))}function g(l){if(l!==undefined){k=l}return k}function a(){c.attach(f,"dragover",function(l){if(!h(l)){return}var m=qq.ie()?null:l.dataTransfer.effectAllowed;if(m==="move"||m==="linkMove"){l.dataTransfer.dropEffect="move"}else{l.dataTransfer.dropEffect="copy"}l.stopPropagation();l.preventDefault()});c.attach(f,"dragenter",function(l){if(!g()){if(!h(l)){return}j.onEnter(l)}});c.attach(f,"dragleave",function(l){if(!h(l)){return}j.onLeave(l);var m=document.elementFromPoint(l.clientX,l.clientY);if(qq(this).contains(m)){return}j.onLeaveNotDescendants(l)});c.attach(f,"drop",function(l){if(!g()){if(!h(l)){return}l.preventDefault();j.onDrop(l)}})}b();a();return{dropDisabled:function(l){return g(l)},dispose:function(){c.dispose()}}};qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",deleteButton:"Delete",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>':"")+(!this._options.button?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':"")+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':"")+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><a class="qq-upload-retry" href="#">{retryButtonText}</a><a class="qq-upload-delete" href="#">{deleteButtonText}</a><span class="qq-upload-status-text">{statusText}</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},deleteFile:{forceConfirm:false,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:false},paste:{promptForName:false,namePromptMessage:"Please name this image"},showMessage:function(b){setTimeout(function(){window.alert(b)},0)},showConfirm:function(c,d,b){setTimeout(function(){var e=window.confirm(c);if(e){d()}else{if(b){b()}}},0)},showPrompt:function(c,b){var d=new qq.Promise(),e=window.prompt(c,b);if(e!=null&&qq.trimStr(e).length>0){d.success(e)}else{d.failure("Undefined or invalid user-supplied value.")}return d}},true);qq.extend(this._options,a,true);if(!qq.supportedFeatures.uploading||(this._options.cors.expected&&!qq.supportedFeatures.uploadCors)){this._options.element.innerHTML="<div>"+this._options.messages.unsupportedBrowser+"</div>"}else{this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd=this._setupDragAndDrop();if(this._options.paste.targetElement&&this._options.paste.promptForName){this._setupPastePrompt()}}};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._dnd.setupExtraDropzone(a)},removeExtraDropzone:function(a){return this._dnd.removeDropzone(a)},getItemByFileId:function(a){var b=this._listElement.firstChild;while(b){if(b.qqFileId==a){return b}b=b.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");if(!this._options.button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd.dispose();this._dnd=this._setupDragAndDrop()},_removeFileItem:function(a){var b=this.getItemByFileId(a);qq(b).remove()},_setupDragAndDrop:function(){var d=this,a=this._find(this._element,"dropProcessing"),b=this._options.dragAndDrop.extraDropzones,c;c=function(e){e.preventDefault()};if(!this._options.dragAndDrop.disableDefaultDropzone){b.push(this._find(this._options.element,"drop"))}return new qq.DragAndDrop({dropZoneElements:b,hideDropZonesBeforeEnter:this._options.dragAndDrop.hideDropzones,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){var e=d._button.getInput();qq(a).css({display:"block"});qq(e).attach("click",c)},processingDroppedFilesComplete:function(e){var f=d._button.getInput();qq(a).hide();qq(f).detach("click",c);if(e){d.addFiles(e)}},dropError:function(e,f){d._itemError(e,f)},dropLog:function(f,e){d.log(f,e)}}})},_leaving_document_out:function(a){return((qq.chrome()||(qq.safari()&&qq.windows()))&&a.clientX==0&&a.clientY==0)||(qq.firefox()&&!a.relatedTarget)},_storeForLater:function(a){qq.FineUploaderBasic.prototype._storeForLater.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"spinner")).hide()},_find:function(b,c){var a=qq(b).getByClass(this._options.classes[c])[0];if(!a){throw new Error("element not found "+c)}return a},_onSubmit:function(a,b){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(a,b)},_onProgress:function(b,e,d,h){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var c,g,f,a;c=this.getItemByFileId(b);g=this._find(c,"progressBar");f=Math.round(d/h*100);if(d===h){a=this._find(c,"cancel");qq(a).hide();qq(g).hide();qq(this._find(c,"statusText")).setText(this._options.text.waitingForResponse);this._displayFileSize(b)}else{this._displayFileSize(b,d,h);qq(g).css({display:"block"})}qq(g).css({width:f+"%"})},_onComplete:function(a,c,d,e){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"statusText")).clearText();qq(b).removeClass(this._classes.retrying);qq(this._find(b,"progressBar")).hide();if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){qq(this._find(b,"cancel")).hide()}qq(this._find(b,"spinner")).hide();if(d.success){if(this._isDeletePossible()){this._showDeleteLink(a)}qq(b).addClass(this._classes.success);if(this._classes.successIcon){this._find(b,"finished").style.display="inline-block";qq(b).addClass(this._classes.successIcon)}}else{qq(b).addClass(this._classes.fail);if(this._classes.failIcon){this._find(b,"finished").style.display="inline-block";qq(b).addClass(this._classes.failIcon)}if(this._options.retry.showButton&&!this._preventRetries[a]){qq(b).addClass(this._classes.retryable)}this._controlFailureTextDisplay(b,d)}},_onUpload:function(a,b){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);this._showSpinner(a)},_onCancel:function(a,b){qq.FineUploaderBasic.prototype._onCancel.apply(this,arguments);this._removeFileItem(a)},_onBeforeAutoRetry:function(b){var c,e,a,g,d,f;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);c=this.getItemByFileId(b);e=this._find(c,"progressBar");this._showCancelLink(c);e.style.width=0;qq(e).hide();if(this._options.retry.showAutoRetryNote){a=this._find(c,"statusText");g=this._autoRetries[b]+1;d=this._options.retry.maxAutoAttempts;f=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,g);f=f.replace(/\{maxAuto\}/g,d);qq(a).setText(f);if(g===1){qq(c).addClass(this._classes.retrying)}}},_onBeforeManualRetry:function(a){var b=this.getItemByFileId(a);if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){this._find(b,"progressBar").style.width=0;qq(b).removeClass(this._classes.fail);qq(this._find(b,"statusText")).clearText();this._showSpinner(a);this._showCancelLink(b);return true}else{qq(b).addClass(this._classes.retryable);return false}},_onSubmitDelete:function(a){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(a)!==false){if(this._options.deleteFile.forceConfirm){this._showDeleteConfirm(a)}else{this._sendDeleteRequest(a)}}}else{this.log("Delete request ignored for file ID "+a+", delete feature is disabled.","warn");return false}},_onDeleteComplete:function(a,f,b){qq.FineUploaderBasic.prototype._onDeleteComplete.apply(this,arguments);var c=this.getItemByFileId(a),d=this._find(c,"spinner"),e=this._find(c,"statusText");qq(d).hide();if(b){qq(e).setText(this._options.deleteFile.deletingFailedText);this._showDeleteLink(a)}else{this._removeFileItem(a)}},_sendDeleteRequest:function(b){var c=this.getItemByFileId(b),a=this._find(c,"deleteButton"),d=this._find(c,"statusText");qq(a).hide();this._showSpinner(b);qq(d).setText(this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete(b,this.getUuid(b))},_showDeleteConfirm:function(c){var b=this._handler.getName(c),a=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,b),e=this.getUuid(c),d=this;this._options.showConfirm(a,function(){d._sendDeleteRequest(c)})},_addToList:function(c,e){var d=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading){var a=this._find(d,"cancel");qq(a).remove()}d.qqFileId=c;var b=this._find(d,"file");qq(b).setText(this._options.formatFileName(e));qq(this._find(d,"size")).hide();if(!this._options.multiple){this._handler.cancelAll();this._clearList()}this._listElement.appendChild(d);if(this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading){this._displayFileSize(c)}},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_displayFileSize:function(a,c,g){var b=this.getItemByFileId(a),d=this.getSize(a),f=this._formatSize(d),e=this._find(b,"size");if(c!==undefined&&g!==undefined){f=this._formatProgress(c,g)}qq(e).css({display:"inline"});qq(e).setText(f)},_bindCancelAndRetryEvents:function(){var b=this,a=this._listElement;this._disposeSupport.attach(a,"click",function(c){c=c||window.event;var f=c.target||c.srcElement;if(qq(f).hasClass(b._classes.cancel)||qq(f).hasClass(b._classes.retry)||qq(f).hasClass(b._classes.deleteButton)){qq.preventDefault(c);var d=f.parentNode;while(d.qqFileId===undefined){d=d.parentNode}if(qq(f).hasClass(b._classes.deleteButton)){b.deleteFile(d.qqFileId)}else{if(qq(f).hasClass(b._classes.cancel)){b.cancel(d.qqFileId)}else{qq(d).removeClass(b._classes.retryable);b.retry(d.qqFileId)}}}})},_formatProgress:function(d,c){var a=this._options.text.formatProgress;function b(e,f){a=a.replace(e,f)}b("{percent}",Math.round(d/c*100));b("{total_size}",this._formatSize(c));return a},_controlFailureTextDisplay:function(b,e){var d,c,f,a,g;d=this._options.failedUploadTextDisplay.mode;c=this._options.failedUploadTextDisplay.maxChars;f=this._options.failedUploadTextDisplay.responseProperty;if(d==="custom"){a=e[f];if(a){if(a.length>c){g=a.substring(0,c)+"..."}}else{a=this._options.text.failUpload;this.log("'"+f+"' is not a valid property on the server response.","warn")}qq(this._find(b,"statusText")).setText(g||a);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(b,a)}}else{if(d==="default"){qq(this._find(b,"statusText")).setText(this._options.text.failUpload)}else{if(d!=="none"){this.log("failedUploadTextDisplay.mode value of '"+d+"' is not valid","warn")}}}},_showTooltip:function(a,b){a.title=b},_showSpinner:function(a){var b=this.getItemByFileId(a),c=this._find(b,"spinner");c.style.display="inline-block"},_showCancelLink:function(b){if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){var a=this._find(b,"cancel");qq(a).css({display:"inline"})}},_showDeleteLink:function(b){var c=this.getItemByFileId(b),a=this._find(c,"deleteButton");qq(a).css({display:"inline"})},_itemError:function(a,c){var b=qq.FineUploaderBasic.prototype._itemError.apply(this,arguments);this._options.showMessage(b)},_batchError:function(a){qq.FineUploaderBasic.prototype._batchError.apply(this,arguments);this._options.showMessage(a)},_setupPastePrompt:function(){var a=this;this._options.callbacks.onPasteReceived=function(){var c=a._options.paste.namePromptMessage,b=a._options.paste.defaultName;return a._options.showPrompt(c,b)}}});qq.AjaxRequestor=function(h){var g,p,k=[],l=[],j={method:"POST",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},successfulResponseCodes:[200],demoMode:false,cors:{expected:false,sendCredentials:false},log:function(q,o){},onSend:function(o){},onComplete:function(o,r,q){},onCancel:function(o){}};qq.extend(j,h);g=j.log;p=d()==="GET"||d()==="DELETE";function c(q){var o=qq.indexOf(k,q),r=j.maxConnections,s;delete l[q];k.splice(o,1);if(k.length>=r&&o<r){s=k[r-1];m(s)}}function i(o){var s=l[o].xhr,r=d(),q=false;c(o);if(!f(s.status)){q=true;g(r+" request for "+o+" has failed - response code "+s.status,"error")}j.onComplete(o,s,q)}function m(o){var t=new XMLHttpRequest(),q=d(),r={},s;j.onSend(o);if(j.paramsStore.getParams){r=j.paramsStore.getParams(o)}s=b(o,r);l[o].xhr=t;t.onreadystatechange=e(o);t.open(q,s,true);if(j.cors.expected&&j.cors.sendCredentials){t.withCredentials=true}n(o);g("Sending "+q+" request for "+o);if(!p&&r){t.send(qq.obj2url(r,""))}else{t.send()}}function b(r,s){var q=j.endpointStore.getEndpoint(r),o=l[r].addToPath;if(o!==undefined){q+="/"+o}if(p&&s){return qq.obj2url(s,q)}else{return q}}function e(o){var q=l[o].xhr;return function(){if(q.readyState===4){i(o,q)}}}function n(q){var r=l[q].xhr,o=j.customHeaders;r.setRequestHeader("X-Requested-With","XMLHttpRequest");r.setRequestHeader("Cache-Control","no-cache");qq.each(o,function(s,t){r.setRequestHeader(s,t)})}function a(o){var r=l[o].xhr,q=d();if(r){r.onreadystatechange=null;r.abort();c(o);g("Cancelled "+q+" for "+o);j.onCancel(o);return true}return false}function f(o){return qq.indexOf(j.successfulResponseCodes,o)>=0}function d(){if(j.demoMode){return"GET"}return j.method}return{send:function(q,o){l[q]={addToPath:o};var r=k.push(q);if(r<=j.maxConnections){m(q)}},cancel:function(o){return a(o)}}};qq.DeleteFileAjaxRequestor=function(a){var c,b={endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:false,cors:{expected:false,sendCredentials:false},log:function(e,d){},onDelete:function(d){},onDeleteComplete:function(d,f,e){}};qq.extend(b,a);c=new qq.AjaxRequestor({method:"DELETE",endpointStore:b.endpointStore,paramsStore:b.paramsStore,maxConnections:b.maxConnections,customHeaders:b.customHeaders,successfulResponseCodes:[200,202,204],demoMode:b.demoMode,log:b.log,onSend:b.onDelete,onComplete:b.onDeleteComplete});return{sendDelete:function(d,e){c.send(d,e);b.log("Submitted delete file request for "+d)}}};qq.WindowReceiveMessage=function(b){var c={log:function(e,d){}},a={};qq.extend(c,b);return{receiveMessage:function(e,d){var f=function(g){d(g.data)};if(window.postMessage){a[e]=qq(window).attach("message",f)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var d=a[e];if(d){d()}}}}};qq.UploadHandler=function(d){var f=[],e,c,a,b;e={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},cors:{expected:false,sendCredentials:false},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:false,partSize:2000000,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},blobs:{paramNames:{name:"qqblobname"}},log:function(h,g){},onProgress:function(h,g,i,j){},onComplete:function(h,g,i,j){},onCancel:function(h,g){},onUpload:function(h,g){},onUploadChunk:function(i,h,g){},onAutoRetry:function(h,g,i,j){},onResume:function(i,h,g){}};qq.extend(e,d);c=e.log;a=function(h){var g=qq.indexOf(f,h),j=e.maxConnections,k;if(g>=0){f.splice(g,1);if(f.length>=j&&g<j){k=f[j-1];b.upload(k)}}};if(qq.supportedFeatures.ajaxUploading){b=new qq.UploadHandlerXhr(e,a,c)}else{b=new qq.UploadHandlerForm(e,a,c)}return{add:function(g){return b.add(g)},upload:function(g){var h=f.push(g);if(h<=e.maxConnections){return b.upload(g)}},retry:function(h){var g=qq.indexOf(f,h);if(g>=0){return b.upload(h,true)}else{return this.upload(h)}},cancel:function(g){c("Cancelling "+g);e.paramsStore.remove(g);b.cancel(g);a(g)},cancelAll:function(){var h=this,g=[];qq.extend(g,f);qq.each(g,function(j,i){h.cancel(i)});f=[]},getName:function(g){return b.getName(g)},getSize:function(g){if(b.getSize){return b.getSize(g)}},getFile:function(g){if(b.getFile){return b.getFile(g)}},getQueue:function(){return f},reset:function(){c("Resetting upload handler");f=[];b.reset()},getUuid:function(g){return b.getUuid(g)},isValid:function(g){return b.isValid(g)},getResumableFilesData:function(){if(b.getResumableFilesData){return b.getResumableFilesData()}return[]}}};qq.UploadHandlerForm=function(l,s,k){var n=l,i=[],t=[],g={},p={},r=s,j=k,c=new qq.WindowReceiveMessage({log:j}),m={},a;function f(o){if(g[o]!==undefined){g[o]();delete g[o]}}function q(v,o){var u=v.id;m[t[u]]=o;g[u]=qq(v).attach("load",function(){if(i[u]){j("Received iframe load event for CORS upload request (file id "+u+")");p[u]=setTimeout(function(){var w="No valid message received from loaded iframe for file id "+u;j(w,"error");o({error:w})},1000)}});c.receiveMessage(u,function(w){j("Received the following window message: '"+w+"'");var y=qq.parseJson(w),z=y.uuid,x;if(z&&m[z]){clearTimeout(p[u]);delete p[u];f(u);x=m[z];delete m[z];c.stopReceivingMessages(u);x(y)}else{if(!z){j("'"+w+"' does not contain a UUID - ignoring.")}}})}function b(u,o){if(n.cors.expected){q(u,o)}else{g[u.id]=qq(u).attach("load",function(){j("Received response for "+u.id);if(!u.parentNode){return}try{if(u.contentDocument&&u.contentDocument.body&&u.contentDocument.body.innerHTML=="false"){return}}catch(v){j("Error when attempting to access iframe during handling of upload response ("+v+")","error")}o()})}}function h(v){var x;try{var o=v.contentDocument||v.contentWindow.document,w=o.body.innerHTML;j("converting iframe's innerHTML to JSON");j("innerHTML = "+w);if(w&&w.match(/^<pre/i)){w=o.body.firstChild.firstChild.nodeValue}x=qq.parseJson(w)}catch(u){j("Error when attempting to parse form upload response ("+u+")","error");x={success:false}}return x}function e(o){var u=qq.toElement('<iframe src="javascript:false;" name="'+o+'" />');u.setAttribute("id",o);u.style.display="none";document.body.appendChild(u);return u}function d(v,w){var x=n.paramsStore.getParams(v),y=n.demoMode?"GET":"POST",u=qq.toElement('<form method="'+y+'" enctype="multipart/form-data"></form>'),o=n.endpointStore.getEndpoint(v),z=o;x[n.uuidParamName]=t[v];if(!n.paramsInBody){z=qq.obj2url(x,o)}else{qq.obj2Inputs(x,u)}u.setAttribute("action",z);u.setAttribute("target",w.name);u.style.display="none";document.body.appendChild(u);return u}a={add:function(o){o.setAttribute("name",n.inputName);var u=i.push(o)-1;t[u]=qq.getUniqueId();if(o.parentNode){qq(o).remove()}return u},getName:function(o){if(a.isValid(o)){return i[o].value.replace(/.*(\/|\\)/,"")}else{j(o+" is not a valid item ID.","error")}},isValid:function(o){return i[o]!==undefined},reset:function(){i=[];t=[];g={}},getUuid:function(o){return t[o]},cancel:function(o){n.onCancel(o,this.getName(o));delete i[o];delete t[o];delete g[o];if(n.cors.expected){clearTimeout(p[o]);delete p[o];c.stopReceivingMessages(o)}var u=GetGlobalById(o);if(u){u.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;");qq(u).remove()}},upload:function(v){var x=i[v],o=a.getName(v),w=e(v),u;if(!x){throw new Error("file with passed id was not added, or already uploaded or cancelled")}n.onUpload(v,this.getName(v));u=d(v,w);u.appendChild(x);b(w,function(z){j("iframe loaded");var y=z?z:h(w);f(v);if(!n.cors.expected){qq(w).remove()}if(!y.success){if(n.onAutoRetry(v,o,y)){return}}n.onComplete(v,o,y);r(v)});j("Sending upload request for "+v);u.submit();qq(u).remove();return v}};return a};qq.UploadHandlerXhr=function(E,O,C){var G=E,N=O,B=C,i=[],f="|",e=G.chunking.enabled&&qq.supportedFeatures.chunking,J=G.resume.enabled&&e&&qq.supportedFeatures.resume,K=r(),D=G.forceMultipart||G.paramsInBody,c;function a(Q,S,o){var T=c.getSize(Q),R=c.getName(Q);S[G.chunking.paramNames.partIndex]=o.part;S[G.chunking.paramNames.partByteOffset]=o.start;S[G.chunking.paramNames.chunkSize]=o.size;S[G.chunking.paramNames.totalParts]=o.count;S[G.totalFileSizeParamName]=T;if(D){S[G.chunking.paramNames.filename]=R}}function b(o){o[G.resume.paramNames.resuming]=true}function j(Q,R,o){if(Q.slice){return Q.slice(R,o)}else{if(Q.mozSlice){return Q.mozSlice(R,o)}else{if(Q.webkitSlice){return Q.webkitSlice(R,o)}}}}function k(U,o){var Q=G.chunking.partSize,T=c.getSize(U),S=i[U].file||i[U].blobData.blob,V=Q*o,R=V+Q>=T?T:V+Q,W=s(U);return{part:o,start:V,end:R,count:W,blob:j(S,V,R),size:R-V}}function s(R){var Q=c.getSize(R),o=G.chunking.partSize;return Math.ceil(Q/o)}function g(o){var Q=new XMLHttpRequest();i[o].xhr=Q;return Q}function M(W,Z,R,T){var S=new FormData(),U=G.demoMode?"GET":"POST",Q=G.endpointStore.getEndpoint(T),Y=Q,V=c.getName(T),X=c.getSize(T),o=i[T].blobData;W[G.uuidParamName]=i[T].uuid;if(D){W[G.totalFileSizeParamName]=X;if(o){W[G.blobs.paramNames.name]=o.name}}if(!G.paramsInBody){if(!D){W[G.inputName]=V}Y=qq.obj2url(W,Q)}Z.open(U,Y,true);if(G.cors.expected&&G.cors.sendCredentials){Z.withCredentials=true}if(D){if(G.paramsInBody){qq.obj2FormData(W,S)}S.append(G.inputName,R);return S}return R}function L(R,S){var o=G.customHeaders,Q=i[R].file||i[R].blobData.blob;S.setRequestHeader("X-Requested-With","XMLHttpRequest");S.setRequestHeader("Cache-Control","no-cache");if(!D){S.setRequestHeader("Content-Type","application/octet-stream");S.setRequestHeader("X-Mime-Type",Q.type)}qq.each(o,function(T,U){S.setRequestHeader(T,U)})}function t(o,R,T){var Q=c.getName(o),S=c.getSize(o);i[o].attemptingResume=false;G.onProgress(o,Q,S,S);G.onComplete(o,Q,R,T);delete i[o].xhr;N(o)}function P(R){var Q=i[R].remainingChunkIdxs[0],o=k(R,Q),W=g(R),U=c.getSize(R),S=c.getName(R),V,T;if(i[R].loaded===undefined){i[R].loaded=0}if(J&&i[R].file){I(R,o)}W.onreadystatechange=q(R,W);W.upload.onprogress=function(X){if(X.lengthComputable){var Z=X.loaded+i[R].loaded,Y=d(R,Q,X.total);G.onProgress(R,S,Z,Y)}};G.onUploadChunk(R,S,m(o));T=G.paramsStore.getParams(R);a(R,T,o);if(i[R].attemptingResume){b(T)}V=M(T,W,o.blob,R);L(R,W);B("Sending chunked upload request for item "+R+": bytes "+(o.start+1)+"-"+o.end+" of "+U);W.send(V)}function d(T,S,X){var R=k(T,S),o=R.size,V=X-o,Y=c.getSize(T),Q=R.count,U=i[T].initialRequestOverhead,W=V-U;i[T].lastRequestOverhead=V;if(S===0){i[T].lastChunkIdxProgress=0;i[T].initialRequestOverhead=V;i[T].estTotalRequestsSize=Y+(Q*V)}else{if(i[T].lastChunkIdxProgress!==S){i[T].lastChunkIdxProgress=S;i[T].estTotalRequestsSize+=W}}return i[T].estTotalRequestsSize}function n(o){if(D){return i[o].lastRequestOverhead}else{return 0}}function z(R,S,T){var Q=i[R].remainingChunkIdxs.shift(),o=k(R,Q);i[R].attemptingResume=false;i[R].loaded+=o.size+n(R);if(i[R].remainingChunkIdxs.length>0){P(R)}else{if(J){h(R)}t(R,S,T)}}function A(Q,o){return Q.status!==200||!o.success||o.reset}function H(R){var Q;try{Q=qq.parseJson(R.responseText)}catch(o){B("Error when attempting to parse xhr response text ("+o+")","error");Q={}}return Q}function w(o){B("Server has ordered chunking effort to be restarted on next attempt for item ID "+o,"error");if(J){h(o);i[o].attemptingResume=false}i[o].remainingChunkIdxs=[];delete i[o].loaded;delete i[o].estTotalRequestsSize;delete i[o].initialRequestOverhead}function x(o){i[o].attemptingResume=false;B("Server has declared that it cannot handle resume for item ID "+o+" - starting from the first chunk","error");w(o);c.upload(o,true)}function v(o,R,S){var Q=c.getName(o);if(G.onAutoRetry(o,Q,R,S)){return}else{t(o,R,S)}}function F(o,R){var Q;if(!i[o]){return}B("xhr - server response received for "+o);B("responseText = "+R.responseText);Q=H(R);if(A(R,Q)){if(Q.reset){w(o)}if(i[o].attemptingResume&&Q.reset){x(o)}else{v(o,Q,R)}}else{if(e){z(o,Q,R)}else{t(o,Q,R)}}}function m(o){return{partIndex:o.part,startByte:o.start+1,endByte:o.end,totalParts:o.count}}function q(o,Q){return function(){if(Q.readyState===4){F(o,Q)}}}function I(V,o){var U=c.getUuid(V),X=i[V].loaded,W=i[V].initialRequestOverhead,T=i[V].estTotalRequestsSize,R=l(V),S=U+f+o.part+f+X+f+W+f+T,Q=G.resume.cookiesExpireIn;qq.setCookie(R,S,Q)}function h(Q){if(i[Q].file){var o=l(Q);qq.deleteCookie(o)}}function p(S){var o=qq.getCookie(l(S)),R=c.getName(S),W,X,V,U,T,Q;if(o){W=o.split(f);if(W.length===5){X=W[0];V=parseInt(W[1],10);U=parseInt(W[2],10);T=parseInt(W[3],10);Q=parseInt(W[4],10);return{uuid:X,part:V,lastByteSent:U,initialRequestOverhead:T,estTotalRequestsSize:Q}}else{B("Ignoring previously stored resume/chunk cookie for "+R+" - old cookie format","warn")}}}function l(S){var Q=c.getName(S),R=c.getSize(S),T=G.chunking.partSize,o;o="qqfilechunk"+f+encodeURIComponent(Q)+f+R+f+T;if(K!==undefined){o+=f+K}return o}function r(){if(G.resume.id!==null&&G.resume.id!==undefined&&!qq.isFunction(G.resume.id)&&!qq.isObject(G.resume.id)){return G.resume.id}}function u(S,V){var T=c.getName(S),R=0,U,Q,o;if(!i[S].remainingChunkIdxs||i[S].remainingChunkIdxs.length===0){i[S].remainingChunkIdxs=[];if(J&&!V&&i[S].file){U=p(S);if(U){Q=k(S,U.part);if(G.onResume(S,T,m(Q))!==false){R=U.part;i[S].uuid=U.uuid;i[S].loaded=U.lastByteSent;i[S].estTotalRequestsSize=U.estTotalRequestsSize;i[S].initialRequestOverhead=U.initialRequestOverhead;i[S].attemptingResume=true;B("Resuming "+T+" at partition index "+R)}}}for(o=s(S)-1;o>=R;o-=1){i[S].remainingChunkIdxs.unshift(o)}}P(S)}function y(Q){var o=i[Q].file||i[Q].blobData.blob,R=c.getName(Q),U,S,T;i[Q].loaded=0;U=g(Q);U.upload.onprogress=function(V){if(V.lengthComputable){i[Q].loaded=V.loaded;G.onProgress(Q,R,V.loaded,V.total)}};U.onreadystatechange=q(Q,U);S=G.paramsStore.getParams(Q);T=M(S,U,o,Q);L(Q,U);B("Sending upload request for "+Q);U.send(T)}c={add:function(o){var Q;if(o instanceof File){Q=i.push({file:o})-1}else{if(qq.isBlob(o.blob)){Q=i.push({blobData:o})-1}else{throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)")}}i[Q].uuid=qq.getUniqueId();return Q},getName:function(R){if(c.isValid(R)){var Q=i[R].file,o=i[R].blobData;if(Q){return(Q.fileName!==null&&Q.fileName!==undefined)?Q.fileName:Q.name}else{return o.name}}else{B(R+" is not a valid item ID.","error")}},getSize:function(Q){var o=i[Q].file||i[Q].blobData.blob;if(qq.isFileOrInput(o)){return o.fileSize!=null?o.fileSize:o.size}else{return o.size}},getFile:function(o){if(i[o]){return i[o].file||i[o].blobData.blob}},getLoaded:function(o){return i[o].loaded||0},isValid:function(o){return i[o]!==undefined},reset:function(){i=[]},getUuid:function(o){return i[o].uuid},upload:function(o,R){var Q=this.getName(o);G.onUpload(o,Q);if(e){u(o,R)}else{y(o)}},cancel:function(o){var Q=i[o].xhr;G.onCancel(o,this.getName(o));if(Q){Q.onreadystatechange=null;Q.abort()}if(J){h(o)}delete i[o]},getResumableFilesData:function(){var o=[],Q=[];if(e&&J){if(K===undefined){o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+f+".+\\"+f+"\\d+\\"+f+G.chunking.partSize+"="))}else{o=qq.getCookieNames(new RegExp("^qqfilechunk\\"+f+".+\\"+f+"\\d+\\"+f+G.chunking.partSize+"\\"+f+K+"="))}qq.each(o,function(U,R){var S=R.split(f);var T=qq.getCookie(R).split(f);Q.push({name:decodeURIComponent(S[1]),size:S[2],uuid:T[0],partIdx:T[1]})});return Q}return[]}};return c};(function(a){var k,b,f,d,h,i,c,j,g,e;i=["uploaderType"];f=function(l){if(l){var m=j(l);c(m);if(h("uploaderType")==="basic"){k(new qq.FineUploaderBasic(m))}else{k(new qq.FineUploader(m))}}return b};d=function(m,n){var l=b.data("fineuploader");if(n){if(l===undefined){l={}}l[m]=n;b.data("fineuploader",l)}else{if(l===undefined){return null}return l[m]}};k=function(l){return d("uploader",l)};h=function(l,m){return d(l,m)};c=function(m){var l=m.callbacks={},n=new qq.FineUploaderBasic();a.each(n._options.callbacks,function(r,p){var q,o;q=/^on(\w+)/.exec(r)[1];q=q.substring(0,1).toLowerCase()+q.substring(1);o=b;l[r]=function(){var s=Array.prototype.slice.call(arguments);return o.triggerHandler(q,s)}})};j=function(n,m){var o,l;if(m===undefined){if(n.uploaderType!=="basic"){o={element:b[0]}}else{o={}}}else{o=m}a.each(n,function(p,q){if(a.inArray(p,i)>=0){h(p,q)}else{if(q instanceof a){o[p]=q[0]}else{if(a.isPlainObject(q)){o[p]={};j(q,o[p])}else{if(a.isArray(q)){l=[];a.each(q,function(s,r){if(r instanceof a){a.merge(l,r)}else{l.push(r)}});o[p]=l}else{o[p]=q}}}}});if(m===undefined){return o}};g=function(l){return a.type(l)==="string"&&!l.match(/^_/)&&k()[l]!==undefined};e=function(l){var n=[],m=Array.prototype.slice.call(arguments,1);j(m,n);return k()[l].apply(k(),n)};a.fn.fineUploader=function(l){var n=this,o=arguments,m=[];this.each(function(q,p){b=a(p);if(k()&&g(l)){m.push(e.apply(n,o));if(n.length===1){return false}}else{if(typeof l==="object"||!l){f.apply(n,o)}else{a.error("Method "+l+" does not exist on jQuery.fineUploader")}}});if(m.length===1){return m[0]}else{if(m.length>1){return m}}return this}}(jQuery));(function(a){var i="fineUploaderDnd",b;function g(k){if(!k){k={}}k.dropZoneElements=[b];var l=j(k);c(l);f(new qq.DragAndDrop(l));return b}function d(l,m){var k=b.data(i);if(m){if(k===undefined){k={}}k[l]=m;b.data(i,k)}else{if(k===undefined){return null}return k[l]}}function f(k){return d("dndInstance",k)}function c(m){var k=m.callbacks={},l=new qq.FineUploaderBasic();a.each(new qq.DragAndDrop.callbacks(),function(q,o){var p=q,n;n=b;k[q]=function(){var r=Array.prototype.slice.call(arguments),s=n.triggerHandler(p,r);return s}})}function j(m,l){var n,k;if(l===undefined){n={}}else{n=l}a.each(m,function(o,p){if(p instanceof a){n[o]=p[0]}else{if(a.isPlainObject(p)){n[o]={};j(p,n[o])}else{if(a.isArray(p)){k=[];a.each(p,function(r,q){if(q instanceof a){a.merge(k,q)}else{k.push(q)}});n[o]=k}else{n[o]=p}}}});if(l===undefined){return n}}function h(k){return a.type(k)==="string"&&k==="dispose"&&f()[k]!==undefined}function e(k){var m=[],l=Array.prototype.slice.call(arguments,1);j(l,m);return f()[k].apply(f(),m)}a.fn.fineUploaderDnd=function(k){var m=this,n=arguments,l=[];this.each(function(p,o){b=a(o);if(f()&&h(k)){l.push(e.apply(m,n));if(m.length===1){return false}}else{if(typeof k==="object"||!k){g.apply(m,n)}else{a.error("Method "+k+" does not exist in Fine Uploader's DnD module.")}}});if(l.length===1){return l[0]}else{if(l.length>1){return l}}return this}}(jQuery));(function(u,a,t){var d={beforeShow:l,move:l,change:l,show:l,hide:l,color:false,flat:false,showInput:false,showButtons:true,clickoutFiresChange:false,showInitial:false,showPalette:false,showPaletteOnly:false,showSelectionPalette:true,localStorageKey:false,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:false,className:"",showAlpha:false,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:false},q=[],h=!!/msie/i.exec(u.navigator.userAgent),o=(function(){function v(y,z){return !!~(""+y).indexOf(z)}var w=document.createElement("div");var x=w.style;x.cssText="background-color:rgba(0,0,0,.5)";return v(x.backgroundColor,"rgba")||v(x.backgroundColor,"hsla")})(),n=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),k=(function(){var v="";if(h){for(var w=1;w<=6;w++){v+="<div class='sp-"+w+"'></div>"}}return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",v,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")})();function m(A,x,w){var y=[];for(var z=0;z<A.length;z++){var C=tinycolor(A[z]);var v=C.toHsl().l<0.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";v+=(tinycolor.equals(x,A[z]))?" sp-thumb-active":"";var B=o?("background-color:"+C.toRgbString()):"filter:"+C.toFilter();y.push('<span title="'+C.toRgbString()+'" data-color="'+C.toRgbString()+'" class="'+v+'"><span class="sp-thumb-inner" style="'+B+';" /></span>')}return"<div class='sp-cf "+w+"'>"+y.join("")+"</div>"}function g(){for(var v=0;v<q.length;v++){if(q[v]){q[v].hide()}}}function i(w,v){var x=a.extend({},d,w);x.callbacks={move:b(x.move,v),change:b(x.change,v),show:b(x.show,v),hide:b(x.hide,v),beforeShow:b(x.beforeShow,v)};return x}function p(ad,ar){var av=i(ar,ad),af=av.flat,aL=av.showSelectionPalette,ao=av.localStorageKey,aT=av.theme,E=av.callbacks,aD=s(aB,10),aY=false,aa=0,V=0,X=0,aM=0,aQ=0,A=0,x=0,aO=0,L=0,N=0,O=0,K=1,aw=av.palette.slice(0),ax=a.isArray(aw[0])?aw:[aw],aF=av.selectionPalette.slice(0),ap=av.maxSelectionSize,U="sp-dragging",aI=null;var S=ad.ownerDocument,C=S.body,D=a(ad),R=false,J=a(k,S).addClass(aT),T=J.find(".sp-color"),W=J.find(".sp-dragger"),aP=J.find(".sp-hue"),aN=J.find(".sp-slider"),z=J.find(".sp-alpha-inner"),y=J.find(".sp-alpha"),w=J.find(".sp-alpha-handle"),aS=J.find(".sp-input"),ay=J.find(".sp-palette"),ak=J.find(".sp-initial"),F=J.find(".sp-cancel"),G=J.find(".sp-choose"),am=D.is("input"),aJ=am&&!af,aC=(aJ)?a(n).addClass(aT).addClass(av.className):a([]),at=(aJ)?aC:D,aA=aC.find(".sp-preview-inner"),aj=av.color||(am&&D.val()),I=false,az=av.preferredFormat,M=az,H=!av.showButtons||av.clickoutFiresChange;function B(){if(av.showPaletteOnly){av.showPalette=true}J.toggleClass("sp-flat",af);J.toggleClass("sp-input-disabled",!av.showInput);J.toggleClass("sp-alpha-enabled",av.showAlpha);J.toggleClass("sp-buttons-disabled",!av.showButtons);J.toggleClass("sp-palette-disabled",!av.showPalette);J.toggleClass("sp-palette-only",av.showPaletteOnly);J.toggleClass("sp-initial-disabled",!av.showInitial);J.addClass(av.className);aB()}function al(){if(h){J.find("*:not(input)").attr("unselectable","on")}B();if(aJ){D.after(aC).hide()}if(af){D.after(J).hide()}else{var aZ=av.appendTo==="parent"?D.parent():a(av.appendTo);if(aZ.length!==1){aZ=a("body")}aZ.append(J)}try{if(ao&&u.localStorage){try{var a1=u.localStorage[ao].split(",#");if(a1.length>1){delete u.localStorage[ao];a.each(a1,function(a5,a4){v(a4)})}}catch(a0){}try{aF=u.localStorage[ao].split(";")}catch(a0){}}}catch(a0){}at.bind("click.spectrum touchstart.spectrum",function(a4){if(!R){aU()}a4.stopPropagation();if(!a(a4.target).is("input")){a4.preventDefault()}});if(D.is(":disabled")||(av.disabled===true)){Q()}J.click(r);aS.change(aH);aS.bind("paste",function(){setTimeout(aH,1)});aS.keydown(function(a4){if(a4.keyCode==13){aH()}});F.text(av.cancelText);F.bind("click.spectrum",function(a4){a4.stopPropagation();a4.preventDefault();ai("cancel")});G.text(av.chooseText);G.bind("click.spectrum",function(a4){a4.stopPropagation();a4.preventDefault();if(an()){aW(true);ai()}});e(y,function(a4,a5,a6){K=(a4/A);if(a6.shiftKey){K=Math.round(K*10)/10}aq()});e(aP,function(a4,a5){L=parseFloat(a5/aM);aq()},Y,Z);e(T,function(a4,a5,a6){if(!a6.shiftKey){aI=null}else{if(!aI){var a8=N*aa;var a9=V-(O*V);var a7=Math.abs(a4-a8)>Math.abs(a5-a9);aI=a7?"x":"y"}}var ba=!aI||aI==="x";var bb=!aI||aI==="y";if(ba){N=parseFloat(a4/aa)}if(bb){O=parseFloat((V-a5)/V)}aq()},Y,Z);if(!!aj){aG(aj);aX();M=az||tinycolor(aj).format;v(aj)}else{aX()}if(af){aK()}function a3(a4){if(a4.data&&a4.data.ignore){aG(a(this).data("color"));aq()}else{aG(a(this).data("color"));aW(true);aq();ai()}return false}var a2=h?"mousedown.spectrum":"click.spectrum touchstart.spectrum";ay.delegate(".sp-thumb-el",a2,a3);ak.delegate(".sp-thumb-el:nth-child(1)",a2,{ignore:true},a3)}function v(aZ){if(aL){var a0=tinycolor(aZ).toRgbString();if(a.inArray(a0,aF)===-1){aF.push(a0);while(aF.length>ap){aF.shift()}}try{if(ao&&u.localStorage){u.localStorage[ao]=aF.join(";")}}catch(a1){}}}function ah(){var a4=[];var a1=aF;var a2={};var a3;if(av.showPalette){for(var aZ=0;aZ<ax.length;aZ++){for(var a0=0;a0<ax[aZ].length;a0++){a3=tinycolor(ax[aZ][a0]).toRgbString();a2[a3]=true}}for(aZ=0;aZ<a1.length;aZ++){a3=tinycolor(a1[aZ]).toRgbString();if(!a2.hasOwnProperty(a3)){a4.push(a1[aZ]);a2[a3]=true}}}return a4.reverse().slice(0,av.maxSelectionSize)}function ac(){var aZ=ag();var a0=a.map(ax,function(a2,a1){return m(a2,aZ,"sp-palette-row sp-palette-row-"+a1)});if(aF){a0.push(m(ah(),aZ,"sp-palette-row sp-palette-row-selection"))}ay.html(a0.join(""))}function ab(){if(av.showInitial){var a0=I;var aZ=ag();ak.html(m([a0,aZ],aZ,"sp-palette-row-initial"))}}function Y(){if(V<=0||aa<=0||aM<=0){aB()}J.addClass(U);aI=null}function Z(){J.removeClass(U)}function aH(){var aZ=tinycolor(aS.val());if(aZ.ok){aG(aZ)}else{aS.addClass("sp-validation-error")}}function aU(){if(aY){ai()}else{aK()}}function aK(){var aZ=a.Event("beforeShow.spectrum");if(aY){aB();return}D.trigger(aZ,[ag()]);if(E.beforeShow(ag())===false||aZ.isDefaultPrevented()){return}g();aY=true;a(S).bind("click.spectrum",ai);a(u).bind("resize.spectrum",aD);aC.addClass("sp-active");J.removeClass("sp-hidden");if(av.showPalette){ac()}aB();aX();I=ag();ab();E.show(I);D.trigger("show.spectrum",[I])}function ai(a0){if(a0&&a0.type=="click"&&a0.button==2){return}if(!aY||af){return}aY=false;a(S).unbind("click.spectrum",ai);a(u).unbind("resize.spectrum",aD);aC.removeClass("sp-active");J.addClass("sp-hidden");var aZ=!tinycolor.equals(ag(),I);if(aZ){if(H&&a0!=="cancel"){aW(true)}else{aE()}}E.hide(ag());D.trigger("hide.spectrum",[ag()])}function aE(){aG(I,true)}function aG(aZ,a0){if(tinycolor.equals(aZ,ag())){return}var a1=tinycolor(aZ);var a2=a1.toHsv();L=(a2.h%360)/360;N=a2.s;O=a2.v;K=a2.a;aX();if(a1.ok&&!a0){M=az||a1.format}}function ag(aZ){aZ=aZ||{};return tinycolor.fromRatio({h:L,s:N,v:O,a:Math.round(K*100)/100},{format:aZ.format||M})}function an(){return !aS.hasClass("sp-validation-error")}function aq(){aX();E.move(ag());D.trigger("move.spectrum",[ag()])}function aX(){aS.removeClass("sp-validation-error");aV();var aZ=tinycolor.fromRatio({h:L,s:1,v:1});T.css("background-color",aZ.toHexString());var a0=M;if(K<1){if(a0==="hex"||a0==="hex3"||a0==="hex6"||a0==="name"){a0="rgb"}}var a3=ag({format:a0}),a4=a3.toHexString(),a5=a3.toRgbString();if(o||a3.alpha===1){aA.css("background-color",a5)}else{aA.css("background-color","transparent");aA.css("filter",a3.toFilter())}if(av.showAlpha){var a6=a3.toRgb();a6.a=0;var a2=tinycolor(a6).toRgbString();var a1="linear-gradient(left, "+a2+", "+a4+")";if(h){z.css("filter",tinycolor(a2).toFilter({gradientType:1},a4))}else{z.css("background","-webkit-"+a1);z.css("background","-moz-"+a1);z.css("background","-ms-"+a1);z.css("background",a1)}}if(av.showInput){aS.val(a3.toString(a0))}if(av.showPalette){ac()}ab()}function aV(){var a2=N;var a4=O;var a0=a2*aa;var a1=V-(a4*V);a0=Math.max(-X,Math.min(aa-X,a0-X));a1=Math.max(-X,Math.min(V-X,a1-X));W.css({top:a1,left:a0});var aZ=K*A;w.css({left:aZ-(x/2)});var a3=(L)*aM;aN.css({top:a3-aO})}function aW(a0){var aZ=ag();if(am){D.val(aZ.toString(M))}var a1=!tinycolor.equals(aZ,I);I=aZ;v(aZ);if(a0&&a1){E.change(aZ);D.trigger("change",[aZ])}}function aB(){aa=T.width();V=T.height();X=W.height();aQ=aP.width();aM=aP.height();aO=aN.height();A=y.width();x=w.width();if(!af){J.css("position","absolute");J.offset(f(J,at))}aV()}function P(){D.show();at.unbind("click.spectrum touchstart.spectrum");J.remove();aC.remove();q[aR.id]=null}function au(aZ,a0){if(aZ===t){return a.extend({},av)}if(a0===t){return av[aZ]}av[aZ]=a0;B()}function ae(){R=false;D.attr("disabled",false);at.removeClass("sp-disabled")}function Q(){ai();R=true;D.attr("disabled",true);at.addClass("sp-disabled")}al();var aR={show:aK,hide:ai,toggle:aU,reflow:aB,option:au,enable:ae,disable:Q,set:function(aZ){aG(aZ);aW()},get:ag,destroy:P,container:J};aR.id=q.push(aR)-1;return aR}function f(D,A){var z=0;var y=D.outerWidth();var x=D.outerHeight();var B=A.outerHeight();var v=D[0].ownerDocument;var w=v.documentElement;var F=w.clientWidth+a(v).scrollLeft();var E=w.clientHeight+a(v).scrollTop();var C=A.offset();C.top+=B;C.left-=Math.min(C.left,(C.left+y>F&&F>y)?Math.abs(C.left+y-F):0);C.top-=Math.min(C.top,((C.top+x>E&&E>x)?Math.abs(x+B-z):z));return C}function l(){}function r(v){v.stopPropagation()}function b(w,x){var y=Array.prototype.slice;var v=y.call(arguments,2);return function(){return w.apply(x,v.concat(y.call(arguments)))}}function e(y,E,F,G){E=E||function(){};F=F||function(){};G=G||function(){};var v=y.ownerDocument||document;var w=false;var D={};var A=0;var B=0;var z=("ontouchstart" in u);var x={};x.selectstart=H;x.dragstart=H;x["touchmove mousemove"]=C;x["touchend mouseup"]=J;function H(K){if(K.stopPropagation){K.stopPropagation()}if(K.preventDefault){K.preventDefault()}K.returnValue=false}function C(M){if(w){if(h&&document.documentMode<9&&!M.button){return J()}var P=M.originalEvent.touches;var N=P?P[0].pageX:M.pageX;var O=P?P[0].pageY:M.pageY;var K=Math.max(0,Math.min(N-D.left,B));var L=Math.max(0,Math.min(O-D.top,A));if(z){H(M)}E.apply(y,[K,L,M])}}function I(K){var L=(K.which)?(K.which==3):(K.button==2);var M=K.originalEvent.touches;if(!L&&!w){if(F.apply(y,arguments)!==false){w=true;A=a(y).height();B=a(y).width();D=a(y).offset();a(v).bind(x);a(v.body).addClass("sp-dragging");if(!z){C(K)}H(K)}}}function J(){if(w){a(v).unbind(x);a(v.body).removeClass("sp-dragging");G.apply(y,arguments)}w=false}a(y).bind("touchstart mousedown",I)}function s(w,y,v){var x;return function(){var A=this,z=arguments;var B=function(){x=null;w.apply(A,z)};if(v){clearTimeout(x)}if(v||!x){x=setTimeout(B,y)}}}function j(){if(u.console){if(Function.prototype.bind){j=Function.prototype.bind.call(console.log,console)}else{j=function(){Function.prototype.apply.call(console.log,console,arguments)}}j.apply(this,arguments)}}var c="spectrum.id";a.fn.spectrum=function(x,w){if(typeof x=="string"){var y=this;var v=Array.prototype.slice.call(arguments,1);this.each(function(){var A=q[a(this).data(c)];if(A){var z=A[x];if(!z){throw new Error("Spectrum: no such method: '"+x+"'")}if(x=="get"){y=A.get()}else{if(x=="container"){y=A.container}else{if(x=="option"){y=A.option.apply(A,v)}else{if(x=="destroy"){A.destroy();a(this).removeData(c)}else{z.apply(A,v)}}}}}});return y}return this.spectrum("destroy").each(function(){var z=p(this,x);a(this).data(c,z.id)})};a.fn.spectrum.load=true;a.fn.spectrum.loadOpts={};a.fn.spectrum.draggable=e;a.fn.spectrum.defaults=d;a.spectrum={};a.spectrum.localization={};a.spectrum.palettes={};a.fn.spectrum.processNativeColorInputs=function(){var v=a("<input type='color' value='#ffffff' />")[0];var w=v.type==="color"&&v.value!="!";if(!w){a("input[type=color]").spectrum({preferredFormat:"hex6"})}};(function(){var W=/^[\s,#]+/,X=/\s+$/,V=0,H=Math,L=H.round,J=H.min,I=H.max,K=H.random;function U(aa,ad){aa=(aa)?aa:"";ad=ad||{};if(typeof aa=="object"&&aa.hasOwnProperty("_tc_id")){return aa}var af=D(aa);var ae=af.r,ac=af.g,Z=af.b,Y=af.a,ag=L(100*Y)/100,ab=ad.format||af.format;if(ae<1){ae=L(ae)}if(ac<1){ac=L(ac)}if(Z<1){Z=L(Z)}return{ok:af.ok,format:ab,_tc_id:V++,alpha:Y,getAlpha:function(){return Y},setAlpha:function(ah){Y=w(ah);ag=L(100*Y)/100},toHsv:function(){var ah=R(ae,ac,Z);return{h:ah.h*360,s:ah.s,v:ah.v,a:Y}},toHsvString:function(){var ai=R(ae,ac,Z);var ah=L(ai.h*360),aj=L(ai.s*100),ak=L(ai.v*100);return(Y==1)?"hsv("+ah+", "+aj+"%, "+ak+"%)":"hsva("+ah+", "+aj+"%, "+ak+"%, "+ag+")"},toHsl:function(){var ah=Q(ae,ac,Z);return{h:ah.h*360,s:ah.s,l:ah.l,a:Y}},toHslString:function(){var ai=Q(ae,ac,Z);var ah=L(ai.h*360),ak=L(ai.s*100),aj=L(ai.l*100);return(Y==1)?"hsl("+ah+", "+ak+"%, "+aj+"%)":"hsla("+ah+", "+ak+"%, "+aj+"%, "+ag+")"},toHex:function(ah){return P(ae,ac,Z,ah)},toHexString:function(ah){return"#"+P(ae,ac,Z,ah)},toRgb:function(){return{r:L(ae),g:L(ac),b:L(Z),a:Y}},toRgbString:function(){return(Y==1)?"rgb("+L(ae)+", "+L(ac)+", "+L(Z)+")":"rgba("+L(ae)+", "+L(ac)+", "+L(Z)+", "+ag+")"},toPercentageRgb:function(){return{r:L(v(ae,255)*100)+"%",g:L(v(ac,255)*100)+"%",b:L(v(Z,255)*100)+"%",a:Y}},toPercentageRgbString:function(){return(Y==1)?"rgb("+L(v(ae,255)*100)+"%, "+L(v(ac,255)*100)+"%, "+L(v(Z,255)*100)+"%)":"rgba("+L(v(ae,255)*100)+"%, "+L(v(ac,255)*100)+"%, "+L(v(Z,255)*100)+"%, "+ag+")"},toName:function(){if(Y===0){return"transparent"}return A[P(ae,ac,Z,true)]||false},toFilter:function(am){var aj=P(ae,ac,Z);var an=aj;var ah=Math.round(parseFloat(Y)*255).toString(16);var al=ah;var ai=ad&&ad.gradientType?"GradientType = 1, ":"";if(am){var ak=U(am);an=ak.toHex();al=Math.round(parseFloat(ak.alpha)*255).toString(16)}return"progid:DXImageTransform.Microsoft.gradient("+ai+"startColorstr=#"+N(ah)+aj+",endColorstr=#"+N(al)+an+")"},toString:function(ah){var ai=!!ah;ah=ah||this.format;var aj=false;var al=!ai&&Y<1&&Y>0;var ak=al&&(ah==="hex"||ah==="hex6"||ah==="hex3"||ah==="name");if(ah==="rgb"){aj=this.toRgbString()}if(ah==="prgb"){aj=this.toPercentageRgbString()}if(ah==="hex"||ah==="hex6"){aj=this.toHexString()}if(ah==="hex3"){aj=this.toHexString(true)}if(ah==="name"){aj=this.toName()}if(ah==="hsl"){aj=this.toHslString()}if(ah==="hsv"){aj=this.toHsvString()}if(ak){return this.toRgbString()}return aj||this.toHexString()}}}U.fromRatio=function(Y,ab){if(typeof Y=="object"){var aa={};for(var Z in Y){if(Y.hasOwnProperty(Z)){if(Z==="a"){aa[Z]=Y[Z]}else{aa[Z]=y(Y[Z])}}}Y=aa}return U(Y,ab)};function D(Z){var ac={r:0,g:0,b:0};var Y=1;var ab=false;var aa=false;if(typeof Z=="string"){Z=T(Z)}if(typeof Z=="object"){if(Z.hasOwnProperty("r")&&Z.hasOwnProperty("g")&&Z.hasOwnProperty("b")){ac=S(Z.r,Z.g,Z.b);ab=true;aa=String(Z.r).substr(-1)==="%"?"prgb":"rgb"}else{if(Z.hasOwnProperty("h")&&Z.hasOwnProperty("s")&&Z.hasOwnProperty("v")){Z.s=y(Z.s);Z.v=y(Z.v);ac=C(Z.h,Z.s,Z.v);ab=true;aa="hsv"}else{if(Z.hasOwnProperty("h")&&Z.hasOwnProperty("s")&&Z.hasOwnProperty("l")){Z.s=y(Z.s);Z.l=y(Z.l);ac=B(Z.h,Z.s,Z.l);ab=true;aa="hsl"}}}if(Z.hasOwnProperty("a")){Y=Z.a}}Y=w(Y);return{ok:ab,format:Z.format||aa,r:J(255,I(ac.r,0)),g:J(255,I(ac.g,0)),b:J(255,I(ac.b,0)),a:Y}}function S(aa,Z,Y){return{r:v(aa,255)*255,g:v(Z,255)*255,b:v(Y,255)*255}}function Q(af,aa,Y){af=v(af,255);aa=v(aa,255);Y=v(Y,255);var ad=I(af,aa,Y),ae=J(af,aa,Y);var ab,ag,ac=(ad+ae)/2;if(ad==ae){ab=ag=0}else{var Z=ad-ae;ag=ac>0.5?Z/(2-ad-ae):Z/(ad+ae);switch(ad){case af:ab=(aa-Y)/Z+(aa<Y?6:0);break;case aa:ab=(Y-af)/Z+2;break;case Y:ab=(af-aa)/Z+4;break}ab/=6}return{h:ab,s:ag,l:ac}}function B(aa,ag,ac){var af,Z,Y;aa=v(aa,360);ag=v(ag,100);ac=v(ac,100);function ab(ah,ai,aj){if(aj<0){aj+=1}if(aj>1){aj-=1}if(aj<1/6){return ah+(ai-ah)*6*aj}if(aj<1/2){return ai}if(aj<2/3){return ah+(ai-ah)*(2/3-aj)*6}return ah}if(ag===0){af=Z=Y=ac}else{var ae=ac<0.5?ac*(1+ag):ac+ag-ac*ag;var ad=2*ac-ae;af=ab(ad,ae,aa+1/3);Z=ab(ad,ae,aa);Y=ab(ad,ae,aa-1/3)}return{r:af*255,g:Z*255,b:Y*255}}function R(ae,aa,Y){ae=v(ae,255);aa=v(aa,255);Y=v(Y,255);var ac=I(ae,aa,Y),ad=J(ae,aa,Y);var ab,af,ag=ac;var Z=ac-ad;af=ac===0?0:Z/ac;if(ac==ad){ab=0}else{switch(ac){case ae:ab=(aa-Y)/Z+(aa<Y?6:0);break;case aa:ab=(Y-ae)/Z+2;break;case Y:ab=(ae-aa)/Z+4;break}ab/=6}return{h:ab,s:af,v:ag}}function C(ab,ah,aj){ab=v(ab,360)*6;ah=v(ah,100);aj=v(aj,100);var ac=H.floor(ab),Z=ab-ac,ae=aj*(1-ah),af=aj*(1-Z*ah),ai=aj*(1-(1-Z)*ah),ad=ac%6,ag=[aj,af,ae,ae,ai,aj][ad],aa=[ai,aj,aj,af,ae,ae][ad],Y=[ae,ae,ai,aj,aj,af][ad];return{r:ag*255,g:aa*255,b:Y*255}}function P(ac,aa,Z,Y){var ab=[N(L(ac).toString(16)),N(L(aa).toString(16)),N(L(Z).toString(16))];if(Y&&ab[0].charAt(0)==ab[0].charAt(1)&&ab[1].charAt(0)==ab[1].charAt(1)&&ab[2].charAt(0)==ab[2].charAt(1)){return ab[0].charAt(0)+ab[1].charAt(0)+ab[2].charAt(0)}return ab.join("")}U.equals=function(Y,Z){if(!Y||!Z){return false}return U(Y).toRgbString()==U(Z).toRgbString()};U.random=function(){return U.fromRatio({r:K(),g:K(),b:K()})};U.desaturate=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.s-=Y/100;aa.s=x(aa.s);return U(aa)};U.saturate=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.s+=Y/100;aa.s=x(aa.s);return U(aa)};U.greyscale=function(Y){return U.desaturate(Y,100)};U.lighten=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.l+=Y/100;aa.l=x(aa.l);return U(aa)};U.darken=function(Z,Y){Y=(Y===0)?0:(Y||10);var aa=U(Z).toHsl();aa.l-=Y/100;aa.l=x(aa.l);return U(aa)};U.complement=function(Y){var Z=U(Y).toHsl();Z.h=(Z.h+180)%360;return U(Z)};U.triad=function(Y){var aa=U(Y).toHsl();var Z=aa.h;return[U(Y),U({h:(Z+120)%360,s:aa.s,l:aa.l}),U({h:(Z+240)%360,s:aa.s,l:aa.l})]};U.tetrad=function(Y){var aa=U(Y).toHsl();var Z=aa.h;return[U(Y),U({h:(Z+90)%360,s:aa.s,l:aa.l}),U({h:(Z+180)%360,s:aa.s,l:aa.l}),U({h:(Z+270)%360,s:aa.s,l:aa.l})]};U.splitcomplement=function(Y){var aa=U(Y).toHsl();var Z=aa.h;return[U(Y),U({h:(Z+72)%360,s:aa.s,l:aa.l}),U({h:(Z+216)%360,s:aa.s,l:aa.l})]};U.analogous=function(Y,ab,ad){ab=ab||6;ad=ad||30;var Z=U(Y).toHsl();var aa=360/ad;var ac=[U(Y)];for(Z.h=((Z.h-(aa*ab>>1))+720)%360;--ab;){Z.h=(Z.h+aa)%360;ac.push(U(Z))}return ac};U.monochromatic=function(Y,ac){ac=ac||6;var aa=U(Y).toHsv();var Z=aa.h,ae=aa.s,af=aa.v;var ad=[];var ab=1/ac;while(ac--){ad.push(U({h:Z,s:ae,v:af}));af=(af+ab)%1}return ad};U.readability=function(ac,ad){var Y=U(ac).toRgb();var Z=U(ad).toRgb();var aa=(Y.r*299+Y.g*587+Y.b*114)/1000;var ab=(Z.r*299+Z.g*587+Z.b*114)/1000;var ae=(Math.max(Y.r,Z.r)-Math.min(Y.r,Z.r)+Math.max(Y.g,Z.g)-Math.min(Y.g,Z.g)+Math.max(Y.b,Z.b)-Math.min(Y.b,Z.b));return{brightness:Math.abs(aa-ab),color:ae}};U.readable=function(Y,Z){var aa=U.readability(Y,Z);return aa.brightness>125&&aa.color>500};U.mostReadable=function(Y,ac){var Z=null;var ab=0;var aa=false;for(var ad=0;ad<ac.length;ad++){var ae=U.readability(Y,ac[ad]);var af=ae.brightness>125&&ae.color>500;var ag=3*(ae.brightness/125)+(ae.color/500);if((af&&!aa)||(af&&aa&&ag>ab)||((!af)&&(!aa)&&ag>ab)){aa=af;ab=ag;Z=U(ac[ad])}}return Z};var M=U.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var A=U.hexNames=z(M);function z(aa){var Y={};for(var Z in aa){if(aa.hasOwnProperty(Z)){Y[aa[Z]]=Z}}return Y}function w(Y){Y=parseFloat(Y);if(isNaN(Y)||Y<0||Y>1){Y=1}return Y}function v(Z,Y){if(E(Z)){Z="100%"}var aa=F(Z);Z=J(Y,I(0,parseFloat(Z)));if(aa){Z=parseInt(Z*Y,10)/100}if((H.abs(Z-Y)<1e-06)){return 1}return(Z%Y)/parseFloat(Y)}function x(Y){return J(1,I(0,Y))}function O(Y){return parseInt(Y,16)}function E(Y){return typeof Y=="string"&&Y.indexOf(".")!=-1&&parseFloat(Y)===1}function F(Y){return typeof Y==="string"&&Y.indexOf("%")!=-1}function N(Y){return Y.length==1?"0"+Y:""+Y}function y(Y){if(Y<=1){Y=(Y*100)+"%"}return Y}var G=(function(){var Y="[-\\+]?\\d+%?";var Z="[-\\+]?\\d*\\.\\d+%?";var aa="(?:"+Z+")|(?:"+Y+")";var ab="[\\s|\\(]+("+aa+")[,|\\s]+("+aa+")[,|\\s]+("+aa+")\\s*\\)?";var ac="[\\s|\\(]+("+aa+")[,|\\s]+("+aa+")[,|\\s]+("+aa+")[,|\\s]+("+aa+")\\s*\\)?";return{rgb:new RegExp("rgb"+ab),rgba:new RegExp("rgba"+ac),hsl:new RegExp("hsl"+ab),hsla:new RegExp("hsla"+ac),hsv:new RegExp("hsv"+ab),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}})();function T(Y){Y=Y.replace(W,"").replace(X,"").toLowerCase();var aa=false;if(M[Y]){Y=M[Y];aa=true}else{if(Y=="transparent"){return{r:0,g:0,b:0,a:0,format:"name"}}}var Z;if((Z=G.rgb.exec(Y))){return{r:Z[1],g:Z[2],b:Z[3]}}if((Z=G.rgba.exec(Y))){return{r:Z[1],g:Z[2],b:Z[3],a:Z[4]}}if((Z=G.hsl.exec(Y))){return{h:Z[1],s:Z[2],l:Z[3]}}if((Z=G.hsla.exec(Y))){return{h:Z[1],s:Z[2],l:Z[3],a:Z[4]}}if((Z=G.hsv.exec(Y))){return{h:Z[1],s:Z[2],v:Z[3]}}if((Z=G.hex6.exec(Y))){return{r:O(Z[1]),g:O(Z[2]),b:O(Z[3]),format:aa?"name":"hex"}}if((Z=G.hex3.exec(Y))){return{r:O(Z[1]+""+Z[1]),g:O(Z[2]+""+Z[2]),b:O(Z[3]+""+Z[3]),format:aa?"name":"hex"}}return false}u.tinycolor=U})();a(function(){if(a.fn.spectrum.load){a.fn.spectrum.processNativeColorInputs()}})})(window,jQuery);(function(a){var c;var b={init:function(f){c=a.extend({hide_fallbacks:false,selected:function(i){},initial:"",fonts:[],PrettyFonts:[]},f);c.Id=a(this).attr("id");c.SpanId=a(this).attr("id")+"_span";var h=this;h.callback=c.selected;var m=false;var k=false;var j=function(i){b.UpdateDisplayName(i);k=i;h.callback(k)};var g=function(){var i,n;i=a(h).offset().left;n=a(h).offset().top+a(h).outerHeight();a(l).css({position:"absolute",left:i+"px",top:n+"px"})};a(this).prepend('<span id="'+c.SpanId+'">'+c.initial.replace(/'/g,"&#039;")+"</span>");var l=a('<ul class="fontSelectUl"></ul>').appendTo("body");l.hide();g();for(var d=0;d<c.fonts.length;d++){var e=a("<li>"+b.displayName(c.fonts[d])+"</li>").appendTo(l);a(e).css("font-family",c.fonts[d])}if(c.initial!=""){j(c.initial)}l.find("li").click(function(){if(!m){return}g();l.slideUp("fast",function(){m=false});j(a(this).css("font-family"))});a(this).click(function(i){if(m){return}i.stopPropagation();g();l.slideDown("fast",function(){m=true})});a("html").click(function(){if(m){l.slideUp("fast",function(){m=false})}})},selected:function(){return this.css("font-family")},displayName:function(d){if(c.PrettyFonts.length>0){d=d.replace(/["']{1}/gi,"");var e=c.fonts.indexOf(d);if(e>=0){return c.PrettyFonts[e]}}if(c.hide_fallbacks){var f=d.indexOf(",");if(f<0){f=d.length}return d.substr(0,f)}return d},UpdateDisplayName:function(d){var e=b.displayName(d).replace(/["']{1}/gi,"");if(e.indexOf(")")!==-1&&e.indexOf(")")!==-1){var g=(e.indexOf(")")+1);e=e.substring(g)}a("#"+c.SpanId).html(e);var f="14px";if(e.length>12){f="12px"}a("#"+c.Id).css("font-family",d);a("#"+c.Id).css("font-size",f)},};a.fn.fontSelector=function(d){if(b[d]){return b[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return b.init.apply(this,arguments)}else{a.error("Method "+d+" does not exist on jQuery.fontSelector")}}}})(jQuery);(function(f){function g(i,k){var h=typeof i[k];return h==="function"||!!(h=="object"&&i[k])||h=="unknown"}function j(i,k,h){if(k<0){k+=i.value.length}if(typeof h=="undefined"){h=k}if(h<0){h+=i.value.length}return{start:k,end:h}}function c(){return typeof document.body=="object"&&document.body?document.body:document.getElementsByTagName("body")[0]}var b,a,v,d,w,x,y,z,e;f(document).ready(function(){function h(k,l){return function(){var m=this.jquery?this[0]:this,n=m.nodeName.toLowerCase();if(m.nodeType==1&&(n=="textarea"||n=="input"&&m.type=="text")){m=[m].concat(Array.prototype.slice.call(arguments));m=k.apply(this,m);if(!l){return m}}if(l){return this}}}var i=document.createElement("textarea");c().appendChild(i);if(typeof i.selectionStart!="undefined"&&typeof i.selectionEnd!="undefined"){b=function(k){return{start:k.selectionStart,end:k.selectionEnd,length:k.selectionEnd-k.selectionStart,text:k.value.slice(k.selectionStart,k.selectionEnd)}};a=function(k,l,m){l=j(k,l,m);k.selectionStart=l.start;k.selectionEnd=l.end};e=function(k,l){if(l){k.selectionEnd=k.selectionStart}else{k.selectionStart=k.selectionEnd}}}else{if(g(i,"createTextRange")&&typeof document.selection=="object"&&document.selection&&g(document.selection,"createRange")){b=function(k){var l=0,m=0,n,o,p;if((p=document.selection.createRange())&&p.parentElement()==k){o=k.value.length;n=k.value.replace(/\r\n/g,"\n");m=k.createTextRange();m.moveToBookmark(p.getBookmark());p=k.createTextRange();p.collapse(false);if(m.compareEndPoints("StartToEnd",p)>-1){l=m=o}else{l=-m.moveStart("character",-o);l+=n.slice(0,l).split("\n").length-1;if(m.compareEndPoints("EndToEnd",p)>-1){m=o}else{m=-m.moveEnd("character",-o);m+=n.slice(0,m).split("\n").length-1}}}return{start:l,end:m,length:m-l,text:k.value.slice(l,m)}};a=function(k,l,m){l=j(k,l,m);m=k.createTextRange();var n=l.start-(k.value.slice(0,l.start).split("\r\n").length-1);m.collapse(true);if(l.start==l.end){m.move("character",n)}else{m.moveEnd("character",l.end-(k.value.slice(0,l.end).split("\r\n").length-1));m.moveStart("character",n)}m.select()};e=function(k,l){var m=document.selection.createRange();m.collapse(l);m.select()}}else{c().removeChild(i);window.console&&window.console.log&&window.console.log("TextInputs module for Rangy not supported in your browser. Reason: No means of finding text input caret position");return}}c().removeChild(i);d=function(k,l,m,n){var o;if(l!=m){o=k.value;k.value=o.slice(0,l)+o.slice(m)}n&&a(k,l,l)};v=function(k){var l=b(k);d(k,l.start,l.end,true)};z=function(k){var l=b(k),m;if(l.start!=l.end){m=k.value;k.value=m.slice(0,l.start)+m.slice(l.end)}a(k,l.start,l.start);return l.text};w=function(k,l,m,n){var o=k.value;k.value=o.slice(0,m)+l+o.slice(m);if(n){l=m+l.length;a(k,l,l)}};x=function(k,l){var m=b(k),n=k.value;k.value=n.slice(0,m.start)+l+n.slice(m.end);m=m.start+l.length;a(k,m,m)};y=function(k,l,m){var n=b(k),o=k.value;k.value=o.slice(0,n.start)+l+n.text+m+o.slice(n.end);l=n.start+l.length;a(k,l,l+n.length)};f.fn.extend({getSelection:h(b,false),setSelection:h(a,true),collapseSelection:h(e,true),deleteSelectedText:h(v,true),deleteText:h(d,true),extractSelectedText:h(z,false),insertText:h(w,true),replaceSelectedText:h(x,true),surroundSelectedText:h(y,true)})})})(jQuery);(function(f,g){var d=f.jQuery||f.Cowboy||(f.Cowboy={}),e;d.throttle=e=function(b,c,n,m){var l,a=0;if(typeof c!=="boolean"){m=n;n=c;c=g}function k(){var q=this,j=+new Date()-a,p=arguments;function i(){a=+new Date();n.apply(q,p)}function h(){l=g}if(m&&!l){i()}l&&clearTimeout(l);if(m===g&&j>b){i()}else{if(c!==true){l=setTimeout(m?h:i,m===g?b-j:b)}}}if(d.guid){k.guid=n.guid=n.guid||d.guid++}return k};d.debounce=function(a,b,c){return c===g?e(a,b,false):e(a,c,b!==false)}})(this);(function(a){var c={formatInvalidInputErrorMsg:function(h){return"Invalid input value '"+h+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"};var g=function(j,k){var i=this.element=a(j).hide();var l=a(j)[0].style.width;var p=false;var m=this.element.parent();if(m.hasClass("slider")===true){p=true;this.picker=m}else{this.picker=a('<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle min-slider-handle"></div><div class="slider-handle max-slider-handle"></div></div><div id="tooltip" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div><div id="tooltip_min" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div><div id="tooltip_max" class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>').insertBefore(this.element).append(this.element)}this.id=this.element.data("slider-id")||k.id;if(this.id){this.picker[0].id=this.id}if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof window.DocumentTouch){this.touchCapable=true}var o=this.element.data("slider-tooltip")||k.tooltip;this.tooltip=this.picker.find("#tooltip");this.tooltipInner=this.tooltip.find("div.tooltip-inner");this.tooltip_min=this.picker.find("#tooltip_min");this.tooltipInner_min=this.tooltip_min.find("div.tooltip-inner");this.tooltip_max=this.picker.find("#tooltip_max");this.tooltipInner_max=this.tooltip_max.find("div.tooltip-inner");if(p===true){this.picker.removeClass("slider-horizontal");this.picker.removeClass("slider-vertical");this.tooltip.removeClass("hide");this.tooltip_min.removeClass("hide");this.tooltip_max.removeClass("hide")}this.orientation=this.element.data("slider-orientation")||k.orientation;switch(this.orientation){case"vertical":this.picker.addClass("slider-vertical");this.stylePos="top";this.mousePos="pageY";this.sizePos="offsetHeight";this.tooltip.addClass("right")[0].style.left="100%";this.tooltip_min.addClass("right")[0].style.left="100%";this.tooltip_max.addClass("right")[0].style.left="100%";break;default:this.picker.addClass("slider-horizontal").css("width",l);this.orientation="horizontal";this.stylePos="left";this.mousePos="pageX";this.sizePos="offsetWidth";this.tooltip.addClass("top")[0].style.top=-this.tooltip.outerHeight()-14+"px";this.tooltip_min.addClass("top")[0].style.top=-this.tooltip_min.outerHeight()-14+"px";this.tooltip_max.addClass("top")[0].style.top=-this.tooltip_max.outerHeight()-14+"px";break}var n=this;a.each(["min","max","step","precision","value","reversed","handle"],function(r,q){if(typeof i.data("slider-"+q)!=="undefined"){n[q]=i.data("slider-"+q)}else{if(typeof k[q]!=="undefined"){n[q]=k[q]}else{if(typeof i.prop(q)!=="undefined"){n[q]=i.prop(q)}else{n[q]=0}}}});if(this.value instanceof Array){if(p&&!this.range){this.value=this.value[0]}else{this.range=true}}else{if(this.range){this.value=[this.value,this.max]}}this.selection=this.element.data("slider-selection")||k.selection;this.selectionEl=this.picker.find(".slider-selection");if(this.selection==="none"){this.selectionEl.addClass("hide")}this.selectionElStyle=this.selectionEl[0].style;this.handle1=this.picker.find(".slider-handle:first");this.handle1Stype=this.handle1[0].style;this.handle2=this.picker.find(".slider-handle:last");this.handle2Stype=this.handle2[0].style;if(p===true){this.handle1.removeClass("round triangle");this.handle2.removeClass("round triangle hide")}var h=["round","triangle","custom"];if(h.indexOf(this.handle)!==-1){this.handle1.addClass(this.handle);this.handle2.addClass(this.handle)}this.offset=this.picker.offset();this.size=this.picker[0][this.sizePos];this.formater=k.formater;this.tooltip_separator=k.tooltip_separator;this.tooltip_split=k.tooltip_split;this.setValue(this.value);this.handle1.on({keydown:a.proxy(this.keydown,this,0)});this.handle2.on({keydown:a.proxy(this.keydown,this,1)});if(this.touchCapable){this.picker.on({touchstart:a.proxy(this.mousedown,this)})}this.picker.on({mousedown:a.proxy(this.mousedown,this)});if(o==="hide"){this.tooltip.addClass("hide");this.tooltip_min.addClass("hide");this.tooltip_max.addClass("hide")}else{if(o==="always"){this.showTooltip();this.alwaysShowTooltip=true}else{this.picker.on({mouseenter:a.proxy(this.showTooltip,this),mouseleave:a.proxy(this.hideTooltip,this)});this.handle1.on({focus:a.proxy(this.showTooltip,this),blur:a.proxy(this.hideTooltip,this)});this.handle2.on({focus:a.proxy(this.showTooltip,this),blur:a.proxy(this.hideTooltip,this)})}}this.enabled=k.enabled&&(this.element.data("slider-enabled")===undefined||this.element.data("slider-enabled")===true);if(this.enabled){this.enable()}else{this.disable()}this.natural_arrow_keys=this.element.data("slider-natural_arrow_keys")||k.natural_arrow_keys};g.prototype={constructor:g,over:false,inDrag:false,showTooltip:function(){if(this.tooltip_split===false){this.tooltip.addClass("in")}else{this.tooltip_min.addClass("in");this.tooltip_max.addClass("in")}this.over=true},hideTooltip:function(){if(this.inDrag===false&&this.alwaysShowTooltip!==true){this.tooltip.removeClass("in");this.tooltip_min.removeClass("in");this.tooltip_max.removeClass("in")}this.over=false},layout:function(){var j;if(this.reversed){j=[100-this.percentage[0],this.percentage[1]]}else{j=[this.percentage[0],this.percentage[1]]}this.handle1Stype[this.stylePos]=j[0]+"%";this.handle2Stype[this.stylePos]=j[1]+"%";if(this.orientation==="vertical"){this.selectionElStyle.top=Math.min(j[0],j[1])+"%";this.selectionElStyle.height=Math.abs(j[0]-j[1])+"%"}else{this.selectionElStyle.left=Math.min(j[0],j[1])+"%";this.selectionElStyle.width=Math.abs(j[0]-j[1])+"%";var i=this.tooltip_min[0].getBoundingClientRect();var h=this.tooltip_max[0].getBoundingClientRect();if(i.right>h.left){this.tooltip_max.removeClass("top");this.tooltip_max.addClass("bottom")[0].style.top=18+"px"}else{this.tooltip_max.removeClass("bottom");this.tooltip_max.addClass("top")[0].style.top=-30+"px"}}if(this.range){this.tooltipInner.text(this.formater(this.value[0])+this.tooltip_separator+this.formater(this.value[1]));this.tooltip[0].style[this.stylePos]=(j[1]+j[0])/2+"%";if(this.orientation==="vertical"){this.tooltip.css("margin-top",-this.tooltip.outerHeight()/2+"px")}else{this.tooltip.css("margin-left",-this.tooltip.outerWidth()/2+"px")}if(this.orientation==="vertical"){this.tooltip.css("margin-top",-this.tooltip.outerHeight()/2+"px")}else{this.tooltip.css("margin-left",-this.tooltip.outerWidth()/2+"px")}this.tooltipInner_min.text(this.formater(this.value[0]));this.tooltipInner_max.text(this.formater(this.value[1]));this.tooltip_min[0].style[this.stylePos]=j[0]+"%";if(this.orientation==="vertical"){this.tooltip_min.css("margin-top",-this.tooltip_min.outerHeight()/2+"px")}else{this.tooltip_min.css("margin-left",-this.tooltip_min.outerWidth()/2+"px")}this.tooltip_max[0].style[this.stylePos]=j[1]+"%";if(this.orientation==="vertical"){this.tooltip_max.css("margin-top",-this.tooltip_max.outerHeight()/2+"px")}else{this.tooltip_max.css("margin-left",-this.tooltip_max.outerWidth()/2+"px")}}else{this.tooltipInner.text(this.formater(this.value[0]));this.tooltip[0].style[this.stylePos]=j[0]+"%";if(this.orientation==="vertical"){this.tooltip.css("margin-top",-this.tooltip.outerHeight()/2+"px")}else{this.tooltip.css("margin-left",-this.tooltip.outerWidth()/2+"px")}}},mousedown:function(j){if(!this.isEnabled()){return false}if(this.touchCapable&&j.type==="touchstart"){j=j.originalEvent}this.triggerFocusOnHandle();this.offset=this.picker.offset();this.size=this.picker[0][this.sizePos];var k=this.getPercentage(j);if(this.range){var h=Math.abs(this.percentage[0]-k);var i=Math.abs(this.percentage[1]-k);this.dragged=(h<i)?0:1}else{this.dragged=0}this.percentage[this.dragged]=this.reversed?100-k:k;this.layout();if(this.touchCapable){a(document).on({touchmove:a.proxy(this.mousemove,this),touchend:a.proxy(this.mouseup,this)})}a(document).on({mousemove:a.proxy(this.mousemove,this),mouseup:a.proxy(this.mouseup,this)});this.inDrag=true;var l=this.calculateValue();this.element.trigger({type:"slideStart",value:l}).data("value",l).prop("value",l);this.setValue(l);return true},triggerFocusOnHandle:function(h){if(h===0){this.handle1.focus()}if(h===1){this.handle2.focus()}},keydown:function(j,i){if(!this.isEnabled()){return false}var h;switch(i.which){case 37:case 40:h=-1;break;case 39:case 38:h=1;break}if(!h){return}if(this.natural_arrow_keys){if((this.orientation==="vertical"&&!this.reversed)||(this.orientation==="horizontal"&&this.reversed)){h=h*-1}}var k=h*this.percentage[2];var l=this.percentage[j]+k;if(l>100){l=100}else{if(l<0){l=0}}this.dragged=j;this.adjustPercentageForRangeSliders(l);this.percentage[this.dragged]=l;this.layout();var m=this.calculateValue();this.element.trigger({type:"slideStart",value:m}).data("value",m).prop("value",m);this.setValue(m,true);this.element.trigger({type:"slideStop",value:m}).data("value",m).prop("value",m);return false},mousemove:function(h){if(!this.isEnabled()){return false}if(this.touchCapable&&h.type==="touchmove"){h=h.originalEvent}var i=this.getPercentage(h);this.adjustPercentageForRangeSliders(i);this.percentage[this.dragged]=this.reversed?100-i:i;this.layout();var j=this.calculateValue();this.setValue(j,true);return false},adjustPercentageForRangeSliders:function(h){if(this.range){if(this.dragged===0&&this.percentage[1]<h){this.percentage[0]=this.percentage[1];this.dragged=1}else{if(this.dragged===1&&this.percentage[0]>h){this.percentage[1]=this.percentage[0];this.dragged=0}}}},mouseup:function(){if(!this.isEnabled()){return false}if(this.touchCapable){a(document).off({touchmove:this.mousemove,touchend:this.mouseup})}a(document).off({mousemove:this.mousemove,mouseup:this.mouseup});this.inDrag=false;if(this.over===false){this.hideTooltip()}var h=this.calculateValue();this.layout();this.element.data("value",h).prop("value",h).trigger({type:"slideStop",value:h});return false},calculateValue:function(){var h;if(this.range){h=[this.min,this.max];if(this.percentage[0]!==0){h[0]=(Math.max(this.min,this.min+Math.round((this.diff*this.percentage[0]/100)/this.step)*this.step));h[0]=this.applyPrecision(h[0])}if(this.percentage[1]!==100){h[1]=(Math.min(this.max,this.min+Math.round((this.diff*this.percentage[1]/100)/this.step)*this.step));h[1]=this.applyPrecision(h[1])}this.value=h}else{h=(this.min+Math.round((this.diff*this.percentage[0]/100)/this.step)*this.step);if(h<this.min){h=this.min}else{if(h>this.max){h=this.max}}h=parseFloat(h);h=this.applyPrecision(h);this.value=[h,this.value[1]]}return h},applyPrecision:function(i){var h=this.precision||this.getNumDigitsAfterDecimalPlace(this.step);return this.applyToFixedAndParseFloat(i,h)},getNumDigitsAfterDecimalPlace:function(i){var h=(""+i).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!h){return 0}return Math.max(0,(h[1]?h[1].length:0)-(h[2]?+h[2]:0))},applyToFixedAndParseFloat:function(h,i){var j=h.toFixed(i);return parseFloat(j)},getPercentage:function(h){if(this.touchCapable&&(h.type==="touchstart"||h.type==="touchmove")){h=h.touches[0]}var i=(h[this.mousePos]-this.offset[this.stylePos])*100/this.size;i=Math.round(i/this.percentage[2])*this.percentage[2];return Math.max(0,Math.min(100,i))},getValue:function(){if(this.range){return this.value}return this.value[0]},setValue:function(j,i){if(!j){j=0}this.value=this.validateInputValue(j);if(this.range){this.value[0]=this.applyPrecision(this.value[0]);this.value[1]=this.applyPrecision(this.value[1]);this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0]));this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))}else{this.value=this.applyPrecision(this.value);this.value=[Math.max(this.min,Math.min(this.max,this.value))];this.handle2.addClass("hide");if(this.selection==="after"){this.value[1]=this.max}else{this.value[1]=this.min}}this.diff=this.max-this.min;if(this.diff>0){this.percentage=[(this.value[0]-this.min)*100/this.diff,(this.value[1]-this.min)*100/this.diff,this.step*100/this.diff]}else{this.percentage=[0,0,100]}this.layout();if(i===true){var h=this.range?this.value:this.value[0];this.element.trigger({type:"slide",value:h}).data("value",h).prop("value",h)}},validateInputValue:function(h){if(typeof h==="number"){return h}else{if(h instanceof Array){a.each(h,function(j,k){if(typeof k!=="number"){throw new Error(c.formatInvalidInputErrorMsg(k))}});return h}else{throw new Error(c.formatInvalidInputErrorMsg(h))}}},destroy:function(){this.handle1.off();this.handle2.off();this.element.off().show().insertBefore(this.picker);this.picker.off().remove();a(this.element).removeData("slider")},disable:function(){this.enabled=false;this.handle1.removeAttr("tabindex");this.handle2.removeAttr("tabindex");this.picker.addClass("slider-disabled");this.element.trigger("slideDisabled")},enable:function(){this.enabled=true;this.handle1.attr("tabindex",0);this.handle2.attr("tabindex",0);this.picker.removeClass("slider-disabled");this.element.trigger("slideEnabled")},toggle:function(){if(this.enabled){this.disable()}else{this.enable()}},isEnabled:function(){return this.enabled},setAttribute:function(h,i){this[h]=i},getAttribute:function(h){return this[h]}};var e={getValue:g.prototype.getValue,setValue:g.prototype.setValue,setAttribute:g.prototype.setAttribute,getAttribute:g.prototype.getAttribute,destroy:g.prototype.destroy,disable:g.prototype.disable,enable:g.prototype.enable,toggle:g.prototype.toggle,isEnabled:g.prototype.isEnabled};a.fn.slider=function(i){if(typeof i==="string"&&i!=="refresh"){var h=Array.prototype.slice.call(arguments,1);return d.call(this,i,h)}else{return b.call(this,i)}};function d(i,h){if(e[i]){var k=f(this);var j=e[i].apply(k,h);if(typeof j==="undefined"){return a(this)}else{return j}}else{throw new Error("method '"+i+"()' does not exist for slider.")}}function f(h){var i=a(h).data("slider");if(i&&i instanceof g){return i}else{throw new Error(c.callingContextNotSliderInstance)}}function b(i){var h=a(this);h.each(function(){var j=a(this),l=j.data("slider"),k=typeof i==="object"&&i;if(l&&!k){k={};l.handle1.off();l.handle2.off();l.picker.off();a.each(a.fn.slider.defaults,function(m){k[m]=l[m]})}j.data("slider",(new g(this,a.extend({},a.fn.slider.defaults,k))))});return h}a.fn.slider.defaults={min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:false,selection:"before",tooltip:"show",tooltip_separator:":",tooltip_split:false,natural_arrow_keys:false,handle:"round",reversed:false,enabled:true,formater:function(h){return h}};a.fn.slider.Constructor=g})(window.jQuery);if(typeof Iuppiter==="undefined"){Iuppiter={version:"$Revision: 3026 $".substring(11).replace(" $",""),}}Iuppiter.toByteArray=function(d){var a=[],c,e;for(c=0;c<d.length;c++){e=d.charCodeAt(c);if(e<=127){a.push(e)}else{if(e<=2047){a.push((e>>6)|192);a.push((e&63)|128)}else{if(e<=65535){a.push((e>>12)|224);a.push(((e>>6)&63)|128);a.push((e&63)|128)}else{a.push((e>>18)|240);a.push(((e>>12)&63)|128);a.push(((e>>6)&63)|128);a.push((e&63)|128)}}}}return a};Iuppiter.Base64={CA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",CAS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",IA:new Array(256),IAS:new Array(256),init:function(){var a;for(a=0;a<256;a++){Iuppiter.Base64.IA[a]=-1;Iuppiter.Base64.IAS[a]=-1}for(a=0,iS=Iuppiter.Base64.CA.length;a<iS;a++){Iuppiter.Base64.IA[Iuppiter.Base64.CA.charCodeAt(a)]=a;Iuppiter.Base64.IAS[Iuppiter.Base64.CAS.charCodeAt(a)]=a}Iuppiter.Base64.IA["="]=Iuppiter.Base64.IAS["="]=0},encode:function(h,n){var a,c,l,m,f,e,k,b,j,g;if(n){a=Iuppiter.Base64.CAS}else{a=Iuppiter.Base64.CA}if(h.constructor==Array){l=h}else{l=Iuppiter.toByteArray(h)}m=l.length;f=(m/3)*3;e=((m-1)/3+1)<<2;c=new Array(e);for(k=0,b=0;k<f;){g=(l[k++]&255)<<16|(l[k++]&255)<<8|(l[k++]&255);c[b++]=a.charAt((g>>18)&63);c[b++]=a.charAt((g>>12)&63);c[b++]=a.charAt((g>>6)&63);c[b++]=a.charAt(g&63)}j=m-f;if(j>0){g=((l[f]&255)<<10)|(j==2?((l[m-1]&255)<<2):0);c[e-4]=a.charAt(g>>12);c[e-3]=a.charAt((g>>6)&63);c[e-2]=j==2?a.charAt(g&63):"=";c[e-1]="="}return c.join("")},decode:function(l,w){var k,f,s,v,a,u,g,p,c,t,o,e,b,n,h,m,q;if(w){k=Iuppiter.Base64.IAS}else{k=Iuppiter.Base64.IA}if(l.constructor==Array){s=l;a=true}else{s=Iuppiter.toByteArray(l);a=false}v=s.length;u=0;g=v-1;while(u<g&&k[s[u]]<0){u++}while(g>0&&k[s[g]]<0){g--}p=s[g]=="="?(s[g-1]=="="?2:1):0;c=g-u+1;t=v>76?(s[76]=="\r"?c/78:0)<<1:0;o=((c-t)*6>>3)-p;f=new Array(o);e=0;for(b=0,eLen=(o/3)*3;e<eLen;){h=k[s[u++]]<<18|k[s[u++]]<<12|k[s[u++]]<<6|k[s[u++]];f[e++]=(h>>16)&255;f[e++]=(h>>8)&255;f[e++]=h&255;if(t>0&&++b==19){u+=2;b=0}}if(e<o){h=0;for(m=0;u<=g-p;m++){h|=k[s[u++]]<<(18-m*6)}for(q=16;e<o;q-=8){f[e++]=(h>>q)&255}}if(a){return f}else{for(h=0;h<f.length;h++){f[h]=String.fromCharCode(f[h])}return f.join("")}}};Iuppiter.Base64.init();(function(){NBBY=8,MATCH_BITS=6,MATCH_MIN=3,MATCH_MAX=((1<<MATCH_BITS)+(MATCH_MIN-1)),OFFSET_MASK=((1<<(16-MATCH_BITS))-1),LEMPEL_SIZE=256;Iuppiter.compress=function(j){var p,f=[],n,o=0,e=0,d,b,c=1<<(NBBY-1),l,m,g,k=new Array(LEMPEL_SIZE),h,a;for(h=0;h<LEMPEL_SIZE;h++){k[h]=3435973836}if(j.constructor==Array){p=j;a=true}else{p=Iuppiter.toByteArray(j);a=false}n=p.length;while(o<n){if((c<<=1)==(1<<NBBY)){if(e>=n-1-2*NBBY){l=n;for(o=0,e=0;l;l--){f[e++]=p[o++]}return f}c=1;b=e;f[e++]=0}if(o>n-MATCH_MAX){f[e++]=p[o++];continue}g=((p[o]+13)^(p[o+1]-13)^p[o+2])&(LEMPEL_SIZE-1);m=(o-k[g])&OFFSET_MASK;k[g]=o;d=o-m;if(d>=0&&d!=o&&p[o]==p[d]&&p[o+1]==p[d+1]&&p[o+2]==p[d+2]){f[b]|=c;for(l=MATCH_MIN;l<MATCH_MAX;l++){if(p[o+l]!=p[d+l]){break}}f[e++]=((l-MATCH_MIN)<<(NBBY-MATCH_BITS))|(m>>NBBY);f[e++]=m;o+=l}else{f[e++]=p[o++]}}return f};Iuppiter.decompress=function(k,a){var p,g=[],n,o=0,f=0,e,c,d=1<<(NBBY-1),l,m,j,b,h;if(k.constructor==Array){p=k;b=true}else{p=Iuppiter.toByteArray(k);b=false}if(typeof(a)=="undefined"){b=false}else{b=a}n=p.length;h=function(){if(b){return g}else{for(j=0;j<f;j++){g[j]=String.fromCharCode(g[j])}return g.join("")}};while(o<n){if((d<<=1)==(1<<NBBY)){d=1;c=p[o++]}if(c&d){l=(p[o]>>(NBBY-MATCH_BITS))+MATCH_MIN;m=((p[o]<<NBBY)|p[o+1])&OFFSET_MASK;o+=2;if((e=f-m)>=0){while(--l>=0){g[f++]=g[e++]}}else{return h()}}else{g[f++]=p[o++]}}return h()}})();if(!Worker||(location&&location.protocol==="file:")){
/*@cc_on
        var onmessage   = function () {};
        var postMessage = function () {};
    @*/
var Worker=function(c){var a,b={};if(typeof window!=="undefined"){a=window}else{if(global){a=global}}if(a.document&&!a.require){a.require=function(d){var e=document.createElement("script");e.type="text/javascript";e.src=d;document.getElementsByTagName("head")[0].appendChild(e)}}b.onmessage=function(){};b.postMessage=function(d){if(a.onmessage){a.onmessage({data:d})}else{setTimeout(function(){b.postMessage(d)},50)}};a.postMessage=function(d){b.onmessage({data:d,type:"message"})};require(c);return b}}this.LZMA=function(e){var a=1,b=2,c=3,d={},f=new Worker((typeof e==="undefined"?"./lzma_worker.js":e));f.onmessage=function(g){if(g.data.action===c){if(d[g.data.callback_num]&&typeof d[g.data.callback_num].on_progress==="function"){d[g.data.callback_num].on_progress(g.data.result)}}else{if(d[g.data.callback_num]&&typeof d[g.data.callback_num].on_finish==="function"){d[g.data.callback_num].on_finish(g.data.result);delete d[g.data.callback_num]}}};f.onerror=function(g){throw new Error(g.message+" ("+g.filename+":"+g.lineno+")")};return(function(){function g(h,j,k,l,m){var i;do{i=Math.floor(Math.random()*(10000000))}while(typeof d[i]!=="undefined");d[i]={on_finish:l,on_progress:m};f.postMessage({action:h,callback_num:i,data:j,mode:k})}return{compress:function(k,h,i,j){g(a,String(k),h,i,j)},decompress:function(h,i,j){g(b,h,false,i,j)}}}())};/* A fix for the iOS orientationchange zoom bug.
Script by @scottjehl, rebound by @wilto.
MIT License.
*/
(function(k){if(!(/iPhone|iPad|iPod/.test(navigator.platform)&&navigator.userAgent.indexOf("AppleWebKit")>-1)){return}var e=k.document;if(!e.querySelector){return}var i=e.querySelector("meta[name=viewport]"),h=i&&i.getAttribute("content"),c=h+",maximum-scale=1",g=h+",maximum-scale=10",f=true,l,m,n,a;if(!i){return}var j=function(){i.setAttribute("content",g);f=true};var d=function(){i.setAttribute("content",c);f=false};var b=function(o){a=o.accelerationIncludingGravity;l=Math.abs(a.x);m=Math.abs(a.y);n=Math.abs(a.z);if(!k.orientation&&(l>7||(((n>6&&m<8)||(n<8&&m>6))&&l>5))){if(f){d()}}else{if(!f){j()}}};k.addEventListener("orientationchange",j,false);k.addEventListener("devicemotion",b,false)}(this));(function(){var b=false;window.JQClass=function(){};JQClass.classes={};JQClass.extend=function a(f){var c=this.prototype;b=true;var g=new this();b=false;for(var e in f){g[e]=typeof f[e]=="function"&&typeof c[e]=="function"?(function(i,h){return function(){var j=this._super;this._super=function(l){return c[i].apply(this,l||[])};var k=h.apply(this,arguments);this._super=j;return k}})(e,f[e]):f[e]}function d(){if(!b&&this._init){this._init.apply(this,arguments)}}d.prototype=g;d.prototype.constructor=d;d.extend=a;return d}})();(function($){JQClass.classes.JQPlugin=JQClass.extend({name:"plugin",defaultOptions:{},regionalOptions:{},_getters:[],_getMarker:function(){return"is-"+this.name},_init:function(){$.extend(this.defaultOptions,(this.regionalOptions&&this.regionalOptions[""])||{});var jqName=camelCase(this.name);$[jqName]=this;$.fn[jqName]=function(options){var otherArgs=Array.prototype.slice.call(arguments,1);if($[jqName]._isNotChained(options,otherArgs)){return $[jqName][options].apply($[jqName],[this[0]].concat(otherArgs))}return this.each(function(){if(typeof options==="string"){if(options[0]==="_"||!$[jqName][options]){throw"Unknown method: "+options}$[jqName][options].apply($[jqName],[this].concat(otherArgs))}else{$[jqName]._attach(this,options)}})}},setDefaults:function(options){$.extend(this.defaultOptions,options||{})},_isNotChained:function(name,otherArgs){if(name==="option"&&(otherArgs.length===0||(otherArgs.length===1&&typeof otherArgs[0]==="string"))){return true}return $.inArray(name,this._getters)>-1},_attach:function(elem,options){elem=$(elem);if(elem.hasClass(this._getMarker())){return}elem.addClass(this._getMarker());options=$.extend({},this.defaultOptions,this._getMetadata(elem),options||{});var inst=$.extend({name:this.name,elem:elem,options:options},this._instSettings(elem,options));elem.data(this.name,inst);this._postAttach(elem,inst);this.option(elem,options)},_instSettings:function(elem,options){return{}},_postAttach:function(elem,inst){},_getMetadata:function(elem){try{var data=elem.data(this.name.toLowerCase())||"";data=data.replace(/'/g,'"');data=data.replace(/([a-zA-Z0-9]+):/g,function(match,group,i){var count=data.substring(0,i).match(/"/g);return(!count||count.length%2===0?'"'+group+'":':group+":")});data=$.parseJSON("{"+data+"}");for(var name in data){var value=data[name];if(typeof value==="string"&&value.match(/^new Date\((.*)\)$/)){data[name]=eval(value)}}return data}catch(e){return{}}},_getInst:function(elem){return $(elem).data(this.name)||{}},option:function(elem,name,value){elem=$(elem);var inst=elem.data(this.name);if(!name||(typeof name==="string"&&value==null)){var options=(inst||{}).options;return(options&&name?options[name]:options)}if(!elem.hasClass(this._getMarker())){return}var options=name||{};if(typeof name==="string"){options={};options[name]=value}this._optionsChanged(elem,inst,options);$.extend(inst.options,options)},_optionsChanged:function(elem,inst,options){},destroy:function(elem){elem=$(elem);if(!elem.hasClass(this._getMarker())){return}this._preDestroy(elem,this._getInst(elem));elem.removeData(this.name).removeClass(this._getMarker())},_preDestroy:function(elem,inst){}});function camelCase(name){return name.replace(/-([a-z])/g,function(match,group){return group.toUpperCase()})}$.JQPlugin={createPlugin:function(superClass,overrides){if(typeof superClass==="object"){overrides=superClass;superClass="JQPlugin"}superClass=camelCase(superClass);var className=camelCase(overrides.name);JQClass.classes[className]=JQClass.classes[superClass].extend(overrides);new JQClass.classes[className]()}}})(jQuery);(function(a){var d="keypad";var b=["  BSCECA","_1_2_3_+@X","_4_5_6_-@U","_7_8_9_*@E","_0_._=_/"];a.JQPlugin.createPlugin({name:d,defaultOptions:{showOn:"focus",buttonImage:"",buttonImageOnly:false,showAnim:"show",showOptions:null,duration:"normal",appendText:"",useThemeRoller:false,keypadClass:"",prompt:"",layout:[],separator:"",target:null,keypadOnly:true,randomiseAlphabetic:false,randomiseNumeric:false,randomiseOther:false,randomiseAll:false,beforeShow:null,onKeypress:null,onClose:null},regionalOptions:{"":{buttonText:"...",buttonStatus:"Open the keypad",closeText:"Close",closeStatus:"Close the keypad",clearText:"Clear",clearStatus:"Erase all the text",backText:"Back",backStatus:"Erase the previous character",spacebarText:"&nbsp;",spacebarStatus:"Space",enterText:"Enter",enterStatus:"Carriage return",tabText:"?",tabStatus:"Horizontal tab",shiftText:"Shift",shiftStatus:"Toggle upper/lower case characters",alphabeticLayout:[],fullLayout:[],isAlphabetic:null,isNumeric:null,toUpper:null,isRTL:false}},_getters:["isDisabled"],_curInst:null,_disabledFields:[],_keypadShowing:false,_keyCode:0,_specialKeys:[],_mainDivClass:d+"-popup",_inlineClass:d+"-inline",_appendClass:d+"-append",_triggerClass:d+"-trigger",_disableClass:d+"-disabled",_inlineEntryClass:d+"-keyentry",_rtlClass:d+"-rtl",_rowClass:d+"-row",_promptClass:d+"-prompt",_specialClass:d+"-special",_namePrefixClass:d+"-",_keyClass:d+"-key",_keyDownClass:d+"-key-down",qwertyAlphabetic:["qwertyuiop","asdfghjkl","zxcvbnm"],qwertyLayout:["!@#$%^&*()_="+this.HALF_SPACE+this.SPACE+this.CLOSE,this.HALF_SPACE+"`~[]{}<>\\|/"+this.SPACE+"789","qwertyuiop'\""+this.HALF_SPACE+"456",this.HALF_SPACE+"asdfghjkl;:"+this.SPACE+"123",this.SPACE+"zxcvbnm,.?"+this.SPACE+this.HALF_SPACE+"-0+",""+this.TAB+this.ENTER+this.SPACE_BAR+this.SHIFT+this.HALF_SPACE+this.BACK+this.CLEAR],addKeyDef:function(f,g,e,h){if(this._keyCode==32){throw"Only 32 special keys allowed"}this[f]=String.fromCharCode(this._keyCode++);this._specialKeys.push({code:this[f],id:f,name:g,action:e,noHighlight:h});return this},_init:function(){this.mainDiv=a('<div class="'+this._mainDivClass+'" style="display: none;"></div>');this._super()},_instSettings:function(e,g){var f=!e[0].nodeName.toLowerCase().match(/input|textarea/);return{_inline:f,ucase:false,_mainDiv:(f?a('<div class="'+this._inlineClass+'"></div>'):c.mainDiv)}},_postAttach:function(e,f){if(f._inline){e.append(f._mainDiv).on("click."+f.name,function(){f._input.focus()});this._updateKeypad(f)}else{if(e.is(":disabled")){this.disable(e)}}},_setInput:function(e,f){f._input=a(!f._inline?e:f.options.target||'<input type="text" class="'+this._inlineEntryClass+'" disabled/>');if(f._inline){e.find("input").remove();if(!f.options.target){e.append(f._input)}}},_optionsChanged:function(h,i,j){a.extend(i.options,j);h.off("."+i.name).siblings("."+this._appendClass).remove().end().siblings("."+this._triggerClass).remove();var e=i.options.appendText;if(e){h[i.options.isRTL?"before":"after"]('<span class="'+this._appendClass+'">'+e+"</span>")}if(!i._inline){if(i.options.showOn=="focus"||i.options.showOn=="both"){h.on("focus."+i.name,this.show).on("keydown."+i.name,this._doKeyDown)}if(i.options.showOn=="button"||i.options.showOn=="both"){var g=i.options.buttonStatus;var f=i.options.buttonImage;var k=a(i.options.buttonImageOnly?a('<img src="'+f+'" alt="'+g+'" title="'+g+'"/>'):a('<button type="button" title="'+g+'"></button>').html(f==""?i.options.buttonText:a('<img src="'+f+'" alt="'+g+'" title="'+g+'"/>')));h[i.options.isRTL?"before":"after"](k);k.addClass(this._triggerClass).click(function(){if(c._keypadShowing&&c._lastField==h[0]){c.hide()}else{c.show(h[0])}return false})}}i.saveReadonly=h.attr("readonly");h[i.options.keypadOnly?"attr":"removeAttr"]("readonly",true).on("setData."+i.name,function(l,m,n){i.options[m]=n}).on("getData."+i.name,function(l,m){return i.options[m]});this._setInput(h,i);this._updateKeypad(i)},_preDestroy:function(e,f){if(this._curInst==f){this.hide()}e.siblings("."+this._appendClass).remove().end().siblings("."+this._triggerClass).remove().end().prev("."+this._inlineEntryClass).remove();e.empty().off("."+f.name)[f.saveReadonly?"attr":"removeAttr"]("readonly",true);f._input.removeData(f.name)},enable:function(e){e=a(e);if(!e.hasClass(this._getMarker())){return}var f=e[0].nodeName.toLowerCase();if(f.match(/input|textarea/)){e.prop("disabled",false).siblings("button."+this._triggerClass).prop("disabled",false).end().siblings("img."+this._triggerClass).css({opacity:"1.0",cursor:""})}else{if(f.match(/div|span/)){e.children("."+this._disableClass).remove();this._getInst(e)._mainDiv.find("button").prop("disabled",false)}}this._disabledFields=a.map(this._disabledFields,function(g){return(g==e[0]?null:g)})},disable:function(e){e=a(e);if(!e.hasClass(this._getMarker())){return}var g=e[0].nodeName.toLowerCase();if(g.match(/input|textarea/)){e.prop("disabled",true).siblings("button."+this._triggerClass).prop("disabled",true).end().siblings("img."+this._triggerClass).css({opacity:"0.5",cursor:"default"})}else{if(g.match(/div|span/)){var f=e.children("."+this._inlineClass);var h=f.offset();var i={left:0,top:0};f.parents().each(function(){if(a(this).css("position")=="relative"){i=a(this).offset();return false}});e.prepend('<div class="'+this._disableClass+'" style="width: '+f.outerWidth()+"px; height: "+f.outerHeight()+"px; left: "+(h.left-i.left)+"px; top: "+(h.top-i.top)+'px;"></div>');this._getInst(e)._mainDiv.find("button").prop("disabled",true)}}this._disabledFields=a.map(this._disabledFields,function(j){return(j==e[0]?null:j)});this._disabledFields[this._disabledFields.length]=e[0]},isDisabled:function(e){return(e&&a.inArray(e,this._disabledFields)>-1)},show:function(g){g=g.target||g;if(c.isDisabled(g)||c._lastField==g){return}var h=c._getInst(g);c.hide(null,"");c._lastField=g;c._pos=c._findPos(g);c._pos[1]+=g.offsetHeight;var i=false;a(g).parents().each(function(){i|=a(this).css("position")=="fixed";return !i});var k={left:c._pos[0],top:c._pos[1]};c._pos=null;h._mainDiv.css({position:"absolute",display:"block",top:"-1000px",width:"auto"});c._updateKeypad(h);k=c._checkOffset(h,k,i);h._mainDiv.css({position:(i?"fixed":"absolute"),display:"none",left:k.left+"px",top:k.top+"px"});var f=h.options.duration;var m=h.options.showAnim;var l=function(){c._keypadShowing=true};if(a.effects&&(a.effects[m]||(a.effects.effect&&a.effects.effect[m]))){var e=h._mainDiv.data();for(var j in e){if(j.match(/^ec\.storage\./)){e[j]=h._mainDiv.css(j.replace(/ec\.storage\./,""))}}h._mainDiv.data(e).show(m,h.options.showOptions||{},f,l)}else{h._mainDiv[m||"show"]((m?f:0),l)}if(h._input[0].type!="hidden"){h._input[0].focus()}c._curInst=h},_updateKeypad:function(f){var e=this._getBorders(f._mainDiv);f._mainDiv.empty().append(this._generateHTML(f)).removeClass().addClass(f.options.keypadClass+(f.options.useThemeRoller?" ui-widget ui-widget-content":"")+(f.options.isRTL?" "+this._rtlClass:"")+" "+(f._inline?this._inlineClass:this._mainDivClass));if(a.isFunction(f.options.beforeShow)){f.options.beforeShow.apply((f._input?f._input[0]:null),[f._mainDiv,f])}},_getBorders:function(f){var e=function(g){return{thin:1,medium:3,thick:5}[g]||g};return[parseFloat(e(f.css("border-left-width"))),parseFloat(e(f.css("border-top-width")))]},_checkOffset:function(g,i,h){var j=g._input?this._findPos(g._input[0]):null;var f=window.innerWidth||document.documentElement.clientWidth;var e=window.innerHeight||document.documentElement.clientHeight;var k=document.documentElement.scrollLeft||document.body.scrollLeft;var l=document.documentElement.scrollTop||document.body.scrollTop;var m=0;g._mainDiv.find(":not(div)").each(function(){m=Math.max(m,this.offsetLeft+a(this).outerWidth(true))});g._mainDiv.css("width",m+1);if(g.options.isRTL||(i.left+g._mainDiv.outerWidth()-k)>f){i.left=Math.max((h?0:k),j[0]+(g._input?g._input.outerWidth():0)-(h?k:0)-g._mainDiv.outerWidth())}else{i.left=Math.max((h?0:k),i.left-(h?k:0))}if((i.top+g._mainDiv.outerHeight()-l)>e){i.top=Math.max((h?0:l),j[1]-(h?l:0)-g._mainDiv.outerHeight())}else{i.top=Math.max((h?0:l),i.top-(h?l:0))}return i},_findPos:function(e){while(e&&(e.type=="hidden"||e.nodeType!=1)){e=e.nextSibling}var f=a(e).offset();return[f.left,f.top]},hide:function(f,e){var g=this._curInst;if(!g||(f&&g!=a.data(f,this.propertyName))){return}if(this._keypadShowing){e=(e!=null?e:g.options.duration);var h=g.options.showAnim;if(a.effects&&(a.effects[h]||(a.effects.effect&&a.effects.effect[h]))){g._mainDiv.hide(h,g.options.showOptions||{},e)}else{g._mainDiv[(h=="slideDown"?"slideUp":(h=="fadeIn"?"fadeOut":"hide"))](h?e:0)}}if(a.isFunction(g.options.onClose)){g.options.onClose.apply((g._input?g._input[0]:null),[g._input.val(),g])}if(this._keypadShowing){this._keypadShowing=false;this._lastField=null}if(g._inline){g._input.val("")}this._curInst=null},_doKeyDown:function(e){if(e.keyCode==9){c.mainDiv.stop(true,true);c.hide()}},_checkExternalClick:function(e){if(!c._curInst){return}var f=a(e.target);if(f.closest("."+c._mainDivClass).length===0&&!f.hasClass(c._getMarker())&&f.closest("."+c._triggerClass).length===0&&c._keypadShowing){c.hide()}},_shiftKeypad:function(e){e.ucase=!e.ucase;this._updateKeypad(e);e._input.focus()},_clearValue:function(e){this._setValue(e,"",0);this._notifyKeypress(e,c.DEL)},_backValue:function(f){var e=f._input[0];var h=f._input.val();var g=[h.length,h.length];g=(f._input.prop("readonly")||f._input.prop("disabled")?g:(e.setSelectionRange?[e.selectionStart,e.selectionEnd]:(e.createTextRange?this._getIERange(e):g)));this._setValue(f,(h.length==0?"":h.substr(0,g[0]-1)+h.substr(g[1])),g[0]-1);this._notifyKeypress(f,c.BS)},_selectValue:function(e,f){this.insertValue(e._input[0],f);this._setValue(e,e._input.val());this._notifyKeypress(e,f)},insertValue:function(f,i){f=(f.jquery?f:a(f));var e=f[0];var g=f.val();var h=[g.length,g.length];h=(f.attr("readonly")||f.attr("disabled")?h:(e.setSelectionRange?[e.selectionStart,e.selectionEnd]:(e.createTextRange?this._getIERange(e):h)));f.val(g.substr(0,h[0])+i+g.substr(h[1]));pos=h[0]+i.length;if(f.is(":visible")){f.focus()}if(e.setSelectionRange){if(f.is(":visible")){e.setSelectionRange(pos,pos)}}else{if(e.createTextRange){h=e.createTextRange();h.move("character",pos);h.select()}}},_getIERange:function(h){h.focus();var i=document.selection.createRange().duplicate();var e=this._getIETextRange(h);e.setEndPoint("EndToStart",i);var g=function(m){var l=m.text;var n=l;var k=false;while(true){if(m.compareEndPoints("StartToEnd",m)==0){break}else{m.moveEnd("character",-1);if(m.text==l){n+="\r\n"}else{break}}}return n};var f=g(e);var j=g(i);return[f.length,f.length+j.length]},_getIETextRange:function(e){var f=(e.nodeName.toLowerCase()=="input");var g=(f?e.createTextRange():document.body.createTextRange());if(!f){g.moveToElementText(e)}return g},_setValue:function(e,g){var f=e._input.attr("maxlength");if(f>-1){g=g.substr(0,f)}e._input.val(g);if(!a.isFunction(e.options.onKeypress)){e._input.trigger("change")}},_notifyKeypress:function(e,f){if(a.isFunction(e.options.onKeypress)){e.options.onKeypress.apply((e._input?e._input[0]:null),[f,e._input.val(),e])}},_generateHTML:function(h){var f=(!h.options.prompt?"":'<div class="'+this._promptClass+(h.options.useThemeRoller?" ui-widget-header ui-corner-all":"")+'">'+h.options.prompt+"</div>");var n=this._randomiseLayout(h);for(var g=0;g<n.length;g++){f+='<div class="'+this._rowClass+'">';var m=n[g].split(h.options.separator);for(var k=0;k<m.length;k++){if(h.ucase){m[k]=h.options.toUpper(m[k])}var l=this._specialKeys[m[k].charCodeAt(0)];if(l){f+=(l.action?'<button type="button" class="'+this._specialClass+" "+this._namePrefixClass+l.name+(h.options.useThemeRoller?" ui-corner-all ui-state-default"+(l.noHighlight?"":" ui-state-highlight"):"")+'" title="'+h.options[l.name+"Status"]+'">'+(h.options[l.name+"Text"]||"&nbsp;")+"</button>":'<div class="'+this._namePrefixClass+l.name+'"></div>')}else{f+='<button type="button" class="'+this._keyClass+(h.options.useThemeRoller?" ui-corner-all ui-state-default":"")+'">'+(m[k]==" "?"&nbsp;":m[k])+"</button>"}}f+="</div>"}f=a(f);var o=h;var e=this._keyDownClass+(h.options.useThemeRoller?" ui-state-active":"");f.find("button").mousedown(function(){a(this).addClass(e)}).mouseup(function(){a(this).removeClass(e)}).mouseout(function(){a(this).removeClass(e)}).filter("."+this._keyClass).click(function(){c._selectValue(o,a(this).text())});a.each(this._specialKeys,function(j,p){f.find("."+c._namePrefixClass+p.name).click(function(){p.action.apply(o._input,[o])})});return f},_randomiseLayout:function(h){if(!h.options.randomiseNumeric&&!h.options.randomiseAlphabetic&&!h.options.randomiseOther&&!h.options.randomiseAll){return h.options.layout}var q=[];var f=[];var s=[];var p=[];for(var g=0;g<h.options.layout.length;g++){p[g]="";var l=h.options.layout[g].split(h.options.separator);for(var k=0;k<l.length;k++){if(this._isControl(l[k])){continue}if(h.options.randomiseAll){s.push(l[k])}else{if(h.options.isNumeric(l[k])){q.push(l[k])}else{if(h.options.isAlphabetic(l[k])){f.push(l[k])}else{s.push(l[k])}}}}}if(h.options.randomiseNumeric){this._shuffle(q)}if(h.options.randomiseAlphabetic){this._shuffle(f)}if(h.options.randomiseOther||h.options.randomiseAll){this._shuffle(s)}var m=0;var e=0;var r=0;for(var g=0;g<h.options.layout.length;g++){var l=h.options.layout[g].split(h.options.separator);for(var k=0;k<l.length;k++){p[g]+=(this._isControl(l[k])?l[k]:(h.options.randomiseAll?s[r++]:(h.options.isNumeric(l[k])?q[m++]:(h.options.isAlphabetic(l[k])?f[e++]:s[r++]))))+h.options.separator}}return p},_isControl:function(e){return e<" "},isAlphabetic:function(e){return(e>="A"&&e<="Z")||(e>="a"&&e<="z")},isNumeric:function(e){return(e>="0"&&e<="9")},toUpper:function(e){return e.toUpperCase()},_shuffle:function(h){for(var f=h.length-1;f>0;f--){var g=Math.floor(Math.random()*h.length);var e=h[f];h[f]=h[g];h[g]=e}}});var c=a.keypad;c.addKeyDef("CLOSE","close",function(e){c._curInst=(e._inline?e:c._curInst);c.hide()});c.addKeyDef("CLEAR","clear",function(e){c._clearValue(e)});c.addKeyDef("BACK","back",function(e){c._backValue(e)});c.addKeyDef("SHIFT","shift",function(e){c._shiftKeypad(e)});c.addKeyDef("SPACE_BAR","spacebar",function(e){c._selectValue(e," ")},true);c.addKeyDef("SPACE","space");c.addKeyDef("HALF_SPACE","half-space");c.addKeyDef("ENTER","enter",function(e){c._selectValue(e,"\x0D")},true);c.addKeyDef("TAB","tab",function(e){c._selectValue(e,"\x09")},true);c.numericLayout=["123"+c.CLOSE,"456"+c.CLEAR,"789"+c.BACK,c.SPACE+"0"];c.qwertyLayout=["!@#$%^&*()_="+c.HALF_SPACE+c.SPACE+c.CLOSE,c.HALF_SPACE+"`~[]{}<>\\|/"+c.SPACE+"789","qwertyuiop'\""+c.HALF_SPACE+"456",c.HALF_SPACE+"asdfghjkl;:"+c.SPACE+"123",c.SPACE+"zxcvbnm,.?"+c.SPACE+c.HALF_SPACE+"-0+",""+c.TAB+c.ENTER+c.SPACE_BAR+c.SHIFT+c.HALF_SPACE+c.BACK+c.CLEAR],a.extend(c.regionalOptions[""],{alphabeticLayout:c.qwertyAlphabetic,fullLayout:c.qwertyLayout,isAlphabetic:c.isAlphabetic,isNumeric:c.isNumeric,toUpper:c.toUpper});c.setDefaults(a.extend({layout:c.numericLayout},c.regionalOptions[""]));a(function(){a(document.body).append(c.mainDiv).mousedown(c._checkExternalClick)})})(jQuery);!function(a){var c=(function(){var f=[];var d=false;var h;var g=function(i){clearTimeout(h);h=setTimeout(e,100)};var e=function(){for(var k=0,j=f.length;k<j;k++){f[k].apply()}};return{register:function(i){f.push(i);if(d===false){a(window).bind("resize",g);d=true}},unregister:function(k){for(var l=0,j=f.length;l<j;l++){if(f[l]==k){delete f[l];break}}}}}());var b=function(d,e){this.element=a(d);this.dropdown=a('<li class="dropdown hide pull-right tabdrop"><a class="dropdown-toggle" data-toggle="dropdown" href="#">'+e.text+' <b class="caret"></b></a><ul class="dropdown-menu tab-drop-dropdown-menu"></ul></li>').prependTo(this.element);if(this.element.parent().is(".tabs-below")){this.dropdown.addClass("dropup")}c.register(a.proxy(this.layout,this));this.layout()};b.prototype={constructor:b,layout:function(){var d=[];this.dropdown.removeClass("hide");this.element.append(this.dropdown.find("li")).find(">li").not(".tabdrop").each(function(){if(this.offsetTop>0){d.push(this)}});if(d.length>0){d=a(d);this.dropdown.find("ul").empty().append(d);if(this.dropdown.find(".active").length==1){this.dropdown.addClass("active")}else{this.dropdown.removeClass("active")}}else{this.dropdown.addClass("hide")}}};a.fn.tabdrop=function(d){return this.each(function(){var e=a(this),f=e.data("tabdrop"),g=typeof d==="object"&&d;if(!f){e.data("tabdrop",(f=new b(this,a.extend({},a.fn.tabdrop.defaults,g))))}if(typeof d=="string"){f[d]()}})};a.fn.tabdrop.defaults={text:'<i class="icon-align-justify"></i>'};a.fn.tabdrop.Constructor=b}(window.jQuery);var AaronWasHere=1;var pDosWasHere=1;var hiddenOptimizeFlag=true;function selectElementContents(a){var b=document.createRange();b.selectNodeContents(a);var c=window.getSelection();c.removeAllRanges();c.addRange(b)}(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof module==="object"&&module.exports){module.exports=a(require("jquery"))}else{a(window.jQuery)}}}(function($){var func=(function(){var eq=function(itemA){return function(itemB){return itemA===itemB}};var eq2=function(itemA,itemB){return itemA===itemB};var peq2=function(propName){return function(itemA,itemB){return itemA[propName]===itemB[propName]}};var ok=function(){return true};var fail=function(){return false};var not=function(f){return function(){return !f.apply(f,arguments)}};var and=function(fA,fB){return function(item){return fA(item)&&fB(item)}};var self=function(a){return a};var invoke=function(obj,method){return function(){return obj[method].apply(obj,arguments)}};var idCounter=0;var uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};var rect2bnd=function(rect){var $document=$(document);return{top:rect.top+$document.scrollTop(),left:rect.left+$document.scrollLeft(),width:rect.right-rect.left,height:rect.bottom-rect.top}};var invertObject=function(obj){var inverted={};for(var key in obj){if(obj.hasOwnProperty(key)){inverted[obj[key]]=key}}return inverted};var namespaceToCamel=function(namespace,prefix){prefix=prefix||"";return prefix+namespace.split(".").map(function(name){return name.substring(0,1).toUpperCase()+name.substring(1)}).join("")};var debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate){func.apply(context,args)}};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){func.apply(context,args)}}};return{eq:eq,eq2:eq2,peq2:peq2,ok:ok,fail:fail,self:self,not:not,and:and,invoke:invoke,uniqueId:uniqueId,rect2bnd:rect2bnd,invertObject:invertObject,namespaceToCamel:namespaceToCamel,debounce:debounce}})();var list=(function(){var head=function(array){return array[0]};var last=function(array){return array[array.length-1]};var initial=function(array){return array.slice(0,array.length-1)};var tail=function(array){return array.slice(1)};var find=function(array,pred){for(var idx=0,len=array.length;idx<len;idx++){var item=array[idx];if(pred(item)){return item}}};var all=function(array,pred){for(var idx=0,len=array.length;idx<len;idx++){if(!pred(array[idx])){return false}}return true};var indexOf=function(array,item){return $.inArray(item,array)};var contains=function(array,item){return indexOf(array,item)!==-1};var sum=function(array,fn){fn=fn||func.self;return array.reduce(function(memo,v){return memo+fn(v)},0)};var from=function(collection){var result=[],idx=-1,length=collection.length;while(++idx<length){result[idx]=collection[idx]}return result};var isEmpty=function(array){return !array||!array.length};var clusterBy=function(array,fn){if(!array.length){return[]}var aTail=tail(array);return aTail.reduce(function(memo,v){var aLast=last(memo);if(fn(last(aLast),v)){aLast[aLast.length]=v}else{memo[memo.length]=[v]}return memo},[[head(array)]])};var compact=function(array){var aResult=[];for(var idx=0,len=array.length;idx<len;idx++){if(array[idx]){aResult.push(array[idx])}}return aResult};var unique=function(array){var results=[];for(var idx=0,len=array.length;idx<len;idx++){if(!contains(results,array[idx])){results.push(array[idx])}}return results};var next=function(array,item){var idx=indexOf(array,item);if(idx===-1){return null}return array[idx+1]};var prev=function(array,item){var idx=indexOf(array,item);if(idx===-1){return null}return array[idx-1]};return{head:head,last:last,initial:initial,tail:tail,prev:prev,next:next,find:find,contains:contains,all:all,sum:sum,from:from,isEmpty:isEmpty,clusterBy:clusterBy,compact:compact,unique:unique}})();var isSupportAmd=typeof define==="function"&&define.amd;var isFontInstalled=function(fontName){if(fontName.toLowerCase().indexOf("open")>=0){return false}if(fontName.toLowerCase().indexOf("helv")>=0){return false}if(fontName.toLowerCase().indexOf("sans-se")>=0){return false}return true};var userAgent=navigator.userAgent;var isMSIE=/MSIE|Trident/i.test(userAgent);var browserVersion;if(isMSIE){var matches=/MSIE (\d+[.]\d+)/.exec(userAgent);if(matches){browserVersion=parseFloat(matches[1])}matches=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(userAgent);if(matches){browserVersion=parseFloat(matches[1])}}var isEdge=/Edge\/\d+/.test(userAgent);var hasCodeMirror=!!window.CodeMirror;if(!hasCodeMirror&&isSupportAmd&&typeof require!=="undefined"){if(typeof require.resolve!=="undefined"){try{require.resolve("codemirror");hasCodeMirror=true}catch(e){}}else{if(typeof eval("require").specified!=="undefined"){hasCodeMirror=eval("require").specified("codemirror")}}}var agent={isMac:navigator.appVersion.indexOf("Mac")>-1,isMSIE:isMSIE,isEdge:isEdge,isFF:!isEdge&&/firefox/i.test(userAgent),isPhantom:/PhantomJS/i.test(userAgent),isWebkit:!isEdge&&/webkit/i.test(userAgent),isChrome:!isEdge&&/chrome/i.test(userAgent),isSafari:!isEdge&&/safari/i.test(userAgent),browserVersion:browserVersion,jqueryVersion:parseFloat($.fn.jquery),isSupportAmd:isSupportAmd,hasCodeMirror:hasCodeMirror,isFontInstalled:isFontInstalled,isW3CRangeSupport:!!document.createRange};var NBSP_CHAR=String.fromCharCode(160);var ZERO_WIDTH_NBSP_CHAR="\ufeff";var dom=(function(){var isEditable=function(node){return node&&$(node).hasClass("note-editable")};var isControlSizing=function(node){return node&&$(node).hasClass("note-control-sizing")};var makePredByNodeName=function(nodeName){nodeName=nodeName.toUpperCase();return function(node){return node&&node.nodeName.toUpperCase()===nodeName}};var isText=function(node){return node&&node.nodeType===3};var isElement=function(node){return node&&node.nodeType===1};var isVoid=function(node){return node&&/^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(node.nodeName.toUpperCase())};var isPara=function(node){if(isEditable(node)){return false}return node&&/^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase())};var isHeading=function(node){return node&&/^H[1-7]/.test(node.nodeName.toUpperCase())};var isPre=makePredByNodeName("PRE");var isLi=makePredByNodeName("LI");var isPurePara=function(node){return isPara(node)&&!isLi(node)};var isTable=makePredByNodeName("TABLE");var isData=makePredByNodeName("DATA");var isInline=function(node){return !isBodyContainer(node)&&!isList(node)&&!isHr(node)&&!isPara(node)&&!isTable(node)&&!isBlockquote(node)&&!isData(node)};var isList=function(node){return node&&/^UL|^OL/.test(node.nodeName.toUpperCase())};var isHr=makePredByNodeName("HR");var isCell=function(node){return node&&/^TD|^TH/.test(node.nodeName.toUpperCase())};var isBlockquote=makePredByNodeName("BLOCKQUOTE");var isBodyContainer=function(node){return isCell(node)||isBlockquote(node)||isEditable(node)};var isAnchor=makePredByNodeName("A");var isParaInline=function(node){return isInline(node)&&!!ancestor(node,isPara)};var isBodyInline=function(node){return isInline(node)&&!ancestor(node,isPara)};var isBody=makePredByNodeName("BODY");var isClosestSibling=function(nodeA,nodeB){return nodeA.nextSibling===nodeB||nodeA.previousSibling===nodeB};var withClosestSiblings=function(node,pred){pred=pred||func.ok;var siblings=[];if(node.previousSibling&&pred(node.previousSibling)){siblings.push(node.previousSibling)}siblings.push(node);if(node.nextSibling&&pred(node.nextSibling)){siblings.push(node.nextSibling)}return siblings};var blankHTML=agent.isMSIE&&agent.browserVersion<11?"&nbsp;":"<br>";var nodeLength=function(node){if(isText(node)){return node.nodeValue.length}if(node){return node.childNodes.length}return 0};var isEmpty=function(node){var len=nodeLength(node);if(len===0){return true}else{if(!isText(node)&&len===1&&node.innerHTML===blankHTML){return true}else{if(list.all(node.childNodes,isText)&&node.innerHTML===""){return true}}}return false};var paddingBlankHTML=function(node){if(!isVoid(node)&&!nodeLength(node)){node.innerHTML=blankHTML}};var ancestor=function(node,pred){while(node){if(pred(node)){return node}if(isEditable(node)){break}node=node.parentNode}return null};var singleChildAncestor=function(node,pred){node=node.parentNode;while(node){if(nodeLength(node)!==1){break}if(pred(node)){return node}if(isEditable(node)){break}node=node.parentNode}return null};var listAncestor=function(node,pred){pred=pred||func.fail;var ancestors=[];ancestor(node,function(el){if(!isEditable(el)){ancestors.push(el)}return pred(el)});return ancestors};var lastAncestor=function(node,pred){var ancestors=listAncestor(node);return list.last(ancestors.filter(pred))};var commonAncestor=function(nodeA,nodeB){var ancestors=listAncestor(nodeA);for(var n=nodeB;n;n=n.parentNode){if($.inArray(n,ancestors)>-1){return n}}return null};var listPrev=function(node,pred){pred=pred||func.fail;var nodes=[];while(node){if(pred(node)){break}nodes.push(node);node=node.previousSibling}return nodes};var listNext=function(node,pred){pred=pred||func.fail;var nodes=[];while(node){if(pred(node)){break}nodes.push(node);node=node.nextSibling}return nodes};var listDescendant=function(node,pred){var descendants=[];pred=pred||func.ok;(function fnWalk(current){if(node!==current&&pred(current)){descendants.push(current)}for(var idx=0,len=current.childNodes.length;idx<len;idx++){fnWalk(current.childNodes[idx])}})(node);return descendants};var wrap=function(node,wrapperName){var parent=node.parentNode;var wrapper=$("<"+wrapperName+">")[0];parent.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper};var insertAfter=function(node,preceding){var next=preceding.nextSibling,parent=preceding.parentNode;if(next){parent.insertBefore(node,next)}else{parent.appendChild(node)}return node};var appendChildNodes=function(node,aChild){$.each(aChild,function(idx,child){node.appendChild(child)});return node};var isLeftEdgePoint=function(point){return point.offset===0};var isRightEdgePoint=function(point){return point.offset===nodeLength(point.node)};var isEdgePoint=function(point){return isLeftEdgePoint(point)||isRightEdgePoint(point)};var isLeftEdgeOf=function(node,ancestor){while(node&&node!==ancestor){if(position(node)!==0){return false}node=node.parentNode}return true};var isRightEdgeOf=function(node,ancestor){if(!ancestor){return false}while(node&&node!==ancestor){if(position(node)!==nodeLength(node.parentNode)-1){return false}node=node.parentNode}return true};var isLeftEdgePointOf=function(point,ancestor){return isLeftEdgePoint(point)&&isLeftEdgeOf(point.node,ancestor)};var isRightEdgePointOf=function(point,ancestor){return isRightEdgePoint(point)&&isRightEdgeOf(point.node,ancestor)};var position=function(node){var offset=0;while((node=node.previousSibling)){offset+=1}return offset};var hasChildren=function(node){return !!(node&&node.childNodes&&node.childNodes.length)};var prevPoint=function(point,isSkipInnerOffset){var node,offset;if(point.offset===0){if(isEditable(point.node)){return null}node=point.node.parentNode;offset=position(point.node)}else{if(hasChildren(point.node)){node=point.node.childNodes[point.offset-1];offset=nodeLength(node)}else{node=point.node;offset=isSkipInnerOffset?0:point.offset-1}}return{node:node,offset:offset}};var nextPoint=function(point,isSkipInnerOffset){var node,offset;if(nodeLength(point.node)===point.offset){if(isEditable(point.node)){return null}node=point.node.parentNode;offset=position(point.node)+1}else{if(hasChildren(point.node)){node=point.node.childNodes[point.offset];offset=0}else{node=point.node;offset=isSkipInnerOffset?nodeLength(point.node):point.offset+1}}return{node:node,offset:offset}};var isSamePoint=function(pointA,pointB){return pointA.node===pointB.node&&pointA.offset===pointB.offset};var isVisiblePoint=function(point){if(isText(point.node)||!hasChildren(point.node)||isEmpty(point.node)){return true}var leftNode=point.node.childNodes[point.offset-1];var rightNode=point.node.childNodes[point.offset];if((!leftNode||isVoid(leftNode))&&(!rightNode||isVoid(rightNode))){return true}return false};var prevPointUntil=function(point,pred){while(point){if(pred(point)){return point}point=prevPoint(point)}return null};var nextPointUntil=function(point,pred){while(point){if(pred(point)){return point}point=nextPoint(point)}return null};var isCharPoint=function(point){if(!isText(point.node)){return false}var ch=point.node.nodeValue.charAt(point.offset-1);return ch&&(ch!==" "&&ch!==NBSP_CHAR)};var walkPoint=function(startPoint,endPoint,handler,isSkipInnerOffset){var point=startPoint;while(point){handler(point);if(isSamePoint(point,endPoint)){break}var isSkipOffset=isSkipInnerOffset&&startPoint.node!==point.node&&endPoint.node!==point.node;point=nextPoint(point,isSkipOffset)}};var makeOffsetPath=function(ancestor,node){var ancestors=listAncestor(node,func.eq(ancestor));return ancestors.map(position).reverse()};var fromOffsetPath=function(ancestor,offsets){var current=ancestor;for(var i=0,len=offsets.length;i<len;i++){if(current.childNodes.length<=offsets[i]){current=current.childNodes[current.childNodes.length-1]}else{current=current.childNodes[offsets[i]]}}return current};var splitNode=function(point,options){var isSkipPaddingBlankHTML=options&&options.isSkipPaddingBlankHTML;var isNotSplitEdgePoint=options&&options.isNotSplitEdgePoint;if(isEdgePoint(point)&&(isText(point.node)||isNotSplitEdgePoint)){if(isLeftEdgePoint(point)){return point.node}else{if(isRightEdgePoint(point)){return point.node.nextSibling}}}if(isText(point.node)){return point.node.splitText(point.offset)}else{var childNode=point.node.childNodes[point.offset];var clone=insertAfter(point.node.cloneNode(false),point.node);appendChildNodes(clone,listNext(childNode));if(!isSkipPaddingBlankHTML){paddingBlankHTML(point.node);paddingBlankHTML(clone)}return clone}};var splitTree=function(root,point,options){var ancestors=listAncestor(point.node,func.eq(root));if(!ancestors.length){return null}else{if(ancestors.length===1){return splitNode(point,options)}}return ancestors.reduce(function(node,parent){if(node===point.node){node=splitNode(point,options)}return splitNode({node:parent,offset:node?dom.position(node):nodeLength(parent)},options)})};var splitPoint=function(point,isInline){var pred=isInline?isPara:isBodyContainer;var ancestors=listAncestor(point.node,pred);var topAncestor=list.last(ancestors)||point.node;var splitRoot,container;if(pred(topAncestor)){splitRoot=ancestors[ancestors.length-2];container=topAncestor}else{splitRoot=topAncestor;container=splitRoot.parentNode}var pivot=splitRoot&&splitTree(splitRoot,point,{isSkipPaddingBlankHTML:isInline,isNotSplitEdgePoint:isInline});if(!pivot&&container===point.node){pivot=point.node.childNodes[point.offset]}return{rightNode:pivot,container:container}};var create=function(nodeName){return document.createElement(nodeName)};var createText=function(text){return document.createTextNode(text)};var remove=function(node,isRemoveChild){if(!node||!node.parentNode){return}if(node.removeNode){return node.removeNode(isRemoveChild)}var parent=node.parentNode;if(!isRemoveChild){var nodes=[];var i,len;for(i=0,len=node.childNodes.length;i<len;i++){nodes.push(node.childNodes[i])}for(i=0,len=nodes.length;i<len;i++){parent.insertBefore(nodes[i],node)}}parent.removeChild(node)};var removeWhile=function(node,pred){while(node){if(isEditable(node)||!pred(node)){break}var parent=node.parentNode;remove(node);node=parent}};var replace=function(node,nodeName){if(node.nodeName.toUpperCase()===nodeName.toUpperCase()){return node}var newNode=create(nodeName);if(node.style.cssText){newNode.style.cssText=node.style.cssText}appendChildNodes(newNode,list.from(node.childNodes));insertAfter(newNode,node);remove(node);return newNode};var isTextarea=makePredByNodeName("TEXTAREA");var value=function($node,stripLinebreaks){var val=isTextarea($node[0])?$node.val():$node.html();if(stripLinebreaks){return val.replace(/[\n\r]/g,"")}return val};var html=function($node,isNewlineOnBlock){var markup=value($node);if(isNewlineOnBlock){var regexTag=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;markup=markup.replace(regexTag,function(match,endSlash,name){name=name.toUpperCase();var isEndOfInlineContainer=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name)&&!!endSlash;var isBlockNode=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);return match+((isEndOfInlineContainer||isBlockNode)?"\n":"")});markup=$.trim(markup)}return markup};var posFromPlaceholder=function(placeholder){var $placeholder=$(placeholder);var pos=$placeholder.offset();var height=$placeholder.outerHeight(true);return{left:pos.left,top:pos.top+height}};var attachEvents=function($node,events){Object.keys(events).forEach(function(key){$node.on(key,events[key])})};var detachEvents=function($node,events){Object.keys(events).forEach(function(key){$node.off(key,events[key])})};return{NBSP_CHAR:NBSP_CHAR,ZERO_WIDTH_NBSP_CHAR:ZERO_WIDTH_NBSP_CHAR,blank:blankHTML,emptyPara:"<p>"+blankHTML+"</p>",makePredByNodeName:makePredByNodeName,isEditable:isEditable,isControlSizing:isControlSizing,isText:isText,isElement:isElement,isVoid:isVoid,isPara:isPara,isPurePara:isPurePara,isHeading:isHeading,isInline:isInline,isBlock:func.not(isInline),isBodyInline:isBodyInline,isBody:isBody,isParaInline:isParaInline,isPre:isPre,isList:isList,isTable:isTable,isData:isData,isCell:isCell,isBlockquote:isBlockquote,isBodyContainer:isBodyContainer,isAnchor:isAnchor,isDiv:makePredByNodeName("DIV"),isLi:isLi,isBR:makePredByNodeName("BR"),isSpan:makePredByNodeName("SPAN"),isB:makePredByNodeName("B"),isU:makePredByNodeName("U"),isS:makePredByNodeName("S"),isI:makePredByNodeName("I"),isImg:makePredByNodeName("IMG"),isTextarea:isTextarea,isEmpty:isEmpty,isEmptyAnchor:func.and(isAnchor,isEmpty),isClosestSibling:isClosestSibling,withClosestSiblings:withClosestSiblings,nodeLength:nodeLength,isLeftEdgePoint:isLeftEdgePoint,isRightEdgePoint:isRightEdgePoint,isEdgePoint:isEdgePoint,isLeftEdgeOf:isLeftEdgeOf,isRightEdgeOf:isRightEdgeOf,isLeftEdgePointOf:isLeftEdgePointOf,isRightEdgePointOf:isRightEdgePointOf,prevPoint:prevPoint,nextPoint:nextPoint,isSamePoint:isSamePoint,isVisiblePoint:isVisiblePoint,prevPointUntil:prevPointUntil,nextPointUntil:nextPointUntil,isCharPoint:isCharPoint,walkPoint:walkPoint,ancestor:ancestor,singleChildAncestor:singleChildAncestor,listAncestor:listAncestor,lastAncestor:lastAncestor,listNext:listNext,listPrev:listPrev,listDescendant:listDescendant,commonAncestor:commonAncestor,wrap:wrap,insertAfter:insertAfter,appendChildNodes:appendChildNodes,position:position,hasChildren:hasChildren,makeOffsetPath:makeOffsetPath,fromOffsetPath:fromOffsetPath,splitTree:splitTree,splitPoint:splitPoint,create:create,createText:createText,remove:remove,removeWhile:removeWhile,replace:replace,html:html,value:value,posFromPlaceholder:posFromPlaceholder,attachEvents:attachEvents,detachEvents:detachEvents}})();var Context=function($note,options){var self=this;var ui=$.summernote.ui;this.memos={};this.modules={};this.layoutInfo={};this.options=options;this.initialize=function(){this.layoutInfo=ui.createLayout($note,options);this._initialize();$note.hide();return this};this.destroy=function(){this._destroy();$note.removeData("summernote");ui.removeLayout($note,this.layoutInfo)};this.reset=function(){var disabled=self.isDisabled();this.code(dom.emptyPara);this._destroy();this._initialize();if(disabled){self.disable()}};this._initialize=function(){var buttons=$.extend({},this.options.buttons);Object.keys(buttons).forEach(function(key){self.memo("button."+key,buttons[key])});var modules=$.extend({},this.options.modules,$.summernote.plugins||{});Object.keys(modules).forEach(function(key){self.module(key,modules[key],true)});Object.keys(this.modules).forEach(function(key){self.initializeModule(key)})};this._destroy=function(){Object.keys(this.modules).reverse().forEach(function(key){self.removeModule(key)});Object.keys(this.memos).forEach(function(key){self.removeMemo(key)})};this.code=function(html){var isActivated=this.invoke("codeview.isActivated");if(html===undefined){this.invoke("codeview.sync");return isActivated?this.layoutInfo.codable.val():this.layoutInfo.editable.html()}else{if(isActivated){this.layoutInfo.codable.val(html)}else{this.layoutInfo.editable.html(html)}$note.val(html);if(hiddenOptimizeFlag){this.triggerEvent("change",html);hiddenOptimizeFlag=false}}};this.isDisabled=function(){return this.layoutInfo.editable.attr("contenteditable")==="false"};this.enable=function(){this.layoutInfo.editable.attr("contenteditable",true);this.invoke("toolbar.activate",true)};this.disable=function(){if(this.invoke("codeview.isActivated")){this.invoke("codeview.deactivate")}this.layoutInfo.editable.attr("contenteditable",false);this.invoke("toolbar.deactivate",true)};this.triggerEvent=function(){var namespace=list.head(arguments);var args=list.tail(list.from(arguments));var callback=this.options.callbacks[func.namespaceToCamel(namespace,"on")];if(callback){callback.apply($note[0],args)}$note.trigger("summernote."+namespace,args)};this.initializeModule=function(key){var module=this.modules[key];module.shouldInitialize=module.shouldInitialize||func.ok;if(!module.shouldInitialize()){return}if(module.initialize){module.initialize()}if(module.events){dom.attachEvents($note,module.events)}};this.module=function(key,ModuleClass,withoutIntialize){if(arguments.length===1){return this.modules[key]}this.modules[key]=new ModuleClass(this);if(!withoutIntialize){this.initializeModule(key)}};this.removeModule=function(key){var module=this.modules[key];if(module.shouldInitialize()){if(module.events){dom.detachEvents($note,module.events)}if(module.destroy){module.destroy()}}delete this.modules[key]};this.memo=function(key,obj){if(arguments.length===1){return this.memos[key]}this.memos[key]=obj};this.removeMemo=function(key){if(this.memos[key]&&this.memos[key].destroy){this.memos[key].destroy()}delete this.memos[key]};this.createInvokeHandler=function(namespace,value){return function(event){event.preventDefault();value=value||$(event.target).closest("[data-value]").data("value");if(namespace==="editor.fontName"||namespace==="editor.fontSize"){try{value=$(event.target).closest("[data-value]").data("value")||$($(event.target).children()[1]).attr("data-value")}catch(e){LogErrorMessage("SbtSummerNote.Get Data value",e)}}self.invoke(namespace,value)}};this.invoke=function(){var namespace=list.head(arguments);var args=list.tail(list.from(arguments));var splits=namespace.split(".");var hasSeparator=splits.length>1;var moduleName=hasSeparator&&list.head(splits);var methodName=hasSeparator?list.last(splits):list.head(splits);var module=this.modules[moduleName||"editor"];if(!moduleName&&this[methodName]){return this[methodName].apply(this,args)}else{if(module&&module[methodName]&&module.shouldInitialize()){return module[methodName].apply(module,args)}}};return this.initialize()};$.fn.extend({summernote:function(){var type=$.type(list.head(arguments));var isExternalAPICalled=type==="string";var hasInitOptions=type==="object";var options=hasInitOptions?list.head(arguments):{};options=$.extend({},$.summernote.options,options);options.langInfo=$.extend(true,{},$.summernote.lang["en-US"],$.summernote.lang[options.lang]);options.icons=$.extend(true,{},$.summernote.options.icons,options.icons);this.each(function(idx,note){var $note=$(note);if(!$note.data("summernote")){var context=new Context($note,options);$note.data("summernote",context);$note.data("summernote").triggerEvent("init",context.layoutInfo)}});var $note=this.first();if($note.length){var context=$note.data("summernote");if(isExternalAPICalled){var res=context.invoke.apply(context,list.from(arguments));return res}else{if(options.focus){context.invoke("editor.focus")}}}return this}});var Renderer=function(markup,children,options,callback){this.render=function($parent){var $node=$(markup);if(options&&options.contents){$node.html(options.contents)}if(options&&options.className){$node.addClass(options.className)}if(options&&options.data){$.each(options.data,function(k,v){$node.attr("data-"+k,v)})}if(options&&options.click){$node.on("click",options.click)}if(children){var $container=$node.find(".note-children-container");children.forEach(function(child){child.render($container.length?$container:$node)})}if(callback){callback($node,options)}if(options&&options.callback){options.callback($node)}if($parent){$parent.append($node)}return $node}};var renderer={create:function(markup,callback){return function(){var children=$.isArray(arguments[0])?arguments[0]:[];var options=typeof arguments[1]==="object"?arguments[1]:arguments[0];if(options&&options.children){children=options.children}return new Renderer(markup,children,options,callback)}}};var editor=renderer.create('<div class="note-editor note-frame panel panel-default"/>');var toolbar=renderer.create('<div class="note-toolbar panel-heading"/>');var editingArea=renderer.create('<div class="note-editing-area"/>');var codable=renderer.create('<textarea class="note-codable"/>');var editable=renderer.create('<div class="note-editable panel-body" contentEditable="true"/>');var statusbar=renderer.create(['<div class="note-statusbar">','  <div class="note-resizebar">','    <div class="note-icon-bar"/>','    <div class="note-icon-bar"/>','    <div class="note-icon-bar"/>',"  </div>","</div>"].join(""));var airEditor=renderer.create('<div class="note-editor"/>');var airEditable=renderer.create('<div class="note-editable" contentEditable="true"/>');var buttonGroup=renderer.create('<div class="note-btn-group btn-group">');var button=renderer.create('<button type="button" class="note-btn btn btn-default btn-sm" tabindex="-1">',function($node,options){if(options&&options.tooltip){$node.attr({title:options.tooltip}).tooltip({container:"body",trigger:"hover",placement:"bottom"})}});var dropdown=renderer.create('<div class="dropdown-menu">',function($node,options){var markup=$.isArray(options.items)?options.items.map(function(item){var value=(typeof item==="string")?item:(item.value||"");var content=options.template?options.template(item):item;return'<li><a href="#" data-value="'+value+'">'+content+"</a></li>"}).join(""):options.items;$node.html(markup)});var dropdownCheck=renderer.create('<div class="dropdown-menu note-check">',function($node,options){var markup=$.isArray(options.items)?options.items.map(function(item){var value=(typeof item==="string")?item:(item.value||"");var content=options.template?options.template(item):item;return'<li><a href="#" data-value="'+value+'">'+icon(options.checkClassName)+" "+content+"</a></li>"}).join(""):options.items;$node.html(markup)});var palette=renderer.create('<div class="note-color-palette"/>',function($node,options){var contents=[];for(var row=0,rowSize=options.colors.length;row<rowSize;row++){var eventName=options.eventName;var colors=options.colors[row];var buttons=[];for(var col=0,colSize=colors.length;col<colSize;col++){var color=colors[col];buttons.push(['<button type="button" class="note-color-btn"','style="background-color:',color,'" ','data-event="',eventName,'" ','data-value="',color,'" ','title="',color,'" ','data-toggle="button" tabindex="-1"></button>'].join(""))}contents.push('<div class="note-color-row">'+buttons.join("")+"</div>")}$node.html(contents.join(""));$node.find(".note-color-btn").tooltip({container:"body",trigger:"hover",placement:"bottom"})});var dialog=renderer.create('<div class="modal" aria-hidden="false" tabindex="-1"/>',function($node,options){if(options.fade){$node.addClass("fade")}$node.html(['<div class="modal-dialog">','  <div class="modal-content">',(options.title?'    <div class="modal-header">      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>      <h4 class="modal-title">'+options.title+"</h4>    </div>":""),'    <div class="modal-body">'+options.body+"</div>",(options.footer?'    <div class="modal-footer">'+options.footer+"</div>":""),"  </div>","</div>"].join(""))});var popover=renderer.create(['<div class="note-popover popover in">','  <div class="arrow"/>','  <div class="popover-content note-children-container"/>',"</div>"].join(""),function($node,options){var direction=typeof options.direction!=="undefined"?options.direction:"bottom";$node.addClass(direction);if(options.hideArrow){$node.find(".arrow").hide()}});var icon=function(iconClassName,tagName){tagName=tagName||"i";return"<"+tagName+' class="'+iconClassName+'"/>'};var ui={editor:editor,toolbar:toolbar,editingArea:editingArea,codable:codable,editable:editable,statusbar:statusbar,airEditor:airEditor,airEditable:airEditable,buttonGroup:buttonGroup,button:button,dropdown:dropdown,dropdownCheck:dropdownCheck,palette:palette,dialog:dialog,popover:popover,icon:icon,toggleBtn:function($btn,isEnable){$btn.toggleClass("disabled",!isEnable);$btn.attr("disabled",!isEnable)},toggleBtnActive:function($btn,isActive){$btn.toggleClass("active",isActive)},onDialogShown:function($dialog,handler){$dialog.one("shown.bs.modal",handler)},onDialogHidden:function($dialog,handler){$dialog.one("hidden.bs.modal",handler)},showDialog:function($dialog){$dialog.modal("show")},hideDialog:function($dialog){$dialog.modal("hide")},createLayout:function($note,options){var $editor=(options.airMode?ui.airEditor([ui.editingArea([ui.airEditable()])]):ui.editor([ui.toolbar(),ui.editingArea([ui.codable(),ui.editable()]),ui.statusbar()])).render();$editor.insertAfter($note);return{note:$note,editor:$editor,toolbar:$editor.find(".note-toolbar"),editingArea:$editor.find(".note-editing-area"),editable:$editor.find(".note-editable"),codable:$editor.find(".note-codable"),statusbar:$editor.find(".note-statusbar")}},removeLayout:function($note,layoutInfo){$note.html(layoutInfo.editable.html());layoutInfo.editor.remove();$note.show()}};$.summernote=$.summernote||{lang:{}};$.extend($.summernote.lang,{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",clear:"Remove Font Style",height:"Line Height",name:"Font Family",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",size:"Font Size"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag image or text here",dropImage:"Drop image or Text",selectFromFiles:"Select from files",maximumFileSize:"Maximum file size",maximumFileSizeError:"Maximum file size exceeded.",url:"Image URL",remove:"Remove Image"},video:{video:"Video",videoLink:"Video Link",insert:"Insert Video",url:"Video URL?",providers:"(YouTube, Vimeo, Vine, Instagram, DailyMotion or Youku)"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",align:"Align",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style",extraKeys:"Extra keys"},help:{insertParagraph:"Insert Paragraph",undo:"Undoes the last command",redo:"Redoes the last command",tab:"Tab",untab:"Untab",bold:"Set a bold style",italic:"Set a italic style",underline:"Set a underline style",strikethrough:"Set a strikethrough style",removeFormat:"Clean a style",justifyLeft:"Set left align",justifyCenter:"Set center align",justifyRight:"Set right align",justifyFull:"Set full align",insertUnorderedList:"Toggle unordered list",insertOrderedList:"Toggle ordered list",outdent:"Outdent on current paragraph",indent:"Indent on current paragraph",formatPara:"Change current block's format as a paragraph(P tag)",formatH1:"Change current block's format as H1",formatH2:"Change current block's format as H2",formatH3:"Change current block's format as H3",formatH4:"Change current block's format as H4",formatH5:"Change current block's format as H5",formatH6:"Change current block's format as H6",insertHorizontalRule:"Insert horizontal rule","linkDialog.show":"Show Link Dialog"},history:{undo:"Undo",redo:"Redo"},specialChar:{specialChar:"SPECIAL CHARACTERS",select:"Select Special characters"}}});var key=(function(){var keyMap={BACKSPACE:8,TAB:9,ENTER:13,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,B:66,E:69,I:73,J:74,K:75,L:76,R:82,S:83,U:85,V:86,Y:89,Z:90,SLASH:191,LEFTBRACKET:219,BACKSLASH:220,RIGHTBRACKET:221};return{isEdit:function(keyCode){return list.contains([keyMap.BACKSPACE,keyMap.TAB,keyMap.ENTER,keyMap.SPACE],keyCode)},isMove:function(keyCode){return list.contains([keyMap.LEFT,keyMap.UP,keyMap.RIGHT,keyMap.DOWN],keyCode)},nameFromCode:func.invertObject(keyMap),code:keyMap}})();var range=(function(){var textRangeToPoint=function(textRange,isStart){var container=textRange.parentElement(),offset;var tester=document.body.createTextRange(),prevContainer;var childNodes=list.from(container.childNodes);for(offset=0;offset<childNodes.length;offset++){if(dom.isText(childNodes[offset])){continue}tester.moveToElementText(childNodes[offset]);if(tester.compareEndPoints("StartToStart",textRange)>=0){break}prevContainer=childNodes[offset]}if(offset!==0&&dom.isText(childNodes[offset-1])){var textRangeStart=document.body.createTextRange(),curTextNode=null;textRangeStart.moveToElementText(prevContainer||container);textRangeStart.collapse(!prevContainer);curTextNode=prevContainer?prevContainer.nextSibling:container.firstChild;var pointTester=textRange.duplicate();pointTester.setEndPoint("StartToStart",textRangeStart);var textCount=pointTester.text.replace(/[\r\n]/g,"").length;while(textCount>curTextNode.nodeValue.length&&curTextNode.nextSibling){textCount-=curTextNode.nodeValue.length;curTextNode=curTextNode.nextSibling}var dummy=curTextNode.nodeValue;if(isStart&&curTextNode.nextSibling&&dom.isText(curTextNode.nextSibling)&&textCount===curTextNode.nodeValue.length){textCount-=curTextNode.nodeValue.length;curTextNode=curTextNode.nextSibling}container=curTextNode;offset=textCount}return{cont:container,offset:offset}};var pointToTextRange=function(point){var textRangeInfo=function(container,offset){var node,isCollapseToStart;if(dom.isText(container)){var prevTextNodes=dom.listPrev(container,func.not(dom.isText));var prevContainer=list.last(prevTextNodes).previousSibling;node=prevContainer||container.parentNode;offset+=list.sum(list.tail(prevTextNodes),dom.nodeLength);isCollapseToStart=!prevContainer}else{node=container.childNodes[offset]||container;if(dom.isText(node)){return textRangeInfo(node,0)}offset=0;isCollapseToStart=false}return{node:node,collapseToStart:isCollapseToStart,offset:offset}};var textRange=document.body.createTextRange();var info=textRangeInfo(point.node,point.offset);textRange.moveToElementText(info.node);textRange.collapse(info.collapseToStart);textRange.moveStart("character",info.offset);return textRange};var WrappedRange=function(sc,so,ec,eo){this.sc=sc;this.so=so;this.ec=ec;this.eo=eo;var nativeRange=function(){if(agent.isW3CRangeSupport){var w3cRange=document.createRange();w3cRange.setStart(sc,so);w3cRange.setEnd(ec,eo);return w3cRange}else{var textRange=pointToTextRange({node:sc,offset:so});textRange.setEndPoint("EndToEnd",pointToTextRange({node:ec,offset:eo}));return textRange}};this.getPoints=function(){return{sc:sc,so:so,ec:ec,eo:eo}};this.getStartPoint=function(){return{node:sc,offset:so}};this.getEndPoint=function(){return{node:ec,offset:eo}};this.select=function(){var nativeRng=nativeRange();if(agent.isW3CRangeSupport){var selection=document.getSelection();if(selection.rangeCount>0){selection.removeAllRanges()}selection.addRange(nativeRng)}else{nativeRng.select()}return this};this.scrollIntoView=function(container){var height=$(container).height();if(container.scrollTop+height<this.sc.offsetTop){container.scrollTop+=Math.abs(container.scrollTop+height-this.sc.offsetTop)}return this};this.normalize=function(){var getVisiblePoint=function(point,isLeftToRight){if((dom.isVisiblePoint(point)&&!dom.isEdgePoint(point))||(dom.isVisiblePoint(point)&&dom.isRightEdgePoint(point)&&!isLeftToRight)||(dom.isVisiblePoint(point)&&dom.isLeftEdgePoint(point)&&isLeftToRight)||(dom.isVisiblePoint(point)&&dom.isBlock(point.node)&&dom.isEmpty(point.node))){return point}var block=dom.ancestor(point.node,dom.isBlock);if(((dom.isLeftEdgePointOf(point,block)||dom.isVoid(dom.prevPoint(point).node))&&!isLeftToRight)||((dom.isRightEdgePointOf(point,block)||dom.isVoid(dom.nextPoint(point).node))&&isLeftToRight)){if(dom.isVisiblePoint(point)){return point}isLeftToRight=!isLeftToRight}var nextPoint=isLeftToRight?dom.nextPointUntil(dom.nextPoint(point),dom.isVisiblePoint):dom.prevPointUntil(dom.prevPoint(point),dom.isVisiblePoint);return nextPoint||point};var endPoint=getVisiblePoint(this.getEndPoint(),false);var startPoint=this.isCollapsed()?endPoint:getVisiblePoint(this.getStartPoint(),true);return new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset)};this.nodes=function(pred,options){pred=pred||func.ok;var includeAncestor=options&&options.includeAncestor;var fullyContains=options&&options.fullyContains;var startPoint=this.getStartPoint();var endPoint=this.getEndPoint();var nodes=[];var leftEdgeNodes=[];dom.walkPoint(startPoint,endPoint,function(point){if(dom.isEditable(point.node)){return}var node;if(fullyContains){if(dom.isLeftEdgePoint(point)){leftEdgeNodes.push(point.node)}if(dom.isRightEdgePoint(point)&&list.contains(leftEdgeNodes,point.node)){node=point.node}}else{if(includeAncestor){node=dom.ancestor(point.node,pred)}else{node=point.node}}if(node&&pred(node)){nodes.push(node)}},true);return list.unique(nodes)};this.commonAncestor=function(){return dom.commonAncestor(sc,ec)};this.expand=function(pred){var startAncestor=dom.ancestor(sc,pred);var endAncestor=dom.ancestor(ec,pred);if(!startAncestor&&!endAncestor){return new WrappedRange(sc,so,ec,eo)}var boundaryPoints=this.getPoints();if(startAncestor){boundaryPoints.sc=startAncestor;boundaryPoints.so=0}if(endAncestor){boundaryPoints.ec=endAncestor;boundaryPoints.eo=dom.nodeLength(endAncestor)}return new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo)};this.collapse=function(isCollapseToStart){if(isCollapseToStart){return new WrappedRange(sc,so,sc,so)}else{return new WrappedRange(ec,eo,ec,eo)}};this.splitText=function(){var isSameContainer=sc===ec;var boundaryPoints=this.getPoints();if(dom.isText(ec)&&!dom.isEdgePoint(this.getEndPoint())){ec.splitText(eo)}if(dom.isText(sc)&&!dom.isEdgePoint(this.getStartPoint())){boundaryPoints.sc=sc.splitText(so);boundaryPoints.so=0;if(isSameContainer){boundaryPoints.ec=boundaryPoints.sc;boundaryPoints.eo=eo-so}}return new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo)};this.deleteContents=function(){if(this.isCollapsed()){return this}var rng=this.splitText();var nodes=rng.nodes(null,{fullyContains:true});var point=dom.prevPointUntil(rng.getStartPoint(),function(point){return !list.contains(nodes,point.node)});var emptyParents=[];$.each(nodes,function(idx,node){var parent=node.parentNode;if(point.node!==parent&&dom.nodeLength(parent)===1){emptyParents.push(parent)}dom.remove(node,false)});$.each(emptyParents,function(idx,node){dom.remove(node,false)});return new WrappedRange(point.node,point.offset,point.node,point.offset).normalize()};var makeIsOn=function(pred){return function(){var ancestor=dom.ancestor(sc,pred);return !!ancestor&&(ancestor===dom.ancestor(ec,pred))}};this.isOnEditable=makeIsOn(dom.isEditable);this.isOnList=makeIsOn(dom.isList);this.isOnAnchor=makeIsOn(dom.isAnchor);this.isOnCell=makeIsOn(dom.isCell);this.isOnData=makeIsOn(dom.isData);this.isLeftEdgeOf=function(pred){if(!dom.isLeftEdgePoint(this.getStartPoint())){return false}var node=dom.ancestor(this.sc,pred);return node&&dom.isLeftEdgeOf(this.sc,node)};this.isCollapsed=function(){return sc===ec&&so===eo};this.wrapBodyInlineWithPara=function(){if(dom.isBodyContainer(sc)&&dom.isEmpty(sc)){sc.innerHTML=dom.emptyPara;return new WrappedRange(sc.firstChild,0,sc.firstChild,0)}var rng=this.normalize();if(dom.isParaInline(sc)||dom.isPara(sc)){return rng}var topAncestor;if(dom.isInline(rng.sc)){var ancestors=dom.listAncestor(rng.sc,func.not(dom.isInline));topAncestor=list.last(ancestors);if(!dom.isInline(topAncestor)){topAncestor=ancestors[ancestors.length-2]||rng.sc.childNodes[rng.so]}}else{topAncestor=rng.sc.childNodes[rng.so>0?rng.so-1:0]}var inlineSiblings=dom.listPrev(topAncestor,dom.isParaInline).reverse();inlineSiblings=inlineSiblings.concat(dom.listNext(topAncestor.nextSibling,dom.isParaInline));if(inlineSiblings.length){var para=dom.wrap(list.head(inlineSiblings),"p");dom.appendChildNodes(para,list.tail(inlineSiblings))}return this.normalize()};this.insertNode=function(node){var rng=this.wrapBodyInlineWithPara().deleteContents();var info=dom.splitPoint(rng.getStartPoint(),dom.isInline(node));if(info.rightNode){info.rightNode.parentNode.insertBefore(node,info.rightNode)}else{info.container.appendChild(node)}return node};this.pasteHTML=function(markup){var contentsContainer=$("<div></div>").html(markup)[0];var childNodes=list.from(contentsContainer.childNodes);var rng=this.wrapBodyInlineWithPara().deleteContents();return childNodes.reverse().map(function(childNode){return rng.insertNode(childNode)}).reverse()};this.toString=function(){var nativeRng=nativeRange();return agent.isW3CRangeSupport?nativeRng.toString():nativeRng.text};this.getWordRange=function(findAfter){var endPoint=this.getEndPoint();if(!dom.isCharPoint(endPoint)){return this}var startPoint=dom.prevPointUntil(endPoint,function(point){return !dom.isCharPoint(point)});if(findAfter){endPoint=dom.nextPointUntil(endPoint,function(point){return !dom.isCharPoint(point)})}return new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset)};this.bookmark=function(editable){return{s:{path:dom.makeOffsetPath(editable,sc),offset:so},e:{path:dom.makeOffsetPath(editable,ec),offset:eo}}};this.paraBookmark=function(paras){return{s:{path:list.tail(dom.makeOffsetPath(list.head(paras),sc)),offset:so},e:{path:list.tail(dom.makeOffsetPath(list.last(paras),ec)),offset:eo}}};this.getClientRects=function(){var nativeRng=nativeRange();return nativeRng.getClientRects()}};return{create:function(sc,so,ec,eo){if(arguments.length===4){return new WrappedRange(sc,so,ec,eo)}else{if(arguments.length===2){ec=sc;eo=so;return new WrappedRange(sc,so,ec,eo)}else{var wrappedRange=this.createFromSelection();if(!wrappedRange&&arguments.length===1){wrappedRange=this.createFromNode(arguments[0]);return wrappedRange.collapse(dom.emptyPara===arguments[0].innerHTML)}return wrappedRange}}},createFromSelection:function(){var sc,so,ec,eo;if(agent.isW3CRangeSupport){var selection=document.getSelection();if(!selection||selection.rangeCount===0){return null}else{if(dom.isBody(selection.anchorNode)){return null}}var nativeRng=selection.getRangeAt(0);sc=nativeRng.startContainer;so=nativeRng.startOffset;ec=nativeRng.endContainer;eo=nativeRng.endOffset}else{var textRange=document.selection.createRange();var textRangeEnd=textRange.duplicate();textRangeEnd.collapse(false);var textRangeStart=textRange;textRangeStart.collapse(true);var startPoint=textRangeToPoint(textRangeStart,true),endPoint=textRangeToPoint(textRangeEnd,false);if(dom.isText(startPoint.node)&&dom.isLeftEdgePoint(startPoint)&&dom.isTextNode(endPoint.node)&&dom.isRightEdgePoint(endPoint)&&endPoint.node.nextSibling===startPoint.node){startPoint=endPoint}sc=startPoint.cont;so=startPoint.offset;ec=endPoint.cont;eo=endPoint.offset}return new WrappedRange(sc,so,ec,eo)},createFromNode:function(node){var sc=node;var so=0;var ec=node;var eo=dom.nodeLength(ec);if(dom.isVoid(sc)){so=dom.listPrev(sc).length-1;sc=sc.parentNode}if(dom.isBR(ec)){eo=dom.listPrev(ec).length-1;ec=ec.parentNode}else{if(dom.isVoid(ec)){eo=dom.listPrev(ec).length;ec=ec.parentNode}}return this.create(sc,so,ec,eo)},createFromNodeBefore:function(node){return this.createFromNode(node).collapse(true)},createFromNodeAfter:function(node){return this.createFromNode(node).collapse()},createFromBookmark:function(editable,bookmark){var sc=dom.fromOffsetPath(editable,bookmark.s.path);var so=bookmark.s.offset;var ec=dom.fromOffsetPath(editable,bookmark.e.path);var eo=bookmark.e.offset;return new WrappedRange(sc,so,ec,eo)},createFromParaBookmark:function(bookmark,paras){var so=bookmark.s.offset;var eo=bookmark.e.offset;var sc=dom.fromOffsetPath(list.head(paras),bookmark.s.path);var ec=dom.fromOffsetPath(list.last(paras),bookmark.e.path);return new WrappedRange(sc,so,ec,eo)}}})();var async=(function(){var readFileAsDataURL=function(file){return $.Deferred(function(deferred){$.extend(new FileReader(),{onload:function(e){var dataURL=e.target.result;deferred.resolve(dataURL)},onerror:function(){deferred.reject(this)}}).readAsDataURL(file)}).promise()};var createImage=function(url){return $.Deferred(function(deferred){var $img=$("<img>");$img.one("load",function(){$img.off("error abort");deferred.resolve($img)}).one("error abort",function(){$img.off("load").detach();deferred.reject($img)}).css({display:"none"}).appendTo(document.body).attr("src",url)}).promise()};return{readFileAsDataURL:readFileAsDataURL,createImage:createImage}})();var History=function($editable){var stack=[],stackOffset=-1;var editable=$editable[0];var makeSnapshot=function(){var rng=range.create(editable);var emptyBookmark={s:{path:[],offset:0},e:{path:[],offset:0}};return{contents:$editable.html(),bookmark:(rng?rng.bookmark(editable):emptyBookmark)}};var applySnapshot=function(snapshot){if(snapshot.contents!==null){$editable.html(snapshot.contents)}if(snapshot.bookmark!==null){range.createFromBookmark(editable,snapshot.bookmark).select()}};this.rewind=function(){if($editable.html()!==stack[stackOffset].contents){this.recordUndo()}stackOffset=0;applySnapshot(stack[stackOffset])};this.reset=function(){stack=[];stackOffset=-1;$editable.html("");this.recordUndo()};this.undo=function(){if($editable.html()!==stack[stackOffset].contents){this.recordUndo()}if(0<stackOffset){stackOffset--;applySnapshot(stack[stackOffset])}};this.redo=function(){if(stack.length-1>stackOffset){stackOffset++;applySnapshot(stack[stackOffset])}};this.recordUndo=function(){stackOffset++;if(stack.length>stackOffset){stack=stack.slice(0,stackOffset)}stack.push(makeSnapshot())}};var Style=function(){var jQueryCSS=function($obj,propertyNames){if(agent.jqueryVersion<1.9){var result={};$.each(propertyNames,function(idx,propertyName){result[propertyName]=$obj.css(propertyName)});return result}return $obj.css.call($obj,propertyNames)};this.fromNode=function($node){var properties=["font-family","font-size","text-align","list-style-type","line-height"];var styleInfo=jQueryCSS($node,properties)||{};styleInfo["font-size"]=(parseFloat(styleInfo["font-size"])*72/96).toFixed(0);return styleInfo};this.stylePara=function(rng,styleInfo){$.each(rng.nodes(dom.isPara,{includeAncestor:true}),function(idx,para){$(para).css(styleInfo)})};this.styleNodes=function(rng,options){rng=rng.splitText();var nodeName=options&&options.nodeName||"SPAN";var expandClosestSibling=!!(options&&options.expandClosestSibling);var onlyPartialContains=!!(options&&options.onlyPartialContains);if(rng.isCollapsed()){return[rng.insertNode(dom.create(nodeName))]}var pred=dom.makePredByNodeName(nodeName);var nodes=rng.nodes(dom.isText,{fullyContains:true}).map(function(text){return dom.singleChildAncestor(text,pred)||dom.wrap(text,nodeName)});if(expandClosestSibling){if(onlyPartialContains){var nodesInRange=rng.nodes();pred=func.and(pred,function(node){return list.contains(nodesInRange,node)})}return nodes.map(function(node){var siblings=dom.withClosestSiblings(node,pred);var head=list.head(siblings);var tails=list.tail(siblings);$.each(tails,function(idx,elem){dom.appendChildNodes(head,elem.childNodes);dom.remove(elem)});return list.head(siblings)})}else{return nodes}};this.current=function(rng){var $cont=$(!dom.isElement(rng.sc)?rng.sc.parentNode:rng.sc);var styleInfo=this.fromNode($cont);try{styleInfo=$.extend(styleInfo,{"font-bold":document.queryCommandState("bold")?"bold":"normal","font-italic":document.queryCommandState("italic")?"italic":"normal","font-underline":document.queryCommandState("underline")?"underline":"normal","font-subscript":document.queryCommandState("subscript")?"subscript":"normal","font-superscript":document.queryCommandState("superscript")?"superscript":"normal","font-strikethrough":document.queryCommandState("strikethrough")?"strikethrough":"normal"})}catch(e){}if(!rng.isOnList()){styleInfo["list-style"]="none"}else{var orderedTypes=["circle","disc","disc-leading-zero","square"];var isUnordered=$.inArray(styleInfo["list-style-type"],orderedTypes)>-1;styleInfo["list-style"]=isUnordered?"unordered":"ordered"}var para=dom.ancestor(rng.sc,dom.isPara);if(para&&para.style["line-height"]){styleInfo["line-height"]=para.style.lineHeight}else{var lineHeight=parseInt(styleInfo["line-height"],10)/parseInt(styleInfo["font-size"],10);styleInfo["line-height"]=lineHeight.toFixed(1)}styleInfo.anchor=rng.isOnAnchor()&&dom.ancestor(rng.sc,dom.isAnchor);styleInfo.ancestors=dom.listAncestor(rng.sc,dom.isEditable);styleInfo.range=rng;return styleInfo}};var Bullet=function(){var self=this;this.insertOrderedList=function(editable){this.toggleList("OL",editable)};this.insertUnorderedList=function(editable){this.toggleList("UL",editable)};this.indent=function(editable){var self=this;var rng=range.create(editable).wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var clustereds=list.clusterBy(paras,func.peq2("parentNode"));$.each(clustereds,function(idx,paras){var head=list.head(paras);if(dom.isLi(head)){self.wrapList(paras,head.parentNode.nodeName)}else{$.each(paras,function(idx,para){$(para).css("marginLeft",function(idx,val){return(parseInt(val,10)||0)+25})})}});rng.select()};this.outdent=function(editable){var self=this;var rng=range.create(editable).wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var clustereds=list.clusterBy(paras,func.peq2("parentNode"));$.each(clustereds,function(idx,paras){var head=list.head(paras);if(dom.isLi(head)){self.releaseList([paras])}else{$.each(paras,function(idx,para){$(para).css("marginLeft",function(idx,val){val=(parseInt(val,10)||0);return val>25?val-25:""})})}});rng.select()};this.toggleList=function(listName,editable){var rng=range.create(editable).wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var bookmark=rng.paraBookmark(paras);var clustereds=list.clusterBy(paras,func.peq2("parentNode"));if(list.find(paras,dom.isPurePara)){var wrappedParas=[];$.each(clustereds,function(idx,paras){wrappedParas=wrappedParas.concat(self.wrapList(paras,listName))});paras=wrappedParas}else{var diffLists=rng.nodes(dom.isList,{includeAncestor:true}).filter(function(listNode){return !$.nodeName(listNode,listName)});if(diffLists.length){$.each(diffLists,function(idx,listNode){dom.replace(listNode,listName)})}else{paras=this.releaseList(clustereds,true)}}range.createFromParaBookmark(bookmark,paras).select()};this.wrapList=function(paras,listName){var head=list.head(paras);var last=list.last(paras);var prevList=dom.isList(head.previousSibling)&&head.previousSibling;var nextList=dom.isList(last.nextSibling)&&last.nextSibling;var listNode=prevList||dom.insertAfter(dom.create(listName||"UL"),last);paras=paras.map(function(para){return dom.isPurePara(para)?dom.replace(para,"LI"):para});dom.appendChildNodes(listNode,paras);if(nextList){dom.appendChildNodes(listNode,list.from(nextList.childNodes));dom.remove(nextList)}return paras};this.releaseList=function(clustereds,isEscapseToBody){var releasedParas=[];$.each(clustereds,function(idx,paras){var head=list.head(paras);var last=list.last(paras);var headList=isEscapseToBody?dom.lastAncestor(head,dom.isList):head.parentNode;var lastList=headList.childNodes.length>1?dom.splitTree(headList,{node:last.parentNode,offset:dom.position(last)+1},{isSkipPaddingBlankHTML:true}):null;var middleList=dom.splitTree(headList,{node:head.parentNode,offset:dom.position(head)},{isSkipPaddingBlankHTML:true});paras=isEscapseToBody?dom.listDescendant(middleList,dom.isLi):list.from(middleList.childNodes).filter(dom.isLi);if(isEscapseToBody||!dom.isList(headList.parentNode)){paras=paras.map(function(para){return dom.replace(para,"P")})}$.each(list.from(paras).reverse(),function(idx,para){dom.insertAfter(para,headList)});var rootLists=list.compact([headList,middleList,lastList]);$.each(rootLists,function(idx,rootList){var listNodes=[rootList].concat(dom.listDescendant(rootList,dom.isList));$.each(listNodes.reverse(),function(idx,listNode){if(!dom.nodeLength(listNode)){dom.remove(listNode,true)}})});releasedParas=releasedParas.concat(paras)});return releasedParas}};var Typing=function(){var bullet=new Bullet();this.insertTab=function(rng,tabsize){var tab=dom.createText(new Array(tabsize+1).join(dom.NBSP_CHAR));rng=rng.deleteContents();rng.insertNode(tab,true);rng=range.create(tab,tabsize);rng.select()};this.insertParagraph=function(editable){var rng=range.create(editable);rng=rng.deleteContents();rng=rng.wrapBodyInlineWithPara();var splitRoot=dom.ancestor(rng.sc,dom.isPara);var nextPara;if(splitRoot){if(dom.isEmpty(splitRoot)&&dom.isLi(splitRoot)){bullet.toggleList(splitRoot.parentNode.nodeName);return}else{if(dom.isEmpty(splitRoot)&&dom.isPara(splitRoot)&&dom.isBlockquote(splitRoot.parentNode)){dom.insertAfter(splitRoot,splitRoot.parentNode);nextPara=splitRoot}else{nextPara=dom.splitTree(splitRoot,rng.getStartPoint());var emptyAnchors=dom.listDescendant(splitRoot,dom.isEmptyAnchor);emptyAnchors=emptyAnchors.concat(dom.listDescendant(nextPara,dom.isEmptyAnchor));$.each(emptyAnchors,function(idx,anchor){dom.remove(anchor)});if((dom.isHeading(nextPara)||dom.isPre(nextPara))&&dom.isEmpty(nextPara)){nextPara=dom.replace(nextPara,"p")}}}}else{var next=rng.sc.childNodes[rng.so];nextPara=$(dom.emptyPara)[0];if(next){rng.sc.insertBefore(nextPara,next)}else{rng.sc.appendChild(nextPara)}}range.create(nextPara,0).normalize().select().scrollIntoView(editable)}};var Table=function(){this.tab=function(rng,isShift){var cell=dom.ancestor(rng.commonAncestor(),dom.isCell);var table=dom.ancestor(cell,dom.isTable);var cells=dom.listDescendant(table,dom.isCell);var nextCell=list[isShift?"prev":"next"](cells,cell);if(nextCell){range.create(nextCell,0).select()}};this.createTable=function(colCount,rowCount,options){var tds=[],tdHTML;for(var idxCol=0;idxCol<colCount;idxCol++){tds.push("<td>"+dom.blank+"</td>")}tdHTML=tds.join("");var trs=[],trHTML;for(var idxRow=0;idxRow<rowCount;idxRow++){trs.push("<tr>"+tdHTML+"</tr>")}trHTML=trs.join("");var $table=$("<table>"+trHTML+"</table>");if(options&&options.tableClassName){$table.addClass(options.tableClassName)}return $table[0]}};var KEY_BOGUS="bogus";var Editor=function(context){var self=this;var $note=context.layoutInfo.note;var $editor=context.layoutInfo.editor;var $editable=context.layoutInfo.editable;var options=context.options;var lang=options.langInfo;var editable=$editable[0];var lastRange=null;var style=new Style();var table=new Table();var typing=new Typing();var bullet=new Bullet();var history=new History($editable);this.initialize=function(){$editable.on("keydown",function(event){if(event.keyCode===key.code.ENTER){context.triggerEvent("enter",event)}context.triggerEvent("keydown",event);if(!event.isDefaultPrevented()){if(options.shortcuts){self.handleKeyMap(event)}else{self.preventDefaultEditableShortCuts(event)}}}).on("keyup",function(event){context.triggerEvent("keyup",event);if(event.ctrlKey&&(event.keyCode==65||event.keyCode==97)){selectElementContents($(".note-editable")[0])}}).on("focus",function(event){context.triggerEvent("focus",event)}).on("blur",function(event){context.triggerEvent("blur",event)}).on("mousedown",function(event){context.triggerEvent("mousedown",event)}).on("mouseup",function(event){context.triggerEvent("mouseup",event)}).on("scroll",function(event){context.triggerEvent("scroll",event)}).on("paste",function(event){context.triggerEvent("paste",event)});$editable.html(dom.html($note)||dom.emptyPara);var changeEventName=agent.isMSIE?"DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted":"input";$editable.on(changeEventName,func.debounce(function(){context.triggerEvent("change",$editable.html())},250));$editor.on("focusin",function(event){context.triggerEvent("focusin",event)}).on("focusout",function(event){context.triggerEvent("focusout",event)});if(!options.airMode){if(options.width){$editor.outerWidth(options.width)}if(options.height){$editable.outerHeight(options.height)}if(options.maxHeight){$editable.css("max-height",options.maxHeight)}if(options.minHeight){$editable.css("min-height",options.minHeight)}}history.recordUndo()};this.destroy=function(){$editable.off()};this.handleKeyMap=function(event){var keyMap=options.keyMap[agent.isMac?"mac":"pc"];var keys=[];if(event.metaKey){keys.push("CMD")}if(event.ctrlKey&&!event.altKey){keys.push("CTRL")}if(event.shiftKey){keys.push("SHIFT")}var keyName=key.nameFromCode[event.keyCode];if(keyName){keys.push(keyName)}var eventName=keyMap[keys.join("+")];if(eventName){event.preventDefault();context.invoke(eventName)}else{if(key.isEdit(event.keyCode)){this.afterCommand()}}};this.preventDefaultEditableShortCuts=function(event){if((event.ctrlKey||event.metaKey)&&list.contains([66,73,85],event.keyCode)){event.preventDefault()}};this.createRange=function(){this.focus();return range.create(editable)};this.saveRange=function(thenCollapse){lastRange=this.createRange();if(thenCollapse){lastRange.collapse().select()}};this.restoreRange=function(){if(lastRange){lastRange.select();this.focus()}};this.saveTarget=function(node){$editable.data("target",node)};this.clearTarget=function(){$editable.removeData("target")};this.restoreTarget=function(){return $editable.data("target")};this.currentStyle=function(){var rng=range.create();if(rng){rng=rng.normalize()}return rng?style.current(rng):style.fromNode($editable)};this.styleFromNode=function($node){return style.fromNode($node)};this.undo=function(){context.triggerEvent("before.command",$editable.html());history.undo();context.triggerEvent("change",$editable.html())};context.memo("help.undo",lang.help.undo);this.redo=function(){context.triggerEvent("before.command",$editable.html());history.redo();context.triggerEvent("change",$editable.html())};context.memo("help.redo",lang.help.redo);var beforeCommand=this.beforeCommand=function(){context.triggerEvent("before.command",$editable.html());self.focus()};var afterCommand=this.afterCommand=function(isPreventTrigger){if(!isPreventTrigger){context.triggerEvent("change",$editable.html())}};var commands=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","fontName"];for(var idx=0,len=commands.length;idx<len;idx++){this[commands[idx]]=(function(sCmd){return function(value){beforeCommand();document.execCommand(sCmd,false,value);if(sCmd==="fontName"&&value!=null&&value!==""){var fontName=value.replaceAll2("'","");$(".note-current-fontname").text(fontName);$(".note-current-fontname").css("font-family",fontName)}afterCommand(true);SbtSummerNoteHelper.OnChange()}})(commands[idx]);context.memo("help."+commands[idx],lang.help[commands[idx]])}this.tab=function(){var rng=this.createRange();if(rng.isCollapsed()&&rng.isOnCell()){table.tab(rng)}else{beforeCommand();typing.insertTab(rng,options.tabSize);afterCommand()}};context.memo("help.tab",lang.help.tab);this.untab=function(){var rng=this.createRange();if(rng.isCollapsed()&&rng.isOnCell()){table.tab(rng,true)}};context.memo("help.untab",lang.help.untab);this.wrapCommand=function(fn){return function(){beforeCommand();fn.apply(self,arguments);afterCommand()}};this.insertParagraph=this.wrapCommand(function(){typing.insertParagraph(editable)});context.memo("help.insertParagraph",lang.help.insertParagraph);this.insertNode=this.wrapCommand(function(node){var rng=this.createRange();rng.insertNode(node);range.createFromNodeAfter(node).select()});this.insertText=this.wrapCommand(function(text){var rng=this.createRange();var textNode=rng.insertNode(dom.createText(text));var rc=range.create(textNode,dom.nodeLength(textNode)).select()});this.getSelectedText=function(){var rng=this.createRange();if(rng.isOnAnchor()){rng=range.createFromNode(dom.ancestor(rng.sc,dom.isAnchor))}return rng.toString()};this.pasteHTML=this.wrapCommand(function(markup){var contents=this.createRange().pasteHTML(markup);range.createFromNodeAfter(list.last(contents)).select()});this.formatBlock=this.wrapCommand(function(tagName){tagName=agent.isMSIE?"<"+tagName+">":tagName;document.execCommand("FormatBlock",false,tagName)});this.formatPara=function(){this.formatBlock("P")};context.memo("help.formatPara",lang.help.formatPara);for(var idx=1;idx<=6;idx++){this["formatH"+idx]=function(idx){return function(){this.formatBlock("H"+idx)}}(idx);context.memo("help.formatH"+idx,lang.help["formatH"+idx])}this.fontSize=function(value){$(".note-current-fontsize").text(value);var rng=this.createRange();if(rng&&rng.isCollapsed()){var spans=style.styleNodes(rng);var firstSpan=list.head(spans);$(spans).css({"font-size":value+"pt"});if(firstSpan&&!dom.nodeLength(firstSpan)){firstSpan.innerHTML=dom.ZERO_WIDTH_NBSP_CHAR;range.createFromNodeAfter(firstSpan.firstChild).select();$editable.data(KEY_BOGUS,firstSpan)}}else{beforeCommand();$(style.styleNodes(rng)).css({"font-size":value+"pt"});afterCommand()}};this.removeBogus=function(){var bogusNode=$editable.data(KEY_BOGUS);if(!bogusNode){return}var textNode=list.find(list.from(bogusNode.childNodes),dom.isText);var bogusCharIdx=textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);if(bogusCharIdx!==-1){textNode.deleteData(bogusCharIdx,1)}if(dom.isEmpty(bogusNode)){dom.remove(bogusNode)}$editable.removeData(KEY_BOGUS)};this.lineHeight=this.wrapCommand(function(value){style.stylePara(this.createRange(),{lineHeight:value})});this.color=this.wrapCommand(function(colorInfo){var foreColor=colorInfo.foreColor;var backColor=colorInfo.backColor;if(foreColor){document.execCommand("foreColor",false,foreColor)}if(backColor){document.execCommand("backColor",false,backColor)}});this.floatMe=this.wrapCommand(function(value){var $target=$(this.restoreTarget());$target.css("float",value)});this.resize=this.wrapCommand(function(value){var $target=$(this.restoreTarget());$target.css({width:value*100+"%",height:""})});this.resizeTo=function(pos,$target,bKeepRatio){var imageSize;if(bKeepRatio){var newRatio=pos.y/pos.x;var ratio=$target.data("ratio");imageSize={width:ratio>newRatio?pos.x:pos.y/ratio,height:ratio>newRatio?pos.x*ratio:pos.y}}else{imageSize={width:pos.x,height:pos.y}}$target.css(imageSize)};this.removeMedia=this.wrapCommand(function(){var $target=$(this.restoreTarget()).detach();context.triggerEvent("media.delete",$target,$editable)});this.hasFocus=function(){return $editable.is(":focus")};this.focus=function(){if(!this.hasFocus()){$editable.focus()}};this.isEmpty=function(){return dom.isEmpty($editable[0])||dom.emptyPara===$editable.html()};this.empty=function(){context.invoke("code",dom.emptyPara)}};var Clipboard=function(context){var self=this;var $editable=context.layoutInfo.editable;this.events={"summernote.keydown":function(we,e){if(self.needKeydownHook()){if((e.ctrlKey||e.metaKey)&&e.keyCode===key.code.V){context.invoke("editor.saveRange");self.$paste.focus();setTimeout(function(){self.pasteByHook()},0)}}}};this.needKeydownHook=function(){return(agent.isMSIE&&agent.browserVersion>10)||agent.isFF};this.initialize=function(){if(this.needKeydownHook()){this.$paste=$('<div tabindex="-1" />').attr("contenteditable",true).css({position:"absolute",left:-100000,opacity:0});$editable.before(this.$paste);this.$paste.on("paste",function(event){context.triggerEvent("paste",event)})}else{$editable.on("paste",this.pasteByEvent)}};this.destroy=function(){if(this.needKeydownHook()){this.$paste.remove();this.$paste=null}};this.pasteByHook=function(){var node=this.$paste[0].firstChild;if(dom.isImg(node)){var dataURI=node.src;var decodedData=atob(dataURI.split(",")[1]);var array=new Uint8Array(decodedData.length);for(var i=0;i<decodedData.length;i++){array[i]=decodedData.charCodeAt(i)}var blob=new Blob([array],{type:"image/png"});blob.name="clipboard.png";context.invoke("editor.restoreRange");context.invoke("editor.focus");context.invoke("editor.insertImagesOrCallback",[blob])}else{var pasteContent=$("<div />").html(this.$paste.html()).html();context.invoke("editor.restoreRange");context.invoke("editor.focus");if(pasteContent){context.invoke("editor.pasteHTML",pasteContent)}}this.$paste.empty()};this.pasteByEvent=function(event){var clipboardData=event.originalEvent.clipboardData;if(clipboardData&&clipboardData.items&&clipboardData.items.length){var item=list.head(clipboardData.items);if(item.kind==="file"&&item.type.indexOf("image/")!==-1){context.invoke("editor.insertImagesOrCallback",[item.getAsFile()])}context.invoke("editor.afterCommand")}}};var Dropzone=function(context){var $document=$(document);var $editor=context.layoutInfo.editor;var $editable=context.layoutInfo.editable;var options=context.options;var lang=options.langInfo;var documentEventHandlers={};var $dropzone=$(['<div class="note-dropzone">','  <div class="note-dropzone-message"/>',"</div>"].join("")).prependTo($editor);var detachDocumentEvent=function(){Object.keys(documentEventHandlers).forEach(function(key){$document.off(key.substr(2).toLowerCase(),documentEventHandlers[key])});documentEventHandlers={}};this.initialize=function(){if(options.disableDragAndDrop){documentEventHandlers.onDrop=function(e){e.preventDefault()};$document.on("drop",documentEventHandlers.onDrop)}else{this.attachDragAndDropEvent()}};this.attachDragAndDropEvent=function(){var collection=$(),$dropzoneMessage=$dropzone.find(".note-dropzone-message");documentEventHandlers.onDragenter=function(e){var isCodeview=context.invoke("codeview.isActivated");var hasEditorSize=$editor.width()>0&&$editor.height()>0;if(!isCodeview&&!collection.length&&hasEditorSize){$editor.addClass("dragover");$dropzone.width($editor.width());$dropzone.height($editor.height());$dropzoneMessage.text(lang.image.dragImageHere)}collection=collection.add(e.target)};documentEventHandlers.onDragleave=function(e){collection=collection.not(e.target);if(!collection.length){$editor.removeClass("dragover")}};documentEventHandlers.onDrop=function(){collection=$();$editor.removeClass("dragover")};$document.on("dragenter",documentEventHandlers.onDragenter).on("dragleave",documentEventHandlers.onDragleave).on("drop",documentEventHandlers.onDrop);$dropzone.on("dragenter",function(){$dropzone.addClass("hover");$dropzoneMessage.text(lang.image.dropImage)}).on("dragleave",function(){$dropzone.removeClass("hover");$dropzoneMessage.text(lang.image.dragImageHere)});$dropzone.on("drop",function(event){var dataTransfer=event.originalEvent.dataTransfer;if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length){event.preventDefault();$editable.focus();context.invoke("editor.insertImagesOrCallback",dataTransfer.files)}else{$.each(dataTransfer.types,function(idx,type){var content=dataTransfer.getData(type);if(type.toLowerCase().indexOf("text")>-1){context.invoke("editor.pasteHTML",content)}else{$(content).each(function(){context.invoke("editor.insertNode",this)})}})}}).on("dragover",false)};this.destroy=function(){detachDocumentEvent()}};var CodeMirror;if(agent.hasCodeMirror){if(agent.isSupportAmd){require(["codemirror"],function(cm){CodeMirror=cm})}else{CodeMirror=window.CodeMirror}}var Codeview=function(context){var $editor=context.layoutInfo.editor;var $editable=context.layoutInfo.editable;var $codable=context.layoutInfo.codable;var options=context.options;this.sync=function(){var isCodeview=this.isActivated();if(isCodeview&&agent.hasCodeMirror){$codable.data("cmEditor").save()}};this.isActivated=function(){return $editor.hasClass("codeview")};this.toggle=function(){if(this.isActivated()){this.deactivate()}else{this.activate()}context.triggerEvent("codeview.toggled")};this.activate=function(){$codable.val(dom.html($editable,options.prettifyHtml));$codable.height($editable.height());context.invoke("toolbar.updateCodeview",true);$editor.addClass("codeview");$codable.focus();if(agent.hasCodeMirror){var cmEditor=CodeMirror.fromTextArea($codable[0],options.codemirror);if(options.codemirror.tern){var server=new CodeMirror.TernServer(options.codemirror.tern);cmEditor.ternServer=server;cmEditor.on("cursorActivity",function(cm){server.updateArgHints(cm)})}cmEditor.setSize(null,$editable.outerHeight());$codable.data("cmEditor",cmEditor)}};this.deactivate=function(){if(agent.hasCodeMirror){var cmEditor=$codable.data("cmEditor");$codable.val(cmEditor.getValue());cmEditor.toTextArea()}var value=dom.value($codable,options.prettifyHtml)||dom.emptyPara;var isChange=$editable.html()!==value;$editable.html(value);$editable.height(options.height?$codable.height():"auto");$editor.removeClass("codeview");if(isChange){context.triggerEvent("change",$editable.html(),$editable)}$editable.focus();context.invoke("toolbar.updateCodeview",false)};this.destroy=function(){if(this.isActivated()){this.deactivate()}}};var EDITABLE_PADDING=24;var Statusbar=function(context){var $document=$(document);var $statusbar=context.layoutInfo.statusbar;var $editable=context.layoutInfo.editable;var options=context.options;this.initialize=function(){if(options.airMode||options.disableResizeEditor){return}$statusbar.on("mousedown",function(event){event.preventDefault();event.stopPropagation();var editableTop=$editable.offset().top-$document.scrollTop();$document.on("mousemove",function(event){var height=event.clientY-(editableTop+EDITABLE_PADDING);height=(options.minheight>0)?Math.max(height,options.minheight):height;height=(options.maxHeight>0)?Math.min(height,options.maxHeight):height;$editable.height(height)}).one("mouseup",function(){$document.off("mousemove")})})};this.destroy=function(){$statusbar.off();$statusbar.remove()}};var Fullscreen=function(context){var $editor=context.layoutInfo.editor;var $toolbar=context.layoutInfo.toolbar;var $editable=context.layoutInfo.editable;var $codable=context.layoutInfo.codable;var $window=$(window);var $scrollbar=$("html, body");this.toggle=function(){var resize=function(size){$editable.css("height",size.h);$codable.css("height",size.h);if($codable.data("cmeditor")){$codable.data("cmeditor").setsize(null,size.h)}};$editor.toggleClass("fullscreen");if(this.isFullscreen()){$editable.data("orgHeight",$editable.css("height"));$window.on("resize",function(){resize({h:$window.height()-$toolbar.outerHeight()})}).trigger("resize");$scrollbar.css("overflow","hidden")}else{$window.off("resize");resize({h:$editable.data("orgHeight")});$scrollbar.css("overflow","visible")}context.invoke("toolbar.updateFullscreen",this.isFullscreen())};this.isFullscreen=function(){return $editor.hasClass("fullscreen")}};var Handle=function(context){var self=this;var $document=$(document);var $editingArea=context.layoutInfo.editingArea;var options=context.options;this.events={"summernote.mousedown":function(we,e){if(self.update(e.target)){e.preventDefault()}},"summernote.keyup summernote.scroll summernote.change summernote.dialog.shown":function(){self.update()}};this.initialize=function(){this.$handle=$(['<div class="note-handle">','<div class="note-control-selection">','<div class="note-control-selection-bg"></div>','<div class="note-control-holder note-control-nw"></div>','<div class="note-control-holder note-control-ne"></div>','<div class="note-control-holder note-control-sw"></div>','<div class="',(options.disableResizeImage?"note-control-holder":"note-control-sizing"),' note-control-se"></div>',(options.disableResizeImage?"":'<div class="note-control-selection-info"></div>'),"</div>","</div>"].join("")).prependTo($editingArea);this.$handle.on("mousedown",function(event){if(dom.isControlSizing(event.target)){event.preventDefault();event.stopPropagation();var $target=self.$handle.find(".note-control-selection").data("target"),posStart=$target.offset(),scrollTop=$document.scrollTop();$document.on("mousemove",function(event){context.invoke("editor.resizeTo",{x:event.clientX-posStart.left,y:event.clientY-(posStart.top-scrollTop)},$target,!event.shiftKey);self.update($target[0])}).one("mouseup",function(e){e.preventDefault();$document.off("mousemove");context.invoke("editor.afterCommand")});if(!$target.data("ratio")){$target.data("ratio",$target.height()/$target.width())}}})};this.destroy=function(){this.$handle.remove()};this.update=function(target){var isImage=dom.isImg(target);var $selection=this.$handle.find(".note-control-selection");if(isImage){var $image=$(target);var pos=$image.position();var imageSize={w:$image.outerWidth(true),h:$image.outerHeight(true)};$selection.css({display:"block",left:pos.left,top:pos.top,width:imageSize.w,height:imageSize.h}).data("target",$image);var sizingText=imageSize.w+"x"+imageSize.h;$selection.find(".note-control-selection-info").text(sizingText);context.invoke("editor.saveTarget",target)}else{this.hide()}return isImage};this.hide=function(){context.invoke("editor.clearTarget");this.$handle.children().hide()}};var AutoSync=function(context){var $note=context.layoutInfo.note;this.events={"summernote.change":function(){$note.val(context.invoke("code"))}};this.shouldInitialize=function(){return dom.isTextarea($note[0])}};var Placeholder=function(context){var self=this;var $editingArea=context.layoutInfo.editingArea;var options=context.options;this.events={"summernote.init summernote.change":function(){self.update()},"summernote.codeview.toggled":function(){self.update()}};this.shouldInitialize=function(){return !!options.placeholder};this.initialize=function(){this.$placeholder=$('<div class="note-placeholder">');this.$placeholder.on("click",function(){context.invoke("focus")}).text(options.placeholder).prependTo($editingArea)};this.destroy=function(){this.$placeholder.remove()};this.update=function(){var isShow=!context.invoke("codeview.isActivated")&&context.invoke("editor.isEmpty");this.$placeholder.toggle(isShow)}};var Buttons=function(context){var self=this;var ui=$.summernote.ui;var $toolbar=context.layoutInfo.toolbar;var options=context.options;var lang=options.langInfo;var invertedKeyMap=func.invertObject(options.keyMap[agent.isMac?"mac":"pc"]);var representShortcut=this.representShortcut=function(editorMethod){var shortcut=invertedKeyMap[editorMethod];if(!options.shortcuts||!shortcut){return""}if(agent.isMac){shortcut=shortcut.replace("CMD","?").replace("SHIFT","?")}shortcut=shortcut.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]");return" ("+shortcut+")"};this.initialize=function(){this.addToolbarButtons();this.fontInstalledMap={}};this.destroy=function(){delete this.fontInstalledMap};this.isFontInstalled=function(name){if(!self.fontInstalledMap.hasOwnProperty(name)){self.fontInstalledMap[name]=agent.isFontInstalled(name)||list.contains(options.fontNamesIgnoreCheck,name)}return self.fontInstalledMap[name]};this.addToolbarButtons=function(){context.memo("button.style",function(){return ui.buttonGroup([ui.button({className:"dropdown-toggle",contents:ui.icon(options.icons.magic)+" "+ui.icon(options.icons.caret,"span"),tooltip:lang.style.style,data:{toggle:"dropdown"}}),ui.dropdown({className:"dropdown-style",items:context.options.styleTags,template:function(item){if(typeof item==="string"){item={tag:item,title:(lang.style.hasOwnProperty(item)?lang.style[item]:item)}}var tag=item.tag;var title=item.title;var style=item.style?' style="'+item.style+'" ':"";var className=item.className?' class="'+item.className+'"':"";return"<"+tag+style+className+">"+title+"</"+tag+">"},click:context.createInvokeHandler("editor.formatBlock")})]).render()});context.memo("button.bold",function(){return ui.button({className:"note-btn-bold",contents:ui.icon(options.icons.bold),tooltip:lang.font.bold+representShortcut("bold"),click:context.createInvokeHandler("editor.bold")}).render()});context.memo("button.italic",function(){return ui.button({className:"note-btn-italic",contents:ui.icon(options.icons.italic),tooltip:lang.font.italic+representShortcut("italic"),click:context.createInvokeHandler("editor.italic")}).render()});context.memo("button.underline",function(){return ui.button({className:"note-btn-underline",contents:ui.icon(options.icons.underline),tooltip:lang.font.underline+representShortcut("underline"),click:context.createInvokeHandler("editor.underline")}).render()});context.memo("button.clear",function(){return ui.button({contents:ui.icon(options.icons.eraser),tooltip:lang.font.clear+representShortcut("removeFormat"),click:context.createInvokeHandler("editor.removeFormat")}).render()});context.memo("button.strikethrough",function(){return ui.button({className:"note-btn-strikethrough",contents:ui.icon(options.icons.strikethrough),tooltip:lang.font.strikethrough+representShortcut("strikethrough"),click:context.createInvokeHandler("editor.strikethrough")}).render()});context.memo("button.superscript",function(){return ui.button({className:"note-btn-superscript",contents:ui.icon(options.icons.superscript),tooltip:lang.font.superscript,click:context.createInvokeHandler("editor.superscript")}).render()});context.memo("button.subscript",function(){return ui.button({className:"note-btn-subscript",contents:ui.icon(options.icons.subscript),tooltip:lang.font.subscript,click:context.createInvokeHandler("editor.subscript")}).render()});context.memo("button.fontname",function(){return ui.buttonGroup([ui.button({className:"dropdown-toggle",contents:'<span class="note-current-fontname"/> '+ui.icon(options.icons.caret,"span"),tooltip:"",data:{toggle:"dropdown"}}),ui.dropdownCheck({className:"dropdown-fontname",checkClassName:options.icons.menuCheck,items:options.fontNames,template:function(item){return'<span data-value="'+item.Family+'" style="font-family:'+item.Family+'">'+item.Title+"</span>"},click:context.createInvokeHandler("editor.fontName")})]).render()});context.memo("button.fontsize",function(){return ui.buttonGroup([ui.button({className:"dropdown-toggle",contents:'<span class="note-current-fontsize"/>'+ui.icon(options.icons.caret,"span"),tooltip:"",data:{toggle:"dropdown"}}),ui.dropdownCheck({className:"dropdown-fontsize",checkClassName:options.icons.menuCheck,items:options.fontSizes,click:context.createInvokeHandler("editor.fontSize")})]).render()});context.memo("button.color",function(){return ui.buttonGroup({className:"note-color",children:[ui.button({className:"note-current-color-button",contents:ui.icon(options.icons.font+" note-recent-color"),tooltip:lang.color.recent,click:function(e){var $button=$(e.currentTarget);context.invoke("editor.color",{backColor:$button.attr("data-backColor"),foreColor:$button.attr("data-foreColor")})},callback:function($button){var $recentColor=$button.find(".note-recent-color");$recentColor.css("background-color","#FFFFFF");$button.attr("data-backColor","#FFFFFF")}}),ui.button({className:"dropdown-toggle",contents:ui.icon(options.icons.caret+" carat-no-padding","span"),tooltip:"",data:{toggle:"dropdown"}}),ui.dropdown({items:["<li>",'<div class="btn-group">','  <div class="note-palette-title">'+lang.color.foreground+"</div>","  <div>",'    <button type="button" class="note-color-reset btn btn-default" data-event="removeFormat" data-value="foreColor">',lang.color.resetToDefault,"    </button>","  </div>",'  <div class="note-holder" data-event="foreColor"/>',"</div>","</li>"].join(""),callback:function($dropdown){$dropdown.find(".note-holder").each(function(){var $holder=$(this);$holder.append(ui.palette({colors:options.colors,eventName:$holder.data("event")}).render())})},click:function(event){var $button=$(event.target);var eventName=$button.data("event");var value=$button.data("value");if(eventName&&value){var key=eventName==="backColor"?"background-color":"color";var $color=$button.closest(".note-color").find(".note-recent-color");var $currentButton=$button.closest(".note-color").find(".note-current-color-button");$color.css(key,value);$currentButton.attr("data-"+eventName,value);context.invoke("editor."+eventName,value)}}})]}).render()});var justifyLeft=ui.button({contents:ui.icon(options.icons.alignLeft),tooltip:lang.paragraph.left+representShortcut("justifyLeft"),click:context.createInvokeHandler("editor.justifyLeft")});var justifyCenter=ui.button({contents:ui.icon(options.icons.alignCenter),tooltip:lang.paragraph.center+representShortcut("justifyCenter"),click:context.createInvokeHandler("editor.justifyCenter")});var justifyRight=ui.button({contents:ui.icon(options.icons.alignRight),tooltip:lang.paragraph.right+representShortcut("justifyRight"),click:context.createInvokeHandler("editor.justifyRight")});context.memo("button.justifyLeft",func.invoke(justifyLeft,"render"));context.memo("button.justifyCenter",func.invoke(justifyCenter,"render"));context.memo("button.justifyRight",func.invoke(justifyRight,"render"));context.memo("button.paragraph",function(){return ui.buttonGroup([ui.button({className:"dropdown-toggle",contents:ui.icon(options.icons.alignCategory)+" "+ui.icon(options.icons.caret,"span"),tooltip:lang.paragraph.align,data:{toggle:"dropdown"}}),ui.dropdown([ui.buttonGroup({className:"note-align",children:[justifyLeft,justifyCenter,justifyRight]})])]).render()})};this.build=function($container,groups){for(var groupIdx=0,groupLen=groups.length;groupIdx<groupLen;groupIdx++){var group=groups[groupIdx];var groupName=group[0];var buttons=group[1];var $group=ui.buttonGroup({className:"note-"+groupName}).render();for(var idx=0,len=buttons.length;idx<len;idx++){var button=context.memo("button."+buttons[idx]);if(button){$group.append(typeof button==="function"?button(context):button)}}$group.appendTo($container)}};this.updateCurrentStyle=function(){var styleInfo=context.invoke("editor.currentStyle");this.updateBtnStates({".note-btn-bold":function(){return styleInfo["font-bold"]==="bold"},".note-btn-italic":function(){return styleInfo["font-italic"]==="italic"},".note-btn-underline":function(){return styleInfo["font-underline"]==="underline"},".note-btn-subscript":function(){return styleInfo["font-subscript"]==="subscript"},".note-btn-superscript":function(){return styleInfo["font-superscript"]==="superscript"},".note-btn-strikethrough":function(){return styleInfo["font-strikethrough"]==="strikethrough"}});if(styleInfo["font-family"]&&styleInfo["font-family"].indexOf("undef")<0){var fontName=SbtSummerNoteHelper.SanitizeFont(styleInfo["font-family"]).replace(/[\'\"]/g,"");$toolbar.find(".dropdown-fontname li a").each(function(){var isChecked=($(this).data("value")+"")===(fontName+"");this.className=isChecked?"checked":""});$toolbar.find(".note-current-fontname").text(fontName);$toolbar.find(".note-current-fontname").css("font-family",fontName)}if(styleInfo["font-size"]){var fontSize=styleInfo["font-size"];$toolbar.find(".dropdown-fontsize li a").each(function(){var isChecked=($(this).data("value")+"")===(fontSize+"");this.className=isChecked?"checked":""});$toolbar.find(".note-current-fontsize").text(fontSize)}if(styleInfo["line-height"]){var lineHeight=styleInfo["line-height"];$toolbar.find(".dropdown-line-height li a").each(function(){var isChecked=($(this).data("value")+"")===(lineHeight+"");this.className=isChecked?"checked":""})}};this.updateBtnStates=function(infos){$.each(infos,function(selector,pred){ui.toggleBtnActive($toolbar.find(selector),pred())})}};var Toolbar=function(context){var ui=$.summernote.ui;var $note=context.layoutInfo.note;var $toolbar=context.layoutInfo.toolbar;var options=context.options;this.shouldInitialize=function(){return !options.airMode};this.initialize=function(){options.toolbar=options.toolbar||[];if(!options.toolbar.length){$toolbar.hide()}else{context.invoke("buttons.build",$toolbar,options.toolbar)}if(options.toolbarContainer){$toolbar.appendTo(options.toolbarContainer)}$note.on("summernote.keyup summernote.mouseup summernote.change",function(){context.invoke("buttons.updateCurrentStyle")});context.invoke("buttons.updateCurrentStyle")};this.destroy=function(){$toolbar.children().remove()};this.updateFullscreen=function(isFullscreen){ui.toggleBtnActive($toolbar.find(".btn-fullscreen"),isFullscreen)};this.updateCodeview=function(isCodeview){ui.toggleBtnActive($toolbar.find(".btn-codeview"),isCodeview);if(isCodeview){this.deactivate()}else{this.activate()}};this.activate=function(isIncludeCodeview){var $btn=$toolbar.find("button");if(!isIncludeCodeview){$btn=$btn.not(".btn-codeview")}ui.toggleBtn($btn,true)};this.deactivate=function(isIncludeCodeview){var $btn=$toolbar.find("button");if(!isIncludeCodeview){$btn=$btn.not(".btn-codeview")}ui.toggleBtn($btn,false)}};var HintPopover=function(context){var self=this;var ui=$.summernote.ui;var POPOVER_DIST=5;var hint=context.options.hint||[];var direction=context.options.hintDirection||"bottom";var hints=$.isArray(hint)?hint:[hint];this.events={"summernote.keyup":function(we,e){if(!e.isDefaultPrevented()){self.handleKeyup(e)}},"summernote.keydown":function(we,e){self.handleKeydown(e)},"summernote.dialog.shown":function(){self.hide()}};this.shouldInitialize=function(){return hints.length>0};this.initialize=function(){this.lastWordRange=null;this.$popover=ui.popover({className:"note-hint-popover",hideArrow:true,direction:""}).render().appendTo("body");this.$popover.hide();this.$content=this.$popover.find(".popover-content");this.$content.on("click",".note-hint-item",function(){self.$content.find(".active").removeClass("active");$(this).addClass("active");self.replace()})};this.destroy=function(){this.$popover.remove()};this.selectItem=function($item){this.$content.find(".active").removeClass("active");$item.addClass("active");this.$content[0].scrollTop=$item[0].offsetTop-(this.$content.innerHeight()/2)};this.moveDown=function(){var $current=this.$content.find(".note-hint-item.active");var $next=$current.next();if($next.length){this.selectItem($next)}else{var $nextGroup=$current.parent().next();if(!$nextGroup.length){$nextGroup=this.$content.find(".note-hint-group").first()}this.selectItem($nextGroup.find(".note-hint-item").first())}};this.moveUp=function(){var $current=this.$content.find(".note-hint-item.active");var $prev=$current.prev();if($prev.length){this.selectItem($prev)}else{var $prevGroup=$current.parent().prev();if(!$prevGroup.length){$prevGroup=this.$content.find(".note-hint-group").last()}this.selectItem($prevGroup.find(".note-hint-item").last())}};this.replace=function(){var $item=this.$content.find(".note-hint-item.active");if($item.length){var node=this.nodeFromItem($item);this.lastWordRange.insertNode(node);range.createFromNode(node).collapse().select();this.lastWordRange=null;this.hide();context.invoke("editor.focus")}};this.nodeFromItem=function($item){var hint=hints[$item.data("index")];var item=$item.data("item");var node=hint.content?hint.content(item):item;if(typeof node==="string"){node=dom.createText(node)}return node};this.createItemTemplates=function(hintIdx,items){var hint=hints[hintIdx];return items.map(function(item,idx){var $item=$('<div class="note-hint-item"/>');$item.append(hint.template?hint.template(item):item+"");$item.data({index:hintIdx,item:item});if(hintIdx===0&&idx===0){$item.addClass("active")}return $item})};this.handleKeydown=function(e){if(!this.$popover.is(":visible")){return}if(e.keyCode===key.code.ENTER){e.preventDefault();this.replace()}else{if(e.keyCode===key.code.UP){e.preventDefault();this.moveUp()}else{if(e.keyCode===key.code.DOWN){e.preventDefault();this.moveDown()}}}};this.searchKeyword=function(index,keyword,callback){var hint=hints[index];if(hint&&hint.match.test(keyword)&&hint.search){var matches=hint.match.exec(keyword);hint.search(matches[1],callback)}else{callback()}};this.createGroup=function(idx,keyword){var $group=$('<div class="note-hint-group note-hint-group-'+idx+'"/>');this.searchKeyword(idx,keyword,function(items){items=items||[];if(items.length){$group.html(self.createItemTemplates(idx,items));self.show()}});return $group};this.handleKeyup=function(e){if(list.contains([key.code.ENTER,key.code.UP,key.code.DOWN],e.keyCode)){if(e.keyCode===key.code.ENTER){if(this.$popover.is(":visible")){return}}}else{var wordRange=context.invoke("editor.createRange").getWordRange();var keyword=wordRange.toString();if(hints.length&&keyword){this.$content.empty();var bnd=func.rect2bnd(list.last(wordRange.getClientRects()));if(bnd){this.$popover.hide();this.lastWordRange=wordRange;hints.forEach(function(hint,idx){if(hint.match.test(keyword)){self.createGroup(idx,keyword).appendTo(self.$content)}});if(direction==="top"){this.$popover.css({left:bnd.left,top:bnd.top-this.$popover.outerHeight()-POPOVER_DIST})}else{this.$popover.css({left:bnd.left,top:bnd.top+bnd.height+POPOVER_DIST})}}}else{this.hide()}}};this.show=function(){this.$popover.show()};this.hide=function(){this.$popover.hide()}};$.summernote=$.extend($.summernote,{version:"0.8.2",ui:ui,dom:dom,plugins:{},options:{modules:{editor:Editor,clipboard:Clipboard,dropzone:Dropzone,codeview:Codeview,statusbar:Statusbar,fullscreen:Fullscreen,handle:Handle,hintPopover:HintPopover,autoSync:AutoSync,placeholder:Placeholder,buttons:Buttons,toolbar:Toolbar},buttons:{},lang:"en-US",toolbar:[["style",["style"]],["font",["bold","underline","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","picture","video"]],["view",["fullscreen","codeview","help"]]],popover:{image:[["imagesize",["imageSize100","imageSize50","imageSize25"]],["float",["floatLeft","floatRight","floatNone"]],["remove",["removeMedia"]]],link:[["link",["linkDialogShow","unlink"]]],air:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]]},airMode:false,width:null,height:null,focus:false,tabSize:4,styleWithSpan:true,shortcuts:true,textareaAutoSync:true,direction:null,styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Helvetica","Impact","Lucida Grande","Tahoma","Times New Roman","Verdana"],fontSizes:["8","9","10","11","12","14","18","24","36"],colors:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],tableClassName:"table table-bordered",insertTableMaxSize:{col:10,row:10},dialogsInBody:false,dialogsFade:false,maximumImageFileSize:null,callbacks:{onInit:null,onFocus:null,onBlur:null,onEnter:null,onKeyup:null,onKeydown:null,onImageUpload:null,onImageUploadError:null},codemirror:{mode:"text/html",htmlMode:true,lineNumbers:true},keyMap:{pc:{ENTER:"insertParagraph",TAB:"tab","SHIFT+TAB":"untab","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat",},mac:{ENTER:"insertParagraph",TAB:"tab","SHIFT+TAB":"untab","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat",}},icons:{alignJustify:"note-icon-align-justify",alignCategory:"isbt-summer-toolbar-icon isbt-alignment",caret:"isbt-subtle-color isbt-summer-toolbar-icon isbt-twosidedarrow",alignLeft:"isbt-summer-toolbar-icon isbt-leftaligned3",alignCenter:"isbt-summer-toolbar-icon isbt-centeraligned3",alignRight:"isbt-summer-toolbar-icon isbt-rightaligned3",strikethrough:"isbt-summer-toolbar-icon isbt-strikethroughbig",subscript:"isbt-summer-toolbar-icon isbt-subscriptcenter",superscript:'isbt-summer-toolbar-icon isbt-superscriptcenter"',underline:"isbt-summer-toolbar-icon isbt-underlinebig",font:"isbt-summer-toolbar-icon isbt-textabigunderline",indent:"note-icon-align-indent",outdent:"note-icon-align-outdent",arrowsAlt:"note-icon-arrows-alt",bold:"note-icon-bold",circle:"note-icon-circle",close:"note-icon-close",code:"note-icon-code",eraser:"note-icon-eraser",frame:"note-icon-frame",italic:"note-icon-italic",link:"note-icon-link",unlink:"note-icon-chain-broken",magic:"note-icon-magic",menuCheck:"note-icon-check",minus:"note-icon-minus",orderedlist:"note-icon-orderedlist",pencil:"note-icon-pencil",picture:"note-icon-picture",question:"note-icon-question",redo:"note-icon-redo",square:"note-icon-square",table:"note-icon-table",textHeight:"note-icon-text-height",trash:"note-icon-trash",undo:"note-icon-undo",unorderedlist:"note-icon-unorderedlist",video:"note-icon-video"}}})}));AaronWasHere=2;(function(b,a){if(typeof define!=="undefined"&&define.amd){define("canvgModule",["rgbcolor","stackblur"],a)}else{if(typeof module!=="undefined"&&module.exports){module.exports=a(require("rgbcolor"),require("stackblur"))}}b.canvg=a(b.RGBColor,b.stackBlur)}(typeof window!=="undefined"?window:this,function(m,n){var c=function(y,u,t){if(y==null&&u==null&&t==null){var x=document.querySelectorAll("svg");for(var r=0;r<x.length;r++){var w=x[r];var o=document.createElement("canvas");o.width=w.clientWidth;o.height=w.clientHeight;w.parentNode.insertBefore(o,w);w.parentNode.removeChild(w);var q=document.createElement("div");q.appendChild(w);c(o,q.innerHTML)}return}if(typeof y=="string"){y=document.getElementById(y)}if(y.svg!=null){y.svg.stop()}var v=b(t||{});if(!(y.childNodes.length==1&&y.childNodes[0].nodeName=="OBJECT")){y.svg=v}var p=y.getContext("2d");if(typeof u.documentElement!="undefined"){v.loadXmlDoc(p,u)}else{if(u.substr(0,1)=="<"){v.loadXml(p,u)}else{v.load(p,u)}}};var h;if(typeof Element.prototype.matches!="undefined"){h=function(o,p){return o.matches(p)}}else{if(typeof Element.prototype.webkitMatchesSelector!="undefined"){h=function(o,p){return o.webkitMatchesSelector(p)}}else{if(typeof Element.prototype.mozMatchesSelector!="undefined"){h=function(o,p){return o.mozMatchesSelector(p)}}else{if(typeof Element.prototype.msMatchesSelector!="undefined"){h=function(o,p){return o.msMatchesSelector(p)}}else{if(typeof Element.prototype.oMatchesSelector!="undefined"){h=function(o,p){return o.oMatchesSelector(p)}}else{if(typeof jQuery==="function"||typeof Zepto==="function"){h=function(o,p){return $(o).is(p)}}if(typeof h==="undefined"){h=Sizzle.matchesSelector}}}}}}var a=/(\[[^\]]+\])/g;var g=/(#[^\s\+>~\.\[:]+)/g;var d=/(\.[^\s\+>~\.\[:]+)/g;var l=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi;var k=/(:[\w-]+\([^\)]*\))/gi;var j=/(:[^\s\+>~\.\[:]+)/g;var e=/([^\s\+>~\.\[:]+)/g;function f(p){var q=[0,0,0];var o=function(s,t){var r=p.match(s);if(r==null){return}q[t]+=r.length;p=p.replace(s," ")};p=p.replace(/:not\(([^\)]*)\)/g,"     $1 ");p=p.replace(/{[\s\S]*/gm," ");o(a,1);o(g,0);o(d,1);o(l,2);o(k,1);o(j,1);p=p.replace(/[\*\s\+>~]/g," ");p=p.replace(/[#\.]/g," ");o(e,2);return q.join("")}function b(o){var p={opts:o};p.FRAMERATE=30;p.MAX_VIRTUAL_PIXELS=30000;p.log=function(r){};if(p.opts.log==true&&typeof console!="undefined"){p.log=function(r){console.log(r)}}p.init=function(r){var s=0;p.UniqueId=function(){s++;return"canvg"+s};p.Definitions={};p.Styles={};p.StylesSpecificity={};p.Animations=[];p.Images=[];p.ctx=r;p.ViewPort=new (function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(u,t){this.viewPorts.push({width:u,height:t})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(t){if(t!=null&&typeof t=="number"){return t}if(t=="x"){return this.width()}if(t=="y"){return this.height()}return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}})};p.init();p.ImagesLoaded=function(){for(var r=0;r<p.Images.length;r++){if(!p.Images[r].loaded){return false}}return true};p.trim=function(r){return r.replace(/^\s+|\s+$/g,"")};p.compressSpaces=function(r){return r.replace(/[\s\r\t\n]+/gm," ")};p.ajax=function(s){var r;if(window.XMLHttpRequest){r=new XMLHttpRequest()}else{r=new ActiveXObject("Microsoft.XMLHTTP")}if(r){r.open("GET",s,false);r.send(null);return r.responseText}return null};p.parseXml=function(u){if(typeof Windows!="undefined"&&typeof Windows.Data!="undefined"&&typeof Windows.Data.Xml!="undefined"){var v=new Windows.Data.Xml.Dom.XmlDocument();var t=new Windows.Data.Xml.Dom.XmlLoadSettings();t.prohibitDtd=false;v.loadXml(u,t);return v}else{if(window.DOMParser){try{var s=new DOMParser();return s.parseFromString(u,"image/svg+xml")}catch(r){s=new DOMParser();return s.parseFromString(u,"text/xml")}}else{u=u.replace(/<!DOCTYPE svg[^>]*>/,"");var v=new ActiveXObject("Microsoft.XMLDOM");v.async="false";v.loadXML(u);return v}}};p.Property=function(r,s){this.name=r;this.value=s};p.Property.prototype.getValue=function(){return this.value};p.Property.prototype.hasValue=function(){return(this.value!=null&&this.value!=="")};p.Property.prototype.numValue=function(){if(!this.hasValue()){return 0}var r=parseFloat(this.value);if((this.value+"").match(/%$/)){r=r/100}return r};p.Property.prototype.valueOrDefault=function(r){if(this.hasValue()){return this.value}return r};p.Property.prototype.numValueOrDefault=function(r){if(this.hasValue()){return this.numValue()}return r};p.Property.prototype.addOpacity=function(t){var s=this.value;if(t.value!=null&&t.value!=""&&typeof this.value=="string"){var r=new m(this.value);if(r.ok){s="rgba("+r.r+", "+r.g+", "+r.b+", "+t.numValue()+")"}}return new p.Property(this.name,s)};p.Property.prototype.getDefinition=function(){var r=this.value.match(/#([^\)'"]+)/);if(r){r=r[1]}if(!r){r=this.value}return p.Definitions[r]};p.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0};p.Property.prototype.getFillStyleDefinition=function(s,t){var r=this.getDefinition();if(r!=null&&r.createGradient){return r.createGradient(p.ctx,s,t)}if(r!=null&&r.createPattern){if(r.getHrefAttribute().hasValue()){var u=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition();if(u.hasValue()){r.attribute("patternTransform",true).value=u.value}}return r.createPattern(p.ctx,s)}return null};p.Property.prototype.getDPI=function(r){return 96};p.Property.prototype.getEM=function(t){var r=12;var s=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);if(s.hasValue()){r=s.toPixels(t)}return r};p.Property.prototype.getUnits=function(){var r=this.value+"";return r.replace(/[0-9\.\-]/g,"")};p.Property.prototype.toPixels=function(v,t){if(!this.hasValue()){return 0}var u=this.value+"";if(u.match(/em$/)){return this.numValue()*this.getEM(v)}if(u.match(/ex$/)){return this.numValue()*this.getEM(v)/2}if(u.match(/px$/)){return this.numValue()}if(u.match(/pt$/)){return this.numValue()*this.getDPI(v)*(1/72)}if(u.match(/pc$/)){return this.numValue()*15}if(u.match(/cm$/)){return this.numValue()*this.getDPI(v)/2.54}if(u.match(/mm$/)){return this.numValue()*this.getDPI(v)/25.4}if(u.match(/in$/)){return this.numValue()*this.getDPI(v)}if(u.match(/%$/)){return this.numValue()*p.ViewPort.ComputeSize(v)}var r=this.numValue();if(t&&r<1){return r*p.ViewPort.ComputeSize(v)}return r};p.Property.prototype.toMilliseconds=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/s$/)){return this.numValue()*1000}if(r.match(/ms$/)){return this.numValue()}return this.numValue()};p.Property.prototype.toRadians=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/deg$/)){return this.numValue()*(Math.PI/180)}if(r.match(/grad$/)){return this.numValue()*(Math.PI/200)}if(r.match(/rad$/)){return this.numValue()}return this.numValue()*(Math.PI/180)};var q={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};p.Property.prototype.toTextBaseline=function(){if(!this.hasValue()){return null}return q[this.value]};p.Font=new (function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(v,w,x,u,t,y){var s=y!=null?this.Parse(y):this.CreateFont("","","","","",p.ctx.font);return{fontFamily:t||s.fontFamily,fontSize:u||s.fontSize,fontStyle:v||s.fontStyle,fontWeight:x||s.fontWeight,fontVariant:w||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var r=this;this.Parse=function(x){var u={};var t=p.trim(p.compressSpaces(x||"")).split(" ");var y={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var v="";for(var w=0;w<t.length;w++){if(!y.fontStyle&&r.Styles.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontStyle=t[w]}y.fontStyle=true}else{if(!y.fontVariant&&r.Variants.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontVariant=t[w]}y.fontStyle=y.fontVariant=true}else{if(!y.fontWeight&&r.Weights.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontWeight=t[w]}y.fontStyle=y.fontVariant=y.fontWeight=true}else{if(!y.fontSize){if(t[w]!="inherit"){u.fontSize=t[w].split("/")[0]}y.fontStyle=y.fontVariant=y.fontWeight=y.fontSize=true}else{if(t[w]!="inherit"){v+=t[w]}}}}}}if(v!=""){u.fontFamily=v}return u}});p.ToNumberArray=function(u){var r=p.trim(p.compressSpaces((u||"").replace(/,/g," "))).split(" ");for(var t=0;t<r.length;t++){r[t]=parseFloat(r[t])}return r};p.Point=function(r,s){this.x=r;this.y=s};p.Point.prototype.angleTo=function(r){return Math.atan2(r.y-this.y,r.x-this.x)};p.Point.prototype.applyTransform=function(r){var s=this.x*r[0]+this.y*r[2]+r[4];var t=this.x*r[1]+this.y*r[3]+r[5];this.x=s;this.y=t};p.CreatePoint=function(t){var r=p.ToNumberArray(t);return new p.Point(r[0],r[1])};p.CreatePath=function(v){var r=p.ToNumberArray(v);var u=[];for(var t=0;t<r.length;t+=2){u.push(new p.Point(r[t],r[t+1]))}return u};p.BoundingBox=function(r,t,s,u){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(v,w){if(v!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=v;this.x2=v}if(v<this.x1){this.x1=v}if(v>this.x2){this.x2=v}}if(w!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=w;this.y2=w}if(w<this.y1){this.y1=w}if(w>this.y2){this.y2=w}}};this.addX=function(v){this.addPoint(v,null)};this.addY=function(v){this.addPoint(null,v)};this.addBoundingBox=function(v){this.addPoint(v.x1,v.y1);this.addPoint(v.x2,v.y2)};this.addQuadraticCurve=function(z,A,B,C,D,E){var v=z+2/3*(B-z);var w=A+2/3*(C-A);var x=v+1/3*(D-z);var y=w+1/3*(E-A);this.addBezierCurve(z,A,v,x,w,y,D,E)};this.addBezierCurve=function(B,C,E,F,H,I,K,L){var A=[B,C],D=[E,F],G=[H,I],J=[K,L];this.addPoint(A[0],A[1]);this.addPoint(J[0],J[1]);for(i=0;i<=1;i++){var z=function(P){return Math.pow(1-P,3)*A[i]+3*Math.pow(1-P,2)*P*D[i]+3*(1-P)*Math.pow(P,2)*G[i]+Math.pow(P,3)*J[i]};var w=6*A[i]-12*D[i]+6*G[i];var v=-3*A[i]+9*D[i]-9*G[i]+3*J[i];var y=3*D[i]-3*A[i];if(v==0){if(w==0){continue}var M=-y/w;if(0<M&&M<1){if(i==0){this.addX(z(M))}if(i==1){this.addY(z(M))}}continue}var x=Math.pow(w,2)-4*y*v;if(x<0){continue}var N=(-w+Math.sqrt(x))/(2*v);if(0<N&&N<1){if(i==0){this.addX(z(N))}if(i==1){this.addY(z(N))}}var O=(-w-Math.sqrt(x))/(2*v);if(0<O&&O<1){if(i==0){this.addX(z(O))}if(i==1){this.addY(z(O))}}}};this.isPointInBox=function(v,w){return(this.x1<=v&&v<=this.x2&&this.y1<=w&&w<=this.y2)};this.addPoint(r,t);this.addPoint(s,u)};p.Transform=function(A){var w=this;this.Type={};this.Type.translate=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.translate(this.p.x||0,this.p.y||0)};this.unapply=function(s){s.translate(-1*this.p.x||0,-1*this.p.y||0)};this.applyToPoint=function(s){s.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(B){var v=p.ToNumberArray(B);this.angle=new p.Property("angle",v[0]);this.cx=v[1]||0;this.cy=v[2]||0;this.apply=function(s){s.translate(this.cx,this.cy);s.rotate(this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.unapply=function(s){s.translate(this.cx,this.cy);s.rotate(-1*this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.applyToPoint=function(C){var s=this.angle.toRadians();C.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);C.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]);C.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(s){s.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(s){s.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(v){this.m=p.ToNumberArray(v);this.apply=function(s){s.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(D){var s=this.m[0];var B=this.m[2];var C=this.m[4];var E=this.m[1];var G=this.m[3];var H=this.m[5];var I=0;var J=0;var K=1;var F=1/(s*(G*K-H*J)-B*(E*K-H*I)+C*(E*J-G*I));D.transform(F*(G*K-H*J),F*(H*I-E*K),F*(C*J-B*K),F*(s*K-C*I),F*(B*H-C*G),F*(C*E-s*H))};this.applyToPoint=function(s){s.applyTransform(this.m)}};this.Type.SkewBase=function(v){this.base=w.Type.matrix;this.base(v);this.angle=new p.Property("angle",v)};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(s){for(var v=0;v<this.transforms.length;v++){this.transforms[v].apply(s)}};this.unapply=function(s){for(var v=this.transforms.length-1;v>=0;v--){this.transforms[v].unapply(s)}};this.applyToPoint=function(v){for(var s=0;s<this.transforms.length;s++){this.transforms[s].applyToPoint(v)}};var r=p.trim(p.compressSpaces(A)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var t=0;t<r.length;t++){var z=p.trim(r[t].split("(")[0]);var u=r[t].split("(")[1].replace(")","");var y=this.Type[z];if(typeof y!="undefined"){var x=new y(u);x.type=z;this.transforms.push(x)}}};p.AspectRatio=function(t,s,G,v,w,u,y,z,A,B){s=p.compressSpaces(s);s=s.replace(/^defer\s/,"");var r=s.split(" ")[0]||"xMidYMid";var x=s.split(" ")[1]||"meet";var E=G/v;var F=w/u;var D=Math.min(E,F);var C=Math.max(E,F);if(x=="meet"){v*=D;u*=D}if(x=="slice"){v*=C;u*=C}A=new p.Property("refX",A);B=new p.Property("refY",B);if(A.hasValue()&&B.hasValue()){t.translate(-D*A.toPixels("x"),-D*B.toPixels("y"))}else{if(r.match(/^xMid/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G/2-v/2,0)}if(r.match(/YMid$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w/2-u/2)}if(r.match(/^xMax/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G-v,0)}if(r.match(/YMax$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w-u)}}if(r=="none"){t.scale(E,F)}else{if(x=="meet"){t.scale(D,D)}else{if(x=="slice"){t.scale(C,C)}}}t.translate(y==null?0:-y,z==null?0:-z)};p.Element={};p.EmptyProperty=new p.Property("EMPTY","");p.Element.ElementBase=function(w){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(F,E){var D=this.attributes[F];if(D!=null){return D}if(E==true){D=new p.Property(F,"");this.attributes[F]=D}return D||p.EmptyProperty};this.getHrefAttribute=function(){for(var D in this.attributes){if(D=="href"||D.match(/:href$/)){return this.attributes[D]}}return p.EmptyProperty};this.style=function(F,E,J){var I=this.styles[F];if(I!=null){return I}var D=this.attribute(F);if(D!=null&&D.hasValue()){this.styles[F]=D;return D}if(J!=true){var G=this.parent;if(G!=null){var H=G.style(F);if(H!=null&&H.hasValue()){return H}}}if(E==true){I=new p.Property(F,"");this.styles[F]=I}return I||p.EmptyProperty};this.render=function(D){if(this.style("display").value=="none"){return}if(this.style("visibility").value=="hidden"){return}D.save();if(this.style("mask").hasValue()){var F=this.style("mask").getDefinition();if(F!=null){F.apply(D,this)}}else{if(this.style("filter").hasValue()){var E=this.style("filter").getDefinition();if(E!=null){E.apply(D,this)}}else{this.setContext(D);this.renderChildren(D);this.clearContext(D)}}D.restore()};this.setContext=function(D){};this.clearContext=function(D){};this.renderChildren=function(D){for(var E=0;E<this.children.length;E++){this.children[E].render(D)}};this.addChild=function(E,F){var D=E;if(F){D=p.CreateElement(E)}D.parent=this;if(D.type!="title"){this.children.push(D)}};this.addStylesFromStyleDefinition=function(){for(var F in p.Styles){if(F[0]!="@"&&h(w,F)){var H=p.Styles[F];var G=p.StylesSpecificity[F];if(H!=null){for(var E in H){var D=this.stylesSpecificity[E];if(typeof D=="undefined"){D="000"}if(G>D){this.styles[E]=H[E];this.stylesSpecificity[E]=G}}}}}};var r=new RegExp("^[A-Z-]+$");var y=function(D){if(r.test(D)){return D.toLowerCase()}return D};if(w!=null&&w.nodeType==1){for(var u=0;u<w.attributes.length;u++){var s=w.attributes[u];var x=y(s.nodeName);this.attributes[x]=new p.Property(x,s.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue()){var A=this.attribute("style").value.split(";");for(var u=0;u<A.length;u++){if(p.trim(A[u])!=""){var z=A[u].split(":");var v=p.trim(z[0]);var C=p.trim(z[1]);this.styles[v]=new p.Property(v,C)}}}if(this.attribute("id").hasValue()){if(p.Definitions[this.attribute("id").value]==null){p.Definitions[this.attribute("id").value]=this}}for(var u=0;u<w.childNodes.length;u++){var t=w.childNodes[u];if(t.nodeType==1){this.addChild(t,true)}if(this.captureTextNodes&&(t.nodeType==3||t.nodeType==4)){var B=t.value||t.text||t.textContent||"";if(p.compressSpaces(B)!=""){this.addChild(new p.Element.tspan(t),false)}}}}};p.Element.RenderedElementBase=function(r){this.base=p.Element.ElementBase;this.base(r);this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var v=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));if(v!=null){t.fillStyle=v}}else{if(this.style("fill").hasValue()){var u=this.style("fill");if(u.value=="currentColor"){u.value=this.style("color").value}if(u.value!="inherit"){t.fillStyle=(u.value=="none"?"rgba(0,0,0,0)":u.value)}}}if(this.style("fill-opacity").hasValue()){var u=new p.Property("fill",t.fillStyle);u=u.addOpacity(this.style("fill-opacity"));t.fillStyle=u.value}if(this.style("stroke").isUrlDefinition()){var v=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));if(v!=null){t.strokeStyle=v}}else{if(this.style("stroke").hasValue()){var z=this.style("stroke");if(z.value=="currentColor"){z.value=this.style("color").value}if(z.value!="inherit"){t.strokeStyle=(z.value=="none"?"rgba(0,0,0,0)":z.value)}}}if(this.style("stroke-opacity").hasValue()){var z=new p.Property("stroke",t.strokeStyle);z=z.addOpacity(this.style("stroke-opacity"));t.strokeStyle=z.value}if(this.style("stroke-width").hasValue()){var x=this.style("stroke-width").toPixels();t.lineWidth=x==0?0.001:x}if(this.style("stroke-linecap").hasValue()){t.lineCap=this.style("stroke-linecap").value}if(this.style("stroke-linejoin").hasValue()){t.lineJoin=this.style("stroke-linejoin").value}if(this.style("stroke-miterlimit").hasValue()){t.miterLimit=this.style("stroke-miterlimit").value}if(this.style("stroke-dasharray").hasValue()&&this.style("stroke-dasharray").value!="none"){var w=p.ToNumberArray(this.style("stroke-dasharray").value);if(typeof t.setLineDash!="undefined"){t.setLineDash(w)}else{if(typeof t.webkitLineDash!="undefined"){t.webkitLineDash=w}else{if(typeof t.mozDash!="undefined"&&!(w.length==1&&w[0]==0)){t.mozDash=w}}}var y=this.style("stroke-dashoffset").numValueOrDefault(1);if(typeof t.lineDashOffset!="undefined"){t.lineDashOffset=y}else{if(typeof t.webkitLineDashOffset!="undefined"){t.webkitLineDashOffset=y}else{if(typeof t.mozDashOffset!="undefined"){t.mozDashOffset=y}}}}if(typeof t.font!="undefined"){t.font=p.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()}if(this.style("transform",false,true).hasValue()){var A=new p.Transform(this.style("transform",false,true).value);A.apply(t)}if(this.style("clip-path",false,true).hasValue()){var s=this.style("clip-path",false,true).getDefinition();if(s!=null){s.apply(t)}}if(this.style("opacity").hasValue()){t.globalAlpha=this.style("opacity").numValue()}}};p.Element.RenderedElementBase.prototype=new p.Element.ElementBase;p.Element.PathElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.path=function(s){if(s!=null){s.beginPath()}return new p.BoundingBox()};this.renderChildren=function(s){this.path(s);p.Mouse.checkPath(this,s);if(s.fillStyle!=""){if(this.style("fill-rule").valueOrDefault("inherit")!="inherit"){s.fill(this.style("fill-rule").value)}else{s.fill()}}if(s.strokeStyle!=""){s.stroke()}var v=this.getMarkers();if(v!=null){if(this.style("marker-start").isUrlDefinition()){var u=this.style("marker-start").getDefinition();u.render(s,v[0][0],v[0][1])}if(this.style("marker-mid").isUrlDefinition()){var u=this.style("marker-mid").getDefinition();for(var t=1;t<v.length-1;t++){u.render(s,v[t][0],v[t][1])}}if(this.style("marker-end").isUrlDefinition()){var u=this.style("marker-end").getDefinition();u.render(s,v[v.length-1][0],v[v.length-1][1])}}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};p.Element.PathElementBase.prototype=new p.Element.RenderedElementBase;p.Element.svg=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.baseClearContext=this.clearContext;this.clearContext=function(s){this.baseClearContext(s);p.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(s){s.strokeStyle="rgba(0,0,0,0)";s.lineCap="butt";s.lineJoin="miter";s.miterLimit=4;if(typeof s.font!="undefined"&&typeof window.getComputedStyle!="undefined"){s.font=window.getComputedStyle(s.canvas).getPropertyValue("font")}this.baseSetContext(s);if(!this.attribute("x").hasValue()){this.attribute("x",true).value=0}if(!this.attribute("y").hasValue()){this.attribute("y",true).value=0}s.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var z=p.ViewPort.width();var t=p.ViewPort.height();if(!this.attribute("width").hasValue()){this.attribute("width",true).value="100%"}if(!this.attribute("height").hasValue()){this.attribute("height",true).value="100%"}if(typeof this.root=="undefined"){z=this.attribute("width").toPixels("x");t=this.attribute("height").toPixels("y");var A=0;var B=0;if(this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){A=-this.attribute("refX").toPixels("x");B=-this.attribute("refY").toPixels("y")}if(this.attribute("overflow").valueOrDefault("hidden")!="visible"){s.beginPath();s.moveTo(A,B);s.lineTo(z,B);s.lineTo(z,t);s.lineTo(A,t);s.closePath();s.clip()}}p.ViewPort.SetCurrent(z,t);if(this.attribute("viewBox").hasValue()){var w=p.ToNumberArray(this.attribute("viewBox").value);var u=w[0];var v=w[1];z=w[2];t=w[3];p.AspectRatio(s,this.attribute("preserveAspectRatio").value,p.ViewPort.width(),z,p.ViewPort.height(),t,u,v,this.attribute("refX").value,this.attribute("refY").value);p.ViewPort.RemoveCurrent();p.ViewPort.SetCurrent(w[2],w[3])}}};p.Element.svg.prototype=new p.Element.RenderedElementBase;p.Element.rect=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var t=this.attribute("height").toPixels("y");var u=this.attribute("rx").toPixels("x");var v=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()){v=u}if(this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()){u=v}u=Math.min(u,w/2);v=Math.min(v,t/2);if(s!=null){s.beginPath();s.moveTo(z+u,A);s.lineTo(z+w-u,A);s.quadraticCurveTo(z+w,A,z+w,A+v);s.lineTo(z+w,A+t-v);s.quadraticCurveTo(z+w,A+t,z+w-u,A+t);s.lineTo(z+u,A+t);s.quadraticCurveTo(z,A+t,z,A+t-v);s.lineTo(z,A+v);s.quadraticCurveTo(z,A,z+u,A);s.closePath()}return new p.BoundingBox(z,A,z+w,A+t)}};p.Element.rect.prototype=new p.Element.PathElementBase;p.Element.circle=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");var v=this.attribute("r").toPixels();if(s!=null){s.beginPath();s.arc(t,u,v,0,Math.PI*2,true);s.closePath()}return new p.BoundingBox(t-v,u-v,t+v,u+v)}};p.Element.circle.prototype=new p.Element.PathElementBase;p.Element.ellipse=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var v=4*((Math.sqrt(2)-1)/3);var w=this.attribute("rx").toPixels("x");var x=this.attribute("ry").toPixels("y");var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");if(s!=null){s.beginPath();s.moveTo(t,u-x);s.bezierCurveTo(t+(v*w),u-x,t+w,u-(v*x),t+w,u);s.bezierCurveTo(t+w,u+(v*x),t+(v*w),u+x,t,u+x);s.bezierCurveTo(t-(v*w),u+x,t-w,u+(v*x),t-w,u);s.bezierCurveTo(t-w,u-(v*x),t-(v*w),u-x,t,u-x);s.closePath()}return new p.BoundingBox(t-w,u-x,t+w,u+x)}};p.Element.ellipse.prototype=new p.Element.PathElementBase;p.Element.line=function(r){this.base=p.Element.PathElementBase;this.base(r);this.getPoints=function(){return[new p.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new p.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(s){var t=this.getPoints();if(s!=null){s.beginPath();s.moveTo(t[0].x,t[0].y);s.lineTo(t[1].x,t[1].y)}return new p.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)};this.getMarkers=function(){var t=this.getPoints();var s=t[0].angleTo(t[1]);return[[t[0],s],[t[1],s]]}};p.Element.line.prototype=new p.Element.PathElementBase;p.Element.polyline=function(r){this.base=p.Element.PathElementBase;this.base(r);this.points=p.CreatePath(this.attribute("points").value);this.path=function(t){var s=new p.BoundingBox(this.points[0].x,this.points[0].y);if(t!=null){t.beginPath();t.moveTo(this.points[0].x,this.points[0].y)}for(var u=1;u<this.points.length;u++){s.addPoint(this.points[u].x,this.points[u].y);if(t!=null){t.lineTo(this.points[u].x,this.points[u].y)}}return s};this.getMarkers=function(){var t=[];for(var s=0;s<this.points.length-1;s++){t.push([this.points[s],this.points[s].angleTo(this.points[s+1])])}if(t.length>0){t.push([this.points[this.points.length-1],t[t.length-1][1]])}return t}};p.Element.polyline.prototype=new p.Element.PathElementBase;p.Element.polygon=function(r){this.base=p.Element.polyline;this.base(r);this.basePath=this.path;this.path=function(t){var s=this.basePath(t);if(t!=null){t.lineTo(this.points[0].x,this.points[0].y);t.closePath()}return s}};p.Element.polygon.prototype=new p.Element.polyline;p.Element.path=function(t){this.base=p.Element.PathElementBase;this.base(t);var r=this.attribute("d").value;r=r.replace(/,/gm," ");for(var s=0;s<2;s++){r=r.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2")}r=r.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");r=r.replace(/([0-9])([+\-])/gm,"$1 $2");for(var s=0;s<2;s++){r=r.replace(/(\.[0-9]*)(\.)/gm,"$1 $2")}r=r.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");r=p.compressSpaces(r);r=p.trim(r);this.PathParser=new (function(u){this.tokens=u.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new p.Point(0,0);this.control=new p.Point(0,0);this.current=new p.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var v=new p.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(v)};this.getAsControlPoint=function(){var v=this.getPoint();this.control=v;return v};this.getAsCurrentPoint=function(){var v=this.getPoint();this.current=v;return v};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var v=new p.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return v};this.makeAbsolute=function(v){if(this.isRelativeCommand()){v.x+=this.current.x;v.y+=this.current.y}return v};this.addMarker=function(w,v,x){if(x!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(x)}this.addMarkerAngle(w,v==null?null:v.angleTo(w))};this.addMarkerAngle=function(w,v){this.points.push(w);this.angles.push(v)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var v=0;v<this.angles.length;v++){if(this.angles[v]==null){for(var w=v+1;w<this.angles.length;w++){if(this.angles[w]!=null){this.angles[v]=this.angles[w];break}}}}return this.angles}})(r);this.path=function(G){var R=this.PathParser;R.reset();var A=new p.BoundingBox();if(G!=null){G.beginPath()}while(!R.isEnd()){R.nextCommand();switch(R.command){case"M":case"m":var P=R.getAsCurrentPoint();R.addMarker(P);A.addPoint(P.x,P.y);if(G!=null){G.moveTo(P.x,P.y)}R.start=R.current;while(!R.isCommandOrEnd()){var P=R.getAsCurrentPoint();R.addMarker(P,R.start);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"L":case"l":while(!R.isCommandOrEnd()){var B=R.current;var P=R.getAsCurrentPoint();R.addMarker(P,B);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"H":case"h":while(!R.isCommandOrEnd()){var O=new p.Point((R.isRelativeCommand()?R.current.x:0)+R.getScalar(),R.current.y);R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"V":case"v":while(!R.isCommandOrEnd()){var O=new p.Point(R.current.x,(R.isRelativeCommand()?R.current.y:0)+R.getScalar());R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"C":case"c":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"S":case"s":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getReflectedControlPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"Q":case"q":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"T":case"t":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getReflectedControlPoint();R.control=D;var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"A":case"a":while(!R.isCommandOrEnd()){var H=R.current;var T=R.getScalar();var U=R.getScalar();var ab=R.getScalar()*(Math.PI/180);var M=R.getScalar();var W=R.getScalar();var E=R.getAsCurrentPoint();var I=new p.Point(Math.cos(ab)*(H.x-E.x)/2+Math.sin(ab)*(H.y-E.y)/2,-Math.sin(ab)*(H.x-E.x)/2+Math.cos(ab)*(H.y-E.y)/2);var L=Math.pow(I.x,2)/Math.pow(T,2)+Math.pow(I.y,2)/Math.pow(U,2);if(L>1){T*=Math.sqrt(L);U*=Math.sqrt(L)}var V=(M==W?-1:1)*Math.sqrt(((Math.pow(T,2)*Math.pow(U,2))-(Math.pow(T,2)*Math.pow(I.y,2))-(Math.pow(U,2)*Math.pow(I.x,2)))/(Math.pow(T,2)*Math.pow(I.y,2)+Math.pow(U,2)*Math.pow(I.x,2)));if(isNaN(V)){V=0}var F=new p.Point(V*T*I.y/U,V*-U*I.x/T);var C=new p.Point((H.x+E.x)/2+Math.cos(ab)*F.x-Math.sin(ab)*F.y,(H.y+E.y)/2+Math.sin(ab)*F.x+Math.cos(ab)*F.y);var N=function(u){return Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2))};var S=function(ac,ad){return(ac[0]*ad[0]+ac[1]*ad[1])/(N(ac)*N(ad))};var w=function(ac,ad){return(ac[0]*ad[1]<ac[1]*ad[0]?-1:1)*Math.acos(S(ac,ad))};var x=w([1,0],[(I.x-F.x)/T,(I.y-F.y)/U]);var Z=[(I.x-F.x)/T,(I.y-F.y)/U];var aa=[(-I.x-F.x)/T,(-I.y-F.y)/U];var y=w(Z,aa);if(S(Z,aa)<=-1){y=Math.PI}if(S(Z,aa)>=1){y=0}var J=1-W?1:-1;var z=x+J*(y/2);var K=new p.Point(C.x+T*Math.cos(z),C.y+U*Math.sin(z));R.addMarkerAngle(K,z-J*Math.PI/2);R.addMarkerAngle(E,z-J*Math.PI);A.addPoint(E.x,E.y);if(G!=null){var S=T>U?T:U;var X=T>U?1:T/U;var Y=T>U?U/T:1;G.translate(C.x,C.y);G.rotate(ab);G.scale(X,Y);G.arc(0,0,S,x,x+y,1-W);G.scale(1/X,1/Y);G.rotate(-ab);G.translate(-C.x,-C.y)}}break;case"Z":case"z":if(G!=null){G.closePath()}R.current=R.start}}return A};this.getMarkers=function(){var x=this.PathParser.getMarkerPoints();var u=this.PathParser.getMarkerAngles();var w=[];for(var v=0;v<x.length;v++){w.push([x[v],u[v]])}return w}};p.Element.path.prototype=new p.Element.PathElementBase;p.Element.pattern=function(r){this.base=p.Element.ElementBase;this.base(r);this.createPattern=function(u,v){var B=this.attribute("width").toPixels("x",true);var w=this.attribute("height").toPixels("y",true);var A=new p.Element.svg();A.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);A.attributes.width=new p.Property("width",B+"px");A.attributes.height=new p.Property("height",w+"px");A.attributes.transform=new p.Property("transform",this.attribute("patternTransform").value);A.children=this.children;var s=document.createElement("canvas");s.width=B;s.height=w;var t=s.getContext("2d");if(this.attribute("x").hasValue()&&this.attribute("y").hasValue()){t.translate(this.attribute("x").toPixels("x",true),this.attribute("y").toPixels("y",true))}for(var C=-1;C<=1;C++){for(var D=-1;D<=1;D++){t.save();A.attributes.x=new p.Property("x",C*s.width);A.attributes.y=new p.Property("y",D*s.height);A.render(t);t.restore()}}var z=u.createPattern(s,"repeat");return z}};p.Element.pattern.prototype=new p.Element.ElementBase;p.Element.marker=function(r){this.base=p.Element.ElementBase;this.base(r);this.baseRender=this.render;this.render=function(t,u,s){t.translate(u.x,u.y);if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(s)}if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(t.lineWidth,t.lineWidth)}t.save();var v=new p.Element.svg();v.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);v.attributes.refX=new p.Property("refX",this.attribute("refX").value);v.attributes.refY=new p.Property("refY",this.attribute("refY").value);v.attributes.width=new p.Property("width",this.attribute("markerWidth").value);v.attributes.height=new p.Property("height",this.attribute("markerHeight").value);v.attributes.fill=new p.Property("fill",this.attribute("fill").valueOrDefault("black"));v.attributes.stroke=new p.Property("stroke",this.attribute("stroke").valueOrDefault("none"));v.children=this.children;v.render(t);t.restore();if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(1/t.lineWidth,1/t.lineWidth)}if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(-s)}t.translate(-u.x,-u.y)}};p.Element.marker.prototype=new p.Element.ElementBase;p.Element.defs=function(r){this.base=p.Element.ElementBase;this.base(r);this.render=function(s){}};p.Element.defs.prototype=new p.Element.ElementBase;p.Element.GradientBase=function(t){this.base=p.Element.ElementBase;this.base(t);this.stops=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="stop"){this.stops.push(r)}}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(w){for(var v=0;v<this.attributesToInherit.length;v++){var u=this.attributesToInherit[v];if(!this.attribute(u).hasValue()&&w.attribute(u).hasValue()){this.attribute(u,true).value=w.attribute(u).value}}};this.createGradient=function(w,x,B){var E=this;if(this.getHrefAttribute().hasValue()){E=this.getHrefAttribute().getDefinition();this.inheritStopContainer(E)}var u=function(H){if(B.hasValue()){var I=new p.Property("color",H);return I.addOpacity(B).value}return H};var y=this.getGradient(w,x);if(y==null){return u(E.stops[E.stops.length-1].color)}for(var A=0;A<E.stops.length;A++){y.addColorStop(E.stops[A].offset,u(E.stops[A].color))}if(this.attribute("gradientTransform").hasValue()){var D=p.ViewPort.viewPorts[0];var C=new p.Element.rect();C.attributes.x=new p.Property("x",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.y=new p.Property("y",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.width=new p.Property("width",p.MAX_VIRTUAL_PIXELS);C.attributes.height=new p.Property("height",p.MAX_VIRTUAL_PIXELS);var z=new p.Element.g();z.attributes.transform=new p.Property("transform",this.attribute("gradientTransform").value);z.children=[C];var G=new p.Element.svg();G.attributes.x=new p.Property("x",0);G.attributes.y=new p.Property("y",0);G.attributes.width=new p.Property("width",D.width);G.attributes.height=new p.Property("height",D.height);G.children=[z];var v=document.createElement("canvas");v.width=D.width;v.height=D.height;var F=v.getContext("2d");F.fillStyle=y;G.render(F);return F.createPattern(v,"no-repeat")}return y}};p.Element.GradientBase.prototype=new p.Element.ElementBase;p.Element.linearGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");this.attributesToInherit.push("y2");this.getGradient=function(t,u){var s=this.gradientUnits()=="objectBoundingBox"?u.getBoundingBox():null;if(!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()){this.attribute("x1",true).value=0;this.attribute("y1",true).value=0;this.attribute("x2",true).value=1;this.attribute("y2",true).value=0}var v=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"));var x=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"));var w=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"));var y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y"));if(v==w&&x==y){return null}return t.createLinearGradient(v,x,w,y)}};p.Element.linearGradient.prototype=new p.Element.GradientBase;p.Element.radialGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(t,w){var s=w.getBoundingBox();if(!this.attribute("cx").hasValue()){this.attribute("cx",true).value="50%"}if(!this.attribute("cy").hasValue()){this.attribute("cy",true).value="50%"}if(!this.attribute("r").hasValue()){this.attribute("r",true).value="50%"}var u=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"));var v=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"));var x=u;var y=v;if(this.attribute("fx").hasValue()){x=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"))}if(this.attribute("fy").hasValue()){y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"))}var z=(this.gradientUnits()=="objectBoundingBox"?(s.width()+s.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return t.createRadialGradient(x,y,0,u,v,z)}};p.Element.radialGradient.prototype=new p.Element.GradientBase;p.Element.stop=function(r){this.base=p.Element.ElementBase;this.base(r);this.offset=this.attribute("offset").numValue();if(this.offset<0){this.offset=0}if(this.offset>1){this.offset=1}var s=this.style("stop-color",true);if(s.value===""){s.value="#000"}if(this.style("stop-opacity").hasValue()){s=s.addOpacity(this.style("stop-opacity"))}this.color=s.value};p.Element.stop.prototype=new p.Element.ElementBase;p.Element.AnimateBase=function(r){this.base=p.Element.ElementBase;this.base(r);p.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var t=this.attribute("attributeType").value;var s=this.attribute("attributeName").value;if(t=="CSS"){return this.parent.style(s,true)}return this.parent.attribute(s,true)};this.initialValue=null;this.initialUnits="";this.removed=false;this.calcValue=function(){return""};this.update=function(s){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits()}if(this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite"){this.duration=0}else{if(this.attribute("fill").valueOrDefault("remove")=="freeze"&&!this.frozen){this.frozen=true;this.parent.animationFrozen=true;this.parent.animationFrozenValue=this.getProperty().value}else{if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed){this.removed=true;this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue;return true}}}return false}this.duration=this.duration+s;var v=false;if(this.begin<this.duration){var t=this.calcValue();if(this.attribute("type").hasValue()){var u=this.attribute("type").value;t=u+"("+t+")"}this.getProperty().value=t;v=true}return v};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");if(this.values.hasValue()){this.values.value=this.values.value.split(";")}this.progress=function(){var u={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=u.progress*(this.values.value.length-1);var s=Math.floor(t),v=Math.ceil(t);u.from=new p.Property("from",parseFloat(this.values.value[s]));u.to=new p.Property("to",parseFloat(this.values.value[v]));u.progress=(t-s)/(v-s)}else{u.from=this.from;u.to=this.to}return u}};p.Element.AnimateBase.prototype=new p.Element.ElementBase;p.Element.animate=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var t=this.progress();var s=t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress;return s+this.initialUnits}};p.Element.animate.prototype=new p.Element.AnimateBase;p.Element.animateColor=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var t=new m(v.from.value);var x=new m(v.to.value);if(t.ok&&x.ok){var w=t.r+(x.r-t.r)*v.progress;var u=t.g+(x.g-t.g)*v.progress;var s=t.b+(x.b-t.b)*v.progress;return"rgb("+parseInt(w,10)+","+parseInt(u,10)+","+parseInt(s,10)+")"}return this.attribute("from").value}};p.Element.animateColor.prototype=new p.Element.AnimateBase;p.Element.animateTransform=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var s=p.ToNumberArray(v.from.value);var w=p.ToNumberArray(v.to.value);var u="";for(var t=0;t<s.length;t++){u+=s[t]+(w[t]-s[t])*v.progress+" "}return u}};p.Element.animateTransform.prototype=new p.Element.animate;p.Element.font=function(t){this.base=p.Element.ElementBase;this.base(t);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="font-face"){this.fontFace=r;if(r.style("font-family").hasValue()){p.Definitions[r.style("font-family").value]=this}}else{if(r.type=="missing-glyph"){this.missingGlyph=r}else{if(r.type=="glyph"){if(r.arabicForm!=""){this.isRTL=true;this.isArabic=true;if(typeof this.glyphs[r.unicode]=="undefined"){this.glyphs[r.unicode]=[]}this.glyphs[r.unicode][r.arabicForm]=r}else{this.glyphs[r.unicode]=r}}}}}};p.Element.font.prototype=new p.Element.ElementBase;p.Element.fontface=function(r){this.base=p.Element.ElementBase;this.base(r);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;this.unitsPerEm=this.attribute("units-per-em").numValue()};p.Element.fontface.prototype=new p.Element.ElementBase;p.Element.missingglyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=0};p.Element.missingglyph.prototype=new p.Element.path;p.Element.glyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};p.Element.glyph.prototype=new p.Element.path;p.Element.text=function(r){this.captureTextNodes=true;this.base=p.Element.RenderedElementBase;this.base(r);this.baseSetContext=this.setContext;this.setContext=function(s){this.baseSetContext(s);var t=this.style("dominant-baseline").toTextBaseline();if(t==null){t=this.style("alignment-baseline").toTextBaseline()}if(t!=null){s.textBaseline=t}};this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x");var u=this.attribute("y").toPixels("y");var s=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);return new p.BoundingBox(t,u-s,t+Math.floor(s*2/3)*this.children[0].getText().length,u)};this.renderChildren=function(s){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");if(this.attribute("dx").hasValue()){this.x+=this.attribute("dx").toPixels("x")}if(this.attribute("dy").hasValue()){this.y+=this.attribute("dy").toPixels("y")}this.x+=this.getAnchorDelta(s,this,0);for(var t=0;t<this.children.length;t++){this.renderChild(s,this,this,t)}};this.getAnchorDelta=function(t,v,w){var x=this.style("text-anchor").valueOrDefault("start");if(x!="start"){var y=0;for(var u=w;u<v.children.length;u++){var s=v.children[u];if(u>w&&s.attribute("x").hasValue()){break}y+=s.measureTextRecursive(t)}return -1*(x=="end"?y:y/2)}return 0};this.renderChild=function(t,w,v,u){var s=v.children[u];if(s.attribute("x").hasValue()){s.x=s.attribute("x").toPixels("x")+w.getAnchorDelta(t,v,u);if(s.attribute("dx").hasValue()){s.x+=s.attribute("dx").toPixels("x")}}else{if(s.attribute("dx").hasValue()){w.x+=s.attribute("dx").toPixels("x")}s.x=w.x}w.x=s.x+s.measureText(t);if(s.attribute("y").hasValue()){s.y=s.attribute("y").toPixels("y");if(s.attribute("dy").hasValue()){s.y+=s.attribute("dy").toPixels("y")}}else{if(s.attribute("dy").hasValue()){w.y+=s.attribute("dy").toPixels("y")}s.y=w.y}w.y=s.y;s.render(t);for(var u=0;u<s.children.length;u++){w.renderChild(t,w,s,u)}}};p.Element.text.prototype=new p.Element.RenderedElementBase;p.Element.TextElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getGlyph=function(u,x,w){var t=x[w];var v=null;if(u.isArabic){var s="isolated";if((w==0||x[w-1]==" ")&&w<x.length-2&&x[w+1]!=" "){s="terminal"}if(w>0&&x[w-1]!=" "&&w<x.length-2&&x[w+1]!=" "){s="medial"}if(w>0&&x[w-1]!=" "&&(w==x.length-1||x[w+1]==" ")){s="initial"}if(typeof u.glyphs[t]!="undefined"){v=u.glyphs[t][s];if(v==null&&u.glyphs[t].type=="glyph"){v=u.glyphs[t]}}}else{v=u.glyphs[t]}if(v==null){v=u.missingGlyph}return v};this.renderChildren=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var w=this.parent.style("font-style").valueOrDefault(p.Font.Parse(p.ctx.font).fontStyle);var B=this.getText();if(t.isRTL){B=B.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var y=0;y<B.length;y++){var x=this.getGlyph(t,B,y);var A=v/t.fontFace.unitsPerEm;s.translate(this.x,this.y);s.scale(A,-A);var z=s.lineWidth;s.lineWidth=s.lineWidth*t.fontFace.unitsPerEm/v;if(w=="italic"){s.transform(1,0,0.4,1,0,0)}x.render(s);if(w=="italic"){s.transform(1,0,-0.4,1,0,0)}s.lineWidth=z;s.scale(1/A,-1/A);s.translate(-this.x,-this.y);this.x+=v*(x.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm;if(typeof u[y]!="undefined"&&!isNaN(u[y])){this.x+=u[y]}}return}if(s.fillStyle!=""){s.fillText(p.compressSpaces(this.getText()),this.x,this.y)}if(s.strokeStyle!=""){s.strokeText(p.compressSpaces(this.getText()),this.x,this.y)}};this.getText=function(){};this.measureTextRecursive=function(s){var u=this.measureText(s);for(var t=0;t<this.children.length;t++){u+=this.children[t].measureTextRecursive(s)}return u};this.measureText=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var y=0;var z=this.getText();if(t.isRTL){z=z.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var x=0;x<z.length;x++){var w=this.getGlyph(t,z,x);y+=(w.horizAdvX||t.horizAdvX)*v/t.fontFace.unitsPerEm;if(typeof u[x]!="undefined"&&!isNaN(u[x])){y+=u[x]}}return y}var A=p.compressSpaces(this.getText());if(!s.measureText){return A.length*10}s.save();this.setContext(s);var B=s.measureText(A).width;s.restore();return B}};p.Element.TextElementBase.prototype=new p.Element.RenderedElementBase;p.Element.tspan=function(r){this.captureTextNodes=true;this.base=p.Element.TextElementBase;this.base(r);this.text=p.compressSpaces(r.value||r.text||r.textContent||"");this.getText=function(){if(this.children.length>0){return""}return this.text}};p.Element.tspan.prototype=new p.Element.TextElementBase;p.Element.tref=function(r){this.base=p.Element.TextElementBase;this.base(r);this.getText=function(){var s=this.getHrefAttribute().getDefinition();if(s!=null){return s.children[0].getText()}}};p.Element.tref.prototype=new p.Element.TextElementBase;p.Element.a=function(s){this.base=p.Element.TextElementBase;this.base(s);this.hasText=s.childNodes.length>0;for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType!=3){this.hasText=false}}this.text=this.hasText?s.childNodes[0].value:"";this.getText=function(){return this.text};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var u=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);p.Mouse.checkBoundingBox(this,new p.BoundingBox(this.x,this.y-u.toPixels("y"),this.x+this.measureText(t),this.y))}else{if(this.children.length>0){var v=new p.Element.g();v.children=this.children;v.parent=this;v.render(t)}}};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){p.ctx.canvas.style.cursor="pointer"}};p.Element.a.prototype=new p.Element.TextElementBase;p.Element.image=function(t){this.base=p.Element.RenderedElementBase;this.base(t);var r=this.getHrefAttribute().value;if(r==""){return}var s=r.match(/\.svg$/);p.Images.push(this);this.loaded=false;if(!s){this.img=document.createElement("img");if(p.opts.useCORS==true){this.img.crossOrigin="Anonymous"}var u=this;this.img.onload=function(){u.loaded=true};this.img.onerror=function(){p.log('ERROR: image "'+r+'" not found');u.loaded=true};this.img.src=r}else{this.img=p.ajax(r);this.loaded=true}this.renderChildren=function(v){var A=this.attribute("x").toPixels("x");var B=this.attribute("y").toPixels("y");var z=this.attribute("width").toPixels("x");var w=this.attribute("height").toPixels("y");if(z==0||w==0){return}v.save();if(s){v.drawSvg(this.img,A,B,z,w)}else{v.translate(A,B);p.AspectRatio(v,this.attribute("preserveAspectRatio").value,z,this.img.width,w,this.img.height,0,0);v.drawImage(this.img,0,0)}v.restore()};this.getBoundingBox=function(){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var v=this.attribute("height").toPixels("y");return new p.BoundingBox(z,A,z+w,A+v)}};p.Element.image.prototype=new p.Element.RenderedElementBase;p.Element.g=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getBoundingBox=function(){var s=new p.BoundingBox();for(var t=0;t<this.children.length;t++){s.addBoundingBox(this.children[t].getBoundingBox())}return s}};p.Element.g.prototype=new p.Element.RenderedElementBase;p.Element.symbol=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.render=function(s){}};p.Element.symbol.prototype=new p.Element.RenderedElementBase;p.Element.style=function(H){this.base=p.Element.ElementBase;this.base(H);var r="";for(var D=0;D<H.childNodes.length;D++){r+=H.childNodes[D].data}r=r.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");r=p.compressSpaces(r);var w=r.split("}");for(var D=0;D<w.length;D++){if(p.trim(w[D])!=""){var v=w[D].split("{");var u=v[0].split(",");var x=v[1].split(";");for(var E=0;E<u.length;E++){var t=p.trim(u[E]);if(t!=""){var J=p.Styles[t]||{};for(var F=0;F<x.length;F++){var I=x[F].indexOf(":");var G=x[F].substr(0,I);var P=x[F].substr(I+1,x[F].length-I);if(G!=null&&P!=null){J[p.trim(G)]=new p.Property(p.trim(G),p.trim(P))}}p.Styles[t]=J;p.StylesSpecificity[t]=f(t);if(t=="@font-face"){var B=J["font-family"].value.replace(/"/g,"");var L=J.src.value.split(",");for(var K=0;K<L.length;K++){if(L[K].indexOf('format("svg")')>0){var O=L[K].indexOf("url");var N=L[K].indexOf(")",O);var M=L[K].substr(O+5,N-O-6);var y=p.parseXml(p.ajax(M));var C=y.getElementsByTagName("font");for(var z=0;z<C.length;z++){var A=p.CreateElement(C[z]);p.Definitions[B]=A}}}}}}}}};p.Element.style.prototype=new p.Element.ElementBase;p.Element.use=function(s){this.base=p.Element.RenderedElementBase;this.base(s);this.baseSetContext=this.setContext;this.setContext=function(t){this.baseSetContext(t);if(this.attribute("x").hasValue()){t.translate(this.attribute("x").toPixels("x"),0)}if(this.attribute("y").hasValue()){t.translate(0,this.attribute("y").toPixels("y"))}};var r=this.getHrefAttribute().getDefinition();this.path=function(t){if(r!=null){r.path(t)}};this.getBoundingBox=function(){if(r!=null){return r.getBoundingBox()}};this.renderChildren=function(t){if(r!=null){var v=r;if(r.type=="symbol"){v=new p.Element.svg();v.type="svg";v.attributes.viewBox=new p.Property("viewBox",r.attribute("viewBox").value);v.attributes.preserveAspectRatio=new p.Property("preserveAspectRatio",r.attribute("preserveAspectRatio").value);v.attributes.overflow=new p.Property("overflow",r.attribute("overflow").value);v.children=r.children}if(v.type=="svg"){if(this.attribute("width").hasValue()){v.attributes.width=new p.Property("width",this.attribute("width").value)}if(this.attribute("height").hasValue()){v.attributes.height=new p.Property("height",this.attribute("height").value)}}var u=v.parent;v.parent=null;v.render(t);v.parent=u}}};p.Element.use.prototype=new p.Element.RenderedElementBase;p.Element.mask=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(v,w){var F=this.attribute("x").toPixels("x");var G=this.attribute("y").toPixels("y");var E=this.attribute("width").toPixels("x");var z=this.attribute("height").toPixels("y");if(E==0&&z==0){var s=new p.BoundingBox();for(var A=0;A<this.children.length;A++){s.addBoundingBox(this.children[A].getBoundingBox())}var F=Math.floor(s.x1);var G=Math.floor(s.y1);var E=Math.floor(s.width());var z=Math.floor(s.height())}var B=w.attribute("mask").value;w.attribute("mask").value="";var u=document.createElement("canvas");u.width=F+E;u.height=G+z;var C=u.getContext("2d");this.renderChildren(C);var t=document.createElement("canvas");t.width=F+E;t.height=G+z;var D=t.getContext("2d");w.render(D);D.globalCompositeOperation="destination-in";D.fillStyle=C.createPattern(u,"no-repeat");D.fillRect(0,0,F+E,G+z);v.fillStyle=D.createPattern(t,"no-repeat");v.fillRect(0,0,F+E,G+z);w.attribute("mask").value=B};this.render=function(s){}};p.Element.mask.prototype=new p.Element.ElementBase;p.Element.clipPath=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(t){var v=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var w=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};v.call(t);for(var u=0;u<this.children.length;u++){var s=this.children[u];if(typeof s.path!="undefined"){var x=null;if(s.style("transform",false,true).hasValue()){x=new p.Transform(s.style("transform",false,true).value);x.apply(t)}s.path(t);CanvasRenderingContext2D.prototype.closePath=w;if(x){x.unapply(t)}}}w.call(t);t.clip();CanvasRenderingContext2D.prototype.beginPath=v;CanvasRenderingContext2D.prototype.closePath=w};this.render=function(s){}};p.Element.clipPath.prototype=new p.Element.ElementBase;p.Element.filter=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(u,w){var s=w.getBoundingBox();var G=Math.floor(s.x1);var H=Math.floor(s.y1);var F=Math.floor(s.width());var A=Math.floor(s.height());var z=w.style("filter").value;w.style("filter").value="";var C=0,D=0;for(var B=0;B<this.children.length;B++){var v=this.children[B].extraFilterDistance||0;C=Math.max(C,v);D=Math.max(D,v)}var t=document.createElement("canvas");t.width=F+2*C;t.height=A+2*D;var E=t.getContext("2d");E.translate(-G+C,-H+D);w.render(E);for(var B=0;B<this.children.length;B++){if(typeof this.children[B].apply=="function"){this.children[B].apply(E,0,0,F+2*C,A+2*D)}}u.drawImage(t,0,0,F+2*C,A+2*D,G-C,H-D,F+2*C,A+2*D);w.style("filter",true).value=z};this.render=function(s){}};p.Element.filter.prototype=new p.Element.ElementBase;p.Element.feMorphology=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feMorphology.prototype=new p.Element.ElementBase;p.Element.feComposite=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feComposite.prototype=new p.Element.ElementBase;p.Element.feColorMatrix=function(y){this.base=p.Element.ElementBase;this.base(y);var x=p.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var z=x[0];x=[0.213+0.787*z,0.715-0.715*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715+0.285*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715-0.715*z,0.072+0.9280000000000001*z,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=x[0]*Math.PI/180;var t=function(s,A,B){return s+Math.cos(r)*A+Math.sin(r)*B};x=[t(0.213,0.787,-0.213),t(0.715,-0.715,-0.715),t(0.072,-0.072,0.9280000000000001),0,0,t(0.213,-0.213,0.143),t(0.715,0.285,0.14),t(0.072,-0.072,-0.283),0,0,t(0.213,-0.213,-0.787),t(0.715,-0.715,0.715),t(0.072,0.9280000000000001,0.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0,1];break}function u(A,D,E,C,s,B){return A[E*C*4+D*4+B]}function v(A,E,F,D,s,B,C){A[F*D*4+E*4+B]=C}function w(s,B){var A=x[s];return A*(A<0?B-255:B)}this.apply=function(B,H,I,G,D){var F=B.getImageData(0,0,G,D);for(var I=0;I<D;I++){for(var H=0;H<G;H++){var E=u(F.data,H,I,G,D,0);var C=u(F.data,H,I,G,D,1);var A=u(F.data,H,I,G,D,2);var s=u(F.data,H,I,G,D,3);v(F.data,H,I,G,D,0,w(0,E)+w(1,C)+w(2,A)+w(3,s)+w(4,1));v(F.data,H,I,G,D,1,w(5,E)+w(6,C)+w(7,A)+w(8,s)+w(9,1));v(F.data,H,I,G,D,2,w(10,E)+w(11,C)+w(12,A)+w(13,s)+w(14,1));v(F.data,H,I,G,D,3,w(15,E)+w(16,C)+w(17,A)+w(18,s)+w(19,1))}}B.clearRect(0,0,G,D);B.putImageData(F,0,0)}};p.Element.feColorMatrix.prototype=new p.Element.ElementBase;p.Element.feGaussianBlur=function(r){this.base=p.Element.ElementBase;this.base(r);this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(s,v,w,u,t){if(typeof n.canvasRGBA=="undefined"){p.log("ERROR: StackBlur.js must be included for blur to work");return}s.canvas.id=p.UniqueId();s.canvas.style.display="none";document.body.appendChild(s.canvas);n.canvasRGBA(s.canvas.id,v,w,u,t,this.blurRadius);document.body.removeChild(s.canvas)}};p.Element.feGaussianBlur.prototype=new p.Element.ElementBase;p.Element.title=function(r){};p.Element.title.prototype=new p.Element.ElementBase;p.Element.desc=function(r){};p.Element.desc.prototype=new p.Element.ElementBase;p.Element.MISSING=function(r){p.log("ERROR: Element '"+r.nodeName+"' not yet implemented.")};p.Element.MISSING.prototype=new p.Element.ElementBase;p.CreateElement=function(t){var r=t.nodeName.replace(/^[^:]+:/,"");r=r.replace(/\-/g,"");var s=null;if(typeof p.Element[r]!="undefined"){s=new p.Element[r](t)}else{s=new p.Element.MISSING(t)}s.type=t.nodeName;return s};p.load=function(r,s){p.loadXml(r,p.ajax(s))};p.loadXml=function(r,s){p.loadXmlDoc(r,p.parseXml(s))};p.loadXmlDoc=function(r,s){p.init(r);var w=function(z){var y=r.canvas;while(y){z.x-=y.offsetLeft;z.y-=y.offsetTop;y=y.offsetParent}if(window.scrollX){z.x+=window.scrollX}if(window.scrollY){z.y+=window.scrollY}return z};if(p.opts.ignoreMouse!=true){r.canvas.onclick=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onclick(z.x,z.y)};r.canvas.onmousemove=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onmousemove(z.x,z.y)}}var u=p.CreateElement(s.documentElement);u.root=true;u.addStylesFromStyleDefinition();var v=true;var t=function(){p.ViewPort.Clear();if(r.canvas.parentNode){p.ViewPort.SetCurrent(r.canvas.parentNode.clientWidth,r.canvas.parentNode.clientHeight)}if(p.opts.ignoreDimensions!=true){if(u.style("width").hasValue()){r.canvas.width=u.style("width").toPixels("x");r.canvas.style.width=r.canvas.width+"px"}if(u.style("height").hasValue()){r.canvas.height=u.style("height").toPixels("y");r.canvas.style.height=r.canvas.height+"px"}}var z=r.canvas.clientWidth||r.canvas.width;var y=r.canvas.clientHeight||r.canvas.height;if(p.opts.ignoreDimensions==true&&u.style("width").hasValue()&&u.style("height").hasValue()){z=u.style("width").toPixels("x");y=u.style("height").toPixels("y")}p.ViewPort.SetCurrent(z,y);if(p.opts.offsetX!=null){u.attribute("x",true).value=p.opts.offsetX}if(p.opts.offsetY!=null){u.attribute("y",true).value=p.opts.offsetY}if(p.opts.scaleWidth!=null||p.opts.scaleHeight!=null){var B=null,C=null,A=p.ToNumberArray(u.attribute("viewBox").value);if(p.opts.scaleWidth!=null){if(u.attribute("width").hasValue()){B=u.attribute("width").toPixels("x")/p.opts.scaleWidth}else{if(!isNaN(A[2])){B=A[2]/p.opts.scaleWidth}}}if(p.opts.scaleHeight!=null){if(u.attribute("height").hasValue()){C=u.attribute("height").toPixels("y")/p.opts.scaleHeight}else{if(!isNaN(A[3])){C=A[3]/p.opts.scaleHeight}}}if(B==null){B=C}if(C==null){C=B}u.attribute("width",true).value=p.opts.scaleWidth;u.attribute("height",true).value=p.opts.scaleHeight;u.style("transform",true,true).value+=" scale("+(1/B)+","+(1/C)+")"}if(p.opts.ignoreClear!=true){r.clearRect(0,0,z,y)}u.render(r);if(v){v=false;if(typeof p.opts.renderCallback=="function"){p.opts.renderCallback(s)}}};var x=true;if(p.ImagesLoaded()){x=false;t()}p.intervalID=setInterval(function(){var z=false;if(x&&p.ImagesLoaded()){x=false;z=true}if(p.opts.ignoreMouse!=true){z=z|p.Mouse.hasEvents()}if(p.opts.ignoreAnimation!=true){for(var y=0;y<p.Animations.length;y++){z=z|p.Animations[y].update(1000/p.FRAMERATE)}}if(typeof p.opts.forceRedraw=="function"){if(p.opts.forceRedraw()==true){z=true}}if(z){t();p.Mouse.runEvents()}},1000/p.FRAMERATE)};p.stop=function(){if(p.intervalID){clearInterval(p.intervalID)}};p.Mouse=new (function(){this.events=[];this.hasEvents=function(){return this.events.length!=0};this.onclick=function(r,s){this.events.push({type:"onclick",x:r,y:s,run:function(t){if(t.onclick){t.onclick()}}})};this.onmousemove=function(r,s){this.events.push({type:"onmousemove",x:r,y:s,run:function(t){if(t.onmousemove){t.onmousemove()}}})};this.eventElements=[];this.checkPath=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInPath&&r.isPointInPath(s.x,s.y)){this.eventElements[u]=t}}};this.checkBoundingBox=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInBox(s.x,s.y)){this.eventElements[u]=t}}};this.runEvents=function(){p.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++){var r=this.events[t];var s=this.eventElements[t];while(s){r.run(s);s=s.parent}}this.events=[];this.eventElements=[]}});return p}if(typeof CanvasRenderingContext2D!="undefined"){CanvasRenderingContext2D.prototype.drawSvg=function(w,r,t,q,p,u){var o={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:r,offsetY:t,scaleWidth:q,scaleHeight:p};for(var v in u){if(u.hasOwnProperty(v)){o[v]=u[v]}}c(this.canvas,w,o)}}return c}));(function(a){function b(e){this.ok=false;if(e.charAt(0)=="#"){e=e.substr(1,6)}e=e.replace(/ /g,"");e=e.toLowerCase();var k={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var g in k){if(e==g){e=k[g]}}var d=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}];for(var f=0;f<d.length;f++){var j=d[f].re;var h=d[f].process;var c=j.exec(e);if(c){channels=h(c);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var m=this.r.toString(16);var l=this.g.toString(16);var i=this.b.toString(16);if(m.length==1){m="0"+m}if(l.length==1){l="0"+l}if(i.length==1){i="0"+i}return"#"+m+l+i};this.getHelpXML=function(){var o=new Array();for(var p=0;p<d.length;p++){var m=d[p].example;for(var q=0;q<m.length;q++){o[o.length]=m[q]}}for(var u in k){o[o.length]=u}var v=document.createElement("ul");v.setAttribute("id","rgbcolor-examples");for(var p=0;p<o.length;p++){try{var s=document.createElement("li");var r=new b(o[p]);var n=document.createElement("div");n.style.cssText="margin: 3px; border: 1px solid black; background:"+r.toHex()+"; color:"+r.toHex();n.appendChild(document.createTextNode("test"));var t=document.createTextNode(" "+o[p]+" -> "+r.toRGB()+" -> "+r.toHex());s.appendChild(n);s.appendChild(t);v.appendChild(s)}catch(l){}}return v}}if(typeof define!=="undefined"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}}a.RGBColor=b}(typeof window!=="undefined"?window:this));(function(b){var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function d(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3]/255;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}function j(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3];if(k!=0){k=255/k;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}}function i(p,m,r,k){var q=document.getElementById(p);var s=q.naturalWidth;var o=q.naturalHeight;var l=document.getElementById(m);l.style.width=s+"px";l.style.height=o+"px";l.width=s;l.height=o;var n=l.getContext("2d");n.clearRect(0,0,s,o);n.drawImage(q,0,0);if(isNaN(r)||r<1){return}if(k){h(m,0,0,s,o,r)}else{g(m,0,0,s,o,r)}}function h(D,Z,aa,ac,A,P){if(isNaN(P)||P<1){return}P|=0;var r=document.getElementById(D);var s=r.getContext("2d");var E;try{try{E=s.getImageData(Z,aa,ac,A)}catch(u){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");E=s.getImageData(Z,aa,ac,A)}catch(u){alert("Cannot access local image");throw new Error("unable to access local image data: "+u);return}}}catch(u){alert("Cannot access image");throw new Error("unable to access image data: "+u)}d(E);var K=E.data;var ae,af,C,G,ah,ag,ai,O,z,q,m,N,w,o,l,M,v,n,k,L,J,I,H,R;var t=P+P+1;var ab=ac<<2;var ad=ac-1;var B=A-1;var Q=P+1;var Y=Q*(Q+1)/2;var X=new a();var T=X;for(C=1;C<t;C++){T=T.next=new a();if(C==Q){var U=T}}T.next=X;var V=null;var W=null;ai=ag=0;var F=c[P];var S=e[P];for(af=0;af<A;af++){M=v=n=k=O=z=q=m=0;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}for(C=1;C<Q;C++){G=ag+((ad<C?ad:C)<<2);O+=(T.r=(L=K[G]))*(R=Q-C);z+=(T.g=(J=K[G+1]))*R;q+=(T.b=(I=K[G+2]))*R;m+=(T.a=(H=K[G+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next}V=X;W=U;for(ae=0;ae<ac;ae++){K[ag]=(O*F)>>S;K[ag+1]=(z*F)>>S;K[ag+2]=(q*F)>>S;K[ag+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ai+((G=ae+P+1)<ad?G:ad))<<2;M+=(V.r=K[G]);v+=(V.g=K[G+1]);n+=(V.b=K[G+2]);k+=(V.a=K[G+3]);O+=M;z+=v;q+=n;m+=k;V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=4}ai+=ac}for(ae=0;ae<ac;ae++){v=n=k=M=z=q=m=O=0;ag=ae<<2;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}ah=ac;for(C=1;C<=P;C++){ag=(ah+ae)<<2;O+=(T.r=(L=K[ag]))*(R=Q-C);z+=(T.g=(J=K[ag+1]))*R;q+=(T.b=(I=K[ag+2]))*R;m+=(T.a=(H=K[ag+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next;if(C<B){ah+=ac}}ag=ae;V=X;W=U;for(af=0;af<A;af++){G=ag<<2;K[G]=(O*F)>>S;K[G+1]=(z*F)>>S;K[G+2]=(q*F)>>S;K[G+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ae+(((G=af+Q)<B?G:B)*ac))<<2;O+=(M+=(V.r=K[G]));z+=(v+=(V.g=K[G+1]));q+=(n+=(V.b=K[G+2]));m+=(k+=(V.a=K[G+3]));V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=ac}}j(E);s.putImageData(E,Z,aa)}function g(A,V,W,Y,v,L){if(isNaN(L)||L<1){return}L|=0;var n=document.getElementById(A);var o=n.getContext("2d");var B;try{try{B=o.getImageData(V,W,Y,v)}catch(r){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");B=o.getImageData(V,W,Y,v)}catch(r){alert("Cannot access local image");throw new Error("unable to access local image data: "+r);return}}}catch(r){alert("Cannot access image");throw new Error("unable to access image data: "+r)}var G=B.data;var aa,ab,z,D,ad,ac,ae,K,u,m,J,t,l,I,s,k,H,F,E,N;var q=L+L+1;var X=Y<<2;var Z=Y-1;var w=v-1;var M=L+1;var U=M*(M+1)/2;var T=new a();var P=T;for(z=1;z<q;z++){P=P.next=new a();if(z==M){var Q=P}}P.next=T;var R=null;var S=null;ae=ac=0;var C=c[L];var O=e[L];for(ab=0;ab<v;ab++){I=s=k=K=u=m=0;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}for(z=1;z<M;z++){D=ac+((Z<z?Z:z)<<2);K+=(P.r=(H=G[D]))*(N=M-z);u+=(P.g=(F=G[D+1]))*N;m+=(P.b=(E=G[D+2]))*N;I+=H;s+=F;k+=E;P=P.next}R=T;S=Q;for(aa=0;aa<Y;aa++){G[ac]=(K*C)>>O;G[ac+1]=(u*C)>>O;G[ac+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(ae+((D=aa+L+1)<Z?D:Z))<<2;I+=(R.r=G[D]);s+=(R.g=G[D+1]);k+=(R.b=G[D+2]);K+=I;u+=s;m+=k;R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=4}ae+=Y}for(aa=0;aa<Y;aa++){s=k=I=u=m=K=0;ac=aa<<2;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}ad=Y;for(z=1;z<=L;z++){ac=(ad+aa)<<2;K+=(P.r=(H=G[ac]))*(N=M-z);u+=(P.g=(F=G[ac+1]))*N;m+=(P.b=(E=G[ac+2]))*N;I+=H;s+=F;k+=E;P=P.next;if(z<w){ad+=Y}}ac=aa;R=T;S=Q;for(ab=0;ab<v;ab++){D=ac<<2;G[D]=(K*C)>>O;G[D+1]=(u*C)>>O;G[D+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(aa+(((D=ab+M)<w?D:w)*Y))<<2;K+=(I+=(R.r=G[D]));u+=(s+=(R.g=G[D+1]));m+=(k+=(R.b=G[D+2]));R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=Y}}o.putImageData(B,V,W)}function a(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}var f={image:i,canvasRGBA:h,canvasRGB:g};if(typeof define!=="undefined"&&define.amd){define(function(){return f})}else{if(typeof module!=="undefined"&&module.exports){module.exports=f}}b.stackBlur=f}(typeof window!=="undefined"?window:this));function UpdateIsLoggedOn(){if(IsUserLoggedOn&&IsUserLoggedOn!==true){return}var a=GetCookieParameterByName("loggedIn");if(a===true){UpdateIsLoggedOnButton()}else{if(a===false){IsUserLoggedOn=0}else{IsUserLoggedOn=a}}}function showLogonDialog(){showLogonDialogBS()}function ForgotPasswordBS(){var b=$("#forgot_password_username");var c=b.val();if(c.length==0){swalQueue("Please enter your username or email, and we will email you a new password.");return}$.post("/account/forgotpassword?username="+c,function(a){swalQueue("Change Password",a.Message)})}function HandleLogonPasswordKeyPress(a){if(a.which==13){HandleLogon()}}function HandleRegisterPasswordKeyPress(a){if(a.which==13){HandleRegister()}}function PerformLogonViaFullPage(){CleanupLogonForm();$("#LogonForm").attr("action","/account/handlelogon");$("#LogonForm").attr("method","post");$("#LogonForm").submit()}function PerformLogonViaPopBS(){CleanupLogonForm();$.post("/account/handlelogon",$("#LogonForm").serialize(),function(a){$("#login-content").html(a)})}function CleanupLogonForm(){$("#LogOnModel_LogonReturnUrl").attr("name","LogonReturnUrl");$("#LogOnModel_LogonIsPopup").attr("name","LogonIsPopup");$("#LogOnModel_LogonPassword").attr("name","LogonPassword");$("#LogOnModel_LogonUserName").attr("name","LogonUserName");$("#LogOnModel_LogonRememberMe").attr("name","LogonRememberMe")}function PerformRegisterViaFullPage(){if(CheckTermsAndCondtions()==false){return}CleanupRegisterForm();$("#RegistrationForm").attr("action","/account/handleregister");$("#RegistrationForm").attr("method","post");$("#RegistrationForm").submit()}function PerformRegisterViaPopBS(){if(CheckTermsAndCondtions()==false){return}CleanupRegisterForm();$.post("/account/handleregister",$("#RegistrationForm").serialize(),function(a){$("#login-content").html(a)})}function HandleRegisterSSO(a){if(a){if(CheckTermsAndCondtionsSSO()==false){return false}}return true}function CheckTermsAndCondtions(){if($("#RegisterModel_AcceptsTerms").prop("checked")==false){$("#accept-terms-warning").css("display","block");$("#accept-terms-warning-div").css("background","rgb(255, 226, 226)");return false}return true}function CheckTermsAndCondtionsSSO(){if($("#accept-terms-social").prop("checked")==false){$("#accept-terms-warning-social").css("display","block");$("#accept-terms-warning-social-div").css("background","rgb(255, 226, 226)");return false}return true}function CleanupRegisterForm(){$("#RegisterModel_RegisterUserName").attr("name","RegisterUserName");$("#RegisterModel_RegisterEmail").attr("name","RegisterEmail");$("#RegisterModel_RegisterPassword").attr("name","RegisterPassword");$("#RegisterModel_RegisterConfirmPassword").attr("name","RegisterConfirmPassword");$("#RegisterModel_RegisterSbtEmails").attr("name","RegisterSbtEmails");$("#RegisterModel_RegisterPartnerEmails").attr("name","RegisterPartnerEmails");$("#RegisterModel_RegisterReturnUrl").attr("name","RegisterReturnUrl");$("#RegisterModel_AcceptsTerms").attr("name","AcceptsTerms")}function UpdateIsUserLoggedOn(a){var b="/account/isloggedon?time="+new Date().getTime();jQuery.ajax({type:"POST",url:b,async:false,cache:false,dataType:"json",error:function(f,d,e){},success:function(c,d){if(c.IsLoggedOn){IsUserLoggedOn=c.IsLoggedOn}else{IsUserLoggedOn=0}}})}function UpdateIsLoggedOnButton(b,c,a){var d="/account/isloggedon?time="+new Date().getTime();jQuery.ajax({type:"POST",url:d,async:false,cache:false,dataType:"json",error:function(f,g,e){if(typeof a!=="undefined"||a===null){a(f,g,e)}},success:function(g,h){if(g.IsLoggedOn){IsUserLoggedOn=g.IsLoggedOn;$("#nav-logoff-button").attr("style","");$("#nav-logon-button").attr("style","display: none");try{$("#logon-pop-modal").modal("hide");if(typeof b!=="undefined"||b===null){b()}}catch(f){}try{HandleLoginCloseFunction()}catch(f){}}else{$("#nav-logoff-button").attr("style","display: none");$("#nav-logon-button").attr("style","");if(typeof c!=="undefined"||c===null){c()}}}})}function showLogonDialogBS(){UpdateIsLoggedOnButton(null,LoadLogonPop)}function LoadLogonPop(){$("#divLogon").children().remove();$("#divLogon").load("/account/logonpopbs")}function signOutBS(){var a="/account/LogoffPartialBSAsync?uid="+(new Date).getTime();$.post(a);if(SpecialSignOut!=null){window.location.href=SpecialSignOut}$("#nav-logon-button").attr("style","");$("#nav-logoff-button").attr("style","display: none")}function SignInAndCloseLoginPop(){UpdateIsLoggedOnButton(null,null)}function SsoPopupWindow(a,c){var b=window.open("","ssoPopup","width=600,height=600,resizeable,scrollbars");a.target="ssoPopup";b.onunload=function(){if(IsUserLoggedOn===true&&typeof c!=="undefined"){c()}}}function ajaxPostForm(a,d,c){var b;if(a.is("form")){b=a.serialize()}return jQuery.ajax({type:a.attr("method"),url:a.attr("action"),data:b,async:true,cache:false,timeout:180*1000,error:function(f,g,e){if(typeof c!=="undefined"){c(f,g,e)}},success:function(e,g,f){if(typeof d!=="undefined"){d(e,g,f)}}})}if(IsUserLoggedOn===true){UpdateIsUserLoggedOn()}else{if(IsUserLoggedOn===false){IsUsedLoggedOn=0}};function trackEventWithGA(c,b,e,f){try{ga("send","event",c,b,e,f)}catch(d){}}function LogOrphans(c){try{var d=new Object();d.url_title=$("#UrlTitle").val();d.UserName=$("#EditUserName").val();d.orphans=c;$.ajax({type:"POST",url:"/api_storyboardcreator/logstoryboardorphans",timeout:180*1000,data:d,success:null,error:null});DebugLine("Found Orphans: "+c)}catch(b){DebugLine("Log Orphans:"+b)}}function ThrowError(){try{var c=null;var d=c.dnd+10}catch(f){LogErrorMessage("SbtLib.ThrowError",f)}}String.prototype.replaceAll2=function(c,d,b){return this.replace(new RegExp(c.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),(b?"gi":"g")),(typeof(d)=="string")?d.replace(/\$/g,"$$$$"):d)};String.prototype.replaceAll=function(g,e,d){var f,c=-1,b;if((f=this.toString())&&typeof g==="string"){b=d===true?g.toLowerCase():undefined;while((c=(b!==undefined?f.toLowerCase().indexOf(b,c>=0?c+e.length:0):f.indexOf(g,c>=0?c+e.length:0)))!==-1){f=f.substring(0,c).concat(e).concat(f.substring(c+g.length))}}return f};String.prototype.CapitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};jQuery.extend(jQuery.fn,{hasParent:function(b){return this.filter(function(){return $(b).find(this).length})}});jQuery.fn.getIdArray=function(){var b=[];$("[id]",this).each(function(){b.push(this.id)});return b};String.prototype.ExtractNumber=function(){return Number(this.replace(/(?!-)[^0-9.]/g,""))};String.prototype.rgbTriplet=function(){var e=this.toString();var b=e.substring(4,e.length-1);var f=b.split(",");var d=[];for(var c=0;c<3;c++){d[c]=parseInt(f[c])}return d};String.prototype.luma=function(){var b=this.toString();var c=b.rgbTriplet();return(0.2126*c[0])+(0.7152*c[1])+(0.0722*c[2])};function SplitParenthesis(b){b=b.replace("(","");b=b.replace(")","");b=b.replace(" ","");return b.split(",")}function SplitParenthesisNumeric(d){d=d.replace("(","");d=d.replace(")","");if(d.indexOf(",")<0&&d.indexOf(" ")>0){d=d.replaceAll(" ",",")}d=d.replaceAll(" ","");var c=d.split(",");for(var b=0;b<c.length;b++){c[b]=Number(c[b])}return c}function RecursivelyFindChildrenIds(e,c){attributes=e[0].attributes;aLength=attributes.length;var f=e.get(0).tagName.toLowerCase();for(a=0;a<aLength;a++){var b=attributes[a].name.toLowerCase();if(b.indexOf("id")==0){c.push(attributes[a].value)}}for(var d=0;d<e.children().length;d++){RecursivelyFindChildrenIds(e.children().eq(d),c)}}function RecursivelyFindGradientChildrenIds(g,e){var d=g[0].attributes;var b=d.length;var h=g.get(0).tagName.toLowerCase();if(h.indexOf("gradient")>=0||h.indexOf("pattern")>=0||h.indexOf("filter")>=0){for(a=0;a<b;a++){var c=d[a].name.toLowerCase();if(c.indexOf("id")==0){e.push(d[a].value)}}}for(var f=0;f<g.children().length;f++){RecursivelyFindGradientChildrenIds(g.children().eq(f),e)}}function RecursivelyUpdateChildrenIds(f,g,d){var b=f[0].attributes;if(b!=null){for(a=0;a<b.length;a++){if(b[a].value.indexOf(g)>=0){var e=b[a].value.replaceAll(g,d);f.attr(b[a].name,e)}}}for(var c=0;c<f.children().length;c++){RecursivelyUpdateChildrenIds(f.children().eq(c),g,d)}}function FindAndUpdateId(d,b,c){if(b==null||b==""){return}var e=$("#"+d);var f=e.find("[id="+b+"]");if(f!=null){f.attr("id",c)}}function FindAndUpdateIdWildCard(d,b,c){var e=$("#"+d);var f=e.find("[id*="+b+"]");if(f!=null){f.attr("id",c)}}function MoveAndScale(){this.MoveToX=0;this.MoveToY=0;this.ScaleX=0;this.ScaleY=0}DetermineResizeDirection=function(b){if(b.indexOf("_ne_")>0){return ResizeEnum.NE}else{if(b.indexOf("_nw_")>0){return ResizeEnum.NW}else{if(b.indexOf("_sw_")>0){return ResizeEnum.SW}else{if(b.indexOf("_n_")>0){return ResizeEnum.N}else{if(b.indexOf("_e_")>0){return ResizeEnum.E}else{if(b.indexOf("_s_")>0){return ResizeEnum.S}else{if(b.indexOf("_w_")>0){return ResizeEnum.W}else{return ResizeEnum.SE}}}}}}}};function DistanceBetweenTwoPoints(e,g,f,h){var b=(f-e);var c=(h-g);var d=(b*b)+(c*c);d=Math.sqrt(d);return d}function checkRectangleInnerPoint(c,b){return b.Left<=c.x&&b.Right>=c.x&&b.Top<=c.y&&b.Bottom>=c.y}function checkPolygonInnerPoint(f,g){var h=f.x,m=f.y;var c=false;for(var b=0,e=g.length-1;b<g.length;e=b++){var k=g[b].x,n=g[b].y;var l=g[e].x,o=g[e].y;var d=((n>m)!=(o>m))&&(h<(l-k)*(m-n)/(o-n)+k);if(d){c=!c}}return c}function checkLineIntersection(b,c,d,e,f,g,h,i){var l,m,n,o;l=d-b;m=e-c;n=h-f;o=i-g;var k,p;k=(-m*(b-f)+l*(c-g))/(-n*m+l*o);p=(n*(c-g)-o*(b-f))/(-n*m+l*o);var j={intersect:false,x:0,y:0};if(k>=0&&k<=1&&p>=0&&p<=1){j.x=b+(p*l);j.y=c+(p*m);j.intersect=true}return j}Number.prototype.Truncate=function(b){if(b==null){b=1}var c=this-Math.pow(10,-b)/2;c+=c/Math.pow(2,53);return c.toFixed(b)};function stringToByteArray(e){var c=[],d,f;for(d=0;d<e.length;d++){f=e.charCodeAt(d);if(f<=127){c.push(String.fromCharCode(f))}else{if(f<=2047){c.push(String.fromCharCode((f>>6)|192));c.push(String.fromCharCode((f&63)|128))}else{if(f<=65535){c.push(String.fromCharCode((f>>12)|224));c.push(String.fromCharCode(((f>>6)&63)|128));c.push(String.fromCharCode((f&63)|128))}else{c.push(String.fromCharCode((f>>18)|240));c.push(String.fromCharCode(((f>>12)&63)|128));c.push(String.fromCharCode(((f>>6)&63)|128));c.push(String.fromCharCode((f&63)|128))}}}}return c}function adler32(f){var h=65521;var c=1,e=0;var g;for(g=0;g>f.length;++g){c=(c+f.charCodeAt(g))%h;e=(e+c)%h}var d=c|(e<<16);return String.fromCharCode(((d>>24)&255),((d>>16)&255),((d>>8)&255),((d>>0)&255))}function hexToR(b){return parseInt((cutHex(b)).substring(0,2),16)}function hexToG(b){return parseInt((cutHex(b)).substring(2,4),16)}function hexToB(b){return parseInt((cutHex(b)).substring(4,6),16)}function cutHex(b){return(b.charAt(0)=="#")?b.substring(1,7):b}function GetRgb(b){R=hexToR(b);G=hexToG(b);B=hexToB(b);DebugLine("rgb("+R+", "+G+", "+B+")")}function LowerCaseCompare(c,d){if(c==null){return false}if(d==null){return false}try{return(c.toLowerCase()==d.toLowerCase())}catch(b){return false}}function GetSafeAttributeNS(d,b){try{var f=d.getAttributeNS("",b);if(f!=null&&f.length>0){return f}b=b.toLowerCase();return d.getAttributeNS("",b)}catch(c){try{var f=d.getAttribute(b);if(f!=null&&f.length>0){return f}b=b.toLowerCase();return d.getAttribute(b)}catch(c){return null}}}function ExtractPositionPoint(e){var b=e.children().first();var c=b.attr("cx");var d=b.attr("cy");var f=new Object();f.X=parseFloat(c);f.Y=parseFloat(d);return f}function ParseRawSVG(f){try{var b=document.createElementNS("http://www.w3.org/1999/xhtml","div");b.innerHTML='<svg xmlns="http://www.w3.org/2000/svg">'+f+"</svg>";var d=document.createDocumentFragment();while(b.firstChild.firstChild){d.appendChild(b.firstChild.firstChild)}return $(d)}catch(c){LogErrorMessage("SbtLib.ParseRawSVG",c)}return null}function GetIESafeChild(d,b){try{if(d.children!=null){return d.children[b]}}catch(c){}return d.childNodes[b]}var FUNCTION_KEYWORD="function",OBJECT_KEYWORD="object",STRING_KEYWORD="string",PERIOD_STRING=".",EMPTY_STRING="",SPACE_STRING=" ",COMMA_STRING=",",UNDERSCORE_STRING="_",APOSTROPHE_STRING="'";String.prototype.endsWith=function(b){return this.indexOf(b,this.length-b.length)!==-1};String.prototype.startsWith=function(b){return this.indexOf(b)===0};String.prototype.trim=function(){return this.replace(/^\s\s*/,EMPTY_STRING).replace(/\s\s*$/,EMPTY_STRING)};String.prototype.trimLeft=function(){return this.replace(/^\s\s*/,EMPTY_STRING)};String.prototype.trimRight=function(){return this.replace(/\s\s*$/,EMPTY_STRING)};String.prototype.cleanSpace=function(){return this.replace(/\s+/g,SPACE_STRING)};String.prototype.encodeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};if(!Object.prototype.hasOwnProperty){Object.prototype.hasOwnProperty=function(b){var c=obj.__proto__||obj.constructor.prototype;return(b in this)&&(!(b in c)||c[b]!==this[b])}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){for(var b=0;b<this.length;b++){if(this[b]===c){return b}}return -1}}(function(b){b.fn.cleanupInput=function(c){var d=b.extend({trim:true,cleanspace:false,nospace:false,anstart:false,cleancode:false,noquotes:false},c);return this.each(function(){var e=b(this);var g=e.val();var f=g;if(d.trim||d.anstart||d.cleancode){f=f.trim()}if(d.nospace){f=f.replace(/\s/g,EMPTY_STRING)}else{if(d.cleanspace){f=f.cleanSpace()}}if(d.noquotes){f=f.replace(/['"]+/g,EMPTY_STRING)}if(d.anstart||d.cleancode){f=f.replace(/^[^0-9a-zA-Z]+/g,EMPTY_STRING)}if(d.cleancode){f=f.replace(/[^-_0-9a-zA-Z]+/g,EMPTY_STRING)}if(f!==g){e.val(f)}})}}(jQuery));(function(b){b.fn.fixedVal=function(){var c=b(this);var e=c.val();var d=c.attr("placeholder");if(e===d){return EMPTY_STRING}return e}}(jQuery));var isLIHit=function(b,c){while(b.nodeName!=="LI"&&b!==c){b=b.parentNode}if(b.nodeName!=="LI"){return null}return b};var SbtLib=function(){var b=new Object();b.IndexOf=function(c,i,d){var g=c?c.length:0;if(typeof d=="number"){d=d<0?nativeMax(g+d,0):d}else{d=0}var e=(d||0)-1,f=i===i;while(++e<g){var h=c[e];if((f?h===i:h!==h)){return e}}return -1};b.DeepCopy=function(c){return JSON.parse(JSON.stringify(c))};b.DeepCompareEquality=function(d,e){if(d===e){return true}if(!(d instanceof Object)||!(e instanceof Object)){return false}if(d.constructor!==e.constructor){return false}for(var c in d){if(!d.hasOwnProperty(c)){continue}if(!e.hasOwnProperty(c)){return false}if(d[c]===e[c]){continue}if(typeof(d[c])!=="object"){return false}if(!SbtLib.DeepCompareEquality(d[c],e[c])){return false}}for(c in e){if(e.hasOwnProperty(c)&&!d.hasOwnProperty(c)){return false}}return true};return b}();function ConvexHullGrahamScan(){this.anchorPoint=undefined;this.reverse=false;this.points=[]}ConvexHullGrahamScan.prototype={constructor:ConvexHullGrahamScan,Point:function(b,c){this.x=b;this.y=c},_findPolarAngle:function(c,e){var h=57.295779513082;var f,g;if(!c||!e){return 0}f=(e.x-c.x);g=(e.y-c.y);if(f==0&&g==0){return 0}var d=Math.atan2(g,f)*h;if(this.reverse){if(d<=0){d+=360}}else{if(d>=0){d+=360}}return d},addPoint:function(c,d){var b=(this.anchorPoint===undefined)||(this.anchorPoint.y>d)||(this.anchorPoint.y===d&&this.anchorPoint.x>c);if(b){if(this.anchorPoint!==undefined){this.points.push(new this.Point(this.anchorPoint.x,this.anchorPoint.y))}this.anchorPoint=new this.Point(c,d)}else{this.points.push(new this.Point(c,d))}},_sortPoints:function(){var b=this;return this.points.sort(function(c,d){var e=b._findPolarAngle(b.anchorPoint,c);var f=b._findPolarAngle(b.anchorPoint,d);if(e<f){return -1}if(e>f){return 1}return 0})},_checkPoints:function(e,f,g){var d;var c=this._findPolarAngle(e,f);var b=this._findPolarAngle(e,g);if(c>b){d=c-b;return !(d>180)}else{if(c<b){d=b-c;return(d>180)}}return true},getHull:function(){var c=[],g,h;this.reverse=this.points.every(function(i){return(i.x<0&&i.y<0)});g=this._sortPoints();h=g.length;if(h<3){g.unshift(this.anchorPoint);return g}c.push(g.shift(),g.shift());while(true){var d,e,f;c.push(g.shift());d=c[c.length-3];e=c[c.length-2];f=c[c.length-1];if(this._checkPoints(d,e,f)){c.splice(c.length-2,1)}if(g.length==0){if(h==c.length){var b=this.anchorPoint;c=c.filter(function(i){return !!i});if(!c.some(function(i){return(i.x==b.x&&i.y==b.y)})){c.unshift(this.anchorPoint)}return c}g=c;h=g.length;c=[];c.push(g.shift(),g.shift())}}}};this.CommonStylingEnum={ShapeSelector_HotSpot_Corner_Stroke:"#AAA393",ShapeSelector_HotSpot_Corner_Fill:"#6285C7",ShapeSelector_HotSpot_Corner_CircleSize:5,ShapeSelector_HotSpot_Side_Stroke:"#6285C7",ShapeSelector_HotSpot_Side_Fill:"#AAA393",ShapeSelector_HotSpot_Side_CircleSize:5,ShapeSelector_RotateBar_Css:"RotateBar",ShapeSelector_ResizeHotSpot_NW_Css:"ResizeNW",ShapeSelector_ResizeHotSpot_NE_Css:"ResizeNE",ShapeSelector_ResizeHotSpot_V_Css:"ResizeV",ShapeSelector_ResizeHotSpot_H_Css:"ResizeH",};this.CropTypeEnum={Standard:0,Advanced:1,Circle:2,};this.InstaPoseEnum={Angry:1,Speaking:2,Explaining:3,Sad:4,Sleeping:5,Complaining:6,Holding:7,Confusion:8,Upset:9,Sit:10,Determined:11,Happy:12,Walking:13,Shouting:14,Scared:15,};PinchResizeEnum={Proportional:1,Vertical:2,Horizontal:3};ResizeEnum={NE:"NE",SE:"SE",NW:"NW",SW:"SW",N:"N",S:"S",E:"E",W:"W",NSEW:"NSEW",};SbtConstants={SelectionAreaStrokeColor:"#526C85",SelectionAreaFillColor:"#D0E8F4",SelectionAreaStrokeDash:"4.4",SelectionAreaOpacity:0.75,};this.SbtDataEnum={Attribute_TiltOption_Title:"Title",Attribute_TiltOption_Degree:"Degree",Attribute_TiltPose_Title:"Title",Attribute_TiltPose_DefaultTilt:"DefaultTilt",Attribute_TiltPose_TiltableId:"TiltableId",Attribute_TiltPose_Tiltable2Id:"Tiltable2Id",Attribute_TiltPose_PivotId:"PivotId",Attribute_TiltPose_ClearId:"ClearId",Attribute_SwapOption_Title:"Title",Attribute_SwapOption_SwapId:"SwapId",Attribute_SwapPose_Title:"Title",Attribute_SwapPose_DefaultId:"DefaultSwapId",Attribute_SwapPose_AppendToId:"AppendToId",Attribute_LibrarySwapOption_Title:"Title",Attribute_LibrarySwapOption_SwapId:"SwapLibraryId",Attribute_LibrarySwapPose_Title:"Title",Attribute_LibrarySwapPose_DefaultId:"DefaultLibrarySwapId",Attribute_LibrarySwapPose_StartPointId:"StartPointId",Attribute_LibrarySwapPose_AppendToId:"AppendToId",Attribute_SmartSceneItemOption_Title:"Title",Attribute_SmartSceneItemOption_TurnOn:"TurnOn",Attribute_SmartSceneItemOption_TurnOff:"TurnOff",Attribute_SmartSceneItemOption_Default:"Default",Attribute_SmartSceneItemOptionColor_Region:"Region",Attribute_SmartSceneItemOptionColor_ReplaceColor:"ReplaceColor",Attribute_Pose_Type:"Type",PoseType_Swap:"Swap",PoseType_Tilt:"Tilt",PoseType_LibrarySwap:"LibrarySwap",Id_SwapOption_Middle:"_poseswap_",Id_Swap_Middle:"_SWAP_",Id_GlobalLibrary_Middle:"_Library_",Id_Storage:"storage",Id_DisplayOption:"DisplayOption",GlobalLibraryId:"gsl",GlobalLibraryFacesFrontId:"gsl_faces_front",GlobalLibraryFacesSideId:"gsl_faces_side",MetaData_Posable:"posable",MetaData_Poses:"pose",MetaData_Position:"position",MetaData_SmartScene:"smartscene",MetaData_SmartSceneItem:"smartsceneitem",MetaData_SmartSceneItemOption:"smartsceneitemoption",MetaData_SmartSceneItemOptionColor:"smartsceneitemoptioncolor",MetaData_Springable_Anchorset:"anchorset",MetaData_Springable_SpringSet:"springset",MetaData_Springable_Attribute_Side:"side",MetaData_Springable_Attribute_Direction:"direction",MetaData_Springable_Attribute_Groups:"groups",AttributeGlobalImageId:"sbt_image_id",};ShapeActionEnum={Nothing:"Nothing",Selected:"Selected",SelectedControlsHidden:"Selected twice",Move:"moving",Resize:"Resizing",Rotating:"Rotating",MultiSelecting:"MultiSelecting"};this.SvgPartsEnum={ShapeId:"sbt_",Natural:"_natural",Defs:"_defs",ClipPath:"_clipPath",ClipRect:"_clipRect",ClipPolygon:"_clipPolygon",ClipEllipse:"_clipEllipse",Scale:"_scale",CropGroup:"_cropGroup",SvgImage:"_svgImage",ImaginaryBox:"_imaginary_box",SelectionBox:"_selection_box",SelectionBoxRectangle:"_selection_box_rect",RotateCircle:"_rotate_circle",RotateCircleBar:"_rotate_circle_bar",RotateCircleGroup:"_rotate_circle_group",Selector_NW:"_nw_circle",Selector_NE:"_ne_circle",Selector_SW:"_sw_circle",Selector_SE:"_se_circle",Selector_W:"_w_circle",Selector_E:"_e_circle",Selector_N:"_n_circle",Selector_S:"_s_circle",Imaginary_NE:"_imaginary_ne",Imaginary_NW:"_imaginary_nw",Imaginary_SE:"_imaginary_se",Imaginary_SW:"_imaginary_sw",};this.StoryboardLayoutType={StoryboardGrid:"StoryboardGrid",TChart:"TChart",Frayer:"Frayer",Spider:"Spider",Timeline:"Timeline",Matrix:"Matrix",Movie:"Movie",ParallelLabelMatrix:"ParallelLabelMatrix",Cycle:"Cycle",PortraitPaper:"PortraitPaper",LandscapePaper:"LandscapePaper",PortraitLegal:"PortraitLegal",LandscapeLegal:"LandscapeLegal",PortraitTabloid:"PortraitTabloid",LandscapeTabloid:"LandscapeTabloid"};this.StoryboardPartTypeEnum={StoryboardCell:1,StoryboardCellTitle:2,StoryboardCellDescription:3,StoryboardAreaTitle:4,StoryboardCellOuterBox:5,StoryboardAttributionArea:6};var AlignHelper=function(){var a=new Object();a.AlignLeft=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=f-e.Left;g.Y=0;return g};b(null,c)};a.AlignRight=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=h-e.Right;g.Y=0;return g};b(null,c)};a.AlignCenter=function(){var c=function(h,j,k,d,g){var e=(h+j)/2;var l=g.Right-g.Left;var f=e-l/2;var i=new Object();i.X=f-g.Left;i.Y=0;return i};b(null,c)};a.HorizontalDistribution=function(){var c=function(k,m,o,d,g,q,p,j,e,n){if(j==0||j==e-1){return new Object({X:0,Y:0})}var h=((m-k)-(q))/(e-1);var f=h+n;var l=new Object();l.X=f-g.Left;l.Y=0;return l};b(Sorters.SortShapesByVisibleX,c)};a.AlignTop=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=0;g.Y=i-e.Top;return g};b(null,c)};a.AlignBottom=function(){var c=function(f,h,i,d,e){var g=new Object();g.X=0;g.Y=d-e.Bottom;return g};b(null,c)};a.AlignMiddle=function(){var c=function(i,k,l,d,g){var e=(l+d)/2;var h=g.Bottom-g.Top;var f=e-h/2;var j=new Object();j.X=0;j.Y=f-g.Top;return j};b(null,c)};a.VerticalDistribution=function(){var c=function(k,m,p,d,g,r,q,j,e,o,n){if(j==0||j==e-1){return new Object({X:0,Y:0})}var h=((d-p)-(q))/(e-1);var f=h+n;var l=new Object();l.X=0;l.Y=f-g.Top;return l};b(Sorters.SortShapesByVisibleY,c)};function b(r,j){try{var o=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(o.length===0){return}o=o.filter(function(e){return e.Movable});if(o.length===0){return}var v=new Array();var k=new Array();if(r!=null){o=o.sort(r)}var p=new Object();var g;var l;var s;var c;var u=0;var t=0;for(var f=0;f<o.length;f++){var q=o[f];p[q.Id]=q.Public_GetImaginaryOuterBox();if(f==0){g=p[q.Id].Left;l=p[q.Id].Right;s=p[q.Id].Top;c=p[q.Id].Bottom}g=Math.min(g,p[q.Id].Left);l=Math.max(l,p[q.Id].Right);s=Math.min(s,p[q.Id].Top);c=Math.max(c,p[q.Id].Bottom);u+=p[q.Id].Right-p[q.Id].Left;t+=p[q.Id].Bottom-p[q.Id].Top}g=Math.max(g,0);s=Math.max(s,0);l=Math.min(StoryboardContainer.CoreSvgRight-StoryboardContainer.CoreSvgLeft,l);c=Math.min(StoryboardContainer.CoreSvgBottom-StoryboardContainer.CoreSvgTop,c);var n=0;var m=0;for(var f=0;f<o.length;f++){var h=j(g,l,s,c,p[o[f].Id],u,t,f,o.length,n,m);n=p[o[f].Id].Right+h.X;m=p[o[f].Id].Bottom+h.Y;v.push({Id:o[f].Id,X:h.X*-1,Y:h.Y*-1});k.push({Id:o[f].Id,X:h.X,Y:h.Y});o[f].MoveDistance(h.X,h.Y)}UndoManager.register(undefined,UndoShapeMoveArray,v,"",undefined,UndoShapeMoveArray,k,"");UpdateActiveDrawing()}catch(d){LogErrorMessage("SvgManip.AlignLeft",d)}}return a}();var CellPickerHelper=function(){var c=new Object();var g=new Object();g.SelectedCell=null;g.ActionType="";g.UndoCount=0;g.ActionMethod=null;g.CopyActionType="copy";g.MoveActionType="move";g.WidthRatio=1;g.CoreSVGRegion={width:0,height:0,margin:"",state:false};g.CalcPoint=document.getElementById("CoreSvg").createSVGPoint();c.Props=g;function j(){$("#StoryboardCreatorWrapper").toggle();$(".Upgrade-Bar").toggleClass("hide-in-fullscreen");$("#bottom-toolbar-controls").toggle();$("#bottom-toolbar-advice").toggle();$("#tab-roller").toggle();$("#bt-copy-cell-undo").css("display","none");StoryboardContainer.JiggleSvgSize();StoryboardContainer.SetCoreSvgDimensions()}function i(){if(!g.CoreSVGRegion.state){g.CoreSVGRegion={width:document.getElementById("CoreSvg").getAttributeNS(null,"width"),height:document.getElementById("CoreSvg").getAttributeNS(null,"height"),margin:$("#CoreSvg").css("margin"),state:true}}}function h(){document.getElementById("CoreSvg").setAttributeNS(null,"width",g.CoreSVGRegion.width);document.getElementById("CoreSvg").setAttributeNS(null,"height",g.CoreSVGRegion.height);$("#CoreSvg").css("margin",g.CoreSVGRegion.margin);g.CoreSVGRegion.state=false}c.getScreenPointFromSVG=function(m,n){g.CalcPoint.x=m;g.CalcPoint.y=n;return g.CalcPoint.matrixTransform(document.getElementById("CoreSvg").getScreenCTM())};c.getSVGPointFromScreen=function(m,n){g.CalcPoint.x=m;g.CalcPoint.y=n;return g.CalcPoint.matrixTransform(document.getElementById("CellDefinition").getScreenCTM().inverse())};function d(){i();var w=$(window).width();var t=$(window).height();var q=w-10;var p=t-70-10;document.getElementById("CoreSvg").setAttribute("viewBox",0+" "+0+" "+g.CoreSVGRegion.width+" "+g.CoreSVGRegion.height);document.getElementById("CoreSvg").setAttributeNS(null,"width",q);document.getElementById("CoreSvg").setAttributeNS(null,"height",p);g.WidthRatio=g.CoreSVGRegion.width/q;$("#CoreSvg").css("margin","5 5 5 5");$("#cell-overlay-helper").remove();MyPointers.SvgContainer.css("position","fixed");MyPointers.SvgContainer.append("<div id='cell-overlay-helper' class='cell-overlay-parent-div'></div>");var m=$("#cell-overlay-helper");var x=parseFloat(MyPointers.SvgContainer.css("height"));var y=parseFloat(MyPointers.SvgContainer.css("width"));m.css("height",x+"px");m.css("width",y+"px");m.css("margin","0");for(var o=0;o<StoryboardContainer.Cols;o++){for(var s=0;s<StoryboardContainer.Rows;s++){var n=CellConfiguration.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,s,o);var u=CellPickerHelper.getScreenPointFromSVG(n.X,n.Y);var v=CellPickerHelper.getScreenPointFromSVG(n.X+n.Width,n.Y+n.Height);var z=v.x-u.x;var r=v.y-u.y;a(m,u.x,u.y,z,r,s,o,StoryboardPartTypeEnum.StoryboardCell);if(CellConfiguration.HasTitle){b(m,u.x,u.y,z,r,s,o,StoryboardPartTypeEnum.StoryboardCellTitle)}if(CellConfiguration.HasDescription){b(m,u.x,u.y,z,r,s,o,StoryboardPartTypeEnum.StoryboardCellDescription)}}}}function a(o,w,x,v,q,t,p,s){var m=$("#"+MyIdGenerator.GenerateCellId(t,p));if(m.length==0){return}var r=MyIdGenerator.GenerateCellOverlayId(t,p,s);o.append("<div id='"+r+"' class='cell-overlay-cell'></div>");var u=parseFloat(m.attr("stroke-width"))/2;u=isNaN(u)?0:u;var n=$("#"+r);n.css("top",x+"px");n.css("left",w+"px");n.css("width",v+"px");n.css("height",q+"px");n.click(e(t,p))}function b(o,t,s,w,q,u){var v=CellConfiguration.GetCellPartPosition(u,w,q);if(!v||v.length==0){return}var r=MyIdGenerator.GenerateCellOverlayId(w,q,u);o.append("<div id='"+r+"' class='cell-overlay-cell'></div>");var n=$("#"+r);var m=s+v.X;var p=t+v.Y;n.css("top",p+"px");n.css("left",m+"px");n.css("height",v.Height+"px");n.css("width",v.Width+"px");n.click(e(w,q))}function e(n,m){return function(){if(g.SelectedCell==null){$("#"+MyIdGenerator.GenerateCellOverlayId(n,m,StoryboardPartTypeEnum.StoryboardCell)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(n,m,StoryboardPartTypeEnum.StoryboardCellDescription)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(n,m,StoryboardPartTypeEnum.StoryboardCellTitle)).addClass("cell-overlay-cell-selected");g.SelectedCell=new Object({Row:n,Col:m});l(2)}else{$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCell)).removeClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellDescription)).removeClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellTitle)).removeClass("cell-overlay-cell-selected");if(g.SelectedCell.Row==n&&g.SelectedCell.Col==m){l(1)}else{g.ActionMethod(g.SelectedCell.Row,g.SelectedCell.Col,n,m);l(3)}g.SelectedCell=null;CellPickerHelper.UpdateIfNeeded()}}}function l(m){$("#bt-copy-part-1").css("display","none");$("#bt-copy-part-2").css("display","none");$("#bt-copy-part-3").css("display","none");$("#bt-move-part-1").css("display","none");$("#bt-move-part-2").css("display","none");$("#bt-move-part-3").css("display","none");$("#bt-"+g.ActionType+"-part-"+m).css("display","");if(m==3){$("#bt-copy-cell-undo").css("display","");g.UndoCount++}}function f(){g.UndoCount=0;g.SelectedCell=null;ClearActiveState();l(1);j();d()}c.UndoHelper=function(){Undo();g.UndoCount--;if(g.UndoCount<1){$("#bt-copy-cell-undo").css("display","none")}};c.UpdateIfNeeded=function(){if(g.ActionType==""){return}if($("#cell-overlay-helper").length==0){return}d();if(g.SelectedCell!=null){$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCell)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellDescription)).addClass("cell-overlay-cell-selected");$("#"+MyIdGenerator.GenerateCellOverlayId(g.SelectedCell.Row,g.SelectedCell.Col,StoryboardPartTypeEnum.StoryboardCellTitle)).addClass("cell-overlay-cell-selected")}};function k(){var m=MyShapesState.Public_GetAllShapeStates();var n;for(n=0;n<m.length;n++){m[n].UpdateDrawing(true)}}c.StartCopyCell=function(){g.ActionType=g.CopyActionType;g.ActionMethod=CopyHelper.CopyCell;f();k()};c.StartMoveCell=function(){g.ActionType=g.MoveActionType;g.ActionMethod=MoveCellHelper.SwapCell;f();k()};c.Finish=function(){MyPointers.SvgContainer.css("position","fixed");h();$("#cell-overlay-helper").remove();document.getElementById("CoreSvg").removeAttribute("viewBox");j();g.WidthRatio=1;k();g.ActionType=null};return c}();var CellSorterHelper=function(){var a=new Object();a.ChangeCellOrder=function(e){for(var c=0;c<e.length;c++){var b=e[c];var f=StoryboardContainer.GetShapeStatesForCell(b.oldCol,b.oldRow);for(var d=0;d<f.length;d++){}}};return a}();var CopyHelper=function(){var a=new Object();a.CopyCellAction=function(K,J,w,v,D){var L=MyIdGenerator.GenerateCellId(K,J);var A=MyIdGenerator.GenerateCellId(w,v);var p={id:A,undoCellCropRatio:StoryboardContainer.GlobalCellCropRatio[A]?JSON.parse(JSON.stringify(StoryboardContainer.GlobalCellCropRatio[A])):{A1:0,A2:1,A3:0,B1:0,B2:1,B3:0},redoCellCropRatio:StoryboardContainer.GlobalCellCropRatio[L]?JSON.parse(JSON.stringify(StoryboardContainer.GlobalCellCropRatio[L])):{A1:0,A2:1,A3:0,B1:0,B2:1,B3:0}};if(StoryboardContainer.GlobalCellCropRatio[L]){StoryboardContainer.GlobalCellCropRatio[A]=JSON.parse(JSON.stringify(StoryboardContainer.GlobalCellCropRatio[L]))}var I=$("#"+L);var u=$("#"+A);var s=parseFloat(u.attr("x"))-parseFloat(I.attr("x"));var t=parseFloat(u.attr("y"))-parseFloat(I.attr("y"));var H=StoryboardContainer.GetShapeStatesForCell(K,J);var M={undoArray:[],redoArray:[]};if(D){var y=StoryboardContainer.GetShapeStatesForCell(w,v);var x=y[StoryboardPartTypeEnum.StoryboardCell];var O=new Array();var G=new Array();for(var B=0;B<x.length;B++){var g=x[B];var C=g.Id;var f=$("#"+C);var E=f.next();var F=E.attr("id");G.push({Detached:f,NextShapeId:F,Id:C,ShapeState:MyShapesState.Public_GetShapeStateById(C)});O.push({Id:C});MyShapesState.Public_RemoveShapeStateById(C);var z=$("#"+C).detach()}M.undoArray=O;M.redoArray=G}var N=new Array();N=H[StoryboardPartTypeEnum.StoryboardCell].concat(H[StoryboardPartTypeEnum.StoryboardCellTitle],H[StoryboardPartTypeEnum.StoryboardCellDescription]);var n=null;var o=null;var m=null;var j=null;var k=null;var h=null;var r=null;var q=null;if(CellConfiguration.HasTitle||CellConfiguration.HasDescription){if(CellConfiguration.HasTitle){n=MyIdGenerator.GenerateTitleCellId(w,v);r=MyShapesState.Public_GetShapeStateById(n);o=r.TextState.Public_GetFontStyles();m=r.ColorableState.Public_GetColorStyles();q=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(K,J));c(r,q)}if(CellConfiguration.HasDescription){j=MyIdGenerator.GenerateDescriptionCellId(w,v);r=MyShapesState.Public_GetShapeStateById(j);k=r.TextState.Public_GetFontStyles();h=r.ColorableState.Public_GetColorStyles();q=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateDescriptionCellId(K,J));c(r,q)}}var l=null;if(n||j){l={cell_title_id:n,cell_title_txt:o,cell_title_color:m,cell_description_id:j,cell_description_txt:k,cell_description_color:h}}b(N,s,t,false,true,l,M,true,p);ClearActiveState()};a.CopyShape=function(f){if(MyShapesState.Property_SelectedCount==0){return}var g=MyShapesState.Public_GetAllSelectedMovableShapeStates(false);b(g,30,30,true,false,null,null,false)};a.CopyCell=function(i,h,g,f){$("#CopyReplaceConfirm").show();$("#CopyReplaceConfirm").modal();$("#CopyReplaceConfirm_ReplaceBtn").off("click");$("#CopyReplaceConfirm_CopyBtn").off("click");$("#CopyReplaceConfirm_ReplaceBtn").click(function(j){a.CopyCellAction(i,h,g,f,true);$("#CopyReplaceConfirm").hide()});$("#CopyReplaceConfirm_CopyBtn").click(function(j){a.CopyCellAction(i,h,g,f,false);$("#CopyReplaceConfirm").hide()})};function b(v,E,G,B,k,g,z,p,h){try{var s=new Array();v.sort(Sorters.SortShapeStatesByIndex);for(var n=0;n<v.length;n++){var f=v[n];var o=f.Id+SvgPartsEnum.Natural;var w=$("#"+o).clone();StoryboardContainer.UpdateGradientIds(w);var D=f.X+E;var F=f.Y+G;if(B){var C=CellPickerHelper.Props.CoreSVGRegion.state?CellPickerHelper.Props.CoreSVGRegion.width:$("#CoreSvg").width();var m=CellPickerHelper.Props.CoreSVGRegion.state?CellPickerHelper.Props.CoreSVGRegion.height:$("#CoreSvg").height();if(D+50>C){D=f.X-E}if(F+50>m){F=f.Y-G}}var r=AddSvg.AddSvgToStoryboard(w,D,F,false,f.isSceneItem);s.push(r);var t=MyShapesState.Public_GetShapeStateByShape(r);t.CopyShapeState(f);t.MoveTo(D,F);if(k){t.IsLocked=f.IsLocked}}var A=new Array();var u=new Array();ClearActiveState();for(var q=0;q<s.length;q++){var r=s[q];var o=r.attr("id");A.push({Id:o});u.push({Id:o,Detached:r,NextShapeId:r.next().attr("id"),ShapeState:MyShapesState.Public_GetShapeStateById(o)});MyShapesState.Public_SelectShape(r)}if(g){A.push({Id:null,content:g})}MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);UndoManager.register(undefined,e,[A,z?z.redoArray:u,p,h?h.id:null,h?h.undoCellCropRatio:null],undefined,"",d,[u,z?z.undoArray:A,p,h?h.id:null,h?h.redoCellCropRatio:null],"");UpdateActiveDrawing()}catch(l){LogErrorMessage("SvgManip.CopyShapeHelper",l)}}function e(){var j=arguments[0];var i=arguments[1];var h=arguments[2];var g=arguments[3];var f=arguments[4];UndoShapeAdd.apply(this,j);if(i&&h){UndoDeleteShape.apply(this,i)}if(g){StoryboardContainer.GlobalCellCropRatio[g]=f}}function c(g,f){if(g==null||f==null){return}if(g.TextState.D[g.TextState.CurrentId].Text!=""&&g.TextState.D[g.TextState.CurrentId].Text!=g.TextState.D[g.TextState.CurrentId].DefaultText){return}if(f.TextState.D[f.TextState.CurrentId].Text==""||f.TextState.D[f.TextState.CurrentId].Text==f.TextState.D[f.TextState.CurrentId].DefaultText){return}g.TextState.CopyFontStyles(f.TextState.Public_GetFontStyles());g.ColorableState.Public_CopyColorStyles(f.ColorableState.Public_GetColorStyles());g.UpdateDrawing()}function d(){var i=arguments[0];var j=arguments[1];var h=arguments[2];var g=arguments[3];var f=arguments[4];UndoDeleteShape.apply(this,i);if(j&&h){UndoShapeAdd.apply(this,j)}if(g){StoryboardContainer.GlobalCellCropRatio[g]=f}}return a}();var CropHelper=function(){var f=new Object();var r=new Object();r.CropType=CropTypeEnum.Standard;r.CroppedImageCopyId="CroppedImageCopy";r.OriginalShapeId="";r.CropLeft=0;r.CropTop=0;r.CropHeight=0;r.CropWidth=0;r.CropRatio=1;r.CropViewScale;r.ClipScale;r.ImageWidth=0;r.ImageHeight=0;r.CropAction="";r.ResizePageX=0;r.ResizePageY=0;r.CropResizeDirection="";r.CircleSizeRatio=1;r.move_delta={x:0,y:0};r.rotate_center={x:0,y:0};r.rotate_alpha=0;r.scale={x:1,y:1};r.CellPosition={};r.CropPolygonPoint=[{x:0,x:0},{x:150,y:0},{x:150,y:100},{x:0,y:100}];r.CropPolygonPointSelectedID="";r.EllipseCX=75;r.EllipseCY=50;r.EllipseRX=75;r.EllipseRY=50;function x(){r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY}function o(z){return function(A){CropHelper.PrepareShapePostModal(z)}}function s(z){StoryboardContainer.UpdateGradientIds(z);z.attr("id",r.CroppedImageCopyId);z.attr("class","");z.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();z.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",r.CroppedImageCopyId+SvgPartsEnum.CropGroup);var A=z.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",r.CroppedImageCopyId+SvgPartsEnum.Scale);z.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",r.CroppedImageCopyId+SvgPartsEnum.Natural)}function j(z){var C=z.UseClipping;z.UseClipping=false;var B=z.Public_GetImaginaryOuterBox();z.UseClipping=C;var A=f.GetMoveVectorForRotatedObject(z);return{W:B.Right-B.Left,H:B.Bottom-B.Top,X:B.Left-A.x,Y:B.Top-A.y}}f.PrepareShapePostModal=function(A){var F=$("#CropAreaSvg");var E=$("#"+A.Id).clone();StoryboardContainer.UpdateGradientIds(E);r.CropAction="";r.OriginalShapeId=A.Id;s(E);F.children().remove();var G=j(A);var O=StoryboardContainer.GetAllLayoutParts(CellConfiguration);r.CellPosition=StoryboardContainer._GetLayoutPartForShape(O,A);var V=r.CellPosition?StoryboardContainer.GetShapeStatesForCell(r.CellPosition.Row,r.CellPosition.Col):null;var C=A.Public_GetImaginaryOuterBox();var D=GetGlobalById(A.Id).getBBox();r.FlipHorizontal=A.FlipHorizontal;r.FlipVertical=A.FlipVertical;r.move_delta={x:A.X,y:A.Y};r.rotate_center={x:D.width/2,y:D.height/2};r.rotate_alpha=A.Angle;r.scale={x:A.ScaleX,y:A.ScaleY};if(V){for(var N=0;N<V[StoryboardPartTypeEnum.StoryboardCell].length;N++){var z=V[StoryboardPartTypeEnum.StoryboardCell][N];if(z.Id!=A.Id){var W=$("#"+z.Id).clone();W.attr("opacity","0.4");F.append(W)}}}F.append(E);var P=GetGlobalById(r.CroppedImageCopyId+SvgPartsEnum.Scale).getBBox();r.ImageWidth=P.width;r.ImageHeight=P.height;r.CropViewScale=1;r.CropLeft=0;r.CropTop=0;r.CropWidth=P.width;r.CropHeight=P.height;r.CropRatio=r.CropHeight/r.CropWidth;r.CropPolygonPoint=[{x:0,y:0},{x:0,y:P.height},{x:P.width,y:P.height},{x:P.width,y:0}];r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY;if(A.UseClipping&&A.CropType==r.CropType){switch(A.CropType){case CropTypeEnum.Circle:case CropTypeEnum.Standard:r.CropLeft=A.ClipX;r.CropTop=A.ClipY;r.CropWidth=A.ClipWidth;r.CropHeight=A.ClipHeight;if(A.CropType==CropTypeEnum.Circle){x()}break;case CropTypeEnum.Advanced:if(A.CropPolygonPoint){for(N=0;N<A.CropPolygonPoint.length;N++){r.CropPolygonPoint[N]={x:A.CropPolygonPoint[N].x,y:A.CropPolygonPoint[N].y}}}break}}var L=G.X-10;var M=G.Y-10;var K=G.W+20;var H=G.H+20;document.getElementById("CropAreaSvg").setAttribute("viewBox",L+" "+M+" "+K+" "+H);var J=Math.round($(window).width()*8/10);var I=Math.round($(window).height()*8/10)-130;var Q=J>I?I:J;var S=Q,R=Q;if(r.CropType==CropTypeEnum.Standard){if(K<H){S=Q*K/H}else{R=Q*H/K}}$("#CropModalDialog").css("width",Math.max(S+50,350));$("#CropModalDialog").css("height",R);$("#CropModalDialog").css("min-width",550);$(".crop-window-wrapper").css("width",S);$(".crop-window-wrapper").css("height",R);var X=20;F.attr("width",S-X);F.attr("height",R-X);var U=F.attr("width")/K;var T=F.attr("height")/H;F.mousemove(k());F.mouseleave(v());F.mouseup(v());F.mousedown(t());F.css("cursor","hand");r.CropViewScale=U<T?U:T;r.CircleSizeRatio=A.ScaleX<A.ScaleY?1/A.ScaleX:1/A.ScaleY;r.CircleSizeRatio/=r.CropViewScale;d()};function d(){var z=$("#croppedImageCopy_ClipArea");if(z!==null||z.length>0){z.detach()}z=SvgCreator.CreateSvgGroup("croppedImageCopy_ClipArea");$("#"+r.CroppedImageCopyId+SvgPartsEnum.Scale).append(z);switch(r.CropType){case CropTypeEnum.Standard:z.appendChild(SvgCreator.AddRect(r.CropLeft,r.CropTop,r.CropWidth,r.CropHeight,"black","red","4,4",".25","CropAreaBox"));break;case CropTypeEnum.Advanced:z.appendChild(SvgCreator.AddPolygon(r.CropPolygonPoint,"black","red","4,4","1",".25","CropAreaBoxAdvanced",null));break;case CropTypeEnum.Circle:z.appendChild(SvgCreator.AddEllipse(r.EllipseCX,r.EllipseCY,r.EllipseRX,r.EllipseRY,"black","red","4,4",".25","CropAreaEllipse"));z.appendChild(SvgCreator.AddRect(r.CropLeft,r.CropTop,r.CropWidth,r.CropHeight,"black","red","4,4",".25","CropAreaBox"));break}if(MyBrowserProperties.IsMobile){c(z)}else{b(z)}}function c(E){var B=$("#CropAreaBox");var K="#AAA393";var D="#6285C7";if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){var B=$("#CropAreaBox");B.css("border-width",5);var G=r.CropLeft;var J=r.CropWidth+r.CropLeft;var L=r.CropTop;var A=r.CropHeight+r.CropTop;E.appendChild(SvgCreator.AddCircle(G,L,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"ResizeNW"));E.appendChild(SvgCreator.AddCircle(J,L,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"ResizeNE"));E.appendChild(SvgCreator.AddCircle(G,A,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"ResizeNE"));E.appendChild(SvgCreator.AddCircle(J,A,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"ResizeNW"));var z=D;D=K;K=z;var H=(G+J)/2;var I=(L+A)/2;E.appendChild(SvgCreator.AddCircle(H,L,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_N,"ResizeV"));E.appendChild(SvgCreator.AddCircle(H,A,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_S,"ResizeV"));E.appendChild(SvgCreator.AddCircle(G,I,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_W,"ResizeH"));E.appendChild(SvgCreator.AddCircle(J,I,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_E,"ResizeH"));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_N,m(ResizeEnum.N));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_S,m(ResizeEnum.S));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_E,m(ResizeEnum.E));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_W,m(ResizeEnum.W));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,m(ResizeEnum.NE));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,m(ResizeEnum.NW));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,m(ResizeEnum.SE));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,m(ResizeEnum.SW));q("CropAreaBox",l())}if(r.CropType==CropTypeEnum.Advanced){var F;var z=D;D=K;K=z;var C=$("#CropAreaBoxAdvanced");C.css("border-width",5);for(F=0;F<r.CropPolygonPoint.length;F++){E.appendChild(SvgCreator.AddCircle(r.CropPolygonPoint[F].x,r.CropPolygonPoint[F].y,circleSize,K,D,r.CroppedImageCopyId+"_advan_circle"+F,"MoveObject"));q(r.CroppedImageCopyId+"_advan_circle"+F,m(ResizeEnum.NSEW,F))}q("CropAreaBoxAdvanced",l())}}function q(z,A){$("#"+z).bind("touchy-drag",A)}function g(B,z){var A="";switch(B){case ResizeEnum.NE:z+=45;z%=360;break;case ResizeEnum.SW:z+=225;z%=360;break;case ResizeEnum.SE:z+=135;z%=360;break;case ResizeEnum.NW:z+=315;z%=360;break;case ResizeEnum.W:z+=270;z%=360;break;case ResizeEnum.N:z%=360;break;case ResizeEnum.S:z+=180;z%=360;break;case ResizeEnum.E:z+=90;z%=360;break}if(Math.abs(z-90)<EPS_ANGLE||Math.abs(z-270)<EPS_ANGLE){return"H"}if(Math.abs(z)<EPS_ANGLE||Math.abs(z-180)<EPS_ANGLE){return"V"}A="NE";if(z>=90&&z<180){A="NW"}else{if(z>=180&&z<270){A="NE"}else{if(z>=270){A="NW"}}}return A}function b(D){var B=5*r.CircleSizeRatio;var J="#AAA393";var C="#6285C7";if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){var F=r.CropLeft;var I=r.CropWidth+r.CropLeft;var K=r.CropTop;var A=r.CropHeight+r.CropTop;D.appendChild(SvgCreator.AddCircle(F,K,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"Resize".concat(g(ResizeEnum.NW,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(I,K,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"Resize".concat(g(ResizeEnum.NE,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(F,A,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"Resize".concat(g(ResizeEnum.SW,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(I,A,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"Resize".concat(g(ResizeEnum.SE,r.rotate_alpha))));var z=C;C=J;J=z;var G=(F+I)/2;var H=(K+A)/2;D.appendChild(SvgCreator.AddCircle(G,K,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_N,"Resize".concat(g(ResizeEnum.N,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(G,A,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_S,"Resize".concat(g(ResizeEnum.S,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(F,H,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_W,"Resize".concat(g(ResizeEnum.W,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(I,H,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_E,"Resize".concat(g(ResizeEnum.E,r.rotate_alpha))));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_N,u(ResizeEnum.N));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_S,u(ResizeEnum.S));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_E,u(ResizeEnum.E));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_W,u(ResizeEnum.W));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,u(ResizeEnum.NE));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,u(ResizeEnum.NW));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,u(ResizeEnum.SE));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,u(ResizeEnum.SW))}if(r.CropType==CropTypeEnum.Advanced){var E;for(E=0;E<r.CropPolygonPoint.length;E++){D.appendChild(SvgCreator.AddCircle(r.CropPolygonPoint[E].x,r.CropPolygonPoint[E].y,B,J,C,r.CroppedImageCopyId+"_advan_circle"+E,"MoveObject"));p(r.CroppedImageCopyId+"_advan_circle"+E,u(ResizeEnum.NSEW,E))}}}function p(z,A){$("#"+z).mousedown(A)}function y(){if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){var A=$("#CropAreaBox");var K=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_NW);var J=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_NE);var O=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_SW);var N=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_SE);var I=$("#"+r.CroppedImageCopyId+"_n_circle ");var M=$("#"+r.CroppedImageCopyId+"_s_circle ");var Q=$("#"+r.CroppedImageCopyId+"_w_circle ");var E=$("#"+r.CroppedImageCopyId+"_e_circle ");var F=r.CropLeft;var L=r.CropWidth+r.CropLeft;var P=r.CropTop;var z=r.CropHeight+r.CropTop;var G=(F+L)/2;var H=(P+z)/2;SvgCreator.UpdateRectangle(A,r.CropLeft,r.CropTop,r.CropWidth,r.CropHeight);SvgCreator.UpdateCircle(K,F,P);SvgCreator.UpdateCircle(J,L,P);SvgCreator.UpdateCircle(O,F,z);SvgCreator.UpdateCircle(N,L,z);SvgCreator.UpdateCircle(I,G,P);SvgCreator.UpdateCircle(M,G,z);SvgCreator.UpdateCircle(Q,F,H);SvgCreator.UpdateCircle(E,L,H);if(r.CropType==CropTypeEnum.Circle){var C=$("#CropAreaEllipse");r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY;SvgCreator.UpdateEllipse(C,r.EllipseCX,r.EllipseCY,r.EllipseRX,r.EllipseRY)}}if(r.CropType==CropTypeEnum.Advanced){var B=$("#CropAreaBoxAdvanced");SvgCreator.UpdatePolygon(B,r.CropPolygonPoint);for(i=0;i<r.CropPolygonPoint.length;i++){var D=$("#"+r.CroppedImageCopyId+"_advan_circle"+i);SvgCreator.UpdateCircle(D,r.CropPolygonPoint[i].x,r.CropPolygonPoint[i].y)}}}function w(A,B){if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){switch(r.CropResizeDirection){case ResizeEnum.W:case ResizeEnum.NW:case ResizeEnum.SW:r.CropLeft+=A;r.CropWidth-=A;break;case ResizeEnum.E:case ResizeEnum.NE:case ResizeEnum.SE:r.CropWidth+=A;break}switch(r.CropResizeDirection){case ResizeEnum.N:case ResizeEnum.NW:case ResizeEnum.NE:r.CropTop+=B;r.CropHeight-=B;break;case ResizeEnum.S:case ResizeEnum.SW:case ResizeEnum.SE:r.CropHeight+=B;break}if(r.CropType==CropTypeEnum.Circle){r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY}}if(r.CropType==CropTypeEnum.Advanced){if(r.CropPolygonPoint.length>=4){var z=(r.CropPolygonPointSelectedID+2)%4;a=r.CropPolygonPointSelectedID;if(Math.abs(r.CropPolygonPoint[a].x-r.CropPolygonPoint[z].x+A)+Math.abs(r.CropPolygonPoint[a].y-r.CropPolygonPoint[z].y+B)<30){return}}r.CropPolygonPoint[r.CropPolygonPointSelectedID].x+=A;r.CropPolygonPoint[r.CropPolygonPointSelectedID].y+=B}y()}function n(z,A){var B;switch(r.CropType){case CropTypeEnum.Standard:case CropTypeEnum.Circle:r.CropTop+=A;r.CropLeft+=z;if(r.CropType==CropTypeEnum.Standard){}if(r.CropType==CropTypeEnum.Circle){r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY}break;case CropTypeEnum.Advanced:var E=9999;var F=9999;var C=0;var D=0;for(B=0;B<r.CropPolygonPoint.length;B++){E=Math.min(E,r.CropPolygonPoint[B].x);F=Math.min(F,r.CropPolygonPoint[B].y);C=Math.max(C,r.CropPolygonPoint[B].x);D=Math.max(D,r.CropPolygonPoint[B].y)}for(B=0;B<r.CropPolygonPoint.length;B++){r.CropPolygonPoint[B].x+=z;r.CropPolygonPoint[B].y+=A}break}y()}function m(A,z){return function(F,G,B,C){if(G!="move"){return}r.CropResizeDirection=A;r.CropPolygonPointSelectedID=z;if(r.CropResizeDirection==null||r.CropResizeDirection==undefined){return}var D=C.movePoint.x-C.lastMovePoint.x;var E=C.movePoint.y-C.lastMovePoint.y;w(D,E)}}function l(z){return function(E,F,A,B){if(F!="move"){return}var C=B.movePoint.x-B.lastMovePoint.x;var D=B.movePoint.y-B.lastMovePoint.y;n(C,D)}}function u(A,z){return function(B){var C={x:B.pageX/r.CropViewScale,y:B.pageY/r.CropViewScale};var D=e(C);r.CropAction="Resize";r.ResizePageX=D.x;r.ResizePageY=D.y;r.CropResizeDirection=A;r.CropPolygonPointSelectedID=z;B.stopPropagation()}}function t(){return function(z){r.CropAction="Move";var A={x:z.pageX/r.CropViewScale,y:z.pageY/r.CropViewScale};var B=e(A);r.ResizePageX=B.x;r.ResizePageY=B.y;z.stopPropagation()}}function k(){return function(z){if(r.CropAction==""){return}var A={x:z.pageX/r.CropViewScale,y:z.pageY/r.CropViewScale};var B=e(A);deltaX=B.x-r.ResizePageX;deltaY=B.y-r.ResizePageY;if(r.FlipHorizontal===true){deltaX*=-1}if(r.FlipVertical===true){deltaY*=-1}r.ResizePageX=B.x;r.ResizePageY=B.y;if(r.CropAction=="Resize"){w(deltaX,deltaY)}else{if(r.CropAction=="Move"){n(deltaX,deltaY)}}}}function v(){return function(){r.CropAction=""}}function h(){var z=MyShapesState.Public_GetFirstSelectedShapeState();if(z===null){z=MyShapesState.Public_GetShapeStateById(r.OriginalShapeId)}return z}f.ChangeCropMode=function(z,A){r.CropType=A;this.PrepareShapePostModal(z)};f.ShowCropDialog=function(z,B){MyPointers.Dialog_CropImage.one("shown.bs.modal",o(z));r.CropType=B;var A=$("#CropAreaSvg");A.children().remove();MyPointers.Dialog_CropImage.modal()};f.RemoveCrop=function(){var z=h();var A=z.X;var B=z.Y;f.UpdateRotatedObjectPosition(z,false);z.UseClipping=false;z.UpdateDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[z.Id,true,z.ClipX,z.ClipY,z.ClipWidth,z.ClipHeight,JSON.parse(JSON.stringify(z.CropPolygonPoint)),z.CropType,A,B],"",undefined,UndoCrop,[z.Id,z.UseClipping,z.ClipX,z.ClipY,z.ClipWidth,z.ClipHeight,JSON.parse(JSON.stringify(z.CropPolygonPoint)),z.CropType,z.X,z.Y],"")};f.CancelCrop=function(){MyPointers.Dialog_CropImage.modal("hide");var z=h();z.UpdateDrawing()};function e(A){var z={x:A.x-r.move_delta.x,y:A.y-r.move_delta.y};z={x:z.x-r.rotate_center.x,y:z.y-r.rotate_center.y};z={x:z.x*Math.cos(-r.rotate_alpha*Math.PI/180)-z.y*Math.sin(-r.rotate_alpha*Math.PI/180),y:z.x*Math.sin(-r.rotate_alpha*Math.PI/180)+z.y*Math.cos(-r.rotate_alpha*Math.PI/180)};z={x:z.x+r.rotate_center.x,y:z.y+r.rotate_center.y};z={x:z.x/r.scale.x,y:z.y/r.scale.y};return z}f.GetMoveVectorForRotatedObject=function(z){var E=z.GetPivotPoint(true);var F=z.GetPivotPoint();var A=z.Angle*Math.PI/180;var B=SbtMath.RotatePoint(E,A,F);var D=SbtMath.RotatePoint(B,-A,E);return{x:D.x-E.x,y:D.y-E.y}};f.UpdateRotatedObjectPosition=function(z,B){var A=f.GetMoveVectorForRotatedObject(z);if(B){z.X+=A.x;z.Y+=A.y}else{z.X-=A.x;z.Y-=A.y}};f.UpdateCrop=function(){if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=true}var z=h();var I=z.UseClipping;var H=z.CropType;var G=JSON.parse(JSON.stringify(z.CropPolygonPoint));var E=z.ClipX;var F=z.ClipY;var D=z.ClipWidth;var C=z.ClipHeight;var J=z.X;var K=z.Y;f.UpdateRotatedObjectPosition(z,false);z.UseClipping=true;z.CropType=r.CropType;var B;var A=z.GetBBox(false);switch(r.CropType){case CropTypeEnum.Standard:z.ClipX=Math.max(0,r.CropLeft);z.ClipY=Math.max(0,r.CropTop);z.ClipWidth=r.CropLeft+r.CropWidth>r.ImageWidth?r.ImageWidth-r.CropLeft:r.CropWidth;z.ClipHeight=r.CropTop+r.CropHeight>r.ImageHeight?r.ImageHeight-r.CropTop:r.CropHeight;break;case CropTypeEnum.Circle:z.ClipX=r.CropLeft;z.ClipY=r.CropTop;z.ClipWidth=r.CropWidth;z.ClipHeight=r.CropHeight;break;case CropTypeEnum.Advanced:z.ClipX=A.width;z.ClipY=A.height;z.ClipWidth=0;z.ClipHeight=0;for(B=0;B<r.CropPolygonPoint.length;B++){z.CropPolygonPoint[B].x=r.CropPolygonPoint[B].x;z.CropPolygonPoint[B].y=r.CropPolygonPoint[B].y}z.Public_update_ClipRegionByAdvancedCrop();break}z.CropPolygonPointJson=JSON.stringify(z.CropPolygonPoint);if(z.ClipWidth<10){z.ClipWidth=10}if(z.ClipHeight<10){z.ClipHeight=10}f.UpdateRotatedObjectPosition(z,true);UpdateActiveDrawing();UpdateActiveDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[z.Id,I,E,F,D,C,G,H,J,K],"",undefined,UndoCrop,[z.Id,z.UseClipping,z.ClipX,z.ClipY,z.ClipWidth,z.ClipHeight,JSON.parse(JSON.stringify(z.CropPolygonPoint)),z.CropType,z.X,z.Y],"")};return f}();$(window).resize(function(){if($("#CropArea").is(":visible")){var b=MyShapesState.Public_GetFirstSelectedShapeState();CropHelper.PrepareShapePostModal(b)}});var GestureHelper=function(){var b=new Object();b.TitleEmphasis=function(){if(CellConfiguration.HasTitle==false){return}var c=parseInt($("#advanced-title-text-size").val());a(MyIdGenerator.GenerateTitleCellId,c)};b.DescriptionEmphasis=function(){if(CellConfiguration.HasDescription==false){return}var c=parseInt($("#advanced-description-text-size").val());a(MyIdGenerator.GenerateDescriptionCellId,c)};function a(e,d){var i=new Array();var f=new Array();for(var c=0;c<StoryboardContainer.Cols;c++){for(var g=0;g<StoryboardContainer.Rows;g++){var h=MyShapesState.Public_GetShapeStateById(e(g,c));if(h==null){continue}i.push({Id:h.Id,FontColor:h.TextState.D[h.TextState.CurrentId].FontColor,FontSize:h.TextState.D[h.TextState.CurrentId].FontSize,BackgroundColor:h.Public_GetColorForRegion("Textables")});f.push({Id:h.Id,FontColor:"#FFFFFF",FontSize:d,BackgroundColor:"#000000"});h.Public_SetColorForRegion("Textables","#000000",false,false);if(UseQuill){h.TextState.Public_QuillSetFontColor("#FFFFFF");h.TextState.Public_QuillSetFontSize(d)}else{if(UseSummerNote){h.TextState.Public_SummerNote_SetFontSizeAndColor(d,"rgb(255,255,255)")}else{h.TextState.D[h.TextState.CurrentId].FontColor="#FFFFFF";h.TextState.D[h.TextState.CurrentId].FontSize=d}}h.UpdateDrawing(true)}}UndoManager.register(undefined,UndoHelper.UndoTitleEmphasis,i,"",undefined,UndoHelper.UndoTitleEmphasis,f,"");CloseModal(MyPointers.Dialog_AdvancedButtons)}b.CapitalizeTitles=function(){if(CellConfiguration.HasTitle==false){return}var l=new Array();var h=new Array();for(var c=0;c<StoryboardContainer.Cols;c++){for(var j=0;j<StoryboardContainer.Rows;j++){var k=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(j,c));if(k==null){continue}if(UseQuill||UseSummerNote){var g=SbtLib.DeepCopy(k.TextState.Public_GetQuillDeltas());if(g==null){continue}for(var d=0;d<g.length;d++){if(g[d]!=null&&g[d].insert!=null){g[d].insert=g[d].insert.toUpperCase()}}l.push({Id:k.Id,QuillDeltas:k.TextState.Public_GetQuillDeltas()});h.push({Id:k.Id,QuillDeltas:g});k.TextState.Public_SetQuillDeltas(g)}else{var f=k.GetText();var e=f.toUpperCase();k.SetText(e);l.push({Id:k.Id,Text:f});h.push({Id:k.Id,Text:e})}k.UpdateDrawing()}}UndoManager.register(undefined,UndoHelper.UndoBulkTextChange,l,"",undefined,UndoHelper.UndoBulkTextChange,h,"");CloseModal(MyPointers.Dialog_AdvancedButtons)};return b}();window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;var localDB;$(function(){localDB={db:null,initialized:null,isSupported:function(){if(this.initialized==null){try{this.init()}catch(a){}}return window.indexedDB&&this.initialized},init:function(){if(this.initialized===null){this.initialized=true;try{if(window.indexedDB){try{this.getDatabase()}catch(a){this.clearDatabase();this.getDatabase()}return}initialized=false}catch(a){initialized=false;LogErrorMessage("Failed to init local db",a)}}},getDatabase:function(b){b=b||function(){};try{if(this.isSupported()){var f=this;var d="StoryboardDB";var g=1;var c=window.indexedDB.open(d,g);c.onerror=function(e){b(null)};c.onsuccess=function(e){f.db=c.result;b(f.db)};c.onupgradeneeded=function(h){var e=h.target.result;if(h.oldVersion<1){e.createObjectStore("Storyboard",{keyPath:"userId"})}};c.onerror=function(e){b(null)};c.onblocked=function(e){b(null)}}else{b(null)}}catch(a){LogErrorMessage("LocalDbHelper.getDatabase",a);b(null)}},clearDatabase:function(b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(c){var d=c.deleteObjectStore("Storyboard");d.onsuccess=function(e){b(true)};d.onfailure=function(e){b(false)};d.onerror=function(e){b(false)}})}else{b(false)}}catch(a){LogErrorMessage("LocalDbHelper.clearDatabase",a);b(false)}},Save:function(f,d,a,c){c=c||function(){};try{if(this.isSupported()){this.getDatabase(function(e){var g=e.transaction(["Storyboard"],"readwrite").objectStore("Storyboard").put({userId:f,storyboard_name:d,content:a,});g.onsuccess=function(h){c(true)};g.onfailure=function(h){c(false)};g.onerror=function(h){c(false)}})}else{c(false)}}catch(b){LogErrorMessage("LocalDbHelper.Save",b);c(false)}},CheckUser:function(c,b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(d){var e=d.transaction(["Storyboard"]).objectStore("Storyboard").get(c);e.onsuccess=function(f){if(f.target.result===void 0){b(false,null)}else{b(true,f.target.result.storyboard_name)}};e.onfailure=function(f){b(false,null)};e.onerror=function(f){b(false,null)}})}else{b(false,null)}}catch(a){LogErrorMessage("LocalDbHelper.CheckUser",a);b(false,null)}},Load:function(c,b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(d){var e=d.transaction(["Storyboard"]).objectStore("Storyboard").get(c);e.onsuccess=function(f){(f.target.result===void 0)?b(null):b(f.target.result.content)};e.onfailure=function(f){b(null)};e.onerror=function(f){b(null)}})}else{b(null)}}catch(a){LogErrorMessage("LocalDbHelper.Load",a);b(null)}},Delete:function(c,b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(d){var e=d.transaction(["Storyboard"],"readwrite").objectStore("Storyboard")["delete"](c);e.onsuccess=function(f){b(true)};e.onfailure=function(f){b(false)};e.onerror=function(f){b(false)}})}else{b(false)}}catch(a){LogErrorMessage("LocalDbHelper.Delete",a);b(false)}}};localDB.init()});self.addEventListener("message",function(b){var a=b.data;switch(a.cmd){case"Save":localDB.Save(a.userId,a.storyboard_name,a.content);self.postMessage({cmd:"Save"});break;case"Load":localDB.Load(function(e,d,c){self.postMessage({cmd:"Load",userId:e,storyboard_name:d,content:c})});break;default:}},false);var MarkerFilter=function(){var c=new Object();function b(h){if(h===""){return}if(h.toLowerCase()==="transparent"){return[0,0,0,0]}if(h[0]==="#"){if(h.length<7){h="#"+h[1]+h[1]+h[2]+h[2]+h[3]+h[3]+(h.length>4?h[4]+h[4]:"")}return[parseInt(h.substr(1,2),16),parseInt(h.substr(3,2),16),parseInt(h.substr(5,2),16),h.length>7?parseInt(h.substr(7,2),16)/255:1]}if(h.indexOf("rgb")===-1){var j=document.body.appendChild(document.createElement("fictum"));var i="rgb(1, 2, 3)";j.style.color=i;if(j.style.color!==i){return}j.style.color=h;if(j.style.color===i||j.style.color===""){return}h=getComputedStyle(j).color;document.body.removeChild(j)}if(h.indexOf("rgb")===0){if(h.indexOf("rgba")===-1){h+=",1"}return h.match(/[\.\d]+/g).map(function(k){return +k})}}var e=0.2126;var f=0.7152;var g=0.0722;function a(h){var i=b(h);if(i!=undefined){return Math.round((i[0]*e+i[1]*f+i[2]*g))}else{return 0}}function d(t,w,r){var u=t.Id;var o=a("#000000");var p=a("#ffffff");try{var h=t.Public_GetColorRegions();for(var l=0;l<h.length;l++){var q=a(t.Public_GetColorForRegion(h[l]));q=Math.round(Math.sqrt(q/255)*255);q="rgb("+q+", "+q+", "+q+")";t.Public_SetColorForRegion(h[l],q,false,false)}}catch(k){LogErrorMessage("ToMarkerFilter",k)}var s=["path","polygon","rect","ellipse"];for(var n=0;n<s.length;n++){var m=$("#"+u)[0].getElementsByTagName(s[n]);for(var l=0;l<m.length;l++){m[l].setAttributeNS(null,"stroke-width",w);m[l].setAttributeNS(null,"stroke","rgb(12,12,12)");if(m[l].getAttributeNS(null,"fill")==null){continue}if(r){if(m[l].getAttributeNS(null,"opacity")!=null){m[l].setAttributeNS(null,"fill","none");m[l].setAttributeNS(null,"stroke-width",0);continue}if(m[l].getAttributeNS(null,"fill")=="none"){m[l].setAttributeNS(null,"stroke-width",0);continue}}var x=a(m[l].getAttributeNS(null,"fill"));y=Math.round(Math.sqrt(x/255)*255);m[l].setAttributeNS(null,"fill","rgb("+y+","+y+","+y+")")}}}c.TestMarker=function(){var m=3.5;var j=true;var k=MyShapesState.Public_GetAllSelectedShapeStates();for(var h=0;h<k.length;h++){var l=k[h];d(l,m,j)}};return c}();var MoveCellHelper=function(){var c=new Object();c.MoveCell=function(l,k,j,i){var m=[];var o=[];for(var n=0;n<StoryboardContainer.Rows;n++){for(var h=0;h<StoryboardContainer.Cols;h++){var e=a(n,h,l,k,j,i);var f=e%StoryboardContainer.Cols;var g=Math.floor(e/StoryboardContainer.Cols);o.push({oldCol:f,oldRow:g,newCol:h,newRow:n});m.push({oldCol:h,oldRow:n,newCol:f,newRow:g})}}UndoManager.register(undefined,MoveCellHelper.UndoRearrangeCells,[o],"",undefined,MoveCellHelper.UndoRearrangeCells,[m],"");MoveCellHelper.RearrangeCells(m)};c.SwapCell=function(h,g,f,e){var i=[];var j=[];j.push({oldCol:g,oldRow:h,newCol:e,newRow:f});j.push({oldCol:e,oldRow:f,newCol:g,newRow:h});i.push({oldCol:e,oldRow:f,newCol:g,newRow:h});i.push({oldCol:g,oldRow:h,newCol:e,newRow:f});UndoManager.register(undefined,MoveCellHelper.UndoRearrangeCells,[j],"",undefined,MoveCellHelper.UndoRearrangeCells,[i],"");MoveCellHelper.RearrangeCells(i)};c.RearrangeCells=function(j){var h=0;StoryboardContainer.Public_ChangeCellOrder(j);if(CellConfiguration.HasTitle||CellConfiguration.HasDescription){var k=null;var f=null;if(CellConfiguration.HasTitle){k=b(MyIdGenerator.GenerateTitleCellId)}if(CellConfiguration.HasDescription){f=b(MyIdGenerator.GenerateDescriptionCellId)}for(h=0;h<j.length;h++){var e=j[h];if(e.newCol!=e.oldCol||e.newRow!=e.oldRow){if(CellConfiguration.HasTitle){var l=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(e.newRow,e.newCol));d(l,k[e.oldCol][e.oldRow])}if(CellConfiguration.HasDescription){var g=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateDescriptionCellId(e.newRow,e.newCol));d(g,f[e.oldCol][e.oldRow])}}}}};c.UndoRearrangeCells=function(f){try{MoveCellHelper.RearrangeCells(f);UpdateActiveDrawing()}catch(g){LogErrorMessage("SvgManip.UndoRearrangeCells",g)}};function a(l,f,k,j,i,h){var e=(l*StoryboardContainer.Cols)+f;var m=(k*StoryboardContainer.Cols)+j;var g=(i*StoryboardContainer.Cols)+h;if(m==e){return g}if(m<g){if(e<m){return e}if(e>g){return e}return e-1}if(e<g){return e}if(e>m){return e}return e+1}function b(l){var h=new Array();try{for(var f=0;f<StoryboardContainer.Cols;f++){h[f]=new Array();for(var j=0;j<StoryboardContainer.Rows;j++){var i=l(j,f);var k=new Object();k.TextStyles=MyShapesState.Public_GetShapeStateById(i).TextState.Public_GetFontStyles();k.ColorStyles=MyShapesState.Public_GetShapeStateById(i).ColorableState.Public_GetColorStyles();h[f][j]=k}}}catch(g){}return h}function d(f,e){if(f==null||e==null){return}f.TextState.CopyFontStyles(e.TextStyles.Public_GetFontStyles());f.ColorableState.Public_CopyColorStyles(e.ColorStyles.Public_GetColorStyles());f.UpdateDrawing()}return c}();var MultiTextableHelper=function(){var b=new Object();var e=new Object();e.MultiTextImageCopyId="MultiTextableImageCopy";e.OriginalShape;b.Props=e;var a=null;function c(f){e.OriginalShape=f;var p=$("#multiTextableSvg");var g=$("#"+f.Id).clone();StoryboardContainer.UpdateGradientIds(g);g.attr("id",e.MultiTextImageCopyId);g.attr("class","");g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();g.find("[id^='"+e.OriginalShape.Id+"_text']").remove();g.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.CropGroup);var q=g.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Scale);g.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Natural);p.children().remove();p.append(g);var h=GetGlobalById(e.MultiTextImageCopyId).getBBox();p.attr("width",h.width+24);p.attr("height",h.height+24);if(!a){a=new SvgState(e.MultiTextImageCopyId)}var m=f.TextState.D[f.TextState.CurrentId]._QuillDeltas;a.Id=e.MultiTextImageCopyId;a.NaturalOffsetX=f.NaturalOffsetX;a.NaturalOffsetY=f.NaturalOffsetY;a.X=12;a.Y=12;a.CopyShapeState(f);if(m==null){a.TextState.D[a.TextState.CurrentId]._QuillDeltas=null}a.virtualSelected=true;MyShapesState.Public_SetShapeState(a.Id,a);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SelectShape($("#"+e.MultiTextImageCopyId));HideControlsMenu();var o="",l;for(l=0;l<a.TextState.D.length;l++){var n=l+1;o+="<li>                    <a id='multitextable_textarea"+l+"' class='multitextable_textareacls' selid='"+l+"'>                        <span class='sprite-sbt sprite-sbt-Bring-Forward'>                        </span>                        <img height='16' width='16' src='/content/menu/blank.gif'>                        Text Area "+n+"                    </a>        </li>"}GetGlobalById("MultiTextable-menu-select-id").innerHTML=o;$(".multitextable_textareacls").click(function(){var u=this.getAttribute("selid")*1+1;var s;$("#MultiTextable-header-title").html("Text Area "+u);for(s=0;s<a.TextState.D.length;s++){var t=e.MultiTextImageCopyId+"_TextBoxArea"+s;if(u-1==s){$("#"+t).attr("style","stroke-dasharray:1,1; stroke: black; stroke-width: 0.5; ")}else{$("#"+t).attr("style","")}}a.TextState.CurrentId=this.getAttribute("selid");MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,150,140,a)});var k=(parseInt(a.TextState.CurrentId)+1);$("#MultiTextable-header-title").html("Text Area "+k);$("#textableControls").removeClass("ControlsBox");var r=$("#textableControls").detach();$("#MultiTextable-content").append(r);for(l=0;l<a.TextState.D.length;l++){g.find("#"+e.OriginalShape.Id+"_TextBoxArea"+l).attr("id",e.MultiTextImageCopyId+"_TextBoxArea"+l)}$("#"+e.MultiTextImageCopyId+"_TextBoxArea"+a.TextState.CurrentId).attr("style","stroke-dasharray:1,1; stroke: black; stroke-width: 0.5; ");a.UpdateDrawing(true);g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").hide();MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,150,140,a);$("#MultiTextableModal").on("hidden.bs.modal",function(){MyShapesState.Public_RemoveShapeStateById(e.MultiTextImageCopyId)})}function d(f){return function(g){c(f)}}b.ShowMultipleDialog=function(f){MyPointers.Dialog_MultiTextable.one("shown.bs.modal",d(f));var g=$("#multiTextableSvg");g.children().remove();MyPointers.Dialog_MultiTextable.modal()};b.Cancel=function(){MyPointers.Dialog_MultiTextable.modal("hide")};b.Update=function(){e.OriginalShape.CopyTextState(a.TextState);e.OriginalShape.UpdateDrawing(true);MyPointers.Dialog_MultiTextable.modal("hide")};return b}();var OpacitySliderOldValue=null;var OpacityHelper=function(){var d=new Object();d.initControls=function(){var e=$("#opacity-slider").slider({value:1,formater:function(f){return parseInt(f)+"%"}});$("#opacity-slider").on("slide",a);$("#opacity-slider").on("slideStart",b);$("#opacity-slider").on("slideStop",c);$("#opacity-slider").data("previousValue",1)};function b(){OpacitySliderOldValue=$("#opacity-slider").data("previousValue");a()}function a(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=$("#opacity-slider").slider("getValue");OpacityHelper.setOpacity(e,f);return f}function c(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=a();UndoManager.register(undefined,OpacityHelper.setOpacity,[e,OpacitySliderOldValue],undefined,"",OpacityHelper.setOpacity,[e,f])}d.setOpacity=function(e,f){e.opacity=f/100;UpdateActiveDrawing()};d.setSliderValue=function(e){if($("#opacity-slider").length>0){$("#opacity-slider").slider("setValue",e);$("#opacity-slider").data("previousValue",e)}};return d}();var SaveDataHelper=function(c){var d=new Object();d.NewStoryboard=1;d.EditStoryboard=2;d.AutoSave=3;d.GetSaveData=function(f,e){var g=new Object();g.MagicToken=MyUserPermissions.MagicToken;g.RequestStart=(new Date()).toUTCString();g.SaveTry=1;g.Svg=b(f);g.SvgLength=g.Svg.length;g.ShapeStates=MyShapesState.Public_ShapeStateToJson();g.ShapeStatesLength=g.ShapeStates.length;g.CharacterSwapLibrary=MyCharacterSwapLibrary.Public_GetJSON(MyShapesState);g.CharacterSwapLibraryLength=g.CharacterSwapLibrary.length;g.LayoutConfig=JSON.stringify(CellConfiguration.GetLayoutConfig());g.LayoutConfigLength=g.LayoutConfig.length;if(StoryboardContainer.GlobalCellCropRatio!==void 0){g.GlobalCellCropRatio=JSON.stringify(StoryboardContainer.GlobalCellCropRatio)}g.UseCompression=0;g.SaveDuration=+new Date();if(f==SaveDataHelper.NewStoryboard){g.Title=$("#StoryboardTitle").val();g.Description=$("#StoryboardDescription").val();g.PortalFolderId=$("#portal_folder_id").val()}else{if(f==SaveDataHelper.EditStoryboard||f==SaveDataHelper.AutoSave){g.UrlTitle=$("#UrlTitle").val();g.UserName=$("#EditUserName").val()}}if(!e){g.UsePmc=1;g.Svg=pmc(prePmc(g.Svg));g.SvgLength=g.Svg.length;g.ShapeStates=pmc(prePmc(g.ShapeStates));g.ShapeStatesLength=g.ShapeStates.length;g.CharacterSwapLibrary=pmc(g.CharacterSwapLibrary);g.CharacterSwapLibraryLength=g.CharacterSwapLibrary.length}return g};function b(g){try{if(g==SaveDataHelper.AutoSave){var k=$("#CoreSvg").clone();k.attr("style","");k.find("[id$=selection_box]").remove();k.find("[id=SvgTop]").children().remove();return(new XMLSerializer()).serializeToString(k.get()[0])}var j=GetGlobalById("CoreSvg");var h=j.getAttribute("style");j.setAttribute("style","");var i=(new XMLSerializer()).serializeToString(j);j.setAttribute("style",h);return i}catch(f){LogErrorMessage("SaveDataHelper.GetRawSvg",f)}}function a(e){}return d}();var SaveHelper=function(){var k=new Object();var g=new Object();g.NewStoryboardUrl=CreatorUrls.GeoServer+"/geosavestoryboard/savenewstoryboard";g.EditStoryboardUrl=CreatorUrls.GeoServer+"/geosavestoryboard/saveeditstoryboard";g.AutoStoryboardUrl=CreatorUrls.GeoServer+"/geosavestoryboard/autosavestoryboard";k.ChangesDetected=void 0;k.ChangeObserver=new MutationObserver(function(m){k.MarkAsChanged(true)});k.SaveStoryboard=function(p,o,n){$("#SaveChoicesDialog").modal("hide");saveAndContinue=p;try{var q=MyShapesState.Property_GetShapeStatesCount();if(q<1){swalQueue(MyLangMap.GetText("warning-add-more"));return}$.blockUI();MyUserPermissions.Public_RefreshPermissions(true,l(saveAndContinue,o,n))}catch(m){LogErrorMessage("SaveHelper.SaveStoryboard",m)}};k.SaveStoryboard_PostLogon=function(){try{warnOnExit=false;HideControlsMenu();ClearActiveState();$.blockUI();var n=SaveDataHelper.GetSaveData(SaveDataHelper.NewStoryboard);if(MyBrowserProperties.EnableCompression()){c(n,g.NewStoryboardUrl)}else{f(n,g.NewStoryboardUrl)}}catch(m){LogErrorMessage("SaveHelper.SaveStoryboard_PostLogon",m)}};k.AutoSave=function(){if(StoryboardSetup.EnableAutoSave==false){return}MyUserPermissions.Public_RefreshPermissions(true,a())};k.LocalSave=function(){if(SaveHelper.ChangesDetected){var m=SaveDataHelper.GetSaveData(SaveDataHelper.AutoSave,true);localDB.Save(IsUserLoggedOn,m.UrlTitle,JSON.stringify(m));k.MarkAsChanged(false);return true}return false};k.MarkAsChanged=function(m){if(SaveHelper.ChangesDetected!==m){if(m){SaveHelper.ChangesDetected=true;SaveHelper.ChangeObserver.disconnect()}else{SaveHelper.ChangesDetected=false;SaveHelper.ChangeObserver.observe(document.getElementById("CoreSvg"),{attributes:true,childList:true,characterData:true,subtree:true})}}};function c(o,n){var m=new LZMA("/scripts/lzma_worker.js");m.compress(o.Svg,MyBrowserProperties.CompressionRatio,function(q){o.Svg=Iuppiter.Base64.encode(q);o.SvgLength=o.Svg.length;var p=new LZMA("/scripts/lzma_worker.js");p.compress(o.CharacterSwapLibrary,MyBrowserProperties.CompressionRatio,function(r){o.CharacterSwapLibrary=Iuppiter.Base64.encode(r);o.CharacterSwapLibraryLength=o.CharacterSwapLibrary.length;o.UseCompression=1;f(o,n)})})}function i(){try{if(MyUserPermissions.AllowEditSave==false){$("#SaveDialogSorryContent").children().remove();$("#SaveDialogSorryContent").html("");$("#SaveDialogSorryContent").append(MyUserPermissions.SaveMessage);$("#SaveDialogSorry").modal();return}warnOnExit=false;HideControlsMenu();ClearActiveState();$.blockUI();var n=SaveDataHelper.GetSaveData(SaveDataHelper.EditStoryboard);if(MyBrowserProperties.EnableCompression()){c(n,g.EditStoryboardUrl)}else{f(n,g.EditStoryboardUrl)}}catch(m){LogErrorMessage("SaveHelper.SaveAsEdit",m)}}function j(){try{if(MyUserPermissions.AllowNewSave==false){if(MyUserPermissions.ModalPop!=null&&MyUserPermissions.ModalPop!=""){$("#"+MyUserPermissions.ModalPop).modal("show");return}$("#SaveDialogSorryContent").children().remove();$("#SaveDialogSorryContent").html("");$("#SaveDialogSorryContent").append(MyUserPermissions.SaveMessage);$("#SaveDialogSorry").modal();return}var r=$("#save-dialog-message");r.children().remove();r.append(MyUserPermissions.SaveMessage);var n=$("#save-dialog-folders");n.children().remove();n.text("");if(MyUserPermissions.PortalFolders==null){n.append('<input type=hidden id="portal_folder_id" value="0">')}else{var o=false;var p="";p+=MyUserPermissions.FolderTitle+":<br />";p+='<select id="portal_folder_id" style="margin-bottom:15px; width:95%">';p+='<option value="0">--- '+MyUserPermissions.NoFolderTitle+"  ---</option>";for(var q=0;q<MyUserPermissions.PortalFolders.length;q++){var s="";if(MyUserPermissions.SelectedPortalFolder!=null&&MyUserPermissions.SelectedPortalFolder.FolderId==MyUserPermissions.PortalFolders[q].FolderId){s="selected";o=true}p+="<option "+s+' value="'+MyUserPermissions.PortalFolders[q].FolderId+'">'+MyUserPermissions.PortalFolders[q].FolderName+"</option>"}p+="</select>";p+="</br>";p+="</br>";n.append(p);if(o){document.getElementById("portal_folder_id").disabled=true}}$("#SaveDialog").modal()}catch(m){LogErrorMessage("SvgManip.SaveAsNew_PrepareDialog",m)}}function b(){try{if(StoryboardContainer.IsFreeLayoutConfiguration(StoryboardContainer.Rows,StoryboardContainer.Cols)){return true}if(MyUserPermissions.EnableAllCellOptions==false){MyPointers.Dialog_PurchasePopForMoreLayouts.modal();return false}return true}catch(m){LogErrorMessage("SvgManip.CheckCellLimitOnSave",m)}}function f(o,p){try{var n=+new Date();o.SaveDuration=n-o.SaveDuration;$.ajax({type:"POST",url:p,timeout:300*1000,data:o,success:e(o,p),error:d(o,p)});if(window.MenuTelemetryId!=null&&window.MenuTelemetryId!=""){var p="/storyboardcreator/addmenutelemetry";$.ajax({type:"POST",url:p,data:{Guid:MenuTelemetryId,Key:"Saved",Value:Date.now()-MenuTelemetryStart},timeout:300*1000,success:function(q){if(q.success!==true){LogErrorMessage("SaveHelper - PostStoryboard Ajax call error: "+q.Error);return}},error:function(r,s,q){LogErrorMessage("SaveHelper - PostStoryboard Ajax call failed: "+s,q)}})}k.MarkAsChanged(false);localDB.Delete(IsUserLoggedOn)}catch(m){LogErrorMessage("SaveHelper.PostSaveNewStoryboard",m)}}$("#test-save-btn").click(function(){if(k.LocalSave()){swalQueue("Local Save Complete")}else{swalQueue("No changes detected")}});function a(){return function(){if(MyUserPermissions.IsLoggedOn==false){return}if(MyUserPermissions.AllowEditSave==false){return}var o=SaveDataHelper.GetSaveData(SaveDataHelper.AutoSave);try{var n=+new Date();o.SaveDuration=n-o.SaveDuration;$.ajax({type:"POST",url:g.AutoStoryboardUrl,timeout:300*1000,data:o,success:function(q){if(q.Error!=null&&q.Error){return}var p=$("#show-auto-saved");p.toggle();setTimeout(function(){p.toggle()},5000)},error:function(p){try{var q=new Object();q.message=p.statusText;q.stack=p.responseText;LogErrorMessage("SaveHelper.HandleSaveFailureClosure error:",q)}catch(r){LogErrorMessage("SaveHelper.HandleSaveFailureClosure error logger",r)}}})}catch(m){LogErrorMessage("SaveHelper.AutoSavePostRefreshClosure",m)}}}function l(o,n,m){return function(){try{$.unblockUI();if(MyUserPermissions.IsLoggedOn==false){if(n){HandleLoginCloseFunction=function(){SaveHelper.SaveStoryboard(o,false,m)};showLogonDialog();return}swalQueue("You must be logged in to save your storyboard.  Please login and try again.");return}if(b()==false){return}ClearActiveState();if(HasGridLines()){ToggleGridLines()}StoryboardContainer.RemoveFilters();MyShapesState.Public_ClearDefaults();if(m){i()}else{j()}}catch(p){LogErrorMessage("SaveHelper.SaveImagePostRefreshClosure",p)}}}function e(m,n){return function(o){try{if(o.Error!=null){if(h(m,n)){return}if(o.Error=="Timeout"){MyUserPermissions.UseCompression=true;swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("Error-Save-Time-Out"),type:"Error",confirmButtonText:MyLangMap.GetText("warning-ok-button")})}else{if(o.Error=="NoXml"){MyUserPermissions.UseCompression=true;swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("Error-Save-No-Xml"),type:"Error",confirmButtonText:MyLangMap.GetText("warning-ok-button")})}else{if(o.ErrorId!=null){try{swalQueue({title:"There was a problem saving your storyboard",text:MyLangMap.GetTextLineBreaks(o.ErrorId),type:"Error",confirmButtonText:MyLangMap.GetText("warning-ok-button")});LogErrorMessage("SaveHelper.HandleSaveSuccessClosure 1",{message:textStatus,stack:""})}catch(p){}}else{swalQueue("Error saving storyboard",o.Error);LogErrorMessage("SaveHelper.HandleSaveSuccessClosure 2",{message:textStatus,stack:""})}}}$.unblockUI();return}if(saveAndContinue){ResetSaveWarning();$.unblockUI();return}if(o.RedirectUrl==null||o.RedirectUrl==""||o.RedirectUrl=="undefined"){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("Error-Save-Failed"),type:"Error",confirmButtonText:MyLangMap.GetText("warning-ok-button")});$.unblockUI();return}window.location.href=o.RedirectUrl}catch(p){$.unblockUI();LogErrorMessage("SaveHelper.HandleSaveSuccessClosure",p)}$.unblockUI()}}function h(n,p){try{if(n.SaveTry>10){return false}MyUserPermissions.UseCompression=true;var o=new Date()-Date.parse(n.RequestStart);if(o>90*1000){return false}n.SaveTry++;if(MyBrowserProperties.EnableCompression()&&n.UseCompression==0){c(n,p)}else{f(n,p)}return true}catch(m){LogErrorMessage("SaveHelper.RetrySave",m)}return false}function d(m,n){return function(o){try{if(h(m,n)){return}$.unblockUI();trackEventWithGA("Storyboard Creator","Save","SAVE FAILED",0);if(o.statusText=="timeout"){MyUserPermissions.UseCompression=true;swalQueue("Your storyboard timed out while saving - Uh Oh ","If you see this error multiple times please email support@storyboardthat.com and include this message.\r\n\r\nWe will try to use compression the next time you save.")}else{if(o.statusText=="Internal Server Error"){}else{MyUserPermissions.UseCompression=true;swalQueue("Your storyboard timed out while saving :(","If you see this error multiple times please email support@storyboardthat.com and include this message.\r\n\r\nWe will try to use compression the next time you save.")}}var p=new Object();p.message=o.statusText;p.stack=o.responseText;LogErrorMessage("SaveHelper.HandleSaveFailureClosure error:",p)}catch(p){LogErrorMessage("SaveHelper.HandleSaveFailureClosure",p)}}}return k}();var SbtQuillHelper=function(){var a=new Object();a.ResetToDefaults=function(){var b=MyBrowserProperties.Public_GetDefaultFont().replaceAll2("'","").replaceAll2(" ","_");quill.formatLine(0,2,"align","center");quill.format("font",b);$(".ql-editor").css("background-color","")};a.JamText=function(d){var c=quill.getSelection();var b=c==null?quill.getLength()-1:c.index;quill.insertText(b,d);quill.setSelection(b+d.length)};a.HandleWhiteText=function(){var b=false;var d=quill.getContents().ops;for(var c=0;c<d.length;c++){if(d[c].attributes!=null&&d[c].attributes.color!=null){if(d[c].attributes.color==="#ffffff"){b=true}}}if(b){$(".ql-editor").css("background-color","#555555")}else{$(".ql-editor").css("background-color","")}};return a}();var SbtSummerNoteHelper=function(){var l=new Object();var c="";var d=10;var b=null;var o=false;var n=false;l.InitSummerNoteIfNeeded=function(){if(n===true){return false}n=true;InitSummerNote();SbtSummerNoteHelper.ResetToDefaults();return true};l.ResetToDefaults=function(){try{if(n===false){InitSummerNote();n=true}}catch(s){LogErrorMessage("SbtSummerNoteHelperObject.ResetToDefaults.a",s)}try{ClearSelections();c=MyBrowserProperties.Public_GetDefaultFont().replaceAll2("_"," ");$(".note-editable.panel-body").css("font-family",c);if($(".note-current-fontname").text()!=c.replaceAll2("'","")){$("#summernote-editor").summernote("fontName",c)}var q=[];var p=new Object();p.insert="\n";p.attributes=new Object();p.attributes.align="center";var r=new Object();r.insert="&#65279;";r.attributes=g();q.push(p);q.push(r);SbtSummerNoteHelper.UpdateForDeltas(q);if($(".note-current-fontname").text()!=c.replaceAll2("'","")){$("#summernote-editor").summernote("fontName",c)}if($(".note-current-fontsize").text()!=d){$("#summernote-editor").summernote("fontSize",d)}b=SbtSummerNoteHelper.GetDeltas()}catch(s){LogErrorMessage("SbtSummerNoteHelperObject.ResetToDefaults.b",s)}};l.JamText=function(s){try{var p=$("#summernote-editor").summernote("currentStyle");var r=document.createElement("span");r.textContent=s;$(r).css("font-family",p["font-family"]);$(r).css("font-size",p["font-size"]+"pt");try{$(r).css("color",$(p.ancestors[1]).css("color"));$(r).css("text-decoration",$(p.ancestors[1]).css("text-decoration"))}catch(q){LogErrorMessage(" SbtSummerNoteHelperObject.JamText - Sneaky styles",q)}$("#summernote-editor").summernote("insertNode",r)}catch(q){LogErrorMessage(" SbtSummerNoteHelperObject.JamText",q)}};l.Deltas_UpdateFontSizeAndColor=function(q,s,p){if(q==null){return q}for(var r=0;r<q.length;r++){if(q[r]["attributes"]!=null){q[r].attributes.size=s;q[r].attributes.color=p}}return q};l.GenerateQuillForOneLiner=function(v,u,w,s,t){if(w=="middle"){w="center"}var q=[];var p=new Object();p.insert="\n";p.attributes=new Object();p.attributes.align=w;var r=new Object();r.insert=v;r.attributes=g();r.attributes.size=u;r.attributes.font=s;r.attributes.align=w;r.attributes.color=t;q.push(p);q.push(r);return q};l.GetDefaultFont=function(){return MyBrowserProperties.Public_GetDefaultFont().replaceAll2("_"," ")};l.HandleWhiteText=function(){var q=false;var s=SbtSummerNoteHelper.GetDeltas();if(s===null){$(".note-editable").css("background-color","");return}for(var r=0;r<s.length;r++){if(s[r].attributes!=null&&s[r].attributes.color!=null){var p=s[r].attributes.color.replaceAll2(" ","").toLowerCase();if(p==="#ffffff"||p.indexOf("rgb(255,255,255)")>=0){q=true}}}if(q){$(".note-editable").css("background-color","#555555")}else{$(".note-editable").css("background-color","")}};l.Paste=function(){};l.IsDefault=function(){if(b==null){return false}var p=SbtSummerNoteHelper.GetDeltas();return SbtLib.DeepCompareEquality(p,b)};l.GetDeltas=function(){var q=$("#summernote-editor").summernote("code");if(q===""){return null}q=q.replaceAll2("<div","<p").replaceAll2("</div","</p");var p=SbtSummerNoteHelper.GetSummerNoteDeltas(q);if(p==null){LogErrorMessage("SbtSummerNoteHelper.GetDeltas: Deltas null ")}return p};l.OnChange=function(v,q,p){var u=MyShapesState.Public_GetFirstSelectedShapeState();if(u==null){return}var s=u.TextState.Public_GetQuillDeltas();var r=SbtSummerNoteHelper.GetDeltas();if(r==null){return}if(SbtLib.DeepCompareEquality(r,s)){return}var t=$("#summernote-editor").summernote("code");if(k(t,r)){return}UndoManager.register(undefined,SbtSummerNoteHelper.UndoTextChange,[u.Id,s,u.TextState.CurrentId],"",undefined,SbtSummerNoteHelper.UndoTextChange,[u.Id,r,u.TextState.CurrentId],"");u.TextState.Public_SetQuillDeltas(r);u.SetText(SbtSummerNoteHelper.GetText(r));if(r==null){LogErrorMessage("SbtSummerNoteHelper.OnChange: Deltas null ")}u.UpdateDrawing(true)};l.UndoTextChange=function(s,q,p){try{var t=MyShapesState.Public_GetShapeStateById(s);t.TextState.CurrentId=p;if(t==null){LogErrorMessage("SvgManip.UndoTextChangeSummerNote - ShapeState is Null - ID: "+s);return}t.TextState.Public_SetQuillDeltas(q);t.SetText(SbtSummerNoteHelper.GetText(q));SbtSummerNoteHelper.UpdateForDeltas(q);t.UpdateDrawing();if(q==null){LogErrorMessage("SbtSummerNoteHelper.UndoTextChange: Deltas null ")}}catch(r){LogErrorMessage("SvgManip.UndoTextChangeQuill",r)}};l.GetText=function(p){var r="";if(p==null){return r}for(var q=0;q<p.length;q++){r+=p[q].insert}return r};l.UpdateForHtml=function(p){$("#summernote-editor").summernote("code",p)};l.UpdateForDeltas=function(p){if(p==null){SbtSummerNoteHelper.ResetToDefaults()}else{var q=m(p);$("#summernote-editor").summernote("code",q)}};function k(r,p){try{if(i(r)||j(p)){$("#summernote-editor").summernote("code",m(p));return true}}catch(q){LogErrorMessage("SbtSummerNoteHelper.SanitizeIfNeeded",q)}return false}l.GetSummerNoteDeltas=function(s){var t=$("#summernote-text-parse");t.empty();t.append(s);var q=[];e(t,null,q);try{var p=q.length;if(p>2){if(q[p-1].insert[0].charCodeAt()===65279&&SbtLib.DeepCompareEquality(q[p-1]["attributes"],q[p-2]["attributes"])){q.pop()}}}catch(r){LogErrorMessage("SbtSummerNoteHelperObject.GetSummerNoteDeltas",r)}t.empty();return q};function i(q){var r=["<a","<script","<img","<i>","<b>","<ul","<table","<p class=","<span class="];for(var p=0;p<r.length;p++){if(q.indexOf(r[p])>=0){return true}}return false}function j(p){if(p[0]!=null&&p[0]["attributes"]!=null){if(p[0].attributes.font.toLowerCase().indexOf("open sans")>=0){return false}}for(var q=0;q<p.length;q++){if(a(p[q].attributes.font,SbtSummerNoteHelper.SanitizeFont(p[q].attributes.font))==false){return true}}return false}function e(t,u,r){t=$(t);if(t[0].nodeName==="#text"){var q=new Object();q.insert=t.text();q.attributes=u;r.push(q)}else{if(t[0].nodeName==="#comment"){}else{var u=h(t,u);if(t[0].nodeName.toLowerCase()==="p"){var q=new Object();q.insert="\n";q.attributes=u;r.push(q)}}}var p=$(t).contents();for(var s=0;s<p.length;s++){e(p[s],u,r)}}function g(){var p=new Object();p.font=c;p.size=d;p.color="rgb(0,0,0)";p.bold=false;p.italic=false;p.strike=false;p.underline=false;p.align="center";p.script="";return p}l.UpdateUsePAlign=function(p){o=p};function h(t,v){var u=g();if(v!=null){u.script=v.script;u.underline=v.underline;u.strike=v.strike;u.font=v.font}try{if(t.context.nodeName.toLowerCase()==="sub"){u.script="sub"}if(t.context.nodeName.toLowerCase()==="sup"){u.script="super"}var s=1;if(u.script!=""){s=1.333}var p=$(t).css("font-family");u.font=p||u.font||c;u.font=u.font==null?c:u.font;u.font=SbtSummerNoteHelper.SanitizeFont(u.font);var q=$(t).css("font-size");u.size=q==null?u.size:(parseFloat(q)*s*72/96).toFixed(0);u.size=u.size.replace("pt","").replace("px","");u.color=$(t).css("color");u.underline=u.underline?true:$(t).css("text-decoration").toLowerCase().indexOf("underline")>=0;u.strike=u.strike?true:$(t).css("text-decoration").toLowerCase().indexOf("line-through")>=0;u.align=$(t).css("text-align");if($(t).attr("align")!=null&&$(t).attr("align")!=""&&$(t).attr("align")!=u.align){SbtSummerNoteHelper.UpdateUsePAlign(true);u.align=$(t).attr("align")}}catch(r){LogErrorMessage("SbtSummerNoteHelper.GetTextStyles",r)}return u}function m(r){var C="";var v=false;if(r==null){return""}if(r[0]==null){LogErrorMessage("SbtSummerNoteHelper.SummerDeltasToHtml: (Self Healing) Initial delta was null or undefined.  Resetting to defaults");SbtSummerNoteHelper.ResetToDefaults()}if(r[0].insert!=="\n"){if(o){C+='<p align="center">'}else{C+='<p style="text-align:center;">'}}for(var u=0;u<r.length;u++){var q=r[u];if(q==null){LogErrorMessage("SbtSummerNoteHelper.SummerDeltasToHtml: Delta "+u+" was null or undefined.  Skipping");continue}if(q.insert==="\n"){if(v){C+="</p>"}var p="center";if(q.attributes!=null){p=q.attributes.align}v=true;var w=p==="start"?"left":p;if(o){C+='<p align="'+w+'">'}else{C+='<p style="text-align:'+p+';">'}}else{var B="";var s=f(q.attributes,"font",c).replaceAll2('"',"'").replaceAll2("_"," ");s=SbtSummerNoteHelper.SanitizeFont(s);B+="font-family:"+s+";";B+="color:"+f(q.attributes,"color","black")+";";var D=f(q.attributes,"underline",false);var A=f(q.attributes,"strike",false);var z=f(q.attributes,"script","");z=z==="super"?"sup":z;var t=f(q.attributes,"size",d);B+="font-size:"+t+"pt;";if(D){B+="text-decoration:underline;"}if(A){B+="text-decoration:line-through;"}var y="";var x="";if(z!=""){y="<"+z+">";x="</"+z+">"}C+='<span style="'+B+'">'+y+(q.insert?q.insert.replaceAll2("\r"," ").replaceAll2("\n",""):"")+x+"</span>"}}if(v){C+="</p>"}return C}l.SanitizeFont=function(r){try{var p=SbtSummerNoteHelper.GetDefaultFont().replaceAll2('"',"'").replaceAll2("_"," ");if(r==null){return p}for(var s=0;s<SummerNoteSettings.FontNames.length;s++){if(a(r,SummerNoteSettings.FontNames[s].Family)){return SummerNoteSettings.FontNames[s].Family.replaceAll2('"',"'").replaceAll2("_"," ")}}}catch(q){LogErrorMessage("SbtSummerNoteHelperObject.SanitizeFont",q)}return p};function a(p,q){p=p.replaceAll2('"',"").replaceAll2("'","").toLowerCase();q=q.replaceAll2('"',"").replaceAll2("'","").toLowerCase();return(p===q)}function f(q,r,p){if(q==null||q[r]==null){return p}return q[r]}return l}();var Sorters=function(){var a=new Object();a.SortShapeStatesByIndex=function(c,d){try{if($("#"+c.Id).index()>$("#"+d.Id).index()){return 1}else{return -1}}catch(b){LogErrorMessage("Sorters.SortShapeStatesByIndex",b)}};a.SortShapesByVisibleX=function(b,c){return b.Property_VisibleX()==c.Property_VisibleX()?0:+(b.Property_VisibleX()>c.Property_VisibleX())||-1};a.SortShapesByVisibleY=function(b,c){return b.Property_VisibleY()==c.Property_VisibleY()?0:+(b.Property_VisibleY()>c.Property_VisibleY())||-1};return a}();var UndoHelper=function(){var a=new Object();a.UndoBulkTextChange=function(){try{for(var c=0;c<arguments.length;c++){var d=arguments[c].Id;var f=MyShapesState.Public_GetShapeStateById(d);if(UseQuill||UseSummerNote){f.TextState.Public_SetQuillDeltas(arguments[c].QuillDeltas)}else{f.SetText(arguments[c].Text)}f.UpdateDrawing()}}catch(b){LogErrorMessage("UndoHelper.UndoBulkTextChange",b)}};a.UndoTitleEmphasis=function(){try{for(var c=0;c<arguments.length;c++){var d=arguments[c].Id;var f=MyShapesState.Public_GetShapeStateById(d);f.Public_SetColorForRegion("Textables",arguments[c].BackgroundColor,false,false);if(UseQuill){f.TextState.Public_QuillSetFontColor(arguments[c].FontColor);f.TextState.Public_QuillSetFontSize(arguments[c].FontSize)}else{if(UseSummerNote){f.TextState.Public_SummerNote_SetFontSizeAndColor(arguments[c].FontSize,arguments[c].FontColor)}else{f.TextState.FontColor=arguments[c].FontColor;f.TextState.FontSize=arguments[c].FontSize}}f.UpdateDrawing()}}catch(b){LogErrorMessage("UndoHelper.UndoBulkTextChange",b)}};return a}();var ZoomCropHelper=function(){var B=new Object();var u=new Object();u.CropLeft=0;u.CropTop=0;u.CropHeight=0;u.CropWidth=0;u.CropRatio=1;u.CropViewScale;u.ClipScale;u.ImageWidth=0;u.ImageHeight=0;u.CropAction="";u.ResizePageX=0;u.ResizePageY=0;u.CropResizeDirection="";u.CircleSizeRatio=1;u.CroppedImageCopyId="ZoomCroppedImageCopy";u.CalcPoint=document.getElementById("ZoomCropAreaSvg").createSVGPoint();u.selectedShapeStates=new Array();u.CellPosition=null;u.newScale=1;u.CellHash=0;u.CellId=null;u.PrevCellCropRatio=null;u.PrevCellCropLength=null;u.PrevCellCropArea=null;u.PrevScale=null;u.ViewArea=null;function r(C){return function(D){q(C)}}function i(){var J=u.PrevCellCropRatio.A1+u.PrevCellCropRatio.A2+u.PrevCellCropRatio.A3;var I=u.PrevCellCropRatio.B1+u.PrevCellCropRatio.B2+u.PrevCellCropRatio.B3;var C=u.CellPosition.Width*u.PrevCellCropRatio.A1/J;var D=u.CellPosition.Width*u.PrevCellCropRatio.A2/J;var E=u.CellPosition.Width*u.PrevCellCropRatio.A3/J;var F=u.CellPosition.Height*u.PrevCellCropRatio.B1/I;var G=u.CellPosition.Height*u.PrevCellCropRatio.B2/I;var H=u.CellPosition.Height*u.PrevCellCropRatio.B3/I;return{LengthA1:C,LengthA2:D,LengthA3:E,LengthB1:F,LengthB2:G,LengthB3:H}}function h(){return{X:u.CellPosition.X+u.PrevCellCropLength.LengthA1,Y:u.CellPosition.Y+u.PrevCellCropLength.LengthB1,Width:u.PrevCellCropLength.LengthA2,Height:u.PrevCellCropLength.LengthB2}}function j(){return(u.PrevCellCropRatio.A1+u.PrevCellCropRatio.A2+u.PrevCellCropRatio.A3)/u.PrevCellCropRatio.A2}function k(){var C=u.CellPosition.Width*u.PrevCellCropRatio.A1/u.PrevCellCropRatio.A2;var D=u.CellPosition.Width;var E=u.CellPosition.Width*u.PrevCellCropRatio.A3/u.PrevCellCropRatio.A2;var F=u.CellPosition.Height*u.PrevCellCropRatio.B1/u.PrevCellCropRatio.B2;var G=u.CellPosition.Height;var H=u.CellPosition.Height*u.PrevCellCropRatio.B3/u.PrevCellCropRatio.B2;return{X:u.CellPosition.X-C,Y:u.CellPosition.Y-F,Width:C+D+E,Height:F+G+H}}function q(D){var E=$("#ZoomCropAreaSvg");u.CropAction="";E.children().remove();if(u.selectedShapeStates){for(var L=0;L<u.selectedShapeStates[StoryboardPartTypeEnum.StoryboardCell].length;L++){var C=u.selectedShapeStates[StoryboardPartTypeEnum.StoryboardCell][L];var R=$("#"+C.Id).clone();R.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();R.find("#"+C.Id+SvgPartsEnum.CropGroup).removeAttr("clip-path");E.append(R)}}u.CropViewScale=1;u.CropLeft=u.CellPosition.X;u.CropTop=u.CellPosition.Y;u.CropWidth=u.CellPosition.Width;u.CropHeight=u.CellPosition.Height;u.CropRatio=u.CellPosition.Height/u.CellPosition.Width;u.PrevCellCropLength=i();u.PrevCellCropArea=h();u.PrevScale=j();u.ViewArea=k();var J=u.ViewArea.X-10;var K=u.ViewArea.Y-10;var I=u.ViewArea.Width+20;var F=u.ViewArea.Height+20;document.getElementById("ZoomCropAreaSvg").setAttribute("viewBox",J+" "+K+" "+I+" "+F);var H=Math.round($(window).width()*8/10);var G=Math.round($(window).height()*8/10)-130;var M=H>G?G:H;var O=M,N=M;$("#ZoomCropModalDialog").css("width",Math.max(O+50,350));$("#ZoomCropModalDialog").css("height",N);$(".crop-window-wrapper").css("width",O);$(".crop-window-wrapper").css("height",N);var S=20;E.attr("width",O-S);E.attr("height",N-S);E.mousemove(l());E.mouseleave(y());E.mouseup(y());E.mousedown(w());E.css("cursor","hand");c()}function c(){var C=$("#croppedImageCopy_ClipArea");if(C!==null||C.length>0){C.detach()}C=SvgCreator.CreateSvgGroup("croppedImageCopy_ClipArea");$("#ZoomCropAreaSvg").append(C);C.appendChild(SvgCreator.AddRect(u.CropLeft,u.CropTop,u.CropWidth,u.CropHeight,"black","red","4,4",".25","ZoomCropAreaBox"));if(MyBrowserProperties.IsMobile){b(C)}else{a(C)}}function b(G){var D=13;var J="#AAA393";var F="#6285C7";var E=$("#ZoomCropAreaBox");E.css("border-width",5);var H=u.CropLeft;var I=u.CropWidth+u.CropLeft;var K=u.CropTop;var C=u.CropHeight+u.CropTop;G.appendChild(SvgCreator.AddCircle(H,K,D,J,F,u.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"ResizeNW"));G.appendChild(SvgCreator.AddCircle(I,K,D,J,F,u.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"ResizeNE"));G.appendChild(SvgCreator.AddCircle(H,C,D,J,F,u.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"ResizeNE"));G.appendChild(SvgCreator.AddCircle(I,C,D,J,F,u.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"ResizeNW"));t(u.CroppedImageCopyId+SvgPartsEnum.Selector_NE,n(ResizeEnum.NE));t(u.CroppedImageCopyId+SvgPartsEnum.Selector_NW,n(ResizeEnum.NW));t(u.CroppedImageCopyId+SvgPartsEnum.Selector_SE,n(ResizeEnum.SE));t(u.CroppedImageCopyId+SvgPartsEnum.Selector_SW,n(ResizeEnum.SW));t("ZoomCropAreaBox",m())}function t(C,D){$("#"+C).bind("touchy-drag",D)}function a(F){var D=4;var I="#AAA393";var E="#6285C7";var G=u.CropLeft;var H=u.CropWidth+u.CropLeft;var J=u.CropTop;var C=u.CropHeight+u.CropTop;F.appendChild(SvgCreator.AddCircle(G,J,D,I,E,u.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"ResizeNW"));F.appendChild(SvgCreator.AddCircle(H,J,D,I,E,u.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"ResizeNE"));F.appendChild(SvgCreator.AddCircle(G,C,D,I,E,u.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"ResizeNE"));F.appendChild(SvgCreator.AddCircle(H,C,D,I,E,u.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"ResizeNW"));s(u.CroppedImageCopyId+SvgPartsEnum.Selector_NE,x(ResizeEnum.NE));s(u.CroppedImageCopyId+SvgPartsEnum.Selector_NW,x(ResizeEnum.NW));s(u.CroppedImageCopyId+SvgPartsEnum.Selector_SE,x(ResizeEnum.SE));s(u.CroppedImageCopyId+SvgPartsEnum.Selector_SW,x(ResizeEnum.SW))}function s(C,D){$("#"+C).mousedown(D)}function A(){var D=$("#ZoomCropAreaBox");var I=$("#"+u.CroppedImageCopyId+SvgPartsEnum.Selector_NW);var H=$("#"+u.CroppedImageCopyId+SvgPartsEnum.Selector_NE);var L=$("#"+u.CroppedImageCopyId+SvgPartsEnum.Selector_SW);var K=$("#"+u.CroppedImageCopyId+SvgPartsEnum.Selector_SE);var E=u.CropLeft;var J=u.CropWidth+u.CropLeft;var M=u.CropTop;var C=u.CropHeight+u.CropTop;var F=(E+J)/2;var G=(M+C)/2;SvgCreator.UpdateRectangle(D,u.CropLeft,u.CropTop,u.CropWidth,u.CropHeight);SvgCreator.UpdateCircle(I,E,M);SvgCreator.UpdateCircle(H,J,M);SvgCreator.UpdateCircle(L,E,C);SvgCreator.UpdateCircle(K,J,C)}function z(E,F){var C=Math.abs(E);var D=Math.abs(F);if(C>=D){F=E*u.CropRatio}else{E=F/u.CropRatio}switch(u.CropResizeDirection){case ResizeEnum.NE:if(C>=D){u.CropHeight+=F;u.CropTop-=F;u.CropWidth+=E}else{u.CropHeight-=F;u.CropTop+=F;u.CropWidth-=E}break;case ResizeEnum.NW:u.CropHeight-=F;u.CropTop+=F;u.CropWidth-=E;u.CropLeft+=E;break;case ResizeEnum.SE:u.CropHeight+=F;u.CropWidth+=E;break;case ResizeEnum.SW:if(C>=D){u.CropHeight-=F;u.CropWidth-=E;u.CropLeft+=E}else{u.CropHeight+=F;u.CropWidth+=E;u.CropLeft-=E}break}A()}function o(C,D){u.CropTop+=D;u.CropLeft+=C;A()}function n(D,C){return function(I,J,E,F){if(J!="move"){return}u.CropResizeDirection=D;u.CropPolygonPointSelectedID=C;if(u.CropResizeDirection==null||u.CropResizeDirection==undefined){return}var G=F.movePoint.x-F.lastMovePoint.x;var H=F.movePoint.y-F.lastMovePoint.y;z(G,H)}}function m(C){return function(H,I,D,E){if(I!="move"){return}var F=E.movePoint.x-E.lastMovePoint.x;var G=E.movePoint.y-E.lastMovePoint.y;o(F,G)}}function d(C){var D=document.getElementById("ZoomCropAreaSvg");u.CalcPoint.x=C.pageX;u.CalcPoint.y=C.pageY;return u.CalcPoint.matrixTransform(D.getScreenCTM().inverse())}function x(D,C){return function(E){var F=d(E);u.ResizePageX=F.x;u.ResizePageY=F.y;u.CropAction="Resize";u.CropResizeDirection=D;u.CropPolygonPointSelectedID=C;E.stopPropagation()}}function w(){return function(C){u.CropAction="Move";var D=d(C);u.ResizePageX=D.x;u.ResizePageY=D.y;C.stopPropagation()}}function l(){return function(C){if(u.CropAction==""){return}var D=d(C);deltaX=D.x-u.ResizePageX;deltaY=D.y-u.ResizePageY;u.ResizePageX=D.x;u.ResizePageY=D.y;if(u.CropAction=="Resize"){z(deltaX,deltaY)}else{if(u.CropAction=="Move"){o(deltaX,deltaY)}}}}function y(){return function(){u.CropAction=""}}function e(){var C=MyShapesState.Public_GetFirstSelectedShapeState();if(C===null){C=MyShapesState.Public_GetShapeStateById(u.OriginalShapeId)}return C}B.ShowCropDialog=function(C){var E=StoryboardContainer.GetAllLayoutParts(CellConfiguration);u.CellPosition=StoryboardContainer._GetLayoutPartForShape(E,C);u.selectedShapeStates=u.CellPosition?StoryboardContainer.GetShapeStatesForCell(u.CellPosition.Row,u.CellPosition.Col):null;u.CellId=MyIdGenerator.GenerateCellId(u.CellPosition.Row,u.CellPosition.Col);if(u.CellId in StoryboardContainer.GlobalCellCropRatio){u.PrevCellCropRatio=StoryboardContainer.GlobalCellCropRatio[u.CellId]}else{u.PrevCellCropRatio={A1:0,A2:1,A3:0,B1:0,B2:1,B3:0}}if(!u.selectedShapeStates||u.selectedShapeStates.length<=0){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("Warning-Object-Not-In-Cell"),type:"info",confirmButtonText:MyLangMap.GetText("warning-ok-button")});return false}MyPointers.Dialog_ZoomCropImage.one("shown.bs.modal",r(C));var D=$("#ZoomCropAreaSvg");D.children().remove();MyPointers.Dialog_ZoomCropImage.modal();return true};B.RemoveCrop=function(){var C=e();C.UseClipping=false;C.UpdateDrawing();MyPointers.Dialog_ZoomCropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[C.Id,true,C.ClipX,C.ClipY,C.ClipWidth,C.ClipHeight,JSON.parse(JSON.stringify(C.CropPolygonPoint)),C.CropType],"",undefined,UndoCrop,[C.Id,C.UseClipping,C.ClipX,C.ClipY,C.ClipWidth,C.ClipHeight,JSON.parse(JSON.stringify(C.CropPolygonPoint)),C.CropType],"")};B.CancelCrop=function(){MyPointers.Dialog_ZoomCropImage.modal("hide");var C=e();C.UpdateDrawing()};function g(D){var C={x:u.CropLeft-u.CellPosition.X,y:u.CropTop-u.CellPosition.Y};return{x:(D.x-u.CropLeft)*u.newScale+u.CropLeft-C.x,y:(D.y-u.CropTop)*u.newScale+u.CropTop-C.y}}function p(F,C,E){var D={x:C.X-u.CellPosition.X,y:C.Y-u.CellPosition.Y};return{x:(F.x-C.X)*E+C.X-D.x,y:(F.y-C.Y)*E+C.Y-D.y}}function v(F,C,E){var D={x:C.X-u.CellPosition.X,y:C.Y-u.CellPosition.Y};return{x:(F.x-C.X+D.x)/E+C.X,y:(F.y-C.Y+D.y)/E+C.Y}}function f(){var C=u.CropLeft-u.ViewArea.X;var D=u.CropWidth;var E=u.ViewArea.Width-C-D;var F=u.CropTop-u.ViewArea.Y;var G=u.CropHeight;var H=u.ViewArea.Height-F-G;return{A1:C/u.ViewArea.Width,A2:D/u.ViewArea.Width,A3:E/u.ViewArea.Width,B1:F/u.ViewArea.Height,B2:G/u.ViewArea.Height,B3:H/u.ViewArea.Height}}B.UpdateCrop=function(N){if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=true}var C=e();var I=N?{A1:0,A2:1,A3:0,B1:0,B2:1,B3:0}:f();var J=I.A1+I.A2+I.A3;var K=I.B1+I.B2+I.B3;StoryboardContainer.GlobalCellCropRatio[u.CellId]=I;u.newScale=J/I.A2;var H={X:u.CellPosition.X+I.A1*u.CellPosition.Width/J,Y:u.CellPosition.Y+I.B1*u.CellPosition.Height/K,Width:I.A2*u.CellPosition.Width/J,Height:I.B2*u.CellPosition.Height/K};var R=[],M=[];if(u.selectedShapeStates){for(var G=0;G<u.selectedShapeStates[StoryboardPartTypeEnum.StoryboardCell].length;G++){var D=u.selectedShapeStates[StoryboardPartTypeEnum.StoryboardCell][G];var O=D.getCropParam();Q=v({x:D.X,y:D.Y},u.PrevCellCropArea,u.PrevScale);P=p(Q,H,u.newScale);D.X=P.x;D.Y=P.y;D.ScaleX=D.ScaleX*u.newScale/u.PrevScale;D.ScaleY=D.ScaleY*u.newScale/u.PrevScale;var E=D.Private_GetSelectionBoxArea(0);var F={x:E.CenterX,y:E.CenterY};D.UseClipping=true;D.CropType=CropTypeEnum.Advanced;D.CropPolygonPoint=new Array();D.CropPolygonPoint.push(D.ConvertCoordinateToOrigin({x:u.CellPosition.X,y:u.CellPosition.Y},F,true));D.CropPolygonPoint.push(D.ConvertCoordinateToOrigin({x:u.CellPosition.X,y:u.CellPosition.Y+u.CellPosition.Height},F,true));D.CropPolygonPoint.push(D.ConvertCoordinateToOrigin({x:u.CellPosition.X+u.CellPosition.Width,y:u.CellPosition.Y+u.CellPosition.Height},F,true));D.CropPolygonPoint.push(D.ConvertCoordinateToOrigin({x:u.CellPosition.X+u.CellPosition.Width,y:u.CellPosition.Y},F,true));MyGroupAction.MinimizeAdvancedCropRegion(D);CropHelper.UpdateRotatedObjectPosition(D);var L=D.getCropParam();D.UpdateDrawing();R.push(O);M.push(L)}}UndoManager.register(undefined,UndoZoomCrop,[R,u.CellId,u.PrevCellCropRatio],"",undefined,UndoZoomCrop,[M,u.CellId,I],"");MyPointers.Dialog_ZoomCropImage.modal("hide")};return B}();function UndoZoomCrop(f,c,b){var d;var e=StoryboardContainer.GetAllLayoutParts(CellConfiguration);StoryboardContainer.GlobalCellCropRatio[c]=b;for(d=0;d<f.length;d++){var a=MyShapesState.Public_GetShapeStateById(f[d].Id);a.setCropParam(f[d]);a.UpdateDrawing()}};function ColorWheel(g,h,a,b,c,d,e,f){this.Region=g;this.Title=h;this.Color1=a;this.Color2=b;this.Color3=c;this.Color4=d;this.Color5=e;this.Color6=f}ColorWheel.prototype.GetTitle=function(){try{var b=MyLangMap.GetText("CW-"+this.Region);if(b!=""){return b}return this.Region}catch(a){LogErrorMessage("ColorWheel.GetTitle",a);throw a}};function ColorWheels(){this.SanitizeColor=function(a){var b=a.toLowerCase();if(b=="paws"){return"BrightColor1"}if(b=="ears"){return"BrightColor2"}if(b=="color1"){return"PrimaryColor"}if(b=="color2"){return"PrimaryColor2"}if(b=="color3"){return"PrimaryColorAccent"}if(b=="darkcolors"){return"DarkColor"}if(b=="basiccolors"){return"PrimaryColor"}if(b=="brightcolors1"){return"BrightColor1"}if(b=="brightcolors2"){return"BrightColor2"}if(b=="brightcolors3"){return"BrightColor3"}if(b=="brightcolors4"){return"BrightColor4"}if(b=="softcolors"){return"PaleColor"}if(b=="arrows"){return"PaleColor"}if(b=="shapes"){return"LightColor"}if(b=="shapes3d"){return"PaleColor"}return a};this.Skin=new ColorWheel("Skin","Skin",MyColors.White,MyColors.PaleTan,MyColors.PeachyTan,MyColors.Tan,MyColors.DarkTan,MyColors.SoftBrown);this.Hair=new ColorWheel("Hair","Hair",MyColors.White,MyColors.Blonde,MyColors.Orange,MyColors.Brown,MyColors.MediumGrey,MyColors.Black);this.Hair2=new ColorWheel("Hair2","Hair",MyColors.White,MyColors.Blonde,MyColors.Orange,MyColors.Brown,MyColors.MediumGrey,MyColors.Black);this.Eyes=new ColorWheel("Eyes","Eyes",MyColors.White,MyColors.BlueEye,MyColors.OliveGreen,MyColors.SoftBrown,MyColors.Red,MyColors.Black);this.Makeup=new ColorWheel("Makeup","Makeup",MyColors.LightBlue,MyColors.LightRed,MyColors.LightGreen,MyColors.BrightYellow,MyColors.BrightViolet,MyColors.BrightGray);this.Pants=new ColorWheel("Pants","Pants",MyColors.Parchment,MyColors.SoftBrown,MyColors.BlueEye,MyColors.VeryDarkGrayBlue,MyColors.DarkGray,MyColors.Black);this.Shirt=new ColorWheel("Shirt","Shirt",MyColors.White,MyColors.LightRed,MyColors.LightBlue,MyColors.LightGreen,MyColors.LightYellow,MyColors.LightGray);this.Shorts=new ColorWheel("Shorts","Shorts",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.Dress=new ColorWheel("Dress","Dress",MyColors.White,MyColors.PaleRed,MyColors.PaleBlue,MyColors.PaleGreen,MyColors.PaleYellow,MyColors.PaleGray);this.Skirt=new ColorWheel("Skirt","Skirt",MyColors.White,MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightGreen,MyColors.BrightYellow,MyColors.BrightGray);this.Shoes=new ColorWheel("Shoes","Shoes",MyColors.White,MyColors.VeryDarkRed,MyColors.VeryDarkBlue,MyColors.VeryDarkGreen,MyColors.VeryDarkYellow,MyColors.Black);this.Tie=new ColorWheel("Tie","Tie",MyColors.White,MyColors.VeryDarkRed,MyColors.VeryDarkBlue,MyColors.VeryDarkGreen,MyColors.VeryDarkYellow,MyColors.Black);this.Jacket=new ColorWheel("Jacket","Jacket",MyColors.White,MyColors.DarkRed,MyColors.DarkBlue,MyColors.DarkGreen,MyColors.DarkYellow,MyColors.DarkGray);this.PrimaryColor=new ColorWheel("PrimaryColor","Color",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor2=new ColorWheel("PrimaryColor2","Color 2",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor3=new ColorWheel("PrimaryColor3","Color 3",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor4=new ColorWheel("PrimaryColor4","Color 4",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor5=new ColorWheel("PrimaryColor5","Color 5",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor6=new ColorWheel("PrimaryColor6","Color 6",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor7=new ColorWheel("PrimaryColor7","Color 7",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColor8=new ColorWheel("PrimaryColor8","Color 8",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Gray);this.PrimaryColorAccent=new ColorWheel("PrimaryColorAccent","Color 2",MyColors.White,MyColors.DarkRed,MyColors.DarkBlue,MyColors.DarkGreen,MyColors.DarkYellow,MyColors.DarkGray);this.PrimaryColorWhiteAndBlack=new ColorWheel("PrimaryColorWhiteAndBlack","Color",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Black);this.PrimaryColorWhiteAndBlack2=new ColorWheel("PrimaryColorWhiteAndBlack2","Color 2",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Black);this.PrimaryColorNoWhite=new ColorWheel("PrimaryColor","Color",MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.DarkViolet,MyColors.Black);this.DarkColor=new ColorWheel("DarkColor","Color",MyColors.DarkGray,MyColors.DarkRed,MyColors.VeryDarkYellow,MyColors.VeryDarkGreen,MyColors.VeryDarkGrayBlue,MyColors.VeryDarkBrown);this.VeryDarkColor=new ColorWheel("VeryDarkColor","Color",MyColors.VeryDarkRed,MyColors.VeryDarkBlue,MyColors.VeryDarkGreen,MyColors.VeryDarkYellow,MyColors.VeryDarkViolet,MyColors.VeryDarkOrange);this.BrightColor1=new ColorWheel("BrightColor1","Color",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.BrightColor2=new ColorWheel("BrightColor2","Color 2",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.BrightColor3=new ColorWheel("BrightColor3","Color 3",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.BrightColor4=new ColorWheel("BrightColor4","Color 4",MyColors.BrightRed,MyColors.BrightBlue,MyColors.BrightYellow,MyColors.BrightOrange,MyColors.BrightViolet,MyColors.BrightGreen);this.LightColor=new ColorWheel("LightColor","Color",MyColors.LightBlue,MyColors.LightRed,MyColors.LightGreen,MyColors.BrightYellow,MyColors.BrightViolet,MyColors.BrightGray);this.PaleColor=new ColorWheel("PaleColor","Color",MyColors.PaleRed,MyColors.PaleBlue,MyColors.PaleGreen,MyColors.PaleYellow,MyColors.PaleViolet,MyColors.PaleOrange);this.PaleColorWithWhite=new ColorWheel("PaleColorWithWhite","Color",MyColors.White,MyColors.PaleRed,MyColors.PaleBlue,MyColors.PaleGreen,MyColors.PaleYellow,MyColors.PaleViolet);this.HandColor=new ColorWheel("HandColor","Hand",MyColors.HandBlue,MyColors.PaleTan,MyColors.PeachyTan,MyColors.Tan,MyColors.DarkTan,MyColors.SoftBrown);this.HandColor2=new ColorWheel("HandColor2","Hand 2",MyColors.HandBlue,MyColors.PaleTan,MyColors.PeachyTan,MyColors.Tan,MyColors.DarkTan,MyColors.SoftBrown);this.Turban=new ColorWheel("Turban","Turban",MyColors.White,MyColors.Red,MyColors.Blue,MyColors.Green,MyColors.Yellow,MyColors.Black);this.Fur=new ColorWheel("Fur","Fur",MyColors.Brown,MyColors.LightBrown,MyColors.PaleBrown,MyColors.Gray,MyColors.DarkGray,MyColors.LightRed);this.Fur2=new ColorWheel("Fur2","Fur 2",MyColors.VeryDarkBrown,MyColors.LightBrown,MyColors.PaleBrown,MyColors.Black,MyColors.LightGray,MyColors.PaleRed);this.Victorian=new ColorWheel("Victorian","Color",MyColors.VeryDarkRed,MyColors.VeryDarkTeal,MyColors.DarkGrayViolet,MyColors.SoftBrown,MyColors.PaleBrown,MyColors.DarkGold);this.Sky=new ColorWheel("Sky","Sky",MyColors.SkyPaleBlue,MyColors.SkyLightBlue,MyColors.SkyBlue,MyColors.SkyCloudy,MyColors.SkyNight,MyColors.SkyDarkNight);this.Furniture=new ColorWheel("Furniture","Furniture",MyColors.White,MyColors.PaleBrown,MyColors.BrightBrown,MyColors.DarkBrown,MyColors.VeryDarkBrown,MyColors.Gray);this.Textables=new ColorWheel("Textables","Textables",MyColors.White,MyColors.SbtPaleBlue,MyColors.PaleGrayBrown,MyColors.SbtBlue,MyColors.MutedYellow,MyColors.Parchment);this.CoolColor1=new ColorWheel("CoolColor1","Color 1",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.CoolColor2=new ColorWheel("CoolColor2","Color 2",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.CoolColor3=new ColorWheel("CoolColor3","Color 3",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.CoolColor4=new ColorWheel("CoolColor4","Color 4",MyColors.SbtBlue,MyColors.MutedGray,MyColors.SbtPaleBlue,MyColors.SbtDarkBlue,MyColors.White,MyColors.PaleGray);this.Pavement=new ColorWheel("Pavement","Pavement",MyColors.LightGray,MyColors.LightPavement,MyColors.Pavement,MyColors.DarkPavement,MyColors.VeryDarkPavement,MyColors.Black);this.Grass=new ColorWheel("Grass","Grass",MyColors.White,MyColors.GrassPaleGreen,MyColors.GrassLightGreen,MyColors.GrassGreen,MyColors.GrassDarkGreen,MyColors.GrassVeryDarkGreen);this.Claws=new ColorWheel("Claws","Claws",MyColors.White,"rgb(232, 193, 132)","rgb(210, 140, 101)","rgb(204, 181, 158)","rgb(188, 190, 192)","rgb(234, 203, 198)");this.Clothes=new ColorWheel("Clothes","Color",MyColors.OffWhite,MyColors.GreenKelly,MyColors.BlueBright,MyColors.RedShaded,MyColors.YellowLight,MyColors.Black);this.ClothesMuted=new ColorWheel("ClothesMuted","Color",MyColors.OffWhite,MyColors.GreenArmy,MyColors.BlueGrey,MyColors.GreyMedium,MyColors.YellowLight,MyColors.BrownLight);this.Venitian=new ColorWheel("Venitian","Clothing",MyColors.BlueOcean,MyColors.PurplePlum,MyColors.RedRose,MyColors.GreenLeaf,MyColors.YellowButtercup,MyColors.BrownLeather);this.Silhouette=new ColorWheel("Silhouette","Silhouette",MyColors.Black,MyColors.GreySteel,MyColors.RedRust,MyColors.GreyGrey,MyColors.GreenMachine,MyColors.PurpleSil);this.MythicSkin=new ColorWheel("MythicSkin","Skin",MyColors.White,MyColors.DarkGreen,MyColors.BrownLeather,MyColors.GreySteel,MyColors.LightYellow,MyColors.Red);this.House=new ColorWheel("House","House",MyColors.White,MyColors.BrownGray,MyColors.BarnRed,MyColors.ButterYellow,MyColors.LightPavement,MyColors.Sand);this.Water=new ColorWheel("Water","Water",MyColors.White,MyColors.LightWater,MyColors.Water,MyColors.LightBrown,MyColors.VeryDarkBrown,MyColors.Black);this.Metal=new ColorWheel("Metal","Metal",MyColors.Silver,MyColors.Pewter,MyColors.GoldCoin,MyColors.MutedGold,MyColors.BrightGold,MyColors.GreenMetal);this.Retro1=new ColorWheel("Retro1","Color 1",MyColors.White,MyColors.AvocadoGreen,MyColors.SunflowerYellow,MyColors.Aqua,MyColors.PumpkinOrange,MyColors.BubblegumPink);this.Retro2=new ColorWheel("Retro2","Color 2",MyColors.White,MyColors.AvocadoGreen,MyColors.SunflowerYellow,MyColors.Aqua,MyColors.PumpkinOrange,MyColors.BubblegumPink);this.EarthyTones=new ColorWheel("EarthyTones","Earthy Tones",MyColors.ButterYellow,MyColors.ArmyGreen,MyColors.Sand,MyColors.DarkTan,MyColors.VeryDarkBrown,MyColors.VeryDarkGray);this.Modern=new ColorWheel("Modern","Color 1",MyColors.DesertSage,MyColors.DriedHerb,MyColors.OakBuff,MyColors.Marsala,MyColors.StormyWeather,MyColors.ClassicBlue);this.AlternateModern=new ColorWheel("AlternateModern","Color 2",MyColors.BiscayBay,MyColors.ReflectingPond,MyColors.CadmiumOrange,MyColors.CashmereRose,MyColors.AmethystOrchid,MyColors.ToastedAlmond);this.HairDyes=new ColorWheel("HairDyes","Color",MyColors.HotHotPink,MyColors.NeonElectricLizard,MyColors.ShockingBlue,MyColors.Wildfire,MyColors.ElectricTigerLily,MyColors.PurpleHaze,MyColors.OfficeTones);this.OfficeTones=new ColorWheel("OfficeTones","Color",MyColors.Aleutian,MyColors.Alabaster,MyColors.UrbanPutty,MyColors.AquaSphere,MyColors.TempeStar,MyColors.PurplePassage);this.AlternateEarthyTones=new ColorWheel("AlternateEarthyTones","Color",MyColors.BabyBrown,MyColors.MossyGlossGreen,MyColors.SailorBlue,MyColors.TitaniumGrey,MyColors.Hemetite,MyColors.DarkOakBrown);this.AlternateHouse=new ColorWheel("AlternateHouse","Color",MyColors.TornadoSeason,MyColors.Yogi,MyColors.CherryCola,MyColors.Charismatic,MyColors.Camelot,MyColors.Spearmints);this.BrightModern=new ColorWheel("BrightModern","Color",MyColors.RoseQuartz,MyColors.PeachEcho,MyColors.Serenity,MyColors.SnorkelBlue,MyColors.Buttercup,MyColors.CandyPink);this.BrightModern2=new ColorWheel("BrightModern2","Color",MyColors.LimpetShell,MyColors.LilacGray,MyColors.Fiesta,MyColors.IcedCoffee,MyColors.GreenFlash,MyColors.Creamsicle);this.Nautical=new ColorWheel("Nautical","Color",MyColors.Aleutian,MyColors.Naval,MyColors.RenwickOlive,MyColors.CrabbyApple,MyColors.MorrisRoomGrey,MyColors.RoycroftPewter);this.ModernInterior=new ColorWheel("ModernInterior","Color",MyColors.BowString,MyColors.Celadon,MyColors.Coralette,MyColors.Stratus,MyColors.IvoryKeys,MyColors.Opus);this.Technology=new ColorWheel("Technology","Color",MyColors.White,MyColors.PaleGray,MyColors.Silver,MyColors.Gray,MyColors.DarkGray,MyColors.Black);this.Infographic1=new ColorWheel("Infographic1","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic2=new ColorWheel("Infographic2","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic3=new ColorWheel("Infographic3","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic4=new ColorWheel("Infographic4","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic5=new ColorWheel("Infographic5","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray);this.Infographic6=new ColorWheel("Infographic6","Color",MyColors.DarkTeal,MyColors.PoppyOrange,MyColors.AquaMarine,MyColors.RetroGreen,MyColors.RetroLightGray,MyColors.RetroDarkGray)};function SbtColors(){this.GreenKelly="rgb(0, 104, 56)";this.BlueBright="rgb(46, 49, 146)";this.RedShaded="rgb(181, 28, 28)";this.YellowLight="rgb(249, 220, 48)";this.OffWhite="rgb(227, 227, 227)";this.GreenArmy="rgb(115, 113, 68)";this.BlueGrey="rgb(128, 158, 173)";this.GreyMedium="rgb(63, 66, 68)";this.BrownLight="rgb(193, 172, 151)";this.BlueOcean="rgb(88, 101, 174)";this.PurplePlum="rgb(136, 63, 92)";this.RedRose="rgb(178, 42, 43)";this.GreenLeaf="rgb(93, 162, 80)";this.YellowButtercup="rgb(221, 211, 79)";this.BrownLeather="rgb(123, 83, 55)";this.GreySteel="rgb(94, 103, 119)";this.RedRust="rgb(109, 57, 57)";this.GreyGrey="rgb(68, 64, 57)";this.GreenMachine="rgb(70, 92, 73)";this.PurpleSil="rgb(92, 63, 137)";this.PaleTan="rgb(243, 223, 199)";this.PeachyTan="rgb(235, 195, 165)";this.Tan="rgb(211, 159, 111)";this.DarkTan="rgb(154, 105, 65)";this.SoftBrown="rgb(99, 70, 54)";this.Blonde="rgb(247, 204, 97)";this.MediumGrey="rgb(128, 128, 128)";this.BlueEye="rgb(65,95,122)";this.OliveGreen="rgb(102,102, 51)";this.HandBlue="rgb(133, 184, 212)";this.Parchment="rgb(226, 205, 156)";this.MutedYellow="rgb(255, 230, 128)";this.MutedGray="rgb(244, 245, 251)";this.PaleRed="rgb(254, 132, 132)";this.PaleBlue="rgb(167, 194, 252)";this.PaleGreen="rgb(117, 234, 117)";this.PaleYellow="rgb(252, 243, 159)";this.PaleGray="rgb(229, 229, 229)";this.PaleGrayBrown="rgb(204, 198, 194)";this.PaleBrown="rgb(226, 192, 161)";this.PaleViolet="rgb(210, 144, 252)";this.PaleOrange="rgb(249, 183, 138)";this.SbtPaleBlue="rgb(232, 245, 255)";this.LightRed="rgb(254, 77, 77)";this.LightBlue="rgb(85, 134, 245)";this.LightGreen="rgb(55, 196, 55)";this.LightYellow="rgb(255, 235,115)";this.LightGray="rgb(204, 204, 204)";this.LightBrown="rgb(198, 156, 109)";this.LightViolet="rgb(187, 90, 249)";this.BrightRed="rgb(254, 32, 32)";this.BrightBlue="rgb(66, 91, 211)";this.BrightGreen="rgb(7, 147, 7)";this.BrightYellow="rgb(255, 216, 0)";this.BrightGray="rgb(153, 153, 153)";this.BrightBrown="rgb(198, 156, 109)";this.BrightViolet="rgb(158, 60, 221)";this.BrightOrange="rgb(255, 133, 0)";this.White="rgb(255, 255, 255)";this.Black="rgb(0, 0, 0)";this.Orange="rgb(219, 101, 22)";this.Brown="rgb(141, 85, 53) ";this.Red="rgb(186, 0, 0)";this.Blue="rgb(47, 55, 147)";this.Green="rgb(8, 107, 8)";this.Yellow="rgb(255, 185, 0)";this.Gray="rgb(102, 102, 102)";this.Brown="rgb(117, 76, 36)";this.Violet="rgb(108, 29, 178)";this.SbtBlue="rgb(115, 158, 201)";this.DarkRed="rgb(107, 0, 0)";this.DarkBlue="rgb(32, 32, 102)";this.DarkGreen="rgb(2, 68, 2)";this.DarkYellow="rgb(237, 156, 15)";this.DarkGray="rgb(58, 58, 58)";this.DarkBrown="rgb(86, 48, 17)";this.DarkViolet="rgb(78, 4, 142)";this.DarkGrayViolet="rgb(39, 21, 40)";this.DarkGold="rgb(165, 108, 33)";this.SbtDarkBlue="rgb(36, 59, 83)";this.VeryDarkRed="rgb(58, 2, 2)";this.VeryDarkBlue="rgb(12, 12, 58)";this.VeryDarkGreen="rgb(0, 42, 0)";this.VeryDarkYellow="rgb(193, 113, 16)";this.VeryDarkBrown="rgb(66, 33, 11)";this.VeryDarkViolet="rgb(48, 0, 77)";this.VeryDarkGrayBlue="rgb(0, 39, 77)";this.VeryDarkGray="rgb(29, 29, 29)";this.VeryDarkOrange="rgb(165, 50, 10)";this.VeryDarkTeal="rgb(17, 49, 53)";this.SkyPaleBlue="rgb(210, 237, 245)";this.SkyLightBlue="rgb(170, 216, 232)";this.SkyBlue="rgb(87, 167, 195)";this.SkyCloudy="rgb(152, 167, 168)";this.SkyNight="rgb(14, 13, 63)";this.SkyDarkNight="rgb(4, 4, 30)";this.BrownGray="rgb(109,103,100)";this.BarnRed="rgb(191, 78, 73)";this.ButterYellow="rgb(252, 248, 217)";this.LightPavement="rgb(179, 179, 179)";this.Sand="rgb(181, 160, 140)";this.GrassPaleGreen="rgb(202, 214, 174)";this.GrassLightGreen="rgb(152, 174, 115)";this.GrassGreen="rgb(103, 146, 61)";this.GrassDarkGreen="rgb(64, 99, 36)";this.GrassVeryDarkGreen="rgb(35, 66, 14)";this.DarkPavement="rgb(77, 77, 77)";this.VeryDarkPavement="rgb(51, 51, 51)";this.LightWater="rgb(174, 208, 236)";this.Water="rgb(59, 107, 145)";this.Silver="rgb(196, 196, 196)";this.Pewter="rgb(86, 85, 85)";this.GoldCoin="rgb(195, 146, 46)";this.MutedGold="rgb(196, 191, 108)";this.BrightGold="rgb(251, 201, 38)";this.GreenMetal="rgb(99, 126, 119)";this.AvocadoGreen="rgb(111, 150, 72)";this.SunflowerYellow="rgb(229, 164, 48)";this.Aqua="rgb(111, 193, 187)";this.PumpkinOrange="rgb(224, 102, 40)";this.BubblegumPink="rgb(229, 101, 169)";this.DarkTeal="rgb(0, 144, 178)";this.PoppyOrange="rgb(255, 111, 76)";this.AquaMarine="rgb(100, 186, 183)";this.RetroGreen="rgb(211, 212, 56)";this.RetroLightGray="rgb(215, 213, 200)";this.RetroDarkGray="rgb(119, 119,117)";this.ArmyGreen="rgb(73, 76, 52)";this.DesertSage="rgb(167, 174, 158)";this.DriedHerb="rgb(132, 122, 89)";this.OakBuff="rgb(207, 156, 99)";this.Marsala="rgb(150, 79, 76)";this.StormyWeather="rgb(88, 100, 109)";this.ClassicBlue="rgb(29, 78, 137)";this.BiscayBay="rgb(9, 121, 136)";this.ReflectingPond="rgb(32, 62, 74)";this.CadmiumOrange="rgb(249, 148, 113)";this.CashmereRose="rgb(206, 135, 159)";this.AmethystOrchid="rgb(146, 106, 166)";this.ToastedAlmond="rgb(210, 178, 155)";this.Alabaster="rgb(235, 235, 223)";this.Aleutian="rgb(157, 170, 186)";this.AquaSphere="rgb(194, 205, 197)";this.BabyBrown="rgb(150, 95, 30)";this.BowString="rgb(214, 208, 201)";this.Buttercup="rgb(251, 227, 56)";this.Camelot="rgb(139, 144, 164)";this.CandyPink="rgb(224, 84, 123)";this.Celadon="rgb(185, 192, 185)";this.Charismatic="rgb(231, 193, 129)";this.CherryCola="rgb(117, 67, 66)";this.Coralette="rgb(240, 133, 116)";this.CrabbyApple="rgb(127, 41, 50)";this.Creamsicle="rgb(252, 172, 83)";this.DarkOakBrown="rgb(113, 54, 20)";this.ElectricTigerLily="rgb(234, 128, 0)";this.Fiesta="rgb(221, 68, 60)";this.GreenFlash="rgb(114, 204, 81)";this.Hemetite="rgb(33, 32, 30)";this.HotHotPink="rgb(183, 39, 104)";this.IcedCoffee="rgb(177, 143, 106)";this.IvoryKeys="rgb(243, 241, 233)";this.LilacGray="rgb(152, 150, 164)";this.LimpetShell="rgb(153, 221, 222)";this.MorrisRoomGrey="rgb(176, 168, 155)";this.MossyGlossGreen="rgb(109, 122, 42)";this.Naval="rgb(36, 53, 69)";this.NeonElectricLizard="rgb(111, 216, 9)";this.Opus="rgb(114, 103, 93)";this.PeachEcho="rgb(248, 120, 107)";this.PurpleHaze="rgb(156, 24, 232)";this.PurplePassage="rgb(102, 92, 119)";this.RenwickOlive="rgb(153, 140, 106)";this.RoseQuartz="rgb(248, 202, 202)";this.RoycroftPewter="rgb(87, 99, 97)";this.SailorBlue="rgb(46, 55, 70)";this.Serenity="rgb(145, 168, 209)";this.ShockingBlue="rgb(9, 19, 211)";this.SnorkelBlue="rgb(2, 77, 142)";this.Spearmints="rgb(188, 226, 203)";this.Stratus="rgb(128, 147, 171)";this.TempeStar="rgb(75, 97, 108)";this.TitaniumGrey="rgb(130, 127, 118)";this.TornadoSeason="rgb(77, 113, 122)";this.UrbanPutty="rgb(208, 193, 174)";this.Wildfire="rgb(206, 9, 9)";this.Yogi="rgb(138, 139, 103)"};function StoryboardSaveData(a){this.Length="";this.RawLength="";this.ShapeStates="";this.UrlTitle="";this.UserName="";this.MagicToken="";this.LayoutConfig=JSON.stringify(CellConfiguration.GetLayoutConfig());this.LayoutConfigLength=this.LayoutConfig.length;this.Title="";this.Description="";this.Svg=a;this.SaveDuration=+new Date();this.CharacterSwapLibrary="";this.CharacterSwapLibraryLength=""};function Vector(a,c,b,d){this.X1=a;this.Y1=c;this.X2=b;this.Y2=d};function BoxPosition(b,e,f,g,c,a,d){this.Height=b;this.Width=e;this.X=f;this.Y=g;this.Row=c;this.Col=a;this.StoryboardPartType=d};function SpiderCellLocation(d,a,b,c){this.Title=d;this.FakeCol=a;this.FakeRow=b;this.RowOffset=c};function CharacterLibrarySwappablePose(d,a,b,c){this._SwapOptions=new Object();this._ShapeId=d;this.GlobalImageId=a;this._SelectedSwapOption;this.PoseType=SbtDataEnum.PoseType_Swap;this.Title;this._AppendToId;this.Position=c;this.Private_ParseSwapOptions(b)}CharacterLibrarySwappablePose.prototype.Private_ParseSwapOptions=function(c){if(c==null){return}this.Title=GetSafeAttributeNS(c,SbtDataEnum.Attribute_SwapPose_Title);var a=GetSafeAttributeNS(c,SbtDataEnum.Attribute_SwapPose_DefaultId);this._AppendToId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_SwapPose_AppendToId);FindAndUpdateId(this._ShapeId,this._AppendToId,this.Public_GetAppendToId());for(var b=0;b<c.childElementCount;b++){var d=new Pose_CharacterLibrarySwapOption(this._ShapeId,this.GlobalImageId,GetIESafeChild(c,b),this.Position);this._SwapOptions[d.Public_GetInternalId()]=d}this.Public_SetActiveOption(this.Public_GetSwapOptionById(a));if(this.Public_GetActiveOption()==null){}};CharacterLibrarySwappablePose.prototype.Private_GetLocalId=function(a){return this._ShapeId+SbtDataEnum.Id_Swap_Middle+a};CharacterLibrarySwappablePose.prototype.Private_GetCopyId=function(b,a){return b._ShapeId+SbtDataEnum.Id_Swap_Middle+a};CharacterLibrarySwappablePose.prototype.Public_GetAppendToId=function(){return this.Private_GetLocalId(this._AppendToId)};CharacterLibrarySwappablePose.prototype.Public_GetSwapOptions=function(){return this._SwapOptions};CharacterLibrarySwappablePose.prototype.Public_GetSwapOptionById=function(a){return this._SwapOptions[a]};CharacterLibrarySwappablePose.prototype.Public_SetActiveOption=function(a){this._SelectedSwapOption=a};CharacterLibrarySwappablePose.prototype.Public_GetActiveOption=function(){return this._SelectedSwapOption};CharacterLibrarySwappablePose.prototype.Public_Copy=function(c){this.Title=c.Title;this._AppendToId=c._AppendToId;this.GlobalImageId=c.GlobalImageId;this.Position=c.Position;FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(c,c._AppendToId),this.Public_GetAppendToId());this._SelectedSwapOption=new Pose_CharacterLibrarySwapOption(this._ShapeId,this.GlobalImageId,null,this.Position);if(c._SelectedSwapOption!=null){c._SelectedSwapOption._Position=c._SelectedSwapOption._Position||this.Position;this._SelectedSwapOption.Public_Copy(c._SelectedSwapOption)}else{this._SelectedSwapOption._Position=this.Position;this._SelectedSwapOption._SwapId="";this._SelectedSwapOption._Title="";c._SelectedSwapOption=new Object();c._SelectedSwapOption._Position=this.Position}for(var b in c._SwapOptions){if(c._SwapOptions.hasOwnProperty(b)){try{var d=new Pose_CharacterLibrarySwapOption(this._ShapeId,this.GlobalImageId,null,this.Position);c._SwapOptions[b]._Position=c._SelectedSwapOption._Position||this.Position;d.Public_Copy(c._SwapOptions[b]);this._SwapOptions[b]=d}catch(a){LogErrorMessage("CharacterLibrarySwap.Public_Copy",a)}}}};function Pose_CharacterLibrarySwapOption(c,a,d,b){this._SwapId;this._Title;this._Position=b;this.Private_ParseSwapOption(c,d,a)}Pose_CharacterLibrarySwapOption.prototype.Private_ParseSwapOption=function(c,d,a){if(d==null){return}this._Title=GetSafeAttributeNS(d,SbtDataEnum.Attribute_SwapOption_Title);this._SwapId=GetSafeAttributeNS(d,SbtDataEnum.Attribute_SwapOption_SwapId);var b=$("#"+c).find("#"+this._SwapId).remove();if(b.length==0){return}b.attr("display","inline");RecursivelyUpdateChildrenIds(b,c,SbtDataEnum.Id_Storage);MyCharacterSwapLibrary.Public_SetSwap(a,this._Position,this._SwapId,b)};Pose_CharacterLibrarySwapOption.prototype.Public_GetPoseSvg=function(a){var b=MyCharacterSwapLibrary.Public_GetSwap(a,this._Position,this._SwapId);if(b==null){}return ParseRawSVG(b)};Pose_CharacterLibrarySwapOption.prototype.Public_GetInternalId=function(){return this._SwapId};Pose_CharacterLibrarySwapOption.prototype.Public_Copy=function(a){this._SwapId=a._SwapId;this._Title=a._Title;this._Position=a._Position};Pose_CharacterLibrarySwapOption.prototype.Public_GetTitle=function(){if(this._Title==null||this._Title==""){return MyLangMap.GetText("Cls-"+this._SwapId)}return this._Title};Pose_CharacterLibrarySwapOption.prototype.IsEqual=function(a){if(a==null){return false}if(this._Position!=a._Position){return false}if(this._SwapId!=a._SwapId){return false}return true};function GlobalLibrarySwappablePose(b,a){this._LibrarySwapOptions=new Object();this._ShapeId=b;this._SelectedLibraryOption;this.PoseType=SbtDataEnum.PoseType_LibrarySwap;this.Title;this._StartPointId;this._AppendToId;this.Private_ParseLibrarySwapOptions(a)}GlobalLibrarySwappablePose.prototype.Private_ParseLibrarySwapOptions=function(c){if(c==null){return}this.Title=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapOption_Title);var a=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapPose_DefaultId);this._StartPointId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapPose_StartPointId);this._AppendToId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_LibrarySwapPose_AppendToId);FindAndUpdateId(this._ShapeId,this._StartPointId,this.Public_GetStartPointToId());FindAndUpdateId(this._ShapeId,this._AppendToId,this.Public_GetAppendToId());for(var b=0;b<c.childElementCount;b++){var d=new Pose_GlobalLibrarySwapOption(GetIESafeChild(c,b));this._LibrarySwapOptions[d.LibrarySwapId]=d}this.Public_SetActiveOption(this.Public_GetLibrarySwapOptionById(a));if(this.Public_GetActiveOption()==null){}};GlobalLibrarySwappablePose.prototype.Private_GetLocalId=function(a){return this._ShapeId+SbtDataEnum.Id_GlobalLibrary_Middle+a};GlobalLibrarySwappablePose.prototype.Private_GetCopyId=function(b,a){return b._ShapeId+SbtDataEnum.Id_GlobalLibrary_Middle+a};GlobalLibrarySwappablePose.prototype.Public_GetAppendToId=function(){return this.Private_GetLocalId(this._AppendToId)};GlobalLibrarySwappablePose.prototype.Public_GetStartPointToId=function(){return this.Private_GetLocalId(this._StartPointId)};GlobalLibrarySwappablePose.prototype.Public_GetLibrarySwapOptions=function(){return this._LibrarySwapOptions};GlobalLibrarySwappablePose.prototype.Public_GetLibrarySwapOptionById=function(a){return this._LibrarySwapOptions[a]};GlobalLibrarySwappablePose.prototype.Public_SetActiveOption=function(a){this._SelectedLibraryOption=a};GlobalLibrarySwappablePose.prototype.Public_GetActiveOption=function(){return this._SelectedLibraryOption};GlobalLibrarySwappablePose.prototype.Public_Copy=function(b){this.Title=b.Title;this._StartPointId=b._StartPointId;this._AppendToId=b._AppendToId;FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._AppendToId),this.Public_GetAppendToId());FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._StartPointId),this.Public_GetStartPointToId());this._SelectedLibraryOption=new Pose_GlobalLibrarySwapOption(null);this._SelectedLibraryOption.Public_Copy(b._SelectedLibraryOption);for(var a in b._LibrarySwapOptions){if(b._LibrarySwapOptions.hasOwnProperty(a)){var c=new Pose_GlobalLibrarySwapOption(null);c.Public_Copy(b._LibrarySwapOptions[a]);this._LibrarySwapOptions[a]=c}}};function Pose_GlobalLibrarySwapOption(a){this.LibrarySwapId;this._Title;this.Private_ParseSwapOption(a)}Pose_GlobalLibrarySwapOption.prototype.Private_ParseSwapOption=function(a){if(a===null){return}this._Title=GetSafeAttributeNS(a,SbtDataEnum.Attribute_LibrarySwapOption_Title);this.LibrarySwapId=GetSafeAttributeNS(a,SbtDataEnum.Attribute_LibrarySwapOption_SwapId)};Pose_GlobalLibrarySwapOption.prototype.Public_Copy=function(a){this.LibrarySwapId=a.LibrarySwapId;this._Title=a._Title};Pose_GlobalLibrarySwapOption.prototype.Public_GetTitle=function(){if(this._Title===null||this._Title===""){var a=this.LibrarySwapId;a=a.replace("Basic-","").replace("Female2-","").replace("Female-","").replace("Male-","").replace("Asian-","").replace("Indian-","").replace("Kid-","");return MyLangMap.GetText("Gls-"+a)}return this._Title};Pose_GlobalLibrarySwapOption.prototype.Public_GetInternalId=function(){return this.LibrarySwapId};Pose_GlobalLibrarySwapOption.prototype.IsEqual=function(a){if(a===null){return false}if(this.LibrarySwapId!==a.LibrarySwapId){return false}return true};function Pose_TiltOption(b,a){this._Region;this.Degrees;this.Position;this.Private_ParseTiltOption(b,a)}Pose_TiltOption.prototype.Public_Copy=function(a){this.Degrees=a.Degrees;this._Region=a._Region;this.Position=a.Position};Pose_TiltOption.prototype.Public_GetTitle=function(){return MyLangMap.GetText("Tilt-"+this._Region+"-"+this.Position+"-"+this.Degrees)};Pose_TiltOption.prototype.Public_GetInternalId=function(){return this.Degrees};Pose_TiltOption.prototype.Private_ParseTiltOption=function(b,a){if(b==null){return}this._Region=a.Title;this.Degrees=GetSafeAttributeNS(b,SbtDataEnum.Attribute_TiltOption_Degree);this.Position=a.Position};Pose_TiltOption.prototype.IsEqual=function(a){if(a==null){return false}if(this._Region!=a._Region){return false}if(this.Position!=a.Position){return false}if(this.Degrees!=a.Degrees){return false}return true};function TiltablePose(c,a,b){this._TiltOptions=new Array();this._ShapeId=c;this.Position=b;this.PoseType=SbtDataEnum.PoseType_Tilt;this._TiltableId;this._Tiltable2Id;this._PivotId;this._ClearId;this.Title;this.Private_SelectedTiltOption;this.Private_ParseTiltOptions(a)}TiltablePose.prototype.Private_ParseTiltOptions=function(c){if(c==null){return}this.Title=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_Title);var a=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_DefaultTilt);this._ClearId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_ClearId);this._PivotId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_PivotId);this._TiltableId=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_TiltableId);this._Tiltable2Id=GetSafeAttributeNS(c,SbtDataEnum.Attribute_TiltPose_Tiltable2Id);FindAndUpdateId(this._ShapeId,this._PivotId,this.Public_GetPivotId());FindAndUpdateId(this._ShapeId,this._TiltableId,this.Public_GetTiltableId());FindAndUpdateId(this._ShapeId,this._Tiltable2Id,this.Public_GetTiltable2Id());for(var b=0;b<c.childElementCount;b++){this._TiltOptions[b]=new Pose_TiltOption(GetIESafeChild(c,b),this)}this.Private_SelectedTiltOption=this.Public_GetTiltOptionByDegrees(a)};TiltablePose.prototype.Public_GetTiltOptionByDegrees=function(a){for(var b=0;b<this._TiltOptions.length;b++){if(this._TiltOptions[b].Degrees==a){return this._TiltOptions[b]}}return null};TiltablePose.prototype.Private_GetLocalId=function(a){return this._ShapeId+"_TILT_"+a};TiltablePose.prototype.Private_GetCopyId=function(b,a){return b._ShapeId+"_TILT_"+a};TiltablePose.prototype.Public_GetTiltableId=function(){return this.Private_GetLocalId(this._TiltableId)};TiltablePose.prototype.Public_GetTiltable2Id=function(){if(this._Tiltable2Id==null||this._Tiltable2Id==""){return null}return this.Private_GetLocalId(this._Tiltable2Id)};TiltablePose.prototype.Public_GetPivotId=function(){return this.Private_GetLocalId(this._PivotId)};TiltablePose.prototype.Public_GetClearId=function(){return this._ClearId};TiltablePose.prototype.Public_GetTiltOptions=function(){return this._TiltOptions};TiltablePose.prototype.Public_Copy=function(b){this.Title=b.Title;this.Public_DefaultTilt=b.Public_DefaultTilt;this._TiltableId=b._TiltableId;this._Tiltable2Id=b._Tiltable2Id;this._PivotId=b._PivotId;this._ClearId=b._ClearId;this.Position=b.Position;FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._PivotId),this.Public_GetPivotId());FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._TiltableId),this.Public_GetTiltableId());FindAndUpdateId(this._ShapeId,this.Private_GetCopyId(b,b._Tiltable2Id),this.Public_GetTiltable2Id());this.Private_SelectedTiltOption=new Pose_TiltOption(null);if(b.Private_SelectedTiltOption==null){b.Private_SelectedTiltOption=new Pose_TiltOption(null)}b.Private_SelectedTiltOption.Position=b.Private_SelectedTiltOption.Position||b.Position;this.Private_SelectedTiltOption.Public_Copy(b.Private_SelectedTiltOption);for(var a=0;a<b._TiltOptions.length;a++){var c=new Pose_TiltOption(null,null);b._TiltOptions[a].Position=b._TiltOptions[a].Position||b.Position;c.Public_Copy(b._TiltOptions[a]);this._TiltOptions[a]=c}};TiltablePose.prototype.Public_GetActiveOption=function(){return this.Private_SelectedTiltOption};TiltablePose.prototype.Public_SetActiveOption=function(a){this.Private_SelectedTiltOption=a};function SmartSceneItem(){this.Title="";this.SmartSceneItemOptions=[]}SmartSceneItem.prototype.ParseMetaData=function(d,f,a){this.Title=GetSafeAttributeNS(f,SbtDataEnum.Attribute_SmartSceneItemOption_Title);var h=$(f).find(SbtDataEnum.MetaData_SmartSceneItemOption);for(var c=0;c<h.length;c++){try{var g=new SmartSceneItemOption(d,a);g.ParseMetaData(h[c]);this.SmartSceneItemOptions.push(g)}catch(b){LogErrorMessage("SmartSceneItem._ParseMetaData:  ",b)}}};SmartSceneItem.prototype.GetActiveSceneIndex=function(){for(var a=0;a<this.SmartSceneItemOptions.length;a++){if(this.SmartSceneItemOptions[a].IsActive){return a}}return 0};SmartSceneItem.prototype.ActivateSceneOption=function(b){for(var a=0;a<this.SmartSceneItemOptions.length;a++){this.SmartSceneItemOptions[a].IsActive=false}this.SmartSceneItemOptions[b].Activate()};SmartSceneItem.prototype.CopySmartSceneItem=function(c,d,a){this.Title=c.Title;for(var b=0;b<c.SmartSceneItemOptions.length;b++){var e=new SmartSceneItemOption(d,a);e.CopySmartSceneItemOption(c.SmartSceneItemOptions[b]);this.SmartSceneItemOptions.push(e)}};SmartSceneItem.prototype.GetTitle=function(){var a=MyLangMap.GetText("ST-"+this.Title);if(a===""){return this.Title}return a};function SmartSceneItemOption(b,a){this.Title="";this._TurnOn=[];this._TurnOff=[];this._ColorableState=a;this._ColorRegions=[];this.IsActive=false;this._ShapeId=b}SmartSceneItemOption.prototype.ParseMetaData=function(g){this.Title=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_Title);var j=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_TurnOn);var h=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_TurnOff);var d=GetSafeAttributeNS(g,SbtDataEnum.Attribute_SmartSceneItemOption_Default);if(d!=null&&d.toLowerCase()=="true"){this.IsActive=true}this._TurnOn=this._ParseAndUpdateIds(this._ShapeId,this._ShapeId+"-",j);this._TurnOff=this._ParseAndUpdateIds(this._ShapeId,this._ShapeId+"-",h);var b=$(g).find(SbtDataEnum.MetaData_SmartSceneItemOptionColor);for(var c=0;c<b.length;c++){var e=GetSafeAttributeNS(b[c],SbtDataEnum.Attribute_SmartSceneItemOptionColor_Region);var f=GetSafeAttributeNS(b[c],SbtDataEnum.Attribute_SmartSceneItemOptionColor_ReplaceColor);var a={Region:e,ReplaceColor:f};this._ColorRegions.push(a)}};SmartSceneItemOption.prototype.Activate=function(){this._UpdateDisplayForIds(this._TurnOn,"inline");this._UpdateDisplayForIds(this._TurnOff,"none");this.IsActive=true;if(this._ColorableState!=null&&this._ColorRegions.length>0){for(var a=0;a<this._ColorRegions.length;a++){this._ColorableState.Public_UpdateColorForRegion(this._ColorRegions[a].Region,this._ColorRegions[a].ReplaceColor,false)}}};SmartSceneItemOption.prototype._UpdateDisplayForIds=function(c,a){for(var b=0;b<c.length;b++){$("#"+c[b]).attr("display",a)}};SmartSceneItemOption.prototype._ParseAndUpdateIds=function(a,f,c){var g=c.split(",");var e=[];for(var b=0;b<g.length;b++){var h=g[b].trim();var d=f+h;FindAndUpdateId(a,h,d);e.push(d)}return e};SmartSceneItemOption.prototype.CopySmartSceneItemOption=function(e){this.Title=e.Title;this.IsActive=e.IsActive;for(var b=0;b<e._TurnOn.length;b++){var d=e._TurnOn[b];var c=d.replace(e._ShapeId,this._ShapeId);FindAndUpdateId(this._ShapeId,d,c);this._TurnOn.push(c)}for(var b=0;b<e._TurnOff.length;b++){var d=e._TurnOff[b];var c=d.replace(e._ShapeId,this._ShapeId);FindAndUpdateId(this._ShapeId,d,c);this._TurnOff.push(c)}for(var b=0;b<e._ColorRegions.length;b++){var a={Region:e._ColorRegions[b].Region,ReplaceColor:e._ColorRegions[b].ReplaceColor};this._ColorRegions.push(a)}};SmartSceneItemOption.prototype.GetTitle=function(){var a=MyLangMap.GetText("ST-"+this.Title);if(a==""){return this.Title}return a};function CharacterPosistionLibrary(){this.Private_Library=new Object();this.Private_Populate=function(){};this.GetCharacterPositions=function(b,a){if(this.Private_Library.hasOwnProperty(b)){a(this.Private_Library[b]);return}this.Private_LoadCharacter(b,a)};this.GetCharacterPosition=function(a,c){if(this.Private_Library.hasOwnProperty(a)==false){return null}for(var b=0;b<this.Private_Library[a].length;b++){var d=this.Private_Library[a][b];if(d==null){continue}if(d.Position==c){return this.Private_Library[a][b]}}return null};this.Private_LoadCharacter=function(c,a){var b=this;$.ajax({timeout:120*1000,url:CreatorUrls.CharacterPositions+"?guid="+c+"&time="+TimeStamp,error:function(e,f,d){a(null)},success:function(f,d){b.Private_Library[c]=new Array();if(f==null){b.Private_Library[c]=null;a(null);return}for(var e=0;e<f.length;e++){b.Private_Library[c][f[e].Order]=f[e]}a(b.Private_Library[c])},cache:false})};this.Private_Populate()};function CharacterSwapLibrary(a){this.Private_Library=new Object();this.Private_XmlSerializer=new XMLSerializer();this.Private_ClearUnused=function(f){var d=new Array();var b=new Array();var g=f.Public_GetAllMovableShapeStates(false);for(var c=0;c<g.length;c++){d.push(g[c].GlobalImageId)}for(var e in this.Private_Library){if(this.Private_Library.hasOwnProperty(e)){if(SbtLib.IndexOf(d,e)<0){b.push(e)}}}for(c=0;c<b.length;c++){this.Private_Library[b[c]]=null}};this.Private_HandleLoad=function(b){if(b==null){return}this.Private_Library=b};this.Public_SetSwap=function(b,f,d,e){if(this.Private_Library[b]==null){this.Private_Library[b]=new Object()}if(this.Private_Library[b][f]==null){this.Private_Library[b][f]=new Object()}var c=this.Private_XmlSerializer.serializeToString(e[0]);this.Private_Library[b][f][d]=c};this.Public_GetSwap=function(b,f,d){try{return this.Private_Library[b][f][d]}catch(c){}};this.Public_GetJSON=function(b){this.Private_ClearUnused(b);return JSON.stringify(this.Private_Library)};this.Private_HandleLoad(a)};function GlobalSwapLibrary(){this.Private_Library=new Object();this.Private_LoadLibrary=function(){this.Private_ParseGlobalLibrary(SbtDataEnum.GlobalLibraryFacesFrontId,"Front");this.Private_ParseGlobalLibrary(SbtDataEnum.GlobalLibraryFacesSideId,"Side");$("#global_library_load").remove()};this.Private_ParseGlobalLibrary=function(c,f){this.Private_Library[f]=new Object();MyShapeMetaData.LookForMetaData(c);var b=$("#"+c);var e=$("#"+c).find("sbtdata");var g=e.find("swaplibrary");var k=g.find("swaplibraryoption");b.attr("display","inline");for(var a=0;a<k.length;a++){var j=k[a];var h=GetSafeAttributeNS(j,SbtDataEnum.Attribute_LibrarySwapOption_SwapId);var d=b.find("#"+h).remove();this.Private_Library[f][h]=d}};this.Public_GetSvgById=function(a,b){if(b==null){b="Front"}return this.Private_Library[b][a]};this.Private_LoadLibrary()};function ColorableState(a){this.Private_Colorable=false;this.Private_ShapeId=a;this.Regions=new Object();this.Titles=new Object();this.Private_ParseMetaData()}ColorableState.prototype.Property_IsColorable=function(){return this.Private_Colorable};ColorableState.prototype.Public_GetColorWheelForRegion=function(a){a=MyColorWheels.SanitizeColor(a);return MyColorWheels[a]};ColorableState.prototype.Public_GetColorForRegion=function(a){return this.Regions[a]};ColorableState.prototype.Public_GetTitleForRegion=function(c){try{if(this.Titles==undefined||this.Titles==null){return""}var d=this.Titles[c];if(d==null||d==undefined){return""}var b=MyLangMap.GetText("ST-"+d);if(b!=""){return b}return d}catch(a){return""}return""};ColorableState.prototype.Public_GetRegionList=function(){var a=new Array();$.each(this.Regions,function(b,c){a.push(b)});return a};ColorableState.prototype.Public_ResetColors=function(){var b=this.Public_GetRegionList();for(var a=0;a<b.length;a++){this.Public_UpdateColorForRegion(b[a],this.Public_GetColorForRegion(b[a]))}};ColorableState.prototype.Public_UpdateColorForRegion=function(c,b,a){this.Private_UpdateColorForRegion(c,b,a)};ColorableState.prototype.Public_GetColorStyles=function(){var b=new Object();if(this.Regions==null||this.Regions.length==0){return null}$.each(this.Regions,function(c,d){b[c]=d});var a=new Object();a.Regions=b;return a};ColorableState.prototype.Public_CopyColorStyles=function(a){this.Regions=a.Regions;this.Public_ResetColors()};ColorableState.prototype.Public_Copy=function(f){if(f==undefined||f==null){this.Private_Colorable=false;return}this.Private_Colorable=f.Private_Colorable;var d=new Object();$.each(f.Regions,function(e,h){d[e]=h});this.Regions=d;try{var g=new Object();if(f.Titles!=null&&f.Titles!=undefined){$.each(f.Titles,function(e,h){g[e]=h})}this.Titles=g}catch(a){}var c=this.Public_GetRegionList();for(var b=0;b<c.length;b++){this.Private_UpdateRegionIds(c[b])}this.Public_ResetColors()};ColorableState.prototype.Private_HasColor=function(a){if(this.Regions==undefined||this.Regions==null){return false}if(this.Regions[a]==undefined||this.Regions[a]==null){return false}return true};ColorableState.prototype.Public_HandlePositionSwap=function(){this.Private_ParseMetaData();this.Public_ResetColors()};ColorableState.prototype.Private_ParseMetaData=function(){var c=$("#"+this.Private_ShapeId).find("sbtdata");if(c.length==0){return}var a=c.find("colorable");for(var b=0;b<a.length;b++){this.Private_Colorable=true;var d=GetSafeAttributeNS(a[b],"Region");var e=GetSafeAttributeNS(a[b],"ReplaceColor");var f=GetSafeAttributeNS(a[b],"SpecialTitle");if(this.Private_HasColor(d)==false){this.Private_UpdateRegionColor(d,e)}this.Private_UpdateRegionTitle(d,f);this.Private_UpdateRegionIds(d)}};ColorableState.prototype.Private_GetBaseRegionId=function(a){return a+"_"+this.Private_ShapeId+"_"};ColorableState.prototype.Private_UpdateRegionIds=function(d){var a='[id^="'+d+'_"]';var e=$("#"+this.Private_ShapeId).find(a);for(var b=0;b<e.length;b++){var c=this.Private_GetBaseRegionId(d)+b;e[b].setAttributeNS(null,"id",c)}};ColorableState.prototype.Private_UpdateColorForRegion=function(g,f,d){try{var b="[id^="+this.Private_GetBaseRegionId(g)+"]";var h=$(b);for(var c=0;c<h.length;c++){h[c].setAttributeNS(null,"fill",f)}if(d===false){this.Private_UpdateRegionColor(g,f)}}catch(a){LogErrorMessage("ColorableState.Private_UpdateColorForRegion",a)}};ColorableState.prototype.Private_UpdateRegionColor=function(b,a){this.Regions[b]=a};ColorableState.prototype.Private_UpdateRegionTitle=function(a,b){this.Titles[a]=b};function ImageAttribution(a){this.HasAttribution=false;this.Title="";this.Author="";this.ImageUrl="";this.License="";this.PhotoId="";if(a==undefined||a==null||a.length==0){return}this.HasAttribution=true;this.Title=a.getAttribute("title");this.Author=a.getAttribute("author");this.ImageUrl=a.getAttribute("imageurl");this.License=a.getAttribute("license");this.PhotoId=a.getAttribute("photoid")};function PosableState(b,a,c){this.Private_ShapeId=b;this.Private_GlobalImageId=a;this.Position=c;this.Private_PreviousPoseList;this.Private_PoseGroups=new Array();this.Private_HandleLoad()}PosableState.prototype.Private_HandleLoad=function(){this.Private_ParseMetaData();this.Private_LoadDefaults()};PosableState.prototype.Private_LoadDefaults=function(){for(var a=0;a<this.Private_PoseGroups.length;a++){var b=this.Private_PoseGroups[a];if(b.PoseType==SbtDataEnum.PoseType_Swap){var c=b.Public_GetActiveOption();this.Private_CharacterLibrarySwap(b,c)}if(b.PoseType==SbtDataEnum.PoseType_Tilt){this.Private_TiltPose(b,b.Public_GetActiveOption())}if(b.PoseType==SbtDataEnum.PoseType_LibrarySwap){var c=b.Public_GetActiveOption();this.Private_GlobalLibrarySwap(b,c)}}};PosableState.prototype.Private_GlobalLibrarySwap=function(f,g){var c=MyGlobalSwapLibrary.Public_GetSvgById(g.LibrarySwapId,this.Position);if(c==null){}c=c.clone();var a=$("#"+f.Public_GetAppendToId());if(a.length==0){}a.children().remove();a.append(c);var e="gls_"+new Date().getTime();c.attr("id",e);RecursivelyUpdateChildrenIds(c,SbtDataEnum.GlobalLibraryId,this.Private_ShapeId);var d=GetGlobalById(e);var b=d.getBBox();var h=ExtractPositionPoint($("#"+f.Public_GetStartPointToId()));var i=h.X-b.x;var j=h.Y-b.y;c.attr("transform","translate("+i+", "+j+")")};PosableState.prototype.Private_ParseMetaData=function(){try{var c=$("#"+this.Private_ShapeId).find("sbtdata");var d=c.find(SbtDataEnum.MetaData_Posable);var h=d.find(SbtDataEnum.MetaData_Poses);for(var b=0;b<h.length;b++){var f=GetSafeAttributeNS(h[b],SbtDataEnum.Attribute_Pose_Type);var g=null;if(LowerCaseCompare(f,SbtDataEnum.PoseType_Tilt)){g=new TiltablePose(this.Private_ShapeId,h[b],this.Position)}else{if(LowerCaseCompare(f,SbtDataEnum.PoseType_Swap)){g=new CharacterLibrarySwappablePose(this.Private_ShapeId,this.Private_GlobalImageId,h[b],this.Position)}else{if(LowerCaseCompare(f,SbtDataEnum.PoseType_LibrarySwap)){g=new GlobalLibrarySwappablePose(this.Private_ShapeId,h[b],this.Position)}}}this.Private_PoseGroups.push(g)}}catch(a){LogErrorMessage("PosableState.Private_ParseMetaData GUID:  "+this.Private_GlobalImageId,a);throw a}};PosableState.prototype.Private_CharacterLibrarySwap=function(f,d){try{if(d==null){return}var b=d.Public_GetPoseSvg(f.GlobalImageId);RecursivelyUpdateChildrenIds(b,SbtDataEnum.Id_Storage,this.Private_ShapeId);var a=$("#"+f.Public_GetAppendToId());if(a.length==0){}a.children().remove();a.append(b)}catch(c){LogErrorMessage("PosableState.Private_CharacterLibrarySwap",c)}};PosableState.prototype.Private_TiltPose=function(h,i){try{var a=i.Degrees;var f=GetGlobalById(h.Public_GetTiltableId());var c=$("#"+h.Public_GetPivotId());var d=ExtractPositionPoint(c);if(a==null){return}if(c.length==0){LogErrorMessage("Unable to find pivot group: "+h.Public_GetTiltableId());return}f.setAttributeNS(null,"transform","rotate("+a+", "+d.X+", "+d.Y+")");if(h.Public_GetTiltable2Id()!=null){var g=GetGlobalById(h.Public_GetTiltable2Id());if(g!=null){g.setAttributeNS(null,"transform","rotate("+a+", "+d.X+", "+d.Y+")")}else{LogErrorMessage("Public_GetTiltable2Id: "+this.Private_GlobalImageId+" "+h.Public_GetTiltable2Id())}}}catch(b){LogErrorMessage("PosableState.Public_TiltPose",b);try{LogErrorMessage("PosableState.Public_TiltPose extra "+this.Private_GlobalImageId+" : "+i.Degrees,b);LogErrorMessage("PosableState.Public_TiltPose extra "+h.Public_GetTiltableId,b)}catch(b){}}};PosableState.prototype.Public_IsPosable=function(){return this.Private_PoseGroups.length>0};PosableState.prototype.Public_PoseGroups=function(){return this.Private_PoseGroups};PosableState.prototype.Public_GetPreviousPoseList=function(){return this.Private_PreviousPoseList};PosableState.prototype.Public_SetPreviousPoseList=function(a){this.Private_PreviousPoseList=a};PosableState.prototype.Public_UpdatePoseOption=function(a,b){a.Public_SetActiveOption(b);if(a.PoseType==SbtDataEnum.PoseType_Swap){this.Private_CharacterLibrarySwap(a,b)}else{if(a.PoseType==SbtDataEnum.PoseType_Tilt){this.Private_TiltPose(a,b)}else{if(a.PoseType==SbtDataEnum.PoseType_LibrarySwap){this.Private_GlobalLibrarySwap(a,b)}}}};PosableState.prototype.Public_Copy=function(c){if(c==undefined||c==null){return}this.Private_GlobalImageId=c.Private_GlobalImageId;this.Position=c.Position;for(var a=0;a<c.Private_PoseGroups.length;a++){var d=c.Private_PoseGroups[a];d.Position=d.Position||c.Position;var b=null;if(d.PoseType==SbtDataEnum.PoseType_Tilt){b=new TiltablePose(this.Private_ShapeId,null)}else{if(d.PoseType==SbtDataEnum.PoseType_Swap){b=new CharacterLibrarySwappablePose(this.Private_ShapeId,this.Private_GlobalImageId,null,c.Position)}else{if(d.PoseType==SbtDataEnum.PoseType_LibrarySwap){b=new GlobalLibrarySwappablePose(this.Private_ShapeId,null)}}}b.Public_Copy(d);this.Private_PoseGroups.push(b)}};PosableState.prototype.Private_FindPoseAndOption=function(d,b){var c=new Object();for(var a=0;a<this.Private_PoseGroups.length;a++){c.PoseGroup=this.Private_PoseGroups[a];c.PoseOption=null;if(c.PoseGroup.PoseType==SbtDataEnum.PoseType_Tilt&&d==SbtDataEnum.PoseType_Tilt){c.PoseOption=c.PoseGroup.Public_GetTiltOptionByDegrees(b)}else{if(c.PoseGroup.PoseType==SbtDataEnum.PoseType_Swap&&d==SbtDataEnum.PoseType_Swap){c.PoseOption=c.PoseGroup.Public_GetSwapOptionById(b)}else{if(c.PoseGroup.PoseType==SbtDataEnum.PoseType_LibrarySwap&&d==SbtDataEnum.PoseType_LibrarySwap){c.PoseOption=c.PoseGroup.Public_GetLibrarySwapOptionById(b)}}}if(c.PoseOption!=null){return c}}return null};PosableState.prototype.Public_GetSafePoseArray=function(c){if(c==null){return null}var b=new Array();for(var a=0;a<c.length;a++){var d=this.Private_FindPoseAndOption(c[a].PoseType,c[a].PoseId);if(d!=null){b.push(d)}}return b};PosableState.prototype.Private_AddFaces=function(b,a){b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Male-Face-Crazy-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Female2-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Female2-Face-Crazy-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Kid-Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Kid-Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Basic-Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Basic-Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Asian-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Indian-Male-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_LibrarySwap,PoseId:"Indian-Female-Face-"+a});b.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"Face-"+a})};PosableState.prototype.Private_GetPoseAngry=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Mad");return a};PosableState.prototype.Private_GetPoseSpeaking=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"MouthOpen");return a};PosableState.prototype.Private_GetPoseExplaining=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"15"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"MouthOpen");return a};PosableState.prototype.Private_GetPoseSad=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"VerySad");return a};PosableState.prototype.Private_GetPoseSleeping=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"EyesClosed");return a};PosableState.prototype.Private_GetPoseComplaining=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"-15"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Mad");return a};PosableState.prototype.Private_GetPoseHolding=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hold"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseConfusion=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"-15"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Unsure");return a};PosableState.prototype.Private_GetPoseUpset=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Kneel"});this.Private_AddFaces(a,"VerySad");return a};PosableState.prototype.Private_GetPoseSit=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Sit"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseDetermined=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Mad");return a};PosableState.prototype.Private_GetPoseHappy=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Down"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseWalking=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Across"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Hips"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Walk"});this.Private_AddFaces(a,"Happy");return a};PosableState.prototype.Private_GetPoseShouting=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Stand"});this.Private_AddFaces(a,"MouthOpen");return a};PosableState.prototype.Private_GetPoseScared=function(){var a=new Array();a.push({PoseType:SbtDataEnum.PoseType_Tilt,PoseId:"0"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"LA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"RA-Face"});a.push({PoseType:SbtDataEnum.PoseType_Swap,PoseId:"L-Nervous"});this.Private_AddFaces(a,"Shocked");return a};PosableState.prototype.Public_GetPose=function(a){switch(a){case InstaPoseEnum.Angry:return this.Private_GetPoseAngry();case InstaPoseEnum.Speaking:return this.Private_GetPoseSpeaking();case InstaPoseEnum.Explaining:return this.Private_GetPoseExplaining();case InstaPoseEnum.Sad:return this.Private_GetPoseSad();case InstaPoseEnum.Sleeping:return this.Private_GetPoseSleeping();case InstaPoseEnum.Complaining:return this.Private_GetPoseComplaining();case InstaPoseEnum.Holding:return this.Private_GetPoseHolding();case InstaPoseEnum.Confusion:return this.Private_GetPoseConfusion();case InstaPoseEnum.Upset:return this.Private_GetPoseUpset();case InstaPoseEnum.Sit:return this.Private_GetPoseSit();case InstaPoseEnum.Determined:return this.Private_GetPoseDetermined();case InstaPoseEnum.Happy:return this.Private_GetPoseHappy();case InstaPoseEnum.Walking:return this.Private_GetPoseWalking();case InstaPoseEnum.Shouting:return this.Private_GetPoseShouting();case InstaPoseEnum.Scared:return this.Private_GetPoseScared()}return null};function ShapesState(){this.Private_CurrentShapeAction=ShapeActionEnum.Nothing;this.Private_SelectedShapes=new Array();this.Private_ShapeStates=new Object()}ShapesState.Public_ZSortShapeStates=function(a){a.sort(function(c,e){var d=$("g").index($("#"+c.Id));var f=$("g").index($("#"+e.Id));return parseInt(d-f)});return a};ShapesState.prototype.Property_SetCurrentShapeAction=function(a){this.Private_CurrentShapeAction=a};ShapesState.prototype.Property_GetCurrentShapeAction=function(){return this.Private_CurrentShapeAction};ShapesState.prototype.Property_SelectedCount=function(){return this.Private_SelectedShapes.length};ShapesState.prototype.Property_GetShapeStatesCount=function(){var b=0;try{for(shapeStateId in this.Private_ShapeStates){if(shapeStateId!=null){var c=this.Public_GetShapeStateById(shapeStateId);if(c!=null&&c.Movable){b++}if(c.Movable==false&&c.TextState!=null){if(c.TextState.D[c.TextState.CurrentId].DefaultText!=c.TextState.D[c.TextState.CurrentId].Text){b++}}}}}catch(a){LogErrorMessage("ShapesState.Property_GetShapeStatesCount",a)}return b};ShapesState.prototype.Public_GetImageAttributions=function(){var b=this.Public_GetAllShapeStates();var a=new Object();for(var c=0;c<b.length;c++){var d=b[c];if(d.ImageAttribution!=null&&d.ImageAttribution.HasAttribution){a[d.ImageAttribution.PhotoId]=d.ImageAttribution}}return a};ShapesState.prototype.Public_GetFirstSelectedShapeState=function(){if(this.Property_SelectedCount()==0){return null}var c=this.Public_GetFirstSelectedShape().attr("id");var b=this.Public_GetShapeStateById(c);if(b==null){if(c==null){LogErrorMessage("ShapeState.Public_GetFirstSelectedShapeState: firstSelectedShape is null & id is null")}else{$("#"+c).remove();swalQueue({title:MyLangMap.GetText("warning-title-uh-oh"),text:MyLangMap.GetText("warning-corrupted-image"),type:"warning",confirmButtonText:MyLangMap.GetText("warning-ok-button")});MyShapesState.Public_ClearAllSelectedShapes();LogErrorMessage("ShapeState.Public_GetFirstSelectedShapeState: firstSelectedShape is null & ID is "+c+" total shapes state: "+this.Property_GetShapeStatesCount());try{var d="";for(shapeState in this.Private_ShapeStates){d+=shapeState+", "}LogErrorMessage("ShapeState.Public_GetFirstSelectedShapeState: Known Shape States: "+d)}catch(a){}}}return b};ShapesState.prototype.Public_ClearDefaults=function(){this.Private_ClearUnusedShapes();for(var a in this.Private_ShapeStates){if(a===null){continue}a=this.Public_GetShapeStateById(a);a.Public_ClearDefaults()}};ShapesState.prototype.Public_GetAllShapeStates=function(){var a=new Array();for(var b in this.Private_ShapeStates){if(b===null){continue}b=this.Public_GetShapeStateById(b);a.push(b)}return a};ShapesState.prototype.Public_GetAllMovableShapeStates=function(a){a=(typeof a!=="undefined")?a:false;var e=this.Public_GetAllShapeStates();var c=new Array();for(var b=0;b<e.length;b++){var d=e[b];if(d==null){continue}if(a){if(d.IsLocked==true){continue}}if(d.Movable==false){continue}c.push(d)}return c};ShapesState.prototype.Public_GetAllSelectedShapeStates=function(){var c=new Array();if(this.Property_SelectedCount()==0){return c}for(var a=0;a<this.Private_SelectedShapes.length;a++){var b=this.Private_SelectedShapes[a].attr("id");c.push(this.Private_ShapeStates[b])}return c};ShapesState.prototype.Public_GetAllSelectedMovableShapeStates=function(a){a=(typeof a!=="undefined")?a:false;var d=new Array();if(this.Property_SelectedCount()==0){return d}for(var b=0;b<this.Private_SelectedShapes.length;b++){var c=this.Private_SelectedShapes[b].attr("id");if(a){if(this.Private_ShapeStates[c].IsLocked==true){continue}}if(this.Private_ShapeStates[c].Movable==false){continue}d.push(this.Private_ShapeStates[c])}return d};ShapesState.prototype.Public_GetShapeStateByShape=function(a){return this.Public_GetShapeStateById(a.attr("id"))};ShapesState.prototype.Public_GetShapeStateById=function(a){return this.Private_ShapeStates[a]};ShapesState.prototype.Public_RemoveShapeStateById=function(a){this.Public_UnselectShape($("#"+a));delete this.Private_ShapeStates[a]};ShapesState.prototype.Public_LoadShapeStatesFromJson=function(a){this.Private_ShapeStates=JSON.parse(a)};ShapesState.prototype.Public_SetShapeState=function(a,b){this.Private_ShapeStates[a]=b};ShapesState.prototype.Public_ResetShapeStates=function(){this.Private_ShapeStates=new Object()};ShapesState.prototype.Private_ClearUnusedShapes=function(){var c=[];for(id in MyShapesState.Private_ShapeStates){try{var b=$("#"+id);if(b.length==0){c.push(id);continue}}catch(a){LogErrorMessage("ShapeStates.Public_ClearUnusedShapes",a)}}for(i=0;i<c.length;i++){this.Public_RemoveShapeStateById(c[i])}};ShapesState.prototype.Public_ShapeStateToJson=function(){this.Private_ClearUnusedShapes();var b=JSON.stringify(this.Private_ShapeStates,function a(c,d){if(c=="_SnapshotStateData"){return undefined}if(c=="Private_PreviousPoseList"){return undefined}if(c=="_TextStateDataProperties"){return undefined}if(c=="_SvgStateProperties"){return undefined}return d});return b};ShapesState.prototype.Public_GetFirstSelectedShape=function(){if(this.Property_SelectedCount()==0){return null}return this.Private_SelectedShapes[0]};ShapesState.prototype.Public_GetAllSelectedShapes=function(){return this.Private_SelectedShapes};ShapesState.prototype.Public_ClearAllSelectedShapes=function(){var b=this.Public_GetAllSelectedShapeStates();if(b!=null){for(var a=0;a<b.length;a++){if(b[a]!=null){b[a].SetActive(false);b[a].UpdateDrawing()}}}this.Private_SelectedShapes=new Array();this.Private_CurrentShapeAction=ShapeActionEnum.Nothing};ShapesState.prototype.Public_UpdateSingleShapeAndAction=function(b,a){this.Public_ClearAllSelectedShapes();this.Public_SelectShape(b);this.Property_SetCurrentShapeAction(a)};ShapesState.prototype.Public_SelectShape=function(a){if(this.Public_ShapeSelected(a)==false){this.Private_SelectedShapes.push(a)}var b=this.Public_GetShapeStateByShape(a);if(b!=null){b.SetActive(true)}};ShapesState.prototype.Public_ShapeSelected=function(a){return(this.Private_GetShapeIndex(a)>=0)};ShapesState.prototype.Public_UnselectShape=function(b){var c=this.Public_GetShapeStateByShape(b);if(c!=null){c.SetActive(false)}var a=this.Private_GetShapeIndex(b);if(a<0){return}this.Private_SelectedShapes.splice(a,1)};ShapesState.prototype.Private_GetShapeIndex=function(c){var b=c.attr("id");for(var a=0;a<this.Private_SelectedShapes.length;a++){if(b===this.Private_SelectedShapes[a].attr("id")){return a}}return -1};function SmartSceneState(a){this._ShapeId=a;this.SmartSceneItems=[]}SmartSceneState.prototype.IsSmartScene=function(){return this.SmartSceneItems.length>0};SmartSceneState.prototype.GetSelectedSceneOptions=function(){var b=[];for(var a=0;a<this.SmartSceneItems.length;a++){b.push(this.SmartSceneItems[a].GetActiveSceneIndex())}return b};SmartSceneState.prototype.SetSelectedSceneOptions=function(b){if(b.length!=this.SmartSceneItems.length){return}for(var a=0;a<this.SmartSceneItems.length;a++){this.SmartSceneItems[a].ActivateSceneOption(b[a])}};SmartSceneState.prototype.ParseMetaData=function(a){try{var d=$("#"+this._ShapeId).find("sbtdata");if(d==null||d.length==0){return}var f=d.find(SbtDataEnum.MetaData_SmartScene);var h=f.find(SbtDataEnum.MetaData_SmartSceneItem);for(var c=0;c<h.length;c++){var g=new SmartSceneItem();g.ParseMetaData(this._ShapeId,h[c],a);this.SmartSceneItems.push(g)}}catch(b){LogErrorMessage("SmartSceneState._ParseMetaData:  ",b);throw b}};SmartSceneState.prototype.CopySmartSceneState=function(c,a){if(c==undefined||c==null){return}for(var b=0;b<c.SmartSceneItems.length;b++){var d=new SmartSceneItem();d.CopySmartSceneItem(c.SmartSceneItems[b],this._ShapeId,a);this.SmartSceneItems.push(d)}};function SpringableState(a){this._ShapeId=a;this.IsSpringable=false;this.Anchors=new Object();this.Anchors.Right=[];this.Anchors.Bottom=[];this.Springs=new Object();this.Springs.Horizontal=[];this.Springs.Vertical=[]}SpringableState.prototype.ParseMetaData=function(){var b=$("#"+this._ShapeId).find("sbtdata");if(b.length==0){return}var a=b.find(SbtDataEnum.MetaData_Springable_Anchorset);var c=b.find(SbtDataEnum.MetaData_Springable_SpringSet);if(a.length==0||c.length==0){return}this._ParseMetaData_ExtractItems(a,this.Anchors,SbtDataEnum.MetaData_Springable_Attribute_Side);this._ParseMetaData_ExtractItems(c,this.Springs,SbtDataEnum.MetaData_Springable_Attribute_Direction);this.IsSpringable=true};SpringableState.prototype._ParseMetaData_ExtractItems=function(e,d,b){for(var c=0;c<e.length;c++){var f=GetSafeAttributeNS(e[c],b);var a=GetSafeAttributeNS(e[c],SbtDataEnum.MetaData_Springable_Attribute_Groups);if(f==null||a==null||a==""){continue}f=f.toLowerCase().CapitalizeFirstLetter();d[f]=StoryboardCreatorLibrary.ParseAndUpdateIds(this._ShapeId,this._ShapeId+"-spring-",a)}};SpringableState.prototype.CopySpringableState=function(a,b){if(a==undefined||a==null){return}this.IsSpringable=a.IsSpringable;this._UpdateIdsInArray(this.Anchors.Right,a.Anchors.Right,a._ShapeId);this._UpdateIdsInArray(this.Anchors.Bottom,a.Anchors.Bottom,a._ShapeId);this._UpdateIdsInArray(this.Springs.Horizontal,a.Springs.Horizontal,a._ShapeId);this._UpdateIdsInArray(this.Springs.Vertical,a.Springs.Vertical,a._ShapeId)};SpringableState.prototype._UpdateIdsInArray=function(b,a,f){for(var c=0;c<a.length;c++){var e=a[c];var d=e.replace(f,this._ShapeId);FindAndUpdateId(this._ShapeId,e,d);b.push(d)}};SpringableState.prototype.GetSpringStateTransforms=function(){var c=[];c=c.concat(this.Anchors.Right);c=c.concat(this.Anchors.Bottom);c=c.concat(this.Springs.Horizontal);c=c.concat(this.Springs.Vertical);var d=[];for(var a=0;a<c.length;a++){var b=new Object();b.Id=c[a];b.Transform=SvgCreator.GetTransform(b.Id);d.push(b)}return d};SpringableState.prototype.CanResizeVertical=function(){if(this.IsSpringable==false){return false}return this.Springs.Vertical.length>0};SpringableState.prototype.CanResizeHorizontal=function(){if(this.IsSpringable==false){return false}return this.Springs.Horizontal.length>0};function SvgState(a){this.Id=a;this.GlobalImageId;this.FlipHorizontal=false;this.FlipVertical=false;this.X=0;this.Y=0;this.ScaleX=1;this.ScaleY=1;this.SkewX=0;this.SkewY=0;this.Angle=0;this.NaturalOffsetX=0;this.NaturalOffsetY=0;this.isSceneItem=false;this.opacity=1;this.CropType=CropTypeEnum.Standard;this.UseClipping=false;this.ClipX=10;this.ClipY=10;this.ClipWidth=150;this.ClipHeight=100;this.CropPolygonPoint=[{x:0,y:0},{x:150,y:0},{x:150,y:100},{x:0,y:100}];this.CropPolygonPointJson="";this.CacheAddress=new Array();this.isGroupObject=false;this.groupShapeStates=[];this.nextShapeId=null;this.FilterColorMode="";this.IsLocked=false;this.Position="Front";this.Movable=true;this.TextState;this.ColorableState;this.PosableState;this.ImageAttribution;this.SmartSceneState;this.ActivelySelected=false;this.virtualSelected=false;this._SvgStateProperties=["Id","FlipHorizontal","FlipVertical","X","Y","ScaleX","ScaleY","Angle","opacity","NaturalOffsetX","NaturalOffsetY","UseClipping","ClipX","ClipY","ClipWidth","ClipHeight","FilterColorMode","IsLocked","ActivelySelected","Position","CropPolygonPointJson","CropType"];this._TextStateDataProperties=["Text","Font","FontSize","FontColor","TextAlignment","_QuillDeltas"];this._SnapshotStateData={};this.Private_Init()}SvgState.prototype.Public_IsSmartScene=function(){if(this.SmartSceneState==null){return false}return this.SmartSceneState.IsSmartScene()};SvgState.prototype.Property_ClippedOffsetX=function(){if(this.UseClipping==false){return 0}return(this.ClipX*this.ScaleX)};SvgState.prototype.Property_ClippedOffsetY=function(){if(this.UseClipping==false){return 0}return(this.ClipY*this.ScaleY)};SvgState.prototype.Private_Init=function(){var b=this.Private_GetElement("");var a=b.querySelector("sbtdata");if(a!=null){this.GlobalImageId=a.getAttribute(SbtDataEnum.AttributeGlobalImageId);this.Position=a.getAttribute(SbtDataEnum.MetaData_Position)||this.Position}this.TextState=new TextState(this.Id);this.ColorableState=new ColorableState(this.Id);this.PosableState=new PosableState(this.Id,this.GlobalImageId,this.Position);this.SmartSceneState=new SmartSceneState(this.Id);this.SmartSceneState.ParseMetaData(this.ColorableState);this.SpringableState=new SpringableState(this.Id);this.SpringableState.ParseMetaData();this.ImageAttribution=new ImageAttribution(b.querySelector("attribution"));this.Private_ClearMetaData()};SvgState.prototype.Property_VisibleX=function(){var a=this.X+this.Property_ClippedOffsetX();return a};SvgState.prototype.Property_VisibleY=function(){var a=this.Y+this.Property_ClippedOffsetY();return a};SvgState.prototype.IsTextable=function(){for(var a=0;a<this.TextState.D.length;a++){if(this.TextState.D[a].Textable){return true}}return false};SvgState.prototype.IsMultiTextable=function(){return this.TextState.D.length>1};SvgState.prototype.ChangeCharacterPosition=function(e){if(e==this.Position){return}var f=MyCharacterPosistionLibrary.GetCharacterPosition(this.GlobalImageId,e);var c=this.X;var d=this.Y;var a=this.Private_GetPointer(SvgPartsEnum.Natural);var f=MyCharacterPosistionLibrary.GetCharacterPosition(this.GlobalImageId,e);var c=this.X;var d=this.Y;var a=this.Private_GetPointer(SvgPartsEnum.Natural);var b=this.Private_GetElement(SvgPartsEnum.Natural);while(b.firstChild){b.removeChild(b.firstChild)}b.insertAdjacentHTML("afterbegin",f.Svg);b.querySelector("svg").setAttribute("id",this.Id+SvgPartsEnum.SvgImage);StoryboardContainer.UpdateGradientIds(a);MyShapeMetaData.LookForMetaData(this.Id);this.Position=f.Position;this.Private_ResetNaturalOffset();this.PosableState=new PosableState(this.Id,this.GlobalImageId,this.Position);this.ColorableState.Public_HandlePositionSwap();this.Private_ClearMetaData();this.X=c;this.Y=d;this.UpdateDrawing()};function GetParametersFromSVG(k,a){var l=k.getAttribute("transform");var f={X:0,Y:0,Angle:0,ScaleX:1,ScaleY:1,NaturalOffsetX:0,NaturalOffsetY:0,FlipHorizontal:false,FlipVertical:false};if(l!=null){var c=(l==null)?0:l.indexOf("translate");var b=(l==null)?0:l.indexOf("rotate");var e=l.substring(c+"translate".length,l.indexOf(")",c));var g=l.substring(b+"rotate".length,l.indexOf(")",b));e=SplitParenthesis(e);g=SplitParenthesis(g);f.X=Number(e[0]);f.Y=Number(e[1]);f.Angle=Number(g[0])}else{f.X=0;f.Y=0;f.Angle=0}var j=$(k).find("#"+a+SvgPartsEnum.Scale)[0];var h=j.getAttribute("transform");if(h!=null){h=h.replace("scale","");h=SplitParenthesis(h);if(Number(h[0])<0){f.FlipHorizontal=true}if(Number(h[1])<0){f.FlipVertical=true}f.ScaleX=Math.abs(Number(h[0]));f.ScaleY=Math.abs(Number(h[1]))}else{f.ScaleX=1;f.ScaleY=1}f.NaturalOffsetX=0;f.NaturalOffsetY=0;var d=$(k).find("#"+a+SvgPartsEnum.Natural)[0];var m=d.getAttribute("transform");m=m.replace("translate","");m=SplitParenthesis(m);f.NaturalOffsetX=-1*Number(m[0]);f.NaturalOffsetY=-1*Number(m[1]);f.NaturalOffsetX=isNaN(f.NaturalOffsetX)?0:f.NaturalOffsetX;f.NaturalOffsetY=isNaN(f.NaturalOffsetY)?0:f.NaturalOffsetY;return f}SvgState.prototype.Public_RecreateFromOrphan=function(){try{var c=this.Private_GetElement("");var b=GetParametersFromSVG(c,thisId);this.X=b.X;this.Y=b.Y;this.Angle=b.Angle;this.ScaleX=b.ScaleX;this.ScaleY=b.ScaleY;this.FlipHorizontal=b.FlipHorizontal;this.FlipVertical=b.FlipVertical;this.NaturalOffsetX=b.NaturalOffsetX;this.NaturalOffsetY=b.NaturalOffsetY}catch(a){}};SvgState.prototype.Public_ChangeShapeLocation=function(d,c){if(d==null||c==null){return}var a=c.X-d.X;var b=c.Y-d.Y;this.MoveDistance(a,b);this.UpdateDrawing()};SvgState.prototype.Property_IsColorable=function(){if(this.ColorableState==undefined||this.ColorableState==null){return false}return this.ColorableState.Property_IsColorable()};SvgState.prototype.Public_ResetColors=function(){if(this.TextState!=null){this.TextState.Public_ResetFontColor()}if(this.Property_IsColorable()==false){return}this.ColorableState.Public_ResetColors()};SvgState.prototype.Public_SetColorForRegion=function(e,b,d,f,a){if(this.Property_IsColorable()==false){return}if(a){var c=this.ColorableState.Public_GetColorForRegion(e);UndoManager.register(undefined,UndoColorChange,[this.Id,e,c],"",undefined,UndoColorChange,[this.Id,e,b],"")}this.ColorableState.Public_UpdateColorForRegion(e,b,d);if(f){DrawControlsMenu()}};SvgState.prototype.Public_GetColorRegions=function(){if(this.Property_IsColorable()==false){return null}return this.ColorableState.Public_GetRegionList()};SvgState.prototype.Public_GetColorWheelForRegion=function(a){if(this.Property_IsColorable()==false){return null}return this.ColorableState.Public_GetColorWheelForRegion(a)};SvgState.prototype.Public_GetColorForRegion=function(a){if(this.Property_IsColorable()==false){return null}return this.ColorableState.Public_GetColorForRegion(a)};SvgState.prototype.Public_GetTitleForRegion=function(b){if(this.Property_IsColorable()==false){return null}try{return this.ColorableState.Public_GetTitleForRegion(b)}catch(a){}return""};SvgState.prototype.Private_CopyColorableState=function(a){this.ColorableState.Public_Copy(a)};SvgState.prototype.Private_CopySpringableState=function(a){if(a==null){return}this.SpringableState.CopySpringableState(a)};SvgState.prototype.IsSpringable=function(){if(this.SpringableState==null){return false}return this.SpringableState.IsSpringable};SvgState.prototype._CanResizeVertical=function(){if(this.IsSpringable()==false){return true}return this.SpringableState.CanResizeVertical()};SvgState.prototype._CanResizeHorizontal=function(){if(this.IsSpringable()==false){return true}return this.SpringableState.CanResizeHorizontal()};SvgState.prototype.CopyShapeState=function(d,c){DebugLine("not calling here CopyShapeState");this.SetScale(d.ScaleX,d.ScaleY);this.RotateShape(d.Angle);this.FlipHorizontal=d.FlipHorizontal;this.FlipVertical=d.FlipVertical;this.FilterColorMode=d.FilterColorMode;this.IsLocked=false;this.UseClipping=d.UseClipping;this.ClipX=d.ClipX;this.ClipY=d.ClipY;this.opacity=d.opacity;this.ClipWidth=d.ClipWidth;this.ClipHeight=d.ClipHeight;this.SkewX=d.SkewX;this.SkewY=d.SkewY;this.CropType=d.CropType;this.CropPolygonPointJson=JSON.stringify(d.CropPolygonPoint);this.CropPolygonPoint=JSON.parse(this.CropPolygonPointJson);this.isGroupObject=d.isGroupObject;this.nextShapeId=d.nextShapeId;if(c){this.NaturalOffsetX=d.NaturalOffsetX;this.NaturalOffsetY=d.NaturalOffsetY;this.X=d.X;this.Y=d.Y;this.ScaleX=d.ScaleX;this.ScaleY=d.ScaleY;this.Angle=d.Angle}this.GlobalImageId=d.GlobalImageId;this.Position=d.Position;if(this.UseClipping==undefined||this.UseClipping==null){this.UseClipping=false;this.ClipX=0;this.ClipY=0;this.ClipWidth=0;this.ClipHeight=0}if(d.IsTextable()){this.CopyTextState(d.TextState)}if(d.Property_IsColorable()){this.Private_CopyColorableState(d.ColorableState)}if(d.Public_IsPosable()){this.Private_CopyPosableState(d.PosableState)}if(d.Public_IsSmartScene()){this.Private_CopySmartSceneState(d.SmartSceneState)}if(d.IsSpringable()){this.Private_CopySpringableState(d.SpringableState)}var b;for(b=0;b<d.groupShapeStates.length;b++){AddSvg.CurrentShapeIndex++;newShapeId=SvgPartsEnum.ShapeId+AddSvg.CurrentShapeIndex;$("#"+this.Id+SvgPartsEnum.SvgImage).find('[id^="'+d.groupShapeStates[b].Id+'"]').each(function(){var f=this.getAttribute("id");var e=newShapeId+f.substring(newShapeId.length,f.length);this.setAttribute("id",e)});var a=new SvgState(newShapeId);a.CopyShapeState(d.groupShapeStates[b],true);this.groupShapeStates.push(a)}};SvgState.prototype.Private_SnapshotState=function(){var a;for(a=0;a<this._SvgStateProperties.length;a++){this._SnapshotStateData[this._SvgStateProperties[a]]=this[this._SvgStateProperties[a]]}for(a=0;a<this._TextStateDataProperties.length;a++){this._SnapshotStateData[this._TextStateDataProperties[a]]=this.TextState[this._TextStateDataProperties[a]]}if(this.Public_IsPosable()){var c=this.PosableState.Public_PoseGroups();for(a=0;a<c.length;a++){pose=c[a];var b="posable_"+a;this._SnapshotStateData[b]=pose.Public_GetActiveOption()}}};SvgState.prototype.Private_HasChangedSinceLastUpdateDrawing=function(){var c;try{for(c=0;c<this._SvgStateProperties.length;c++){if((this._SnapshotStateData[this._SvgStateProperties[c]]||EMPTY_STRING)!==(this[this._SvgStateProperties[c]]||EMPTY_STRING)){this.Private_SnapshotState();return true}}}catch(b){LogErrorMessage("Private_HasChangedSinceLastUpdateDrawing.a",b);return true}try{for(c=0;c<this._TextStateDataProperties.length;c++){if((this._SnapshotStateData[this._TextStateDataProperties[c]]||EMPTY_STRING)!==(this.TextState[this._TextStateDataProperties[c]]||EMPTY_STRING)){this.Private_SnapshotState();return true}}}catch(b){LogErrorMessage("Private_HasChangedSinceLastUpdateDrawing.b",b);return true}try{if(this.Public_IsPosable()){var f=this.PosableState.Public_PoseGroups();for(c=0;c<f.length;c++){pose=f[c];var d="posable_"+c;var a=pose.Public_GetActiveOption();if(a==null){LogErrorMessage("SvgState.Private_HasChangedSinceLastUpdateDrawing ActivePoseOption is null");this.Private_SnapshotState();return true}if(this._SnapshotStateData[d]==null){LogErrorMessage("SvgState.Private_HasChangedSinceLastUpdateDrawing _SnapshotStateData is null - id "+d);this.Private_SnapshotState();return true}if(a.IsEqual(this._SnapshotStateData[d])==false){this.Private_SnapshotState();return true}}}}catch(b){LogErrorMessage("Private_HasChangedSinceLastUpdateDrawing.c",b);return true}return false};SvgState.prototype.Public_ClearDefaults=function(){if(this.IsTextable&&this.TextState.Public_ClearDefaults()){try{this.UpdateDrawing()}catch(a){LogErrorMessage("SvgState.Public_ClearDefaults",a)}}};SvgState.prototype.GetPivotPoint=function(b){var e=this.UseClipping;if(b){this.UseClipping=false}var a=this.Public_GetVisibleShapeDimensions();var c=a.width/2+this.Property_ClippedOffsetX();var d=a.height/2+this.Property_ClippedOffsetY();if(this.FlipHorizontal){c*=-1}if(this.FlipVertical){d*=-1}this.UseClipping=e;return{x:c,y:d}};SvgState.prototype.UpdateDrawing=function(d){if(d==null||d==false){if(!this.Private_HasChangedSinceLastUpdateDrawing()){return}}if(this.ActivelySelected==false){this.ClearSelectionBox()}var q=this.Private_GetElement("");var r=$("#"+this.Id+SvgPartsEnum.SvgImage);if(!r.isEmptyObject&&r.attr("filter")!=this.FilterColorMode){r.attr("filter",this.FilterColorMode);r.hide().show(0);r.hide().show(0)}var h=this.Private_GetElement(SvgPartsEnum.Natural);var l=this.Private_GetElement(SvgPartsEnum.Scale);var b=this.Private_GetFullShapeDimensions();var c=this.Public_GetVisibleShapeDimensions();var m=this.ScaleX;var u=0;var v=0;var j=c.width/2+this.Property_ClippedOffsetX();var k=c.height/2+this.Property_ClippedOffsetY();if(this.FlipHorizontal){m*=-1;j*=-1;u+=b.width;if(this.UseClipping){var p=c.width+(2*this.Property_ClippedOffsetX());u-=b.width-p}}var n=this.ScaleY;if(this.FlipVertical){n*=-1;k*=-1;v+=b.height;if(this.UseClipping){var p=c.height+(2*this.Property_ClippedOffsetY());v-=b.height-p}}var f=-1*this.NaturalOffsetX;var g=-1*this.NaturalOffsetY;f=isNaN(f)?0:f;g=isNaN(g)?0:g;if(h==null){LogErrorMessage("SvgState.UpdateDrawing - No NaturalOffsetG "+this.Id)}else{h.setAttribute("transform","translate("+f+","+g+")")}if(l==null){LogErrorMessage("SvgState.UpdateDrawing - No scaleG "+this.Id)}else{var a=this.SkewX!=0?Math.atan(this.SkewX/b.height)*180/Math.PI:Math.atan(this.SkewY/b.width)*180/Math.PI;var o=this.SkewX!=0?"skewX("+a+")":"skewY("+a+")";l.setAttribute("transform",o+"scale("+m+", "+n+")")}var t="translate("+(this.X+u)+", "+(this.Y+v)+")";t+="rotate("+this.Angle+", "+j+","+k+")";l.setAttribute("opacity",this.opacity);if(q==null){LogErrorMessage("SvgState.UpdateDrawing - No svg "+this.Id)}else{q.setAttribute("transform",t)}this.UpdateCropping();if(this.IsTextable()){this.AddText();$("#OpacitySlider").css("opacity",0.5)}else{$("#OpacitySlider").css("opacity",1)}if(this.ActivelySelected){this.DrawSelectionBox()}if(MyBrowserProperties.IsSafari5){var e=MyPointers.CoreSvg;var s=MyPointers.SvgContainer;e.detach();s.append(e)}};SvgState.prototype.ClearSelectionBox=function(){var a=this.Private_GetElement(SvgPartsEnum.SelectionBox);if(a){a.parentNode.removeChild(a)}a=this.Private_GetElement(SvgPartsEnum.RotateCircleGroup);if(a){a.parentNode.removeChild(a)}};SvgState.prototype.SetEdgeHandlers=function(a,b,c){this.Private_GetElement(a).addEventListener("mousedown",b);this.Private_GetElement(a).addEventListener("mouseup",c);this.Private_GetElement(a).addEventListener("mouseleave",c)};SvgState.prototype.Private_GetSelectionBoxArea=function(k){var a=this.Private_GetFullShapeDimensions();var m=a.width;var g=a.height;var c=0;var d=0;if(this.UseClipping){m=this.ClipWidth*this.ScaleX;g=this.ClipHeight*this.ScaleY;c=this.ClipX*this.ScaleX;d=this.ClipY*this.ScaleY}if(isNaN(m)||isFinite(m)==false){m=40}if(isNaN(g)||isFinite(g)==false){g=10}var h=-1*k+c;var j=m+k+c;var l=-1*k+d;var b=g+k+d;if(this.FlipHorizontal){var e=m+(2*this.Property_ClippedOffsetX());h-=e;j-=e}if(this.FlipVertical){var f=g+(2*this.Property_ClippedOffsetY());l-=f;b-=f}return{Width:m,Height:g,Left:h,Right:j,Bottom:b,Top:l,CenterX:m/2+c,CenterY:g/2+d}};SvgState.prototype.DrawSelectionBox=function(){if(this.Movable==false){return}var g=5;var a=this.Private_GetSelectionBoxArea(g);var e=this.Private_GetElement(SvgPartsEnum.SelectionBox);var f=a.Width+(2*g);var c=a.Height+(2*g);if(e==null){var d=this.Private_GetId(SvgPartsEnum.SelectionBox);var b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"id",d);var h=this.Private_GetElement("");h.insertBefore(b,h.childNodes[0]);b.appendChild(SvgCreator.AddRect(a.Left,a.Top,f,c,"#526C85","#D0E8F4","4,4",".25",this.Private_GetId(SvgPartsEnum.SelectionBoxRectangle)));e=this.Private_GetElement(SvgPartsEnum.SelectionBox)}else{SvgCreator.UpdateRectangleDom(this.Private_GetElement(SvgPartsEnum.SelectionBoxRectangle),a.Left,a.Top,f,c)}this.Private_HandleHotSpots(e,a.Top,a.Right,a.Bottom,a.Left)};SvgState.prototype.Private_HandleHotSpots=function(d,e,c,a,b){if(MyBrowserProperties.IsMobile){this.Private_HandleMobileSelectionHotSpots(d,e,c,a,b)}else{this.Private_HandlePCSelectionHotSpots(d,e,c,a,b)}};SvgState.prototype.Private_HandleMobileSelectionHotSpots=function(e,o,h,a,f){var c=13;var l=(f+h)/2;var m=o-30;var n="#AAA393";var d="#6285C7";var k=this.Private_GetElement(SvgPartsEnum.RotateCircleGroup);if(k==null){e.appendChild(SvgCreator.AddLine(l,m,l,o-3,"Stroke-dasharray:4,4; stroke: "+n,this.Private_GetId(SvgPartsEnum.RotateCircleBar)));var b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"id",this.Private_GetId(SvgPartsEnum.RotateCircleGroup));e.appendChild(b);b.appendChild(SvgCreator.AddCircle(l,m,c,n,d,this.Private_GetId(SvgPartsEnum.RotateCircle),"RotateBar"));var j=this.Private_GetElement(SvgPartsEnum.RotateCircleGroup);j.addEventListener("touchy-rotate",HandleTouchyRotate)}else{SvgCreator.UpdateLineDom(this.Private_GetElement(SvgPartsEnum.RotateCircleBar),l,m,l,o-3);SvgCreator.UpdateCircleDom(this.Private_GetElement(SvgPartsEnum.RotateCircle),l,m)}};SvgState.prototype.Private_HandlePCSelectionHotSpots=function(b,k,f,a,c){var h=(c+f)/2;var j=k-30;var d=(c+f)/2;var e=(k+a)/2;if(this.Private_GetElement(SvgPartsEnum.Selector_NW)){this.Private_UpdatePCSelectionHotSpots(b,k,f,a,c,h,j,d,e)}else{this.Private_AddPCSelectionHotSpots(b,k,f,a,c,h,j,d,e)}};SvgState.prototype.Private_UpdatePCSelectionHotSpots=function(c,l,h,a,d,j,k,e,f){var b=this.Private_GetElement(SvgPartsEnum.RotateCircleBar);if(b){SvgCreator.UpdateLineDom(b,j,k,j,l-3)}b=this.Private_GetElement(SvgPartsEnum.RotateCircle);if(b){SvgCreator.UpdateCircleDom(b,j,k)}b=this.Private_GetElement(SvgPartsEnum.Selector_NW);if(b){SvgCreator.UpdateCircleDom(b,d,l);b.setAttribute("class",this.Private_GetResizeArrow(3))}b=this.Private_GetElement(SvgPartsEnum.Selector_NE);if(b){SvgCreator.UpdateCircleDom(b,h,l);b.setAttribute("class",this.Private_GetResizeArrow(1))}b=this.Private_GetElement(SvgPartsEnum.Selector_SW);if(b){SvgCreator.UpdateCircleDom(b,d,a);b.setAttribute("class",this.Private_GetResizeArrow(1))}b=this.Private_GetElement(SvgPartsEnum.Selector_SE);if(b){SvgCreator.UpdateCircleDom(b,h,a);b.setAttribute("class",this.Private_GetResizeArrow(3))}b=this.Private_GetElement(SvgPartsEnum.Selector_N);if(b){SvgCreator.UpdateCircleDom(b,e,l);b.setAttribute("class",this.Private_GetResizeArrow(0))}b=this.Private_GetElement(SvgPartsEnum.Selector_S);if(b){SvgCreator.UpdateCircleDom(b,e,a);b.setAttribute("class",this.Private_GetResizeArrow(0))}b=this.Private_GetElement(SvgPartsEnum.Selector_W);if(b){SvgCreator.UpdateCircleDom(b,d,f);b.setAttribute("class",this.Private_GetResizeArrow(2))}b=this.Private_GetElement(SvgPartsEnum.Selector_E);if(b){SvgCreator.UpdateCircleDom(b,h,f);b.setAttribute("class",this.Private_GetResizeArrow(2))}};SvgState.prototype.Private_AddPCSelectionHotSpots=function(d,n,j,a,e,k,l,f,h){var b=CommonStylingEnum.ShapeSelector_HotSpot_Corner_CircleSize;var m=CommonStylingEnum.ShapeSelector_HotSpot_Corner_Stroke;var c=CommonStylingEnum.ShapeSelector_HotSpot_Corner_Fill;d.appendChild(SvgCreator.AddLine(k,l,k,n-3,"Stroke-dasharray:4,4; stroke: "+m,this.Private_GetId(SvgPartsEnum.RotateCircleBar)));d.appendChild(SvgCreator.AddCircle(k,l,b,m,c,this.Private_GetId(SvgPartsEnum.RotateCircle),CommonStylingEnum.ShapeSelector_HotSpot_Fill));d.appendChild(SvgCreator.AddCircle(e,n,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_NW),this.Private_GetResizeArrow(3)));d.appendChild(SvgCreator.AddCircle(j,n,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_NE),this.Private_GetResizeArrow(1)));d.appendChild(SvgCreator.AddCircle(e,a,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_SW),this.Private_GetResizeArrow(1)));d.appendChild(SvgCreator.AddCircle(j,a,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_SE),this.Private_GetResizeArrow(3)));var b=CommonStylingEnum.ShapeSelector_HotSpot_Side_CircleSize;var m=CommonStylingEnum.ShapeSelector_HotSpot_Side_Stroke;var c=CommonStylingEnum.ShapeSelector_HotSpot_Side_Fill;if(this._CanResizeVertical()){d.appendChild(SvgCreator.AddCircle(f,n,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_N),this.Private_GetResizeArrow(0)));d.appendChild(SvgCreator.AddCircle(f,a,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_S),this.Private_GetResizeArrow(0)))}if(this._CanResizeHorizontal()){d.appendChild(SvgCreator.AddCircle(e,h,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_W),this.Private_GetResizeArrow(2)));d.appendChild(SvgCreator.AddCircle(j,h,b,m,c,this.Private_GetId(SvgPartsEnum.Selector_E),this.Private_GetResizeArrow(2)))}this.SetEdgeHandlers(SvgPartsEnum.RotateCircle,StartRotate,StopRotate);this.SetEdgeHandlers(SvgPartsEnum.Selector_NE,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_NW,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_SE,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_SW,StartResize,StopResize);if(this._CanResizeVertical()){this.SetEdgeHandlers(SvgPartsEnum.Selector_N,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_S,StartResize,StopResize)}if(this._CanResizeHorizontal()){this.SetEdgeHandlers(SvgPartsEnum.Selector_E,StartResize,StopResize);this.SetEdgeHandlers(SvgPartsEnum.Selector_W,StartResize,StopResize)}};SvgState.prototype.Private_GetResizeArrow=function(b){var a=this.Angle+360;a=a%180;if(a>=30&&a<75){b+=1}if(a>=75&&a<120){b+=2}if(a>=120&&a<165){b+=3}b%=4;switch(b){case 0:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_V_Css;case 1:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_NE_Css;case 2:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_H_Css;case 3:return CommonStylingEnum.ShapeSelector_ResizeHotSpot_NW_Css}};SvgState.prototype.CreateTextBlock=function(f,g,b,e,d){var c=document.createElementNS("http://www.w3.org/2000/svg","text");c.setAttributeNS(null,"x",f);c.setAttributeNS(null,"y",g);c.setAttributeNS(null,"id",b);c.setAttributeNS(null,"style",d);c.setAttributeNS(null,"class","DisableSelection");var a=document.createTextNode(e);c.appendChild(a);return c};SvgState.prototype.AddText_Quill=function(){var c=this.TextState.CurrentId;for(this.TextState.CurrentId=0;this.TextState.CurrentId<this.TextState.D.length;this.TextState.CurrentId++){var g=this.TextState.CurrentId;if(this.TextState.D[g].RemovalId!==null){var b="#"+this.Id+" #"+this.TextState.D[g].RemovalId;$(b).remove();this.TextState.D[g].RemovalId=null}var f=this.Id+"_text";$("#"+f).remove();var f=this.Id+"_text"+g;$("#"+f).remove();var a=this.Private_GetFullShapeDimensions();var e=this.TextState.Public_GetTextArea(a,this.ScaleX,this.ScaleY,this.NaturalOffsetX,this.NaturalOffsetY,this.IsSpringable());var d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"id",f);d=$("#"+this.Id).append(d);d=$("#"+this.Id).children().last();WordRunRenderHelper.RenderText(this.TextState.Public_GetQuillDeltas(),e,d,this.FlipHorizontal,this.FlipVertical,this.Angle)}this.TextState.CurrentId=c};SvgState.prototype.AddText=function(){if(UseQuill||UseSummerNote){this.AddText_Quill();return}if(this.TextState.RemovalId!==null){var g="#"+this.Id+" #"+this.TextState.RemovalId;$(g).remove();this.RemovalId=null}var w=this.TextState.CurrentId;var u=this.Id+"_text"+w;$("#"+u).remove();var p=this.TextState.D[this.TextState.CurrentId].Text;p=p.replaceAll("\r\n","\n");p=p.replaceAll("\r","\n");p=p.replaceAll("\n"," \n ");p=p.replaceAll("\t"," ");var x=p.trim().split(" ");var j=new Array();var a=this.Private_GetFullShapeDimensions();var r=this.TextState.Public_GetTextArea(a,this.ScaleX,this.ScaleY,this.NaturalOffsetX,this.NaturalOffsetY,this.IsSpringable());var q=(this.TextState.D[this.TextState.CurrentId].TextAlignment||"middle");var y=0;switch(q){case"start":y=r.Left;break;case"middle":y=r.Left+(r.Width/2);break;case"end":y=r.Left+r.Width;break}var d="";var h=0;var c=0;var t=this.TextState.FontColor;if(t.indexOf("#")<0){t="#"+t}var k="font-size:"+this.TextState.FontSize+"pt;font-family:"+this.TextState.Font+";fill:"+t+"; text-anchor:"+q+";";var l=document.createElementNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"id",u);l=$("#"+this.Id).append(l);l=$("#"+this.Id).children().last();c=this.TextState.FontSize/0.75;for(var f=0;f<x.length;f++){if(x[f]==="\n"){j[h]=d;d="";h++}else{var m=d+x[f];var n=this.Id+"_temp_text";var s=this.CreateTextBlock(r.Left,r.Top,n,m,k);l.append(s);var o=s.getBBox().width;if(o>r.Width){j[h]=d;d=x[f]+" ";h++}else{d+=x[f]+" "}$("#"+n).remove()}}j[h]=d;if(j[0]==""){j.shift()}var b=0;if(this.FlipHorizontal){switch(q){case"start":y=-1*(r.Left+r.Width);break;case"middle":y=-1*(r.Left+(r.Width/2));break;case"end":y=-1*r.Left;break}}if(this.FlipVertical){r.Top=-1*(r.Top+r.Height)}if(isFinite(r.Height)){var e=j.length*c;if(e<r.Height){b=(r.Height-e)/2}b-=(c*0.25)}for(f=0;f<j.length;f++){var z=r.Top+((f+1)*c)+b;var v="ts_"+AddSvg.CurrentShapeIndex++;var s=this.CreateTextBlock(y,z,v,j[f],k);l.append(s)}};SvgState.prototype.SetNaturalOffset=function(a,b){this.NaturalOffsetX=a;this.NaturalOffsetY=b};SvgState.prototype.GetSavedFontColor=function(){if(this.TextState==null){return null}return this.TextState.Public_GetSavedFontColor()};SvgState.prototype.GetFontColor=function(){return this.TextState.D[this.TextState.CurrentId].FontColor};SvgState.prototype.SetFontColor=function(a,b){this.TextState.Public_SetFontColor(a,b)};SvgState.prototype.ResetFontColor=function(){try{this.TextState.Public_ResetFontColor();MyPointers.Controls_TextableControls_ColorSelector.spectrum("set",this.TextState.FontColor)}catch(a){DebugLine("Reset Font Color: "+a)}};SvgState.prototype.GetFontSize=function(){return this.TextState.D[this.TextState.CurrentId].FontSize};SvgState.prototype.SetFontSize=function(a){this.TextState.D[this.TextState.CurrentId].FontSize=a};SvgState.prototype.SetFontFace=function(a){this.TextState.D[this.TextState.CurrentId].Font=a};SvgState.prototype.GetFontFace=function(){return this.TextState.D[this.TextState.CurrentId].Font};SvgState.prototype.GetText=function(){return this.TextState.D[this.TextState.CurrentId].Text};SvgState.prototype.SetText=function(a){this.TextState.D[this.TextState.CurrentId].Text=a};SvgState.prototype.GetTextAlignment=function(){return this.TextState.D[this.TextState.CurrentId].TextAlignment};SvgState.prototype.SetTextAlignment=function(a){this.TextState.D[this.TextState.CurrentId].TextAlignment=a};SvgState.prototype.FlipShapeHorizontal=function(){this.FlipHorizontal=!this.FlipHorizontal};SvgState.prototype.FlipShapeVertical=function(){this.FlipVertical=!this.FlipVertical};SvgState.prototype.MoveTo=function(a,b){this.X=a;this.Y=b};SvgState.prototype.MoveDistance=function(a,b){this.X+=a;this.Y+=b};SvgState.prototype.RotateShape=function(a){this.Angle+=a;this.Angle%=360};SvgState.prototype.SetScale=function(a,b){this.ScaleX=a;this.ScaleY=b};SvgState.prototype.ChangeScale=function(a){this.ScaleX*=a;this.ScaleY*=a};SvgState.prototype.ChangeScaleXY=function(a,b){this.ScaleX*=a;this.ScaleY*=b};SvgState.prototype.Resize=function(a,b){this.ScaleX+=a;this.ScaleY+=b};SvgState.prototype.GetBBox=function(b){this.ClearSelectionBox();var a=this.Private_GetElement("").getBBox();if(this.ActivelySelected&&b){this.DrawSelectionBox()}return a};SvgState.prototype.SetLockState=function(a){this.IsLocked=a};SvgState.prototype.SetActive=function(a){this.ActivelySelected=a;if(a){try{$("#"+this.Id).off("touchy-pinch").on("touchy-pinch",HandleTouchyPinch);$("#"+this.Id+SvgPartsEnum.Scale).off("touchy-drag").on("touchy-drag",HandleTouchyDrag)}catch(b){throw b+" Debug: true, "+$("#"+this.Id).length+", "+$("#"+this.Id+SvgPartsEnum.Scale).length}}else{try{this.Public_ResetColors();$("#"+this.Id).off("touchy-pinch");$("#"+this.Id+SvgPartsEnum.Scale).off("touchy-drag")}catch(c){throw c+" Debug: true, "+$("#"+this.Id).length+", "+$("#"+this.Id+SvgPartsEnum.Scale).length}}};SvgState.prototype.CopyTextState=function(a){this.TextState.Copy(a)};SvgState.prototype.PopulateFromJson=function(b){this.ActivelySelected=b.ActivelySelected;this.Angle=b.Angle?b.Angle:0;this.FlipHorizontal=b.FlipHorizontal;this.FlipVertical=b.FlipVertical;this.isGroupObject=b.isGroupObject;this.FilterColorMode=b.FilterColorMode;this.IsLocked=false;try{this.IsLocked=b.IsLocked||false}catch(c){}this.NaturalOffsetX=b.NaturalOffsetX;this.NaturalOffsetY=b.NaturalOffsetY;this.ScaleX=b.ScaleX?b.ScaleX:1;this.ScaleY=b.ScaleY?b.ScaleY:this.ScaleX;this.X=b.X!=null?b.X:10;this.Y=b.Y!=null?b.Y:10;this.opacity=b.opacity;this.UseClipping=b.UseClipping;this.ClipX=b.ClipX;this.ClipY=b.ClipY;this.ClipWidth=b.ClipWidth;this.ClipHeight=b.ClipHeight;if(b.CropType!=null){this.CropType=b.CropType;this.CropPolygonPointJson=b.CropPolygonPointJson;this.CropPolygonPoint=b.CropPolygonPoint}if(b.SkewX!==void (0)){this.SkewX=b.SkewX}if(b.SkewY!==void (0)){this.SkewY=b.SkewY}if(b.nextShapeId!=void 0){this.nextShapeId=b.nextShapeId}this.groupShapeStates=new Array();var d;if(b.groupShapeStates===void (0)){b.groupShapeStates=new Array()}for(d=0;d<b.groupShapeStates.length;d++){var a=new SvgState(b.groupShapeStates[d].Id);a.PopulateFromJson(b.groupShapeStates[d]);this.groupShapeStates.push(a)}if(b.CropPolygonPointJson){this.CropPolygonPointJson=b.CropPolygonPointJson;this.CropPolygonPoint=JSON.parse(b.CropPolygonPointJson)}this.GlobalImageId=b.GlobalImageId;this.Position=b.Position||this.Position;this.Movable=(b.Movable==null?true:b.Movable);if(this.UseClipping==undefined||this.UseClipping==null){this.UseClipping=false;this.ClipX=0;this.ClipY=0;this.ClipWidth=0;this.ClipHeight=0}this.CopyTextState(b.TextState);this.Private_CopyColorableState(b.ColorableState);this.Private_CopyPosableState(b.PosableState);this.Private_CopySmartSceneState(b.SmartSceneState);this.Private_CopySpringableState(b.SpringableState);this.ImageAttribution=b.ImageAttribution};SvgState.prototype.Private_GetPointer=function(a){return $("#"+this.Private_GetId(a))};SvgState.prototype.Private_GetElement=function(b){var a=GetGlobalById(this.Private_GetId(b));if(a===null&&b.substring(0,1)==="_"){a=GetGlobalById(this.Private_GetId(b.substring(1)));if(a!==null){a.setAttributeNS(null,"id",this.Private_GetId(b))}}return a};SvgState.prototype.Private_GetId=function(a){return this.Id+a};SvgState.prototype.Private_GetFullShapeDimensions=function(){var f=this.Private_GetElement(SvgPartsEnum.Scale);var d;try{if(f==null){LogErrorMessage("Scale element is null: "+this.Private_GetId(SvgPartsEnum.Scale))}d=f.getBBox()}catch(b){try{LogErrorMessage("SVG CORRUPTED! Unable to get BBOX for "+this.Private_GetId(SvgPartsEnum.Scale),b);d=f.getBoundingClientRect()}catch(c){LogErrorMessage("SVG Really CORRUPTED! Unable to get BBOX for "+this.Private_GetId(SvgPartsEnum.Scale),b);var a=new Object();a.width=5;a.height=5;return a}}var a=new Object();a.width=d.width*this.ScaleX+(this.SkewX);a.height=d.height*this.ScaleY+(this.SkewX==0?this.SkewY:0);if(a.width<5){a.width=5}if(a.height<5){a.height=5}return a};SvgState.prototype.Public_GetVisibleShapeDimensions=function(){if(this.UseClipping){var a=new Object();a.height=this.ClipHeight*this.ScaleY;a.width=this.ClipWidth*this.ScaleX;if(a.width<5){a.width=5}if(a.height<5){a.height=5}return a}return this.Private_GetFullShapeDimensions()};SvgState.prototype.ConvertCoordinateToOrigin=function(c,a,b){c={x:c.x-this.X,y:c.y-this.Y};c={x:c.x-a.x,y:c.y-a.y};c={x:c.x*Math.cos(-this.Angle*Math.PI/180)-c.y*Math.sin(-this.Angle*Math.PI/180),y:c.x*Math.sin(-this.Angle*Math.PI/180)+c.y*Math.cos(-this.Angle*Math.PI/180)};c={x:c.x+a.x,y:c.y+a.y};if(this.FlipHorizontal){c.x-=a.x*2}if(this.FlipVertical){c.y-=a.y*2}if(b){c={x:c.x/this.ScaleX,y:c.y/this.ScaleY}}return c};SvgState.prototype.ConvertCoordinateToStage=function(c,a,b){if(this.FlipHorizontal){c.x+=a.x*2}if(this.FlipVertical){c.y+=a.y*2}c={x:c.x-a.x,y:c.y-a.y};c={x:c.x*Math.cos(this.Angle*Math.PI/180)-c.y*Math.sin(this.Angle*Math.PI/180),y:c.x*Math.sin(this.Angle*Math.PI/180)+c.y*Math.cos(this.Angle*Math.PI/180)};c={x:c.x+a.x,y:c.y+a.y};if(b){c={x:c.x*this.ScaleX,y:c.y*this.ScaleY}}c={x:c.x+this.X,y:c.y+this.Y};return c};SvgState.prototype.Public_GetImaginaryOuterPoints=function(){var a=this.Private_GetSelectionBoxArea(0);var c=0;var b=[{x:a.Left,y:a.Top},{x:a.Right,y:a.Top},{x:a.Left,y:a.Bottom},{x:a.Right,y:a.Bottom}];var d=new Array();for(i=0;i<b.length;i++){d[i]=this.ConvertCoordinateToStage(b[i],{x:a.CenterX,y:a.CenterY})}return d};SvgState.prototype.Public_GetImaginaryOuterBox=function(){var b=this.Public_GetImaginaryOuterPoints();var a;var g=b[0].y,d=b[0].y;var e=b[0].x,f=b[0].x;for(a=1;a<b.length;a++){g=Math.min(g,b[a].y);d=Math.max(d,b[a].y);e=Math.min(e,b[a].x);f=Math.max(f,b[a].x)}var c={Top:g,Bottom:d,Left:e,Right:f};return c};SvgState.prototype.UpdateCropping=function(){if(this.UseClipping){this.Private_AddClipArea();switch(this.CropType){case CropTypeEnum.Standard:var c=this.Private_GetElement(SvgPartsEnum.ClipRect);c.setAttributeNS(null,"x",this.ClipX);c.setAttributeNS(null,"y",this.ClipY);c.setAttributeNS(null,"width",this.ClipWidth);c.setAttributeNS(null,"height",this.ClipHeight);break;case CropTypeEnum.Advanced:var b=this.Private_GetElement(SvgPartsEnum.ClipPolygon);var e;var f="";for(e=0;e<this.CropPolygonPoint.length;e++){f=f+" "+this.CropPolygonPoint[e].x+","+this.CropPolygonPoint[e].y}b.setAttributeNS(null,"points",f);break;case CropTypeEnum.Circle:var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);a.setAttributeNS(null,"cx",this.ClipX+this.ClipWidth/2);a.setAttributeNS(null,"cy",this.ClipY+this.ClipHeight/2);a.setAttributeNS(null,"rx",this.ClipWidth/2);a.setAttributeNS(null,"ry",this.ClipHeight/2);break}var g=this.Private_GetElement(SvgPartsEnum.Defs);var h=null;if(g){h=g.cloneNode(true);g.parentNode.removeChild(g)}var j=this.Private_GetElement(SvgPartsEnum.Scale);if(j&&h){j.insertBefore(h,j.childNodes[0])}var d=this.Private_GetElement(SvgPartsEnum.CropGroup);if(d){d.removeAttribute("clip-path");d.setAttribute("clip-path","url(#"+this.Private_GetId(SvgPartsEnum.ClipPath)+")")}}else{var d=this.Private_GetElement(SvgPartsEnum.CropGroup);if(d){d.removeAttribute("clip-path")}}};SvgState.prototype.Private_AddClipArea=function(){var j=this.Private_GetElement(SvgPartsEnum.Scale);var g=this.Private_GetElement(SvgPartsEnum.Defs);if(g==null){g=SvgCreator.CreateSvgGroup(this.Private_GetId(SvgPartsEnum.Defs));j.appendChild(g)}var f=this.Private_GetElement(SvgPartsEnum.CropGroup);if(f==null){f=SvgCreator.CreateSvgGroup(this.Private_GetId(SvgPartsEnum.CropGroup));var h=this.Private_GetElement(SvgPartsEnum.Natural);j.appendChild(f);f=this.Private_GetElement(SvgPartsEnum.CropGroup);f.appendChild(h)}var b=this.Private_GetElement(SvgPartsEnum.ClipPath);if(b==null){b=SvgCreator.CreateClipPath(this.Private_GetId(SvgPartsEnum.ClipPath));g.appendChild(b);b=this.Private_GetElement(SvgPartsEnum.ClipPath)}switch(this.CropType){case CropTypeEnum.Standard:var c=this.Private_GetElement(SvgPartsEnum.ClipPolygon);if(c){b.removeChild(c)}var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);if(a){b.removeChild(a)}var e=this.Private_GetElement(SvgPartsEnum.ClipRect);if(e==null){e=SvgCreator.AddRect(this.ClipX,this.ClipY,this.ClipWidth,this.ClipHeight,"black","black","solid",".5",this.Private_GetId(SvgPartsEnum.ClipRect));b.appendChild(e)}break;case CropTypeEnum.Advanced:var d=this.Private_GetElement(SvgPartsEnum.ClipRect);if(d){b.removeChild(d)}var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);if(a){b.removeChild(a)}var c=this.Private_GetElement(SvgPartsEnum.ClipPolygon);if(c==null&&this.CropPolygonPoint.length){c=SvgCreator.AddPolygon(this.CropPolygonPoint,"black","black","solid",1,".5",this.Private_GetId(SvgPartsEnum.ClipPolygon));b.appendChild(c)}break;case CropTypeEnum.Circle:var d=this.Private_GetElement(SvgPartsEnum.ClipRect);if(d){b.removeChild(d)}var c=this.Private_GetElement(SvgPartsEnum.ClipPolygon);if(c){b.removeChild(c)}var a=this.Private_GetElement(SvgPartsEnum.ClipEllipse);if(a==null){a=SvgCreator.AddEllipse(this.ClipX+this.ClipWidth/2,this.ClipY+this.ClipHeight/2,this.ClipWidth/2,this.ClipHeight/2,"black","red","4,4",".25",this.Private_GetId(SvgPartsEnum.ClipEllipse));b.appendChild(a)}break}};SvgState.prototype.GiveSvgId=function(){var a=this.Private_GetPointer(SvgPartsEnum.SvgImage);if(a===null||a.length==0){natural.children().first().attr("id",this.Private_GetId(SvgPartsEnum.SvgImage))}};SvgState.prototype.Private_ClearMetaData=function(){var a=$("#"+this.Id).find("sbtdata");if(a.length==0){return}a.remove()};SvgState.prototype.Private_ResetNaturalOffset=function(){var d=this.Private_GetElement(SvgPartsEnum.Natural);var a=d.getBBox();var b=this.NaturalOffsetX-a.x;var c=this.NaturalOffsetY-a.y;this.NaturalOffsetX=a.x;this.NaturalOffsetY=a.y;if(this.FlipHorizontal){b*=-1}this.X-=(b*this.ScaleX);this.Y-=(c*this.ScaleY)};SvgState.prototype.Private_CopySmartSceneState=function(a){if(a==null){return}this.SmartSceneState.CopySmartSceneState(a,this.ColorableState)};SvgState.prototype.Private_CopyPosableState=function(a){if(a==null){return}a.Position=a.Position||this.Position;this.PosableState.Public_Copy(a)};SvgState.prototype.Public_IsPosable=function(){if(this.PosableState==null){return false}return this.PosableState.Public_IsPosable()};SvgState.prototype.Public_IsInstaPosable=function(){if(this.Public_IsPosable==false){return false}var a=this.PosableState.Public_PoseGroups();if(a==null||a.length<3){return false}return true};SvgState.prototype.Public_GetPoseGroups=function(){if(this.Public_IsPosable()==false){return null}return this.PosableState.Public_PoseGroups()};SvgState.prototype.Public_GetPreviousPoseList=function(){if(this.Public_IsPosable()==false){return null}return this.PosableState.Public_GetPreviousPoseList()};SvgState.prototype.Public_GetPoseGroupList=function(){var c=new Array();var d=this.Public_GetPoseGroups();for(var a=0;a<d.length;a++){var b=d[a];c.push({PoseType:b.PoseType,PoseId:b.Public_GetActiveOption().Public_GetInternalId()})}return c};SvgState.prototype.Public_UpdatePoseOption=function(a,b){if(this.Public_IsPosable()==false){return}this.PosableState.Public_UpdatePoseOption(a,b);this.Private_ResetNaturalOffset();this.Public_ResetColors();this.UpdateDrawing()};SvgState.prototype.Public_GetPose=function(a){if(this.Public_IsPosable()==false){return null}return this.PosableState.Public_GetPose(a)};SvgState.prototype.Public_GetSafePoseArray=function(a){if(a==null||this.Public_IsPosable()==false){return null}return this.PosableState.Public_GetSafePoseArray(a)};SvgState.prototype.Public_SetPreviousPoseList=function(a){if(this.Public_IsPosable()==false){return}this.PosableState.Public_SetPreviousPoseList(a)};SvgState.prototype.Public_BulkUpdatePoseGroups=function(b){if(b==null){return}for(var a=0;a<b.length;a++){var c=b[a].PoseGroup;var d=b[a].PoseOption;this.Public_UpdatePoseOption(c,d)}this.UpdateDrawing()};SvgState.prototype.Public_HandleCellExpansion=function(c,b,a){if(this.Movable==false){return}var k=c;var l=c;if(b!=null&&a!=null){var e=a.X/b.X;var j=a.Y/b.Y;var h=(a.X+a.Width)/(b.X+b.Width);var d=(a.Y+a.Height)/(b.Y+b.Height);var f=(e+h)/2;var g=(j+d)/2;if(this.X<b.X+b.Width*0.25){k=e}else{if(this.X>b.X+b.Width*0.25&&this.X<b.X+b.Width*0.75){k=f}else{if(this.X>b.X+b.Width*0.75){k=h}}}if(this.Y<b.Y+b.Height*0.25){l=j}else{if(this.Y>b.Y+b.Height*0.25&&this.Y<b.Y+b.Height*0.75){l=g}else{if(this.Y>b.Y+b.Height*0.75){l=d}}}}this.X*=k;this.Y*=l;this.ScaleX*=c;this.ScaleY*=c;this.UpdateDrawing()};SvgState.prototype.Public_update_ClipRegionByAdvancedCrop=function(){if(this.UseClipping&&this.CropType==CropTypeEnum.Advanced&&this.CropPolygonPoint.length>2){this.ClipX=this.CropPolygonPoint[0].x;this.ClipY=this.CropPolygonPoint[0].y;this.ClipWidth=this.CropPolygonPoint[0].x;this.ClipHeight=this.CropPolygonPoint[0].y;var a;for(a=1;a<this.CropPolygonPoint.length;a++){this.ClipX=Math.min(this.ClipX,this.CropPolygonPoint[a].x);this.ClipY=Math.min(this.ClipY,this.CropPolygonPoint[a].y);this.ClipWidth=Math.max(this.ClipWidth,this.CropPolygonPoint[a].x);this.ClipHeight=Math.max(this.ClipHeight,this.CropPolygonPoint[a].y)}this.ClipWidth-=this.ClipX;this.ClipHeight-=this.ClipY}};SvgState.prototype.Public_convert_RectangleToAdvanced=function(){if(this.UseClipping&&this.CropType==CropTypeEnum.Standard){this.CropType=CropTypeEnum.Advanced;this.CropPolygonPoint=new Array();this.CropPolygonPoint.push({x:this.ClipX,y:this.ClipY});this.CropPolygonPoint.push({x:this.ClipX,y:this.ClipY+this.ClipHeight});this.CropPolygonPoint.push({x:this.ClipX+this.ClipWidth,y:this.ClipY+this.ClipHeight});this.CropPolygonPoint.push({x:this.ClipX+this.ClipWidth,y:this.ClipY});this.CropPolygonPointJson=JSON.stringify(this.CropPolygonPoint)}};SvgState.prototype.getCropParam=function(){var a={Id:this.Id,X:this.X,Y:this.Y,Angle:this.Angle,ScaleX:this.ScaleX,ScaleY:this.ScaleY,FlipHorizontal:this.FlipHorizontal,FlipVertical:this.FlipVertical,UseClipping:this.UseClipping,CropType:this.CropType,FilterColorMode:this.FilterColorMode,opacity:this.opacity,ClipX:this.ClipX,ClipY:this.ClipY,ClipWidth:this.ClipWidth,ClipHeight:this.ClipHeight,CropPolygonPoint:new Array()};this.CropPolygonPoint.forEach(function(b){a.CropPolygonPoint.push(b)});return a};SvgState.prototype.setCropParam=function(b){this.X=b.X;this.Y=b.Y;this.Angle=b.Angle;this.ScaleX=b.ScaleY;this.ScaleY=b.ScaleY;this.FlipHorizontal=b.FlipHorizontal;this.FlipVertical=b.FlipVertical;this.UseClipping=b.UseClipping;this.CropType=b.CropType;this.FilterColorMode=b.FilterColorMode,this.opacity=b.opacity,this.ClipX=b.ClipX;this.ClipY=b.ClipY;this.ClipWidth=b.ClipWidth;this.ClipHeight=b.ClipHeight;this.CropPolygonPoint=[];var a=this.CropPolygonPoint;b.CropPolygonPoint.forEach(function(c){a.push(c)});this.CropPolygonPointJson=JSON.stringify(this.CropPolygonPoint)};function TextStateData(a){if(a===void 0){a={}}this.Text=a.Text||"";this.DefaultText=a.DefaultText||"";this.Font=a.Font||MyBrowserProperties.Public_GetDefaultFont();this.FontSize=a.FontSize||"10";this.FontColor=a.FontColor||"000000";this.TextAlignment=a.TextAlignment||"middle";this.Textable=a.Textable||false;this.TextOffsetLeft=a.TextOffsetLeft||0;this.TextOffsetRight=a.TextOffsetRight||0;this.TextOffsetTop=a.TextOffsetTop||0;this.Private_IdTextableRectangle=a.Private_IdTextableRectangle||"";this.Private_RevertColor=a.Private_IdTextableRectangle||"";this.RemovalId=a.RemovalId||null;this._QuillDeltas=a._QuillDeltas||null}function TextState(a,c){var b;if(c!==void 0){b=new TextStateData(c)}else{b=new TextStateData()}this.Private_ShapeId=a;this.D=new Array();this.D.push(b);this.CurrentId=0;this.CopyFontStyles(this.D[0]);this.Private_CheckForMetaData(a)}TextState.prototype.Public_ClearDefaults=function(){if(this.D[this.CurrentId].Text!=this.D[this.CurrentId].DefaultText){return false}if(UseSummerNote){SbtSummerNoteHelper.ResetToDefaults();this.Public_SetQuillDeltas(SbtSummerNoteHelper.GetDeltas())}this.D[this.CurrentId].Text="";return true};TextState.prototype.Public_GetSavedFontColor=function(){if(this.D[this.CurrentId].Private_RevertColor!=""){return this.D[this.CurrentId].Private_RevertColor}return this.D[this.CurrentId].FontColor};TextState.prototype.Public_SetFontColor=function(a,b){if(this.D[this.CurrentId].Private_RevertColor===""){this.D[this.CurrentId].Private_RevertColor=this.D[this.CurrentId].FontColor}if(b===false){this.D[this.CurrentId].Private_RevertColor=a}this.D[this.CurrentId].FontColor=a};TextState.prototype.Public_ResetFontColor=function(){if(this.D[this.CurrentId].Private_RevertColor!=null&&this.D[this.CurrentId].Private_RevertColor!=""){this.D[this.CurrentId].FontColor=this.D[this.CurrentId].Private_RevertColor}};TextState.prototype.Public_GenerateQuillForOneLiner=function(d,c,e,a,b){this.Public_SetQuillDeltas(SbtSummerNoteHelper.GenerateQuillForOneLiner(d,c,e,a,b))};TextState.prototype.Public_ConvertToQuill=function(){var a="";if(this.D[this.CurrentId].TextAlignment=="middle"){a="center"}else{if(this.D[this.CurrentId].TextAlignment=="end"){a="right"}}var b=this.D[this.CurrentId].FontColor===""?"black":this.D[this.CurrentId].FontColor;if(UseSummerNote){try{a=a==""?"left":a;SbtSummerNoteHelper.ResetToDefaults();var f='<p style="text-align:'+a+"; color:"+b+";font-family: "+this.D[this.CurrentId].Font.replaceAll2('"',"'")+"; font-size:"+this.D[this.CurrentId].FontSize+'pt;">';var g=this.D[this.CurrentId].Text.replaceAll2("\n\n\n","\n\n").replaceAll2("\n","</p>"+f);g=f+g+"</p>";SbtSummerNoteHelper.UpdateForHtml(g);this.Public_SetQuillDeltas(SbtSummerNoteHelper.GetDeltas());if(this.Public_GetQuillDeltas()==null){try{LogErrorMessage("Post Conversion - Quill is NULL - "+this.D[this.CurrentId].Text)}catch(d){LogErrorMessage("Post Conversion - Quill is NULL - ERROR",d)}}SbtSummerNoteHelper.ResetToDefaults()}catch(c){try{LogErrorMessage("Public_ConvertToQuill Text "+this.D[this.CurrentId].Text,c)}catch(d){LogErrorMessage("Public_ConvertToQuill Error Fallback",d)}}}};TextState.prototype.Public_GetTextArea=function(a,h,i,e,f,d){var b=new Object();if(this.D[this.CurrentId].Private_IdTextableRectangle!=null&&this.D[this.CurrentId].Private_IdTextableRectangle.length>0){var j=$("#"+this.D[this.CurrentId].Private_IdTextableRectangle);var n=Number(j.attr("x"));var o=Number(j.attr("y"));var m=Number(j.attr("width"));var c=Number(j.attr("height"));b.Left=(n-e)*h;b.Width=m*h;b.Top=(o-f)*i;b.Height=c*i;if(d){var k=GetGlobalById(this.D[this.CurrentId].Private_IdTextableRectangle);var g=$(k).parent().attr("id");var l=SvgCreator.GetTransform(g);b.Width*=l.Scale[0];b.Height*=l.Scale[1]}}else{var m=a.width;var c=a.height;b.Left=m*this.D[this.CurrentId].TextOffsetLeft;b.Top=(c*this.D[this.CurrentId].TextOffsetTop);b.Width=(m*this.D[this.CurrentId].TextOffsetRight)-b.Left;b.Height=Infinity}return b};TextState.prototype.Public_SetQuillDeltas=function(b,c){this.D[this.CurrentId]._QuillDeltas=SbtLib.DeepCopy(b);try{if(c==null||c==false){if(this.D[this.CurrentId]._QuillDeltas==null){if(b==null){LogErrorMessage("_Quill deltas is null, and quilldeltas was null")}else{LogErrorMessage("_Quill deltas is null, and quilldeltas was NOT null",{message:"quillDeltas: "+JSON.stringify(b),stack:""})}}}}catch(a){LogErrorMessage("Public_SetQuillDeltas - errors",a)}};TextState.prototype.Public_GetTextableCount=function(){return this.D.length};TextState.prototype.Public_GetQuillDeltas=function(){return this.D[this.CurrentId]._QuillDeltas};TextState.prototype.Public_GetQuillDeltas_ByTextableIndex=function(a){return this.D[a]._QuillDeltas};TextState.prototype.Public_SummerNote_SetFontSizeAndColor=function(c,a){var b=SbtSummerNoteHelper.Deltas_UpdateFontSizeAndColor(this.Public_GetQuillDeltas(),c,a);this.Public_SetQuillDeltas(b);if(b==null){LogErrorMessage("SbtSummerNoteHelper.OnChange: Deltas null ")}};TextState.prototype.Public_QuillSetFontColor=function(a){quill.setContents(this.Public_GetQuillDeltas().Public_GetQuillDeltas());quill.formatText(0,1000,"color",a);this.Public_SetQuillDeltas(quill.getContents().ops)};TextState.prototype.Public_QuillSetFontSize=function(a){quill.setContents(this.Public_GetQuillDeltas());quill.formatText(0,1000,"size",a.toString());this.Public_SetQuillDeltas(quill.getContents().ops)};TextState.prototype.Public_GetFontStyles=function(){var a=new Object();a.Text=this.D[this.CurrentId].Text;a.DefaultText=this.D[this.CurrentId].DefaultText;a.Font=this.D[this.CurrentId].Font;a.FontSize=this.D[this.CurrentId].FontSize;a.FontColor=this.D[this.CurrentId].FontColor;a.TextAlignment=this.D[this.CurrentId].TextAlignment;a.Textable=this.D[this.CurrentId].Textable;a._QuillDeltas=SbtLib.DeepCopy(this.D[this.CurrentId]._QuillDeltas);return a};TextState.prototype.CopyFontStyles=function(a){this.D[this.CurrentId].Text=a.Text;this.D[this.CurrentId].DefaultText=a.DefaultText;this.D[this.CurrentId].Font=this.UpdateOldFont(a.Font);this.D[this.CurrentId].FontSize=a.FontSize;this.D[this.CurrentId].FontColor=a.FontColor;this.D[this.CurrentId].TextAlignment=a.TextAlignment;this.D[this.CurrentId].Textable=a.Textable;if(this.D[this.CurrentId].Text!=null&&this.D[this.CurrentId].Text!=""){this.D[this.CurrentId].Textable=true}if(UseQuill||UseSummerNote){this.D[this.CurrentId]._QuillDeltas=a._QuillDeltas;if(this.D[this.CurrentId]._QuillDeltas==null&&a.Textable==true){this.Public_ConvertToQuill()}}};TextState.prototype.Copy=function(e){var b;var f=e;if(e.D===void 0){var e=new TextState(void (0),e)}for(b=0;b<e.D.length;b++){if(this.D.length<b+1){var a=new TextStateData();this.D.push(a)}this.CurrentId=b;this.CopyFontStyles(e.D[b]);this.D[this.CurrentId].Textable=e.D[b].Textable;this.D[this.CurrentId].TextOffsetLeft=e.D[b].TextOffsetLeft;this.D[this.CurrentId].TextOffsetRight=e.D[b].TextOffsetRight;this.D[this.CurrentId].TextOffsetTop=e.D[b].TextOffsetTop;if(e.D[b].Private_IdTextableRectangle!=null&&e.D[b].Private_IdTextableRectangle.length>0){this.D[this.CurrentId].Private_IdTextableRectangle=this.Private_ShapeId+"_TextBoxArea"+b;var c=$("#"+this.Private_ShapeId);var d=c.find("[id="+e.D[b].Private_IdTextableRectangle+"]");d.attr("id",this.D[this.CurrentId].Private_IdTextableRectangle)}this.D[this.CurrentId].RemovalId=e.D[b].RemovalId}this.CurrentId=e.CurrentId};TextState.prototype.UpdateOldFont=function(b){try{var c=b.toLowerCase();if(c.indexOf("arial")>=0){return"Roboto"}if(c.indexOf("calibri")>=0){return"Roboto"}if(c.indexOf("courier")>=0){return"Roboto"}if(c.indexOf("junction")>=0){return"'Montserrat Alternates'"}if(c.indexOf("gothic")>=0){return"'Francois One'"}if(c.indexOf("linden")>=0){return"'times new roman'"}if(c.indexOf("nobile")>=0){return"'Montserrat Alternates'"}if(c.indexOf("goudy")>=0){return"Coustard"}if(c.indexOf("aleo")>=0){return"Coustard"}if(c.indexOf("questrial")>=0){return"'Montserrat Alternates'"}if(c.indexOf("green fuz")>=0){return"Creepster"}if(c.indexOf("times new roman")>=0){return"Lora"}if(c.indexOf("david")>=0){return"'Varela Round'"}}catch(a){LogErrorMessage("TextState.UpdateFont",a)}return b};TextState.prototype.Private_CheckForMetaData=function(a){var b=$("#"+a).find("sbtdata");if(b.length==0){return}var d=b.find("textoffset");if(d.length>0){this.Private_HandleOldTextables(d)}var c=b.find("textable");if(c.length>0){this.Private_HandleTextable(c)}this.Private_CheckForRemovals(b)};TextState.prototype.Private_HandleTextable=function(c){this.D[0].Textable=true;var b=$("#"+this.Private_ShapeId);for(var a=0;a<c.length;a++){if(!this.D[a]){this.D[a]=new TextStateData()}this.D[a].Private_IdTextableRectangle=c[a].getAttribute("textarea");var d=b.find("[id="+this.D[a].Private_IdTextableRectangle+"]");if(d!=null){this.D[a].Private_IdTextableRectangle=this.Private_ShapeId+"_TextBoxArea"+a;d.attr("id",this.D[a].Private_IdTextableRectangle)}}};TextState.prototype.Private_HandleOldTextables=function(a){this.D[this.CurrentId].Textable=true;this.D[this.CurrentId].TextOffsetLeft=a.find("left").first().text();this.D[this.CurrentId].TextOffsetRight=a.find("right").first().text();this.D[this.CurrentId].TextOffsetTop=a.find("top").first().text()};TextState.prototype.Private_CheckForRemovals=function(a){var b=a.find("removetext");if(b.length==0){return}this.D[this.CurrentId].RemovalId=b.first().text()};function WordRun(){this.TextRuns=[];this.Width=0;this.Height=0;this.IsSpace=false;this.IsLineBreak=false;this.Alignment="left"}WordRun.prototype.AddTextRun=function(a){this.TextRuns.push(a);this.Width+=a.Width;this.Height=Math.max(a.Height,this.Height)};var WordRunHelper=function(){var e=new Object();e.GetWordRuns=function(g,n){var r=[];var f=null;for(var h=0;h<g.length;h++){var p=d(g[h]);var m=g[h].insert;if(g[h].insert.image!==undefined){continue}m=m.replaceAll2("\r\n","\n");m=m.replaceAll2("\r","\n");var k=m.split(/(\n)/g);for(var j=0;j<k.length;j++){if(k[j]===""){continue}var s=k[j].split(/( )/g);for(var q=0;q<s.length;q++){if(s[q]===""){continue}if(s[q]==="\n"){if(f!=null){r.push(f)}f=new WordRun();f.IsLineBreak=true;f.Alignment=p.Alignment===""||p.Alignment==="left"?f.Alignment:p.Alignment;r.push(f);f=null}else{if(s[q]===" "){if(f!=null){r.push(f)}f=new WordRun();f.IsSpace=true;var o=c(p,n,s[q]);o.Width=b(p,n);f.AddTextRun(o);r.push(f);f=null}else{if(f===null){f=new WordRun()}var o=c(p,n,s[q]);f.AddTextRun(o)}}}}}if(f!=null){r.push(f)}$(n).children().remove();return r};function b(g,f){return c(g,f,"X X").Width-c(g,f,"XX").Width}function c(k,i,h){var j=new Object();j.TextStyle=k;j.Tspan=a(h,j.TextStyle);i.appendChild(j.Tspan);j.Width=h.length*12;j.Height=12;try{var f=j.Tspan.getClientRects()[0];if(f==null){}else{j.Width=f.width;j.Height=(f.height)}}catch(g){LogErrorMessage("WordRun.GetTextRun: "+h,g)}$(i).children().remove();return j}function d(f){var h=new Object();h.Font=MyBrowserProperties.Public_GetDefaultFont();h.Color="Black";h.Bold=false;h.Italic=false;h.Strike=false;h.UnderLine=false;h.FontSize=10;h.Alignment="left";h.Shift="";try{if(f.attributes==null){return h}h.Strike=f.attributes.strike==null?false:f.attributes.strike;h.UnderLine=f.attributes.underline==null?false:f.attributes.underline;h.Color=f.attributes.color==null?"black":f.attributes.color;h.Alignment=f.attributes.align;h.Font=f.attributes.font==null?h.Font:f.attributes.font;h.FontSize=f.attributes.size==null?h.FontSize:f.attributes.size;h.Shift=f.attributes.script==null?h.Shift:f.attributes.script;h.Font=h.Font.replaceAll2("_"," ").replaceAll2('"',"").replaceAll2("'","");if(h.Font.indexOf(" ")>=0){h.Font='"'+h.Font+'"'}}catch(g){LogErrorMessage("WordRun.GetTextStyle:",g)}return h}function a(i,j){var h="";h+="font-family:"+j.Font+";";h+="fill: "+j.Color+";";if(j.Bold){h+="font-weight:bold;"}if(j.Italic){h+="font-style:italic;"}if(j.Shift=="sub"){h+="font-size:"+(j.FontSize*0.75)+"pt;";h+="baseline-shift: sub; "}else{if(j.Shift=="super"){h+="font-size:"+(j.FontSize*0.75)+"pt;";h+="baseline-shift: super; "}else{h+="font-size:"+j.FontSize+"pt;"}}if(j.UnderLine){if(j.Strike){h+="text-decoration: underline, line-through;"}else{h+="text-decoration: underline;"}}else{if(j.Strike){h+="text-decoration: line-through;"}}var g=document.createElementNS("http://www.w3.org/2000/svg","tspan");g.setAttributeNS(null,"style",h);g.setAttributeNS(null,"class","DisableSelection");var f=document.createTextNode(i);g.appendChild(f);return g}return e}();var WordRunRenderHelper=function(){var c=new Object();c.OneLineOffset=1.075;c.RenderText=function(l,B,E,n,o,d){if(l==null||l.length==0){return}while(l.length>2&&l[l.length-1].insert=="\n"){l.pop()}var g="";var u=0;var f=0;var x=-1*d;E.children().remove();var z=B.Left;var A=B.Top;var w=B.Width+z;var J=B.Height;if(J=="Infinity"){J=100}var C=a(z,w,A,"",null,0,false,x);E.append(C);var M=WordRunHelper.GetWordRuns(l,C);if(M==null||M.length==0){try{LogErrorMessage("RenderText.Wordruns are null...",{message:"Deltas: "+JSON.stringify(l),stack:""})}catch(m){LogErrorMessage("RenderText.Wordruns are null.On logging errors",m)}}var h=z;var k=A;var v=1;var s=1.1;E.children().remove();var D=[];C=a(z,w,A,"",M,0,n,x);E.append(C);for(var p=0;p<M.length;p++){var L=M[p];var H=L.TextRuns;if(L==null){try{LogErrorMessage("Word run is null...",{message:"Deltas: "+JSON.stringify(l)+" word runs: "+JSON.stringify(M),stack:""})}catch(m){LogErrorMessage("Word run is null... Error on debug info",m)}continue}if(L.IsLineBreak){v++;if(C.clientHeight==0){k+=10}else{k+=C.clientHeight*s}h=z;if(UseSummerNote&&p==0){}else{D.push(C);C=a(z,w,k,"",M,p,n,x);E.append(C)}continue}if(h!=z&&h+L.Width*CellPickerHelper.Props.WidthRatio>w){v++;k+=C.clientHeight*s;h=z;D.push(C);C=a(z,w,k,"",M,p,n,x);E.append(C)}if(L.IsSpace&&h==z){continue}for(var q=0;q<L.TextRuns.length;q++){var G=H[q];C.appendChild(G.Tspan);h+=G.Width*CellPickerHelper.Props.WidthRatio}}D.push(C);var K=0;var r=10;var I=0;var t=0.8*CellPickerHelper.Props.WidthRatio;for(var p=0;p<D.length;p++){if(p===D.length-1&&D[p].innerHTML===""){continue}if(D[p].innerHTML!=""){K+=(D[p].getBoundingClientRect().height*t);r=(D[p].getBoundingClientRect().height*t);I++}else{K+=r}}var y=A;if(o){y=-1*(B.Top+(B.Height))}if(K<J){y+=(J-K)/2}else{if(I===1&&K*0.7<J){K*=WordRunRenderHelper.OneLineOffset;y+=(J-K)/2}else{var F=(D[0].getBoundingClientRect().height*t);y-=F*0.25}}r=10;for(var p=0;p<D.length;p++){var F=(D[p].getBoundingClientRect().height*t);if(F===0){F=r}else{r=F}y+=F*0.8;D[p].removeAttributeNS(null,"transform");D[p].setAttributeNS(null,"y",y);y+=F*0.1}};function b(f){var d=new Object();var h=Number(f.attr("x"));var i=Number(f.attr("y"));var g=Number(f.attr("width"));var e=Number(f.attr("height"));d.Left=h;d.Width=g;d.Top=i;d.Height=e;return d}function a(o,l,s,k,q,f,h,m){m=m||0;var r=o;var d="";var p="";if(UseSummerNote){if(q!=null&&q.length>0){for(var j=f;j>=0;j--){if(q[j]==null){try{LogErrorMessage("CreateTextBlock.Word run is null...",{message:"word runs: "+JSON.stringify(q),stack:""})}catch(g){LogErrorMessage("CreateTextBlock.Word run is null... Error on debug info",g)}continue}if(q[j].IsLineBreak){d=q[j].Alignment;break}}if(d===""){for(var j=f;j<q.length;j++){if(q[j]==null){try{LogErrorMessage("CreateTextBlock.2.Word run is null...",{message:"word runs: "+JSON.stringify(q),stack:""})}catch(g){LogErrorMessage("CreateTextBlock.2.Word run is null... Error on debug info",g)}continue}if(q[j].IsLineBreak){d=q[j].Alignment;break}}}}}if(UseQuill){if(q!=null){for(var j=f+1;j<q.length;j++){if(q[j].IsLineBreak){d=q[j].Alignment;break}}}}d=d===""?"center":d;if(h){if(d=="right"){r=-1*o;p="text-anchor: end;"}else{if(d=="center"){r=-1*(o+l)/2;p="text-anchor: middle;"}else{p="text-anchor: start;";r=-1*l}}}else{if(d=="right"){r=l;p="text-anchor: end;"}else{if(d=="center"){r=(o+l)/2;p="text-anchor: middle;"}else{p="text-anchor: start;"}}}var n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttributeNS(null,"x",r);n.setAttributeNS(null,"y",s);n.setAttributeNS(null,"style",p);n.setAttributeNS(null,"transform","rotate("+m+")");if(k!=null&&k!=""){n.setAttributeNS(null,"id",k)}return n}return c}();function CellSorter(){this.Public_ShowCellSorterDialog=function(){ClearActiveState();MyPointers.Dialog_ReorderCells_Grid.children().remove();MyPointers.Dialog_ReorderCells_Grid.css("width",(StoryboardContainer.Cols*54)+"px");MyPointers.Dialog_ReorderCells_GridWrapper.css("width",((StoryboardContainer.Cols*54)+6)+"px").css("height",((StoryboardContainer.Rows*54)+6)+"px");var b=StoryboardContainer.Cols*StoryboardContainer.Rows;for(var a=0;a<b;a++){MyPointers.Dialog_ReorderCells_Grid.append('<li class="ui-state-default" id="reorder_cell_'+(a+1)+'">'+(a+1)+"</li>")}MyPointers.Dialog_ReorderCells.modal()};this.Public_RearrangeCells=function(){var f=0;var g=[],j=[];for(var h=0;h<StoryboardContainer.Rows;h++){for(var e=0;e<StoryboardContainer.Cols;e++){var a=MyPointers.Dialog_ReorderCells_Grid.children()[f];var b=a.getAttribute("id");b=b.replace("reorder_cell_","");b-=1;var c=b%StoryboardContainer.Cols;var d=Math.floor(b/StoryboardContainer.Cols);g.push({oldCol:c,oldRow:d,newCol:e,newRow:h});j.push({oldCol:e,oldRow:h,newCol:c,newRow:d});f++}}UndoManager.register(undefined,UndoRearrangeCells,[j],"",undefined,UndoRearrangeCells,[g],"");this.Public_ApplyRearrangeCells(g);MyPointers.Dialog_ReorderCells.modal("hide")};this.Public_ApplyRearrangeCells=function(e){var d=0;StoryboardContainer.Public_ChangeCellOrder(e);if(CellConfiguration.HasTitle||CellConfiguration.HasDescription){var f=null;var b=null;if(CellConfiguration.HasTitle){f=this.Private_GetTextableGrid(MyIdGenerator.GenerateTitleCellId)}if(CellConfiguration.HasDescription){b=this.Private_GetTextableGrid(MyIdGenerator.GenerateDescriptionCellId)}for(d=0;d<e.length;d++){var a=e[d];if(a.newCol!=a.oldCol||a.newRow!=a.oldRow){if(CellConfiguration.HasTitle){var g=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateTitleCellId(a.newRow,a.newCol));this.Private_MoveUnmovableText(g,f[a.oldCol][a.oldRow])}if(CellConfiguration.HasDescription){var c=MyShapesState.Public_GetShapeStateById(MyIdGenerator.GenerateDescriptionCellId(a.newRow,a.newCol));this.Private_MoveUnmovableText(c,b[a.oldCol][a.oldRow])}}}}};this.Private_MoveUnmovableText=function(b,a){if(b==null||a==null){return}b.TextState.CopyFontStyles(a.TextStyles);b.ColorableState.Public_CopyColorStyles(a.ColorStyles);b.UpdateDrawing()};this.Public_CancelRearrangeCells=function(){MyPointers.Dialog_ReorderCells.modal("hide")};this.Private_GetTextableGrid=function(h){var c=new Array();try{for(var a=0;a<StoryboardContainer.Cols;a++){c[a]=new Array();for(var f=0;f<StoryboardContainer.Rows;f++){var d=h(f,a);var g=new Object();g.TextStyles=MyShapesState.Public_GetShapeStateById(d).TextState.Public_GetFontStyles();g.ColorStyles=MyShapesState.Public_GetShapeStateById(d).ColorableState.Public_GetColorStyles();c[a][f]=g}}}catch(b){}return c}};function ColorUpdaterBox(){this.Private_ActiveShapeId="";this.Private_ColorTable=$("#ColorUpdaterBoxTable");this.Public_PrepColorControls=function(c,d,a){var b=false;if(a.Id!=this.Private_ActiveShapeId){b=true}if(MyPointers.Controls_UpdateColor.css("display")==="none"){b=true}if(b){this.Private_AddColors(a)}else{this.Private_UpdateColors(a)}this.Private_ActiveShapeId=a.Id;this.Private_MakeVisible(c,d)};this.HideUpdateColors=function(){var a=MyPointers.Controls_UpdateColor.css("display");if(a!="none"){MyPointers.Controls_UpdateColor.css("display","none");$(".sp-container").remove()}};this.Private_MakeVisible=function(a,b){MyPointers.Controls_UpdateColor.css("left",a);MyPointers.Controls_UpdateColor.css("top",b);MyPointers.Controls_UpdateColor.css("display","block")};this.Private_UpdateColors=function(b){var m=b.Public_GetColorRegions();for(var f=0;f<m.length;f++){var a=b.Public_GetColorForRegion(m[f]);var l=m[f];if(l==""){continue}try{var k=$("#ColorSelector_"+l+"_color_picker");if(k.spectrum("container").attr("class").indexOf("hidden")>0){k.spectrum("set",a)}for(var h=1;h<7;h++){var g=this.Private_GenerateColorCellId(l,h);var c=$("#"+g);c.html("");if(a===c.css("background-color")){c.html(this.Private_GenerateColoredX(a))}}}catch(d){}}};this.Private_AddColors=function(b){var j,f;try{this.Private_ColorTable.children().remove();$(".sp-container").remove();j=b.Public_GetColorRegions();for(f=0;f<j.length;f++){if(j[f]==""){continue}var c=b.Public_GetColorWheelForRegion(j[f]);var a=b.Public_GetColorForRegion(j[f]);if(c==null||c==undefined){var d=new Object();d.message="No palette: "+j[f];d.stack="";LogErrorMessage("Private_AddColors: No Color",d);continue}var k=b.Public_GetTitleForRegion(j[f]);if(k==null||k==""||k==undefined){k=c.GetTitle()}var h="";if(f>0){h="<tr>";h+='<td colspan="7" class="BufferRow"></tr>';h+="</tr>"}h+="<tr>";h+='<td  class="ColorPickerTitleCell">'+k+"</td>";h+="<td>";h+='<table class="color-selection-block">';h+="<tr>";h+=this.Private_GenerateColorCell(j[f],1,c.Color1,a);h+=this.Private_GenerateColorCell(j[f],2,c.Color2,a);h+=this.Private_GenerateColorCell(j[f],3,c.Color3,a);h+=this.Private_GenerateColorCell(j[f],4,c.Color4,a);h+=this.Private_GenerateColorCell(j[f],5,c.Color5,a);h+=this.Private_GenerateColorCell(j[f],6,c.Color6,a);h+="</tr>";h+="</table>";h+="</td>";h+=this.Private_GenerateColorPickerCell(j[f],a);h+="</tr>";this.Private_ColorTable.append(h);var g=$("#ColorSelector_"+j[f]+"_color_picker");g.spectrum({color:a,showInput:true,showAlpha:false,showPalette:true,localStorageKey:"StoryboardThat",clickoutFiresChange:true,showInitial:true,change:UpdateColorRegionFromColorPicker,move:UpdateColorRegionFromColorPickerPreview,hide:UpdateColorRegionFromColorPickerHide})}$("[id^=ColorSelector_div]").click(UpdateColorRegion)}catch(d){throw d+" - Debug: "+f+", "+j.join(",")}};this.Private_GenerateColorPickerCell=function(c,a){var b="ColorSelector_"+c+"_color_picker";return'<td  class="ColorPickerInput"><input id="'+b+'" type="text" /></td>'};this.Private_GenerateColorCell=function(f,c,d,a){var e=this.Private_GenerateColorCellId(f,c);var b="<td>";b+='<div id="'+e+'" class="ColorPickerCell" style=" background-color: '+d+'; ">';if(a===d){b+=this.Private_GenerateColoredX(a)}b+="</div></td>";return b};this.Private_GenerateColorCellId=function(b,a){return"ColorSelector_div_"+b+"_cell_"+a};this.Private_GenerateColoredX=function(a){try{if(a===null){return""}var d=a.luma();var b=(d>=165)?"000":"fff";return'<span class="selected-color-x" style="color:#'+b+'">X</span>'}catch(c){return""}}};function LoadHelpTopic(a){MyPointers.HelpTopicArea.load(a);trackVirtualPageView(a)};function MainControlsBox(){this.TextControls=new TextControlsBox();this.ColorUpdateControls=new ColorUpdaterBox();this.HideControlsBox=function(){this.Private_HideMultiControlsBox();this.Private_HideSingleControlsBox()};this.Private_HideSingleControlsBox=function(){MyPointers.Controls_ShapeControls.css("display","none");this.TextControls.HideTextControlsBox();this.ColorUpdateControls.HideUpdateColors()};this.Private_HideMultiControlsBox=function(){MyPointers.Controls_MultiShapeControls.css("display","none")};this.DrawMainControlsBox=function(){var a=MyShapesState.Property_SelectedCount();if(a===0){return}if(a===1){this.Private_HideMultiControlsBox();this.Private_DrawSingleShapeControlsBox()}else{this.Private_HideSingleControlsBox();this.Private_DrawMultipleShapeControlsBox()}};this.Private_DrawMultipleShapeControlsBox=function(){var b=this.Private_CalculateMutlipleShapesArea();var m=b.X;var n=b.Y;var l=b.Width;var h=b.Height;var i=45;var j=MyPointers.Tabs.width()-i;m+=l+i;var e=MyPointers.Controls_MultiShapeControls.width();var k=m+e;var f=document.getElementById("CoreSvg").getBoundingClientRect();var g=(f.width-2);if(k>(MyPointers.SvgContainer.width()+MyPointers.SvgContainer.scrollLeft())||(k>g&&k>MyPointers.SvgContainer.width())){m=b.X-i-e}if(n<MyPointers.SvgContainer.scrollTop()){n=MyPointers.SvgContainer.scrollTop()+10}var c=StoryboardXtoPageX(m);var d=StoryboardYtoPageY(n);MyPointers.Controls_MultiShapeControls.css("display","block");MyPointers.Controls_MultiShapeControls.css("left",c);MyPointers.Controls_MultiShapeControls.css("top",d);if(MyBrowserProperties.IsSafari5||MyBrowserProperties.IsOldIE){$("#multiSelectControlsBoxTable tr.colorfilterrow").hide()}else{$("#multiSelectControlsBoxTable tr.colorfilterrow").show();var a=$("#multiSelectControlsBoxTable tr.colorfilterrow td.filter-dropdown-wrapper ul.dropdown-menu");a.parent().find("button.btn.btn-label").html(MyLangMap.GetText("text-filter-select")+' <span class="caret"></span>');a.find("li").removeClass("active")}};this.Private_DrawSingleShapeControlsBox=function(){var s=MyShapesState.Public_GetFirstSelectedShapeState();var u=s.IsTextable();var n=s.IsMultiTextable();(u&&n)?$("#EditDivMultiTextable").show():$("#EditDivMultiTextable").hide();OpacityHelper.setSliderValue(Math.round(s.opacity*100));if(s.isGroupObject){$("#UnGroupObject").show();$("#UnGroupRow").show()}else{$("#UnGroupObject").hide();$("#UnGroupRow").hide()}if(u&&(s.Id.startsWith("c_descr")||s.Id.startsWith("c_title"))){if(s.ColorableState.Private_Colorable===void 0){console.log("Fixed Private_Colorable");s.ColorableState.Private_Colorable=true}if(s.ColorableState.Regions===void 0){console.log("Fixed Regions");s.ColorableState.Regions={}}if(s.ColorableState.Regions.Textables===void 0){console.log("Fixed Regions.Textables");s.ColorableState.Regions.Textables="rgb(255, 255, 255)"}if(s.ColorableState.Titles===void 0){console.log("Fixed Titles");s.ColorableState.Titles={}}if(s.ColorableState.Titles.Textables===void 0){console.log("Fixed Titles.Textables");s.ColorableState.Titles.Textables="Fill"}}var a=this.Private_CalculateMutlipleShapesArea();var D=StoryboardXtoPageX(a.X);var E=a.Y;var w=a.Width;var k=a.Height;var l=20;if(s.isSceneItem){$(".artpen-colors").show();$(".black-out").hide()}else{$(".artpen-colors").hide();$(".black-out").show()}if(s.Angle%180>=45&&s.Angle%180<=135){l+=25}var b=s.Property_IsColorable();var o=s.Public_IsPosable();var t=s.Public_IsSmartScene();var f=$("#controlsBox").width();var c=$("#controlsBox").height();var m=s.Movable;if(s.IsLocked==true){$("#lockButton").css("display","none");$("#unlockButton").css("display","")}else{$("#lockButton").css("display","");$("#unlockButton").css("display","none")}if(b){f=Math.max(MyPointers.Controls_UpdateColor.width(),f);c+=10+MyPointers.Controls_UpdateColor.height()}if(u){f=Math.max(MyPointers.Controls_TextableControls.width(),f,375);c+=10+MyPointers.Controls_TextableControls.height()}D+=w+l;var A=MyPointers.SvgContainer.scrollLeft();var B=MyPointers.SvgContainer.width()+MyPointers.SvgContainer.scrollLeft();var g=document.getElementById("CoreSvg").getBoundingClientRect();var h=(g.width-2);var q=D+f+MyPointers.SvgContainer.scrollLeft();if(q>B||(q>h&&q>MyPointers.SvgContainer.width())){D=StoryboardXtoPageX(a.X)-l-f;if(D<A){D=A+10}}if(m==false){c-=(10+MyPointers.Controls_ShapeControls.height())}var C=MyPointers.SvgContainer.scrollTop();var z=MyPointers.SvgContainer.height()+MyPointers.SvgContainer.scrollTop();E=E-c/2;if(E<C){E=C+10}if(E+c>z){E=Math.max(C+10,z-c)}var d=D;var e=StoryboardYtoPageY(E);if(m){MyPointers.Controls_ShapeControls.css("display","block");MyPointers.Controls_ShapeControls.css("left",d);MyPointers.Controls_ShapeControls.css("top",e)}var p=$("#EditPoseRow");var i=$("#EditItemOptionsRow");p.hide();i.hide();if(o){if(s.Public_IsInstaPosable()){p.show()}else{i.show()}}var j=$("#EditSceneRow");if(t){j.show()}else{j.hide()}var r=e;if(m){r+=10+MyPointers.Controls_ShapeControls.height()}if(b){this.ColorUpdateControls.Public_PrepColorControls(d,r,s)}if(u){if(n){$("#EditDivMultiTextable").show()}else{if($("#textableControls").parent().attr("id")=="MultiTextable-content"){$("#textableControls").addClass("ControlsBox");var v=$("#textableControls").detach();$(document.documentElement).append(v)}$("#EditDivMultiTextable").hide();if(b){r+=MyPointers.Controls_UpdateColor.height()+10}this.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,d,r,s)}}if(MyBrowserProperties.IsSafari5||MyBrowserProperties.IsOldIE){$("#controlsBoxTable tr.colorfilterrow").hide();$("#single-select-filter-dropdown").hide()}};this.Private_CalculateMutlipleShapesArea=function(){var c=undefined;var d=undefined;var f=undefined;var a=undefined;var e=MyShapesState.Public_GetAllSelectedShapeStates();for(var b=0;b<e.length;b++){boxArea=e[b].Public_GetImaginaryOuterBox();if(c===undefined){c=boxArea.Left;d=boxArea.Right;f=boxArea.Top;a=boxArea.Bottom}c=Math.min(c,boxArea.Left);d=Math.max(d,boxArea.Right);f=Math.min(f,boxArea.Top);a=Math.max(a,boxArea.Bottom)}return{X:c,Y:f,Width:d-c,Height:a-f}}};var MainWindowControls=function(){function a(){try{$("#help-btn").click(ShowHelpDialog);$("#undo-btn").click(Undo);$("#redo-btn").click(Redo);$("#addcell-btn").click(ChangeLayoutDialog);$("#movecell-btn").click(CellPickerHelper.StartMoveCell);$("#copycell-btn").click(CellPickerHelper.StartCopyCell);$("#bt-copy-cell-done").click(CellPickerHelper.Finish);$("#bt-copy-cell-undo").click(CellPickerHelper.UndoHelper);$("#change-storyboard-type-btn").click(ChangeStoryboardTypeDialog);$("#save-btn").click(function(){SaveHelper.SaveStoryboard(false,true,false)});$("#save-as-btn").click(function(){SaveHelper.SaveStoryboard(false,true,false)});$("#saveonly-btn").click(function(){SaveHelper.SaveStoryboard(true,true,true)});$("#savequit-btn").click(function(){SaveHelper.SaveStoryboard(false,true,true)});$("#save-choices-btn").click(function(){$("#SaveChoicesDialog").modal()});$("#even-more-btn").click(ShowAdvancedButtons);$("#cell-size-btn").click(ShowChangeCellSize);$("#gridlines-btn").click(ToggleGridLines);$("#title-caps-btn").click(GestureHelper.CapitalizeTitles);$("#title-emphasis-btn").click(GestureHelper.TitleEmphasis);$("#description-emphasis-btn").click(GestureHelper.DescriptionEmphasis);$("#fullscreen-btn").click(ToggleFullScreen);$("#clear-btn").click(DeleteAll)}catch(d){LogErrorMessage("MainWindowControls.BottomControls_ClickHandlers",d)}}function b(){try{$("#undo-btn").prop("disabled",true);$("#redo-btn").prop("disabled",true);if(ExtraSetup.EnableSaveButton==false){$("#save-btn, #saveonly-btn, #savequit-btn").prop("disabled",true);$("#saveAndContinueWrapper").hide();$("#saveOnlyWrapper").hide()}}catch(d){LogErrorMessage("MainWindowControls.BottomControls_ClickHandlers",d)}}var c=new Object();c.Init=function(){a();b()};return c}();var PosableTypeEnum={Character:1,SmartItem:2,};function PosableControlsBox(a,b){this.Private_ActiveShape=a;this.Private_PoseAreaSvg=$("#PoseAreaSvg");this.Private_PoseAreaOptions=$("#PoseOptions");this.Private_PositionSwap1=null;this.Private_PositionSwap2=null;this.Private_PoseWidth=275;this.Private_PoseHeight=500;this.Private_PartSize=45;this.Private_PoseAreaSize_SinglePose="675px";this.Private_PoseAreaSize_MultiPose="800px";this.Private_SidePoseHeight=114;this.Private_SidePoseWidth=205;this.Public_UndoInfo=null;this.Public_IsCancel=false;this.Private_PrepareDialog=function(c){var d=this;$("#character-poser-title").hide();$("#smart-item-title").hide();$("#pose-dialog-update-pose-button").hide();$("#pose-dialog-update-smart-item-button").hide();if(c==PosableTypeEnum.Character){$("#character-poser-title").show();$("#pose-dialog-update-pose-button").show()}else{if(c==PosableTypeEnum.SmartItem){$("#smart-item-title").show();$("#pose-dialog-update-smart-item-button").show()}}this.Private_SetPosableSizes();MyPointers.Dialog_PoseImage.one("shown.bs.modal",this.Private_PrepareShapePostModalClosure(d));this.Private_ShowAdditionalPositions(false);this.Private_PositionSwap1=this.Private_GetPositionSwapAreas("1");this.Private_PositionSwap2=this.Private_GetPositionSwapAreas("2");this.Private_ResetSvgAreas();this.Public_UndoInfo=new Object;this.Public_UndoInfo.UndoPosition=a.Position;this.Public_UndoInfo.UndoActivePoseList=a.Public_GetPoseGroupList();this.Public_UndoInfo.UndoPreviousPoseList=a.Public_GetPreviousPoseList();if(this.Private_ActiveShape.Public_IsInstaPosable()){$("#insta-pose-dialog-selector").show()}else{$("#insta-pose-dialog-selector").hide()}MyPointers.Dialog_PoseImage.modal();this.Public_IsCancel=false;this.Private_ResetInstaPoses()};this.Private_GetPositionSwapAreas=function(c){var d="#position-swap-"+c+"-";var e=new Object();e.SvgArea=$(d+"svg");e.TitleArea=$(d+"title");e.DivArea=$(d+"div");return e};this.Private_ShowAdditionalPositions=function(f){var c=$("#PoseAreaSize");var e=$("#position-divider");var d=$("#position-choices");if(f){c.css("width",this.Private_PoseAreaSize_MultiPose);e.show();d.show()}else{c.css("width",this.Private_PoseAreaSize_SinglePose);e.hide();d.hide()}};this.Private_ResetSvgAreas=function(){this.Private_PoseAreaSvg.children().remove();this.Private_PoseAreaOptions.children().remove();this.Private_PositionSwap1.SvgArea.children().remove();this.Private_PositionSwap2.SvgArea.children().remove()};this.Private_InstaPoseClosure=function(d,c){return function(){var f=d.Private_ActiveShape.Public_GetPose(c);var e=a.Public_GetSafePoseArray(f);d.Private_ActiveShape.Public_BulkUpdatePoseGroups(e);d.Private_ActiveShape.Public_SetPreviousPoseList(f);d.Private_RedrawActiveCharacter()}};this.Private_PrepareShapePostModalClosure=function(c){return function(d){c.Private_RedrawActiveCharacter();c.Private_DisplayPoseOptions();var f=c.Private_HandleAdditionalPositions(c);MyCharacterPosistionLibrary.GetCharacterPositions(c.Private_ActiveShape.GlobalImageId,f)}};this.Private_RedrawActiveCharacter=function(){SvgCloner.CloneSvg("PoseAreaSvg",a.Id,"Poser",this.Private_PoseWidth,this.Private_PoseHeight)};this.Private_UpdateColors=function(c){var k=this.Private_ActiveShape.ColorableState.Public_GetRegionList();for(var e=0;e<k.length;e++){var h=k[e];var g=this.Private_ActiveShape.ColorableState.Public_GetColorForRegion(h);var d="[id^="+h+"_]";var l=c.find(d);for(var f=0;f<l.length;f++){l[f].setAttributeNS(null,"fill",g)}}};this.Private_HandleAdditionalPositions=function(c){return function(d){if(d==null){return}if(d.length==1){return}c.Private_ShowAdditionalPositions(true);var f=0;for(var e=0;e<d.length;e++){if(d[e].Position==c.Private_ActiveShape.Position){f=d[e].Order}}if(f==0){c.Private_AddCharacterPosition(c.Private_PositionSwap1,d[1]);c.Private_AddCharacterPosition(c.Private_PositionSwap2,d[2])}if(f==1){c.Private_AddCharacterPosition(c.Private_PositionSwap1,d[0]);c.Private_AddCharacterPosition(c.Private_PositionSwap2,d[2])}if(f==2){c.Private_AddCharacterPosition(c.Private_PositionSwap1,d[1]);c.Private_AddCharacterPosition(c.Private_PositionSwap2,d[0])}}};this.Private_AddCharacterPosition=function(i,k){var l=MyLangMap.GetText("ST-"+k.Title);var c=k.Svg;var h=k.Position;var j=SbtDataEnum.Id_DisplayOption+"_"+h;var e=SbtDataEnum.Id_DisplayOption+"_outer_"+h;var f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("id",e);i.SvgArea.append(f);var g=$("#"+e);StoryboardContainer.UpdateGradientIds(g);g.append(c);g.children()[0].setAttributeNS(null,"id",j);MyShapeMetaData.LookForMetaData(j);this.Private_UpdateColors($("#"+j));i.TitleArea.html(l);i.DivArea.attr("title",MyLangMap.GetText("text-character-position-change")+" "+l);var m=SbtMath.ScaleAndCenter(e,this.Private_SidePoseWidth,this.Private_SidePoseHeight,5,5);f.setAttributeNS(null,"transform","translate("+m.CenterX+", "+m.CenterY+") scale("+m.Scale+")");g.parent().attr("width",this.Private_SidePoseWidth+"px");g.parent().attr("height",this.Private_SidePoseHeight+"px");var d=function(n,o){return function(){var q=n.Private_ActiveShape.Public_GetPoseGroupList();var u=n.Private_ActiveShape.Public_GetPreviousPoseList();n.Private_ActiveShape.ChangeCharacterPosition(o);n.Private_ResetSvgAreas();n.Private_DisplayPoseOptions();var r=n.Private_ActiveShape;var t=r.PosableState.Public_GetSafePoseArray(u);r.Public_BulkUpdatePoseGroups(t);r.PosableState.Public_SetPreviousPoseList(q);var p=r.PosableState.Public_GetSafePoseArray(q);r.Public_BulkUpdatePoseGroups(p);n.Private_RedrawActiveCharacter();var s=n.Private_HandleAdditionalPositions(n);MyCharacterPosistionLibrary.GetCharacterPositions(n.Private_ActiveShape.GlobalImageId,s)}}(this,h);i.DivArea.off("click");i.DivArea.click(d)};this.Private_DisplayPoseOptions=function(){var c=this.Private_PoseAreaOptions;c.children().remove();var e=this.Private_ActiveShape.Public_GetPoseGroups();for(var d=0;d<e.length;d++){if(e[d].PoseType==SbtDataEnum.PoseType_Swap){this.Private_RenderCharacterSwapPose(c,e[d])}else{if(e[d].PoseType==SbtDataEnum.PoseType_Tilt){this.Private_RenderTiltPose(c,e[d])}else{if(e[d].PoseType==SbtDataEnum.PoseType_LibrarySwap){this.Private_RenderLibrarySwapPose(c,e[d])}}}}};this.Private_RenderTiltPose=function(j,r){j.append('<h3 class="PosableSelectionTitle">'+r.Title+"</h3>");var s=r.Public_GetTiltOptions();var w=r.Title.replaceAll(" ","")+"_wrapper_div";j.append('<div id="'+w+'" class="PosableSelectionArea"></div>');var n=GetGlobalById(r.Public_GetTiltableId());var m=n.getBBox();var p=m.x+(m.width/2);var q=m.y+(m.height/2);var h=$("#"+w);var o=$("#"+r.Public_GetPivotId());for(var k=0;k<s.length;k++){var t=s[k];var l=(r.Title+"_"+t.Degrees).replaceAll(" ","");var g=l+"_div";h.append('<div id="'+g+'" class="PosableSelection" title="'+t.Public_GetTitle()+'"></div>');var u=$("#"+g);var f=$("#"+r.Public_GetTiltableId()).clone();f.attr("transform","");var v=this.Private_CloneCenterAndCreateSvg(f,l,u,t.Degrees,p,q);var e=$("#"+v.InnerSvgId);var c=e.find("[id*="+r.Public_GetClearId()+"]").remove();var d=function(x,y,z,i){return function(){i.Public_UpdatePoseOption(y,z);x.Private_RedrawActiveCharacter()}}(this,r,t,this.Private_ActiveShape);$("#"+g).click(d)}};this.Private_RenderLibrarySwapPose=function(g,j){g.append('<h3 class="PosableSelectionTitle">'+j.Title+"</h3>");var l=j.Public_GetLibrarySwapOptions();var n=j.Title.replaceAll(" ","")+"_wrapper_div";g.append('<div id="'+n+'" class="PosableSelectionArea"></div>');var f=$("#"+n);for(var i in l){if(l.hasOwnProperty(i)){var k=l[i];var h=(j.Title+"_"+k.LibrarySwapId).replaceAll(" ","");var e=h+"_div";f.append('<div id="'+e+'" class="PosableSelection" title="'+k.Public_GetTitle()+'"></div>');var m=$("#"+e);var d=MyGlobalSwapLibrary.Public_GetSvgById(k.LibrarySwapId,this.Private_ActiveShape.Position).clone();this.Private_CloneCenterAndCreateSvg(d,h,m);RecursivelyUpdateChildrenIds(d,SbtDataEnum.GlobalLibraryId,SbtDataEnum.Id_DisplayOption);this.Private_UpdateColors(d);var c=function(p,q,r,o){return function(){o.Public_UpdatePoseOption(q,r);p.Private_RedrawActiveCharacter()}}(this,j,k,this.Private_ActiveShape);$("#"+e).click(c)}}};this.Private_RenderCharacterSwapPose=function(g,j){g.append('<h3 class="PosableSelectionTitle">'+j.Title+"</h3>");var l=j.Public_GetSwapOptions();var o=j.Title.replaceAll(" ","")+"_wrapper_div";g.append('<div id="'+o+'" class="PosableSelectionArea"></div>');var f=$("#"+o);for(var i in l){if(l.hasOwnProperty(i)){var k=l[i];var h=j.Title.replaceAll(" ","")+"_"+k.Public_GetInternalId();var e=h+"_div";f.append('<div id="'+e+'" class="PosableSelection" title="'+k.Public_GetTitle()+'"></div>');var m=$("#"+e);var d=k.Public_GetPoseSvg(j.GlobalImageId).clone();var n=this.Private_CloneCenterAndCreateSvg(d,h,m);d=$("#"+n.InnerSvgId);RecursivelyUpdateChildrenIds(d,SbtDataEnum.Id_Storage,SbtDataEnum.Id_DisplayOption);this.Private_UpdateColors(d);var c=function(q,r,s,p){return function(){p.Public_UpdatePoseOption(r,s);q.Private_RedrawActiveCharacter()}}(this,j,k,this.Private_ActiveShape);$("#"+e).click(c)}}};this.Private_CloneCenterAndCreateSvg=function(d,g,c,k,h,i){var o=this.Private_PartSize;var n=this.Private_PartSize;var f=g+"_translate";var p=g+"_swap_part";var m=SvgCreator.CreateBlankSvg(o,n);var e=SvgCreator.CreateSvgGroup(f);d.appendTo(e);d=e.lastChild;d.setAttribute("id",p);d.setAttribute("display","inline");m.appendChild(e);c.append(m);var l=SbtMath.ScaleAndCenter(f,o,n,0,0);var q="translate("+(l.CenterX)+","+l.CenterY+") scale("+l.Scale+")";if(k!=null&&h!=null&&i!=null){q+="rotate("+k+", "+h+", "+i+")"}e.setAttributeNS(null,"transform",q);var j=new Object();j.InnerSvgId=p;return j};this.Private_PrepareDialog(b)}PosableControlsBox.prototype.Private_SetPosableSizes=function(){var a=$(window).width()>900;if(a){this.Private_PoseWidth=275;this.Private_PoseHeight=500;this.Private_PartSize=45;this.Private_PoseAreaSize_SinglePose="675px";this.Private_PoseAreaSize_MultiPose="800px";this.Private_SidePoseHeight=205;this.Private_SidePoseWidth=114}else{this.Private_PoseWidth=200;this.Private_PoseHeight=392;this.Private_PartSize=30;this.Private_PoseAreaSize_SinglePose="590px";this.Private_PoseAreaSize_MultiPose="590px";this.Private_SidePoseHeight=156;this.Private_SidePoseWidth=100}};PosableControlsBox.prototype.Private_ResetInstaPoses=function(){$("#Pose-Dialog-Angry").off("click");$("#Pose-Dialog-Speaking").off("click");$("#Pose-Dialog-Sad").off("click");$("#Pose-Dialog-Sleeping").off("click");$("#Pose-Dialog-Complaining").off("click");$("#Pose-Dialog-Holding").off("click");$("#Pose-Dialog-Confusion").off("click");$("#Pose-Dialog-Upset").off("click");$("#Pose-Dialog-Sit").off("click");$("#Pose-Dialog-Determined").off("click");$("#Pose-Dialog-Happy").off("click");$("#Pose-Dialog-Walking").off("click");$("#Pose-Dialog-Shouting").off("click");$("#Pose-Dialog-Scared").off("click");$("#Pose-Dialog-Angry").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Angry));$("#Pose-Dialog-Speaking").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Speaking));$("#Pose-Dialog-Sad").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Sad));$("#Pose-Dialog-Sleeping").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Sleeping));$("#Pose-Dialog-Complaining").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Complaining));$("#Pose-Dialog-Holding").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Holding));$("#Pose-Dialog-Confusion").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Confusion));$("#Pose-Dialog-Upset").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Upset));$("#Pose-Dialog-Sit").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Sit));$("#Pose-Dialog-Determined").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Determined));$("#Pose-Dialog-Happy").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Happy));$("#Pose-Dialog-Walking").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Walking));$("#Pose-Dialog-Shouting").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Shouting));$("#Pose-Dialog-Scared").click(this.Private_InstaPoseClosure(this,InstaPoseEnum.Scared))};function SmartSceneDialog(a){this._ActiveShape=a;this._PreviewSceneWidth=600;this._PreviewSceneHeight=400;this._PrepareDialog();this.CancelButtonPressed=false;this.UndoInfo_Colors;this.UndoInfo_SelectedSceneOptions}SmartSceneDialog.prototype._PrepareDialog=function(){this._PrepareDialog_PrepareUndo();this._PrepareDialog_SceneOptions();this._PrepareDialog_FigureOutSize();this.CancelButtonPressed=false;$("#Smart-Scene-Preview").children().remove();MyPointers.Dialog_SmartScene.one("shown.bs.modal",this._PrepareDialog_PostModalShown_Closure(this));MyPointers.Dialog_SmartScene.modal()};SmartSceneDialog.prototype._PrepareDialog_PostModalShown_Closure=function(a){return function(b){a._RedrawActiveScene()}};SmartSceneDialog.prototype._RedrawActiveScene=function(){SvgCloner.CloneSvg("Smart-Scene-Preview",this._ActiveShape.Id,"smart-scene-preview-area",this._PreviewSceneWidth,this._PreviewSceneHeight)};SmartSceneDialog.prototype._PrepareDialog_PrepareUndo=function(){this.UndoInfo_SelectedSceneOptions=this._ActiveShape.SmartSceneState.GetSelectedSceneOptions();this.UndoInfo_Colors=null;if(this._ActiveShape.Property_IsColorable()){this.UndoInfo_Colors=this._ActiveShape.ColorableState.Public_GetColorStyles()}};SmartSceneDialog.prototype._PrepareDialog_SceneOptions=function(){var g=$("#smart-scene-options");g.empty();var m=this._ActiveShape.SmartSceneState.SmartSceneItems;for(var b=0;b<m.length;b++){var k=m[b];g.append("<h2>"+k.GetTitle()+"</h2>");g.append('<div class="btn-group" data-toggle="buttons">');var h=g.children().last();for(var e=0;e<k.SmartSceneItemOptions.length;e++){var l=k.SmartSceneItemOptions[e];var c="sco-"+b+"-"+e;var a=l.IsActive?"checked":"";var d=l.IsActive?"active":"";h.append('<label class="btn btn-default smart-scene-button '+d+'">');h.children().last().append('<input id="'+c+'" type="radio" autocomplete="off" '+a+" >"+l.GetTitle());var f=this._CreateOptionClosure(this,k,e);$("#"+c).change(f)}}};SmartSceneDialog.prototype._PrepareDialog_FigureOutSize=function(){var a=$(window).width()>1000;if(a){$("#SmartSceneDialogSize").css("width","900px");this._PreviewSceneHeight=400;this._PreviewSceneWidth=600}else{$("#SmartSceneDialogSize").css("width","600px");this._PreviewSceneHeight=400;this._PreviewSceneWidth=300}};SmartSceneDialog.prototype._CreateOptionClosure=function(b,c,a){return function(d){if($(d.currentTarget).is(":checked")){c.ActivateSceneOption(a);b._RedrawActiveScene()}}};var TabRoller=function(){var f=new Object();var g={Up:1,Normal:2,Down:3};var b=new Object();b.TabRollerState=g.Normal;b.ContentPanelHeight=0;b.ActiveTabId=null;f.Up=function(){if(b.TabRollerState==g.Down){d()}else{e()}};f.Normal=function(){d()};f.Down=function(){if(b.TabRollerState==g.Up){d()}else{c()}};f.RefreshRollers_PostResize=function(){switch(b.TabRollerState){case g.Up:e();return;case g.Normal:d();return;case g.Down:c();return}};f.RefreshRollers_PostChangeTab=function(i){b.ActiveTabId=i;switch(b.TabRollerState){case g.Up:case g.Normal:d();return;case g.Down:c();return}};f.RefreshRollers_PostAdd=function(){if(b.TabRollerState!=g.Down){return}var i=$("#"+b.ActiveTabId).height();if(i!=b.ContentPanelHeight){TabRoller.Down()}};function e(){b.TabRollerState=g.Up;$(".content-wrapper").css("display","none");h()}function d(){b.TabRollerState=g.Normal;$(".content-wrapper").css("display","block");$(".content-wrapper").css("white-space","nowrap");$(".content-wrapper").css("max-height","none");$(".content-wrapper").css("overflow-x","scroll");$(".content-wrapper").css("overflow-y","auto");h()}function c(){b.TabRollerState=g.Down;b.ContentPanelHeight=$("#"+b.ActiveTabId).height();svgContainerHeight=parseInt(MyPointers.SvgContainer.css("height"));svgHeight=parseInt(MyPointers.CoreSvg.css("height"));var i=Math.max(b.ContentPanelHeight+svgContainerHeight-svgHeight-50,225);$(".content-wrapper").css("display","block");$(".content-wrapper").css("white-space","normal");$(".content-wrapper").css("max-height",i+"px");$(".content-wrapper").css("overflow-x","auto");$(".content-wrapper").css("overflow-y","scroll");b.ContentPanelHeight=$("#"+b.ActiveTabId).height();h()}function h(){StoryboardContainer.JiggleSvgSize();StoryboardContainer.SetCoreSvgDimensions();a()}function a(){if(b.ActiveTabId==null){if($(".content-wrapper").length>0){b.ActiveTabId=$(".content-wrapper").first().attr("id")}}var i=$("#tab-roller");var j=$("#top-nav-div");i.css("top",j.height());i.css("display","block")}return f}();function TextControlsBox(){this.Private_ActiveShapeId="";this.HideTextControlsBox=function(){MyPointers.Controls_TextableControls.css("display","none");this.Private_ActiveShapeId=""};this.Private_ResetColorSelector=function(){MyPointers.Controls_TextableControls_ColorSelector.spectrum({color:"#ccc",showInput:true,showAlpha:false,showPalette:true,localStorageKey:"StoryboardThat",clickoutFiresChange:true,showInitial:true,change:UpdateFontColor,move:PreviewUpdateFontColor,hide:UpdateFontColorHidden,})};this.PrepTextControls=function(h,d,i,a){try{try{if(UseQuill){var j=true;var f=(a.TextState.Public_GetQuillDeltas()===null);if(a.TextState.Public_GetQuillDeltas()===null&&quill.getLength()==1){j=false}if(j&&SbtLib.DeepCompareEquality(a.TextState.Public_GetQuillDeltas(),quill.getContents().ops)){j=false}if(j){quill.setContents(a.TextState.Public_GetQuillDeltas())}if(f){SbtQuillHelper.ResetToDefaults()}SbtQuillHelper.HandleWhiteText()}}catch(b){LogErrorMessage("TextControlBox.PrepTextContros",b)}try{if(UseSummerNote){SbtSummerNoteHelper.InitSummerNoteIfNeeded();var k=true;var f=(a.TextState.Public_GetQuillDeltas()===null);if(a.TextState.Public_GetQuillDeltas()===null&&SbtSummerNoteHelper.IsDefault()){k=false}if(k&&SbtLib.DeepCompareEquality(a.TextState.Public_GetQuillDeltas(),SbtSummerNoteHelper.GetDeltas())){k=false}if(f){SbtSummerNoteHelper.ResetToDefaults()}else{if(k){SbtSummerNoteHelper.UpdateForDeltas(a.TextState.Public_GetQuillDeltas())}}SbtSummerNoteHelper.HandleWhiteText()}}catch(b){LogErrorMessage("TextControlBox.PrepTextControls Summer",b)}h.css("left",d);h.css("top",i);h.css("display","block");if(UseQuill==false&&UseSummerNote==false){var g=$("#sizeSelector");MyPointers.Controls_TextableControls_TextArea.val(a.TextState.D[this.CurrentId].Text);g.val(a.TextState.D[this.CurrentId].FontSize);MyPointers.Controls_TextableControls_TextAlignmentSelectors.removeClass("active");MyPointers.Controls_TextableControls_TextAlignmentSelectors.filter("."+(a.TextState.D[this.CurrentId].TextAlignment||"middle")).addClass("active")}if(UseQuill==false&&UseSummerNote==false){this.Private_SetFontSelector(a.TextState.D[this.CurrentId].Font);MyPointers.Controls_TextableControls_ColorSelector.spectrum("set",a.TextState.D[this.CurrentId].FontColor);if(MyPointers.Controls_TextableControls_TextArea.is(":focus")==false){MyPointers.Controls_TextableControls_TextArea.focus()}this.Private_ResetColorSelector()}this.Private_ActiveShapeId=a.Id}catch(c){LogErrorMessage("TextControlsBox.PrepTextControls ",c)}};this.Private_SetFontSelector=function(a){MyPointers.Controls_TextableControls_FontSelector.fontSelector("UpdateDisplayName",a)}};var TimelineDateManager=function(){var b=function(g,h,m,l,j){try{var i=$("#timeline-"+h+"-cell-"+g).val();if(i==null||i.length==0){return j}var n=parseInt(i);if(n<m||n>l){return j}return n}catch(k){LogErrorMessage("TimelineDateManager._GetDatePart",k)}return j};var e=function(h,g){$("#timeline-use-"+h).prop("checked",g);if(g){$(".timeline-"+h).css("display","")}else{$(".timeline-"+h).css("display","none")}if(g==true){if(h=="second"){e("minute",true)}if(h=="minute"){e("hour",true)}if(h=="hour"){e("day",true)}if(h=="day"){e("month",true)}}if(g==false){if(h=="month"){e("day",false)}if(h=="day"){e("hour",false)}if(h=="hour"){e("minute",false)}if(h=="minute"){e("second",false)}}};var a=function(){if(f.Cols==10){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("warning-timeline-max-size"),type:"info",confirmButtonText:MyLangMap.GetText("warning-ok-button")});return}$("#timeline-row-cell-"+f.Cols).css("display","");f.Cols++};var d=function(){if(f.Cols==3){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("warning-timeline-min-size"),type:"info",confirmButtonText:MyLangMap.GetText("warning-ok-button")});return}f.Cols--;$("#timeline-row-cell-"+f.Cols).css("display","none")};var c=function(){$("#timeline-use-month").click(function(){e("month",$("#timeline-use-month").prop("checked"))});$("#timeline-use-day").click(function(){e("day",$("#timeline-use-day").prop("checked"))});$("#timeline-use-hour").click(function(){e("hour",$("#timeline-use-hour").prop("checked"))});$("#timeline-use-minute").click(function(){e("minute",$("#timeline-use-minute").prop("checked"))});$("#timeline-use-second").click(function(){e("second",$("#timeline-use-second").prop("checked"))});$("#timeline-add-cell").click(a);$("#timeline-remove-cell").click(d);e("hour",false);e("minute",false);e("second",false)};var f=new Object();f.Cols=0;f.GetSelectedDates=function(g){var h=[];for(var l=0;l<g;l++){var q=b(l,"year",-250000,250000,2000);var n=b(l,"month",1,12,1)-1;var j=b(l,"day",1,31,1);var k=b(l,"hour",1,12,0);var m=b(l,"minute",0,59,0);var o=b(l,"second",0,59,0);q=parseInt($("#timeline-year-era-cell-"+l).val())*q;k=(k==12?0:k)+parseInt($("#timeline-hour-am-cell-"+l).val());var p=new Date(q,n,j,k,m,o);p.setFullYear(q);h.push(p)}h=h.sort(function(i,r){return i>r});return h};f.PreparePopup=function(h){f.Cols=StoryboardContainer.Cols;var n=false;var l=false;var k=false;var j=false;var m=false;$("[id^=timeline-row-cell-]").css("display","");for(var g=StoryboardContainer.Cols;g<10;g++){$("#timeline-row-cell-"+g).css("display","none")}$("#timeline-cell-count").val(StoryboardContainer.Cols);if(h!=null){for(var q=0;q<h.length;q++){var r=h[q].getFullYear()>0?1:2;var o=h[q].getHours()<12?1:2;var p=h[q].getHours();if(p>12){p-=12}if(p==0){p=12}$("#timeline-year-cell-"+q).val(Math.abs(h[q].getFullYear()));$("#timeline-year-era-cell-"+q+" :nth-child("+r+")").prop("selected",true);$("#timeline-month-cell-"+q).val(h[q].getMonth()+1);$("#timeline-day-cell-"+q).val(h[q].getDate());$("#timeline-hour-cell-"+q).val(p);$("#timeline-hour-am-cell-"+q+" :nth-child("+o+")").prop("selected",true);$("#timeline-minute-cell-"+q).val(h[q].getMinutes());$("#timeline-second-cell-"+q).val(h[q].getSeconds());if(h[q].getMonth()>0){m=true}if(h[q].getDate()>1){j=true}if(h[q].getHours()>0){k=true}if(h[q].getMinutes()>0){l=true}if(h[q].getSeconds()>0){n=true}}}e("month",m);e("day",j);e("hour",k);e("minute",l);e("second",n)};c();return f}();function GroupAction(){var a=1;this.MakeGroup=function(b){var c=ShapesState.Public_ZSortShapeStates(MyShapesState.Public_GetAllSelectedShapeStates());if(c.length<=1){return}MyGroupAction.MakeGroupFromSelectedObjects(c)};this.MakeGroupFromSelectedObjects=function(q,n){var u=new Array();var o=new Array();var d=new Array();var f;var t=null;var k=null;var b=null;var p=null;var h=FindTopMostSVG_in_SelectedGroup(q);var j=$("#"+h).next();for(f=0;f<q.length;f++){var c=q[f].Public_GetImaginaryOuterBox();if(f==0||t>c.Top){t=c.Top}if(f==0||k>c.Left){k=c.Left}if(f==0||p<c.Right){p=c.Right}if(f==0||b<c.Bottom){b=c.Bottom}}var w=p-k;var v=b-t;var r=SvgCreator.CreateBlankSvg(w,v);r.setAttribute("viewBox",0+" "+0+" "+w+" "+v);var e=SvgCreator.CreateSvgGroup("natural"+a);e.appendChild(r);var s=$(r);for(var f=0;f<q.length;f++){q[f].nextShapeId=$("#"+q[f].Id).next().attr("id")}AttachChildrenShapesToParent(q,s,k,t);var l=AddSvg.AddSvgToStoryboard(e,0,0,true);j.before(l);var m=MyShapesState.Public_GetShapeStateByShape(l);m.X=k;m.Y=t;m.ScaleX=1;m.ScaleY=1;m.NaturalOffsetX=0;m.NaturalOffsetY=0;m.UseClipping=true;m.ClipX=0;m.ClipY=0;m.ClipWidth=w;m.ClipHeight=v;m.isGroupObject=true;for(f=0;f<q.length;f++){m.groupShapeStates.push(q[f])}MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();MyShapesState.Public_SelectShape(l);UpdateActiveDrawing();UndoManager.register(undefined,DisassembleShapes,[{childShapeStates:q,parentShapeState:m,parentShape:l}],"",undefined,AssembleShapes,[{childShapeStates:q,parentShapeState:m,parentShape:l,LastSVGId:h}],"");return m};this.ApplyParentStateToChild=function(f,e){var b=f.Private_GetSelectionBoxArea(0);var c={x:e.CenterX,y:e.CenterY};var d={x:f.X*e.Sx,y:f.Y*e.Sy};d={x:d.x+b.CenterX*e.Sx-c.x,y:d.y+b.CenterY*e.Sy-c.y};d={x:d.x*Math.cos(e.Angle*Math.PI/180)-d.y*Math.sin(e.Angle*Math.PI/180),y:d.x*Math.sin(e.Angle*Math.PI/180)+d.y*Math.cos(e.Angle*Math.PI/180)};d={x:d.x-b.CenterX*e.Sx+c.x,y:d.y-b.CenterY*e.Sy+c.y};f.X=d.x+e.fX;f.Y=d.y+e.fY};this.ApplyParentClippingToChild=function(e,l,d){if(!l.UseClipping){return}if(l.CropType!=CropTypeEnum.Advanced){return}var b=e.Private_GetSelectionBoxArea(0);var c={x:b.CenterX,y:b.CenterY};e.CropPolygonPoint=[];var h=null,k=null,g=null,j=null;for(i=0;i<l.CropPolygonPoint.length;i++){var f={x:l.CropPolygonPoint[i].x,y:l.CropPolygonPoint[i].y};f=l.ConvertCoordinateToStage(f,d,true);f=e.ConvertCoordinateToOrigin(f,c,true);e.CropPolygonPoint.push(f)}e.UseClipping=l.UseClipping;e.CropType=l.CropType;e.Public_update_ClipRegionByAdvancedCrop()};this.MinimizeAdvancedCropRegion=function(n){if(!n.UseClipping||n.CropType!=CropTypeEnum.Advanced){return false}var d=new ConvexHullGrahamScan();var f;var m=n.Private_GetElement(SvgPartsEnum.Scale);var l=m.getBBox();var k={Left:l.x,Right:l.x+l.width,Top:l.y,Bottom:l.y+l.height};if(checkPolygonInnerPoint({x:k.Left,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Left,k.Top)}if(checkPolygonInnerPoint({x:k.Left,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Left,k.Bottom)}if(checkPolygonInnerPoint({x:k.Right,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Right,k.Top)}if(checkPolygonInnerPoint({x:k.Right,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Right,k.Bottom)}for(f=0;f<n.CropPolygonPoint.length;f++){var b=n.CropPolygonPoint[f];var c=n.CropPolygonPoint[(f+1)%n.CropPolygonPoint.length];var g=new Array();g[0]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Top,k.Left,k.Bottom);g[1]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Bottom,k.Right,k.Bottom);g[2]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Bottom,k.Right,k.Top);g[3]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Top,k.Left,k.Top);if(checkRectangleInnerPoint(b,k)){d.addPoint(b.x,b.y)}for(var h=0;h<4;h++){if(g[h].intersect){d.addPoint(g[h].x,g[h].y)}}}var e=d.getHull();if(e.length>=3){n.CropPolygonPoint=new Array();for(f=0;f<e.length;f++){n.CropPolygonPoint.push({x:e[f].x,y:e[f].y})}n.Public_update_ClipRegionByAdvancedCrop();n.CropPolygonPointJson=JSON.stringify(n.CropPolygonPoint);return true}else{n.CropType=CropTypeEnum.Standard;n.ClipWidth=0;n.ClipHeight=0;n.X=-1000;return false}};this.UnGroup=function(d,o){if(!o||o==undefined){o=MyShapesState.Public_GetFirstSelectedShapeState()}if(!o.isGroupObject){return}o.FlipHorizontal=false;o.FlipVertical=false;var k=o.getCropParam();o.Public_convert_RectangleToAdvanced();var g=$("#"+o.Id).next().attr("id");var b=o.Private_GetSelectionBoxArea(0);var q=[],m=[];var h={CenterX:b.CenterX,CenterY:b.CenterY,fX:o.X,fY:o.Y,Sx:o.ScaleX,Sy:o.ScaleY,flipH:o.FlipHorizontal,flipV:o.FlipVertical,Angle:o.Angle,FilterColorMode:o.FilterColorMode};var c={x:b.CenterX,y:b.CenterY};var f;DetachChildrenShapesFromParent(o,true);MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();for(f=0;f<o.groupShapeStates.length;f++){var p=o.groupShapeStates[f].getCropParam();MyGroupAction.ApplyParentStateToChild(o.groupShapeStates[f],h);o.groupShapeStates[f].Angle+=h.Angle;o.groupShapeStates[f].ScaleX*=h.Sx;o.groupShapeStates[f].ScaleY*=h.Sy;o.groupShapeStates[f].opacity*=o.opacity;if(h.FilterColorMode){o.groupShapeStates[f].FilterColorMode=h.FilterColorMode}o.groupShapeStates[f].UpdateDrawing();if(o.FlipVertical){o.groupShapeStates[f].FlipVertical=!o.groupShapeStates[f].FlipVertical}if(o.FlipHorizontal){o.groupShapeStates[f].FlipHorizontal=!o.groupShapeStates[f].FlipHorizontal}MyShapesState.Public_SelectShape($("#"+o.groupShapeStates[f].Id));MyGroupAction.ApplyParentClippingToChild(o.groupShapeStates[f],o,c);MyGroupAction.MinimizeAdvancedCropRegion(o.groupShapeStates[f]);var l=o.groupShapeStates[f].getCropParam();q.push(p);m.push(l)}var j=o.getCropParam();var n=$("#"+o.Id).detach();MyShapesState.Public_RemoveShapeStateById(o.Id);UpdateActiveDrawing();UndoManager.register(undefined,AssembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:q,ParentParam:k,LastSVGId:g}],"",undefined,DisassembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:m,ParentParam:j}],"")};this.CheckGroupObject=function(){var b=MyShapesState.Public_GetFirstSelectedShapeState();return b.isGroupObject}}function DetachChildrenShapesFromParent(e,g){var b;var d=$("#"+e.Id).next();var a=$("#"+e.Id+SvgPartsEnum.SvgImage);a.children("g").each(function(){var j=this.getAttribute("id");var h=$(this).detach();h.on("mousedown",ShapeSelected);h.on("mouseup",HandleMouseExit);d.before(h)});if(!g){var c;for(c=e.groupShapeStates.length-1;c>=0;c--){var f=$("#"+e.groupShapeStates[c].Id);if($("#"+e.groupShapeStates[c].nextShapeId).length){$("#"+e.groupShapeStates[c].nextShapeId).before(f)}}}for(b=0;b<e.groupShapeStates.length;b++){MyShapesState.Public_SetShapeState(e.groupShapeStates[b].Id,e.groupShapeStates[b])}}function DisassembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var c=arguments[0].parentShape;var d=arguments[0].parentShapeState;var f=arguments[1];var b;DetachChildrenShapesFromParent(d,f);MyShapesState.Public_ClearAllSelectedShapes();for(b=0;b<a.length;b++){var e=a[b];e.X+=d.X;e.Y+=d.Y;MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}$("#"+d.Id).remove();MyShapesState.Public_RemoveShapeStateById(d.Id)}function AttachChildrenShapesToParent(a,b,d,e,h){var c;for(c=0;c<a.length;c++){var g=a[c];if(!h){g.X-=d;g.Y-=e}g.UpdateDrawing();var f=$("#"+g.Id);f.find("[id$='"+SvgPartsEnum.SelectionBox+"']").remove();f.off("mousedown");f.off("mouseup");b.append(f);MyShapesState.Public_RemoveShapeStateById(g.Id)}}function AssembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var d=arguments[0].parentShape;var e=arguments[0].parentShapeState;var c=arguments[0].LastSVGId;var f=arguments[1];$("#"+c).before(d);var b=$("#"+e.Id+SvgPartsEnum.SvgImage);AttachChildrenShapesToParent(a,b,e.X,e.Y,f);d=$("#"+e.Id);d.on("mousedown",ShapeSelected);d.on("mouseup",HandleMouseExit);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SetShapeState(e.Id,e);MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}function AssembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;for(c=0;c<b.length;c++){b[c].setCropParam(a[c])}AssembleShapes(arguments[0],true);f.setCropParam(d);f.UpdateDrawing()}function DisassembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;f.setCropParam(d);DisassembleShapes(arguments[0],true);for(c=0;c<b.length;c++){b[c].setCropParam(a[c]);b[c].UpdateDrawing()}};function MoveShapeAction(){this.UndoMoveX=null;this.UndoMoveY=null;this.MouseMoveOffsetX=0;this.MouseMoveOffsetY=0;this.Public_ClearAction=function(){this.UndoMoveX=null;this.UndoMoveY=null;this.MouseMoveOffsetX=0;this.MouseMoveOffsetY=0};this.Public_UpdateMouseMoveOffsets=function(a,b){this.MouseMoveOffsetX=a;this.MouseMoveOffsetY=b};this.Public_UpdateUndos=function(a,b){this.UndoMoveX=a;this.UndoMoveY=b}};function MultiSelectState(){this.StartX=undefined;this.StartY=undefined;this.Private_Left=undefined;this.Private_Right=undefined;this.Private_Top=undefined;this.Private_Bottom=undefined;this.SelectionAreaPartsEnum={SelectionAreaRect:"selection_area_rect",};this.Public_StartMultiSelect=function(a){this.StartX=PageXtoStoryboardX(a.pageX);this.StartY=PageYtoStoryboardY(a.pageY);if(this.StartY<0){this.StartY=0}if(this.StartX<0){this.StartX=0}this.Private_Left=0;this.Private_Right=0;this.Private_Top=0;this.Private_Bottom=0};this.Public_CompleteSelection=function(){var g=GetGlobalById(this.SelectionAreaPartsEnum.SelectionAreaRect);if(g){g.parentNode.removeChild(g)}var a=MyShapesState.Public_GetAllMovableShapeStates(true);for(var d=0;d<a.length;d++){var f=a[d];var b=null;try{b=f.Public_GetImaginaryOuterBox()}catch(c){throw c+" - Object used: "+JSON.stringify(f)}if(b.Top>=this.Private_Top&&b.Bottom<=this.Private_Bottom){if(b.Left>=this.Private_Left&&b.Right<=this.Private_Right){MyShapesState.Public_SelectShape($("#"+f.Id))}}}UpdateActiveDrawing()};this.Public_DrawSelectionArea=function(a){var c=a.pageX-StoryboardContainer.CoreSvgLeft+MyPointers.SvgContainer.scrollLeft();var d=a.pageY-StoryboardContainer.CoreSvgTop+MyPointers.SvgContainer.scrollTop();this.Private_Left=Math.min(c,this.StartX);this.Private_Right=Math.max(c,this.StartX);this.Private_Top=Math.min(d,this.StartY);this.Private_Bottom=Math.max(d,this.StartY);var c=GetGlobalById(this.SelectionAreaPartsEnum.SelectionAreaRect);if(c){c.parentNode.removeChild(c)}var b=SvgCreator.AddRect(this.Private_Left,this.Private_Top,this.Private_Right-this.Private_Left,this.Private_Bottom-this.Private_Top,SbtConstants.SelectionAreaStrokeColor,SbtConstants.SelectionAreaFillColor,SbtConstants.SelectionAreaStrokeDash,SbtConstants.SelectionAreaOpacity,this.SelectionAreaPartsEnum.SelectionAreaRect);MyPointers.CoreSvg.append(b)}};function ResizeImageAction(){this.ActiveShape=null;this.UndoLog=new Object;this.ResizeDirection=null;this.Public_StartResize=function(a,d){this.ResizeDirection=DetermineResizeDirection(d);this.ActiveShape=a;var e=MyShapesState.Public_GetAllSelectedShapeStates();for(var c=0;c<e.length;c++){var f=e[c];var b=f.Public_GetVisibleShapeDimensions();var g=false;if(this.ResizeDirection==ResizeEnum.N||this.ResizeDirection==ResizeEnum.S||this.ResizeDirection==ResizeEnum.E||this.ResizeDirection==ResizeEnum.W){g=true}if(g&&f.IsSpringable()){this.UndoLog[f.Id]={Transforms:f.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(f.Id+SvgPartsEnum.SvgImage),MoveX:f.X,MoveY:f.Y,UseClipping:f.UseClipping,ClipHeight:f.ClipHeight,ClipWidth:f.ClipWidth,IsSpringable:true}}else{this.UndoLog[f.Id]={ScaleX:f.ScaleX,ScaleY:f.ScaleY,MoveX:f.X,MoveY:f.Y,Width:b.width,Height:b.height,IsSpringable:false}}}};this.Public_ResizeShapes=function(a){var m={x:PageXtoStoryboardX(a.pageX),y:PageYtoStoryboardY(a.pageY)};var h=this.ActiveShape.Public_GetImaginaryOuterPoints();var q=this.ActiveShape.Private_GetSelectionBoxArea(0);var r={x:q.CenterX,y:q.CenterY};var d=0;var c=1;var g=2;var f=3;var N={x:0,y:0};var O=1,P=1;var M={x:h[g].x-h[d].x,y:h[g].y-h[d].y};var L={x:h[c].x-h[d].x,y:h[c].y-h[d].y};var w=false;switch(this.ResizeDirection){case ResizeEnum.SW:var B={x:h[g].x-h[c].x,y:h[g].y-h[c].y};var K={x:m.x-h[g].x,y:m.y-h[g].y};var E=SbtMath.ProjectAtoB(K,B);O=-SbtMath.ProjectAtoBScale(E,L)+1;P=SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var y={x:q.Left*O,y:q.Bottom*P};var x=this.ActiveShape.ConvertCoordinateToStage(y,r);var z={x:h[g].x+E.x,y:h[g].y+E.y};N={x:z.x-x.x,y:z.y-x.y};break;case ResizeEnum.NE:var J={x:h[c].x-h[g].x,y:h[c].y-h[g].y};var A={x:m.x-h[c].x,y:m.y-h[c].y};var E=SbtMath.ProjectAtoB(A,J);O=SbtMath.ProjectAtoBScale(E,L)+1;P=-SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var k={x:q.Right*O,y:q.Top*P};var j=this.ActiveShape.ConvertCoordinateToStage(k,r);var l={x:h[c].x+E.x,y:h[c].y+E.y};N={x:l.x-j.x,y:l.y-j.y};break;case ResizeEnum.SE:var D={x:h[f].x-h[d].x,y:h[f].y-h[d].y};var H={x:m.x-h[f].x,y:m.y-h[f].y};var E=SbtMath.ProjectAtoB(H,D);O=SbtMath.ProjectAtoBScale(E,L)+1;P=SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var t={x:q.Right*O,y:q.Bottom*P};var s=this.ActiveShape.ConvertCoordinateToStage(t,r);var u={x:h[f].x+E.x,y:h[f].y+E.y};N={x:u.x-s.x,y:u.y-s.y};break;case ResizeEnum.NW:var I={x:h[d].x-h[f].x,y:h[d].y-h[f].y};var C={x:m.x-h[d].x,y:m.y-h[d].y};var E=SbtMath.ProjectAtoB(C,I);O=-SbtMath.ProjectAtoBScale(E,L)+1;P=-SbtMath.ProjectAtoBScale(E,M)+1;r={x:r.x*O,y:r.y*P};var o={x:q.Left*O,y:q.Top*P};var n=this.ActiveShape.ConvertCoordinateToStage(o,r);var p={x:h[d].x+E.x,y:h[d].y+E.y};N={x:p.x-n.x,y:p.y-n.y};break;case ResizeEnum.N:var C={x:m.x-h[d].x,y:m.y-h[d].y};var G=SbtMath.ProjectAtoB(C,M);P=-SbtMath.ProjectAtoBScale(C,M)+1;r={x:r.x,y:r.y*P};var o={x:q.Left,y:q.Top*P};var n=this.ActiveShape.ConvertCoordinateToStage(o,r);var p={x:h[d].x+G.x,y:h[d].y+G.y};N={x:p.x-n.x,y:p.y-n.y};w=true;break;case ResizeEnum.S:var K={x:m.x-h[g].x,y:m.y-h[g].y};var G=SbtMath.ProjectAtoB(K,M);P=SbtMath.ProjectAtoBScale(K,M)+1;var y={x:q.Left,y:q.Bottom*P};r={x:r.x,y:r.y*P};var x=this.ActiveShape.ConvertCoordinateToStage(y,r);var z={x:h[g].x+G.x,y:h[g].y+G.y};N={x:z.x-x.x,y:z.y-x.y};w=true;break;case ResizeEnum.E:var A={x:m.x-h[c].x,y:m.y-h[c].y};var F=SbtMath.ProjectAtoB(A,L);O=SbtMath.ProjectAtoBScale(A,L)+1;r={x:r.x*O,y:r.y};var k={x:q.Right*O,y:q.Top};var j=this.ActiveShape.ConvertCoordinateToStage(k,r);var l={x:h[c].x+F.x,y:h[c].y+F.y};N={x:l.x-j.x,y:l.y-j.y};w=true;break;case ResizeEnum.W:var C={x:m.x-h[d].x,y:m.y-h[d].y};var F=SbtMath.ProjectAtoB(C,L);O=-SbtMath.ProjectAtoBScale(C,L)+1;r={x:r.x*O,y:r.y};var o={x:q.Left*O,y:q.Top};var n=this.ActiveShape.ConvertCoordinateToStage(o,r);var p={x:h[d].x+F.x,y:h[d].y+F.y};N={x:p.x-n.x,y:p.y-n.y};w=true;break}if(O==null||P==null||O<0.1||P<0.1){return}if((q.Width<10&&O<1)||(q.Height<10&&P<1)){return}var v=MyShapesState.Public_GetAllSelectedShapeStates();for(var b=0;b<v.length;b++){if(w&&v[b].SpringableState!=null&&v[b].SpringableState.IsSpringable){this.Private_ScaleAndMoveSpringable(v[b],O,P,this.ResizeDirection);v[b].MoveDistance(N.x,N.y)}else{v[b].ChangeScaleXY(O,P);v[b].MoveDistance(N.x,N.y)}v[b].UpdateDrawing(true)}};this.Public_StopResizing=function(){var e=new Array();var b=new Array();var c=MyShapesState.Public_GetAllSelectedShapeStates();for(var a=0;a<c.length;a++){var d=c[a];var f=this.UndoLog[d.Id];if(f==null||f==undefined){continue}if(f.IsSpringable){e.push({Id:d.Id,Transforms:f.Transforms,SvgSize:f.SvgSize,MoveX:f.MoveX,MoveY:f.MoveY,UseClipping:f.UseClipping,ClipHeight:f.ClipHeight,ClipWidth:f.ClipWidth,IsSpringable:true});b.push({Id:d.Id,Transforms:d.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(d.Id+SvgPartsEnum.SvgImage),UseClipping:d.UseClipping,ClipHeight:d.ClipHeight,ClipWidth:d.ClipWidth,MoveX:d.X,MoveY:d.Y,IsSpringable:true})}else{e.push({Id:d.Id,ScaleX:f.ScaleX,ScaleY:f.ScaleY,MoveX:f.MoveX,MoveY:f.MoveY,IsSpringable:false});b.push({Id:d.Id,ScaleX:d.ScaleX,ScaleY:d.ScaleY,MoveX:d.X,MoveY:d.Y,IsSpringable:false})}}UndoManager.register(undefined,UndoShapeResizeWithMove,e,"",undefined,UndoShapeResizeWithMove,b,"")};this.ResizeViaPinch=function(m){var l=this.UndoLog[this.ActiveShape.Id],o=1,n=this.ActiveShape.Angle/57.2957795;var b=this.Private_SanitizeAngle(this.ActiveShape.Angle);var p={x:Math.abs(m.startXOffset*Math.cos(n)+m.startYOffset*Math.sin(n)),y:Math.abs(m.startYOffset*Math.cos(n)-m.startXOffset*Math.sin(n))};var c={x:Math.abs(m.currentXOffset*Math.cos(n)+m.currentYOffset*Math.sin(n)),y:Math.abs(m.currentYOffset*Math.cos(n)-m.currentXOffset*Math.sin(n))};var f=c.x-p.x;var g=c.y-p.y;var d=Math.min(f,g)/Math.max(f,g,0.001);var q=10,e=0.499;var h,i;var k=this.ActiveShape.Public_GetVisibleShapeDimensions();var s=false;if(((f<q)&&(g<q))||((f>q)&&(g>q)&&(d>e))){o=m.scale;h=l.MoveX-((l.Width*(o-1))/2);i=l.MoveY-((l.Height*(o-1))/2);this.ActiveShape.SetScale(o*l.ScaleX,o*l.ScaleY)}else{s=this.ActiveShape.IsSpringable();if((g<q)||((f>g)&&(d<=e))){o=c.x/((p.x===0)?1:p.x);h=l.MoveX-((l.Width*(o-1))/2);i=l.MoveY;if(s){var j=(this.ActiveShape.X-h)*2;var a=1+((f/k.width)/10);this.Private_ScaleAndMoveSpringable(this.ActiveShape,a,1,this.Private_AnchorCorner("W",b),"W")}else{this.ActiveShape.SetScale(o*l.ScaleX,l.ScaleY)}}else{o=c.y/((p.y===0)?1:p.y);h=l.MoveX;i=l.MoveY-((l.Height*(o-1))/2);if(s){var a=1+((g/k.height)/10);this.Private_ScaleAndMoveSpringable(this.ActiveShape,1,a,this.Private_AnchorCorner("N",b),"N")}else{this.ActiveShape.SetScale(l.ScaleX,o*l.ScaleY)}}}if((h<0&&(h-k.width<0))||(i<0&&(i-k.height<0))){}else{this.ActiveShape.MoveTo(h,i)}this.ActiveShape.UpdateDrawing()};this.Private_SanitizeAngle=function(a){a%=360;if(a<0){a+=360}if(a%90===0){a+=1}a%=360;return a};this.Private_AnchorCorner=function(c,a){var b="";switch(c){case ResizeEnum.N:case ResizeEnum.NE:b="SW";if(a>=90&&a<180){b="NW"}else{if(a>=180&&a<270){b="NE"}else{if(a>=270){b="SE"}}}break;case ResizeEnum.S:case ResizeEnum.SW:b="NE";if(a>=90&&a<180){b="SE"}else{if(a>=180&&a<270){b="SW"}else{if(a>=270){b="NW"}}}break;case ResizeEnum.E:case ResizeEnum.SE:b="NW";if(a>=90&&a<180){b="NE"}else{if(a>=180&&a<270){b="SE"}else{if(a>=270){b="SW"}}}break;case ResizeEnum.W:case ResizeEnum.NW:b="SE";if(a>=90&&a<180){b="SW"}else{if(a>=180&&a<270){b="NW"}else{if(a>=270){b="NE"}}}break}return b};this.Private_ScaleAndMoveSpringable=function(o,m,n,l){var h=o.Public_GetVisibleShapeDimensions();var k=h.width;var j=h.height;var d=(m-1)*(k/o.ScaleX);var e=(n-1)*(j/o.ScaleY);var q=o.SpringableState.Anchors.Right;var s=o.SpringableState.Springs.Horizontal;var r=o.SpringableState.Anchors.Bottom;var t=o.SpringableState.Springs.Vertical;if(!this.Private_VerifySafeToScaleSpringable(o,s,m,1,d,0)){return}if(!this.Private_VerifySafeToScaleSpringable(o,t,1,n,0,e)){return}if(o.UseClipping){o.ClipWidth+=d;o.ClipHeight+=e}for(var c=0;c<q.length;c++){var u=SvgCreator.GetTransform(q[c]);var b=q[c].indexOf("-hhalf")>0?2:1;u.Translate[0]+=d/b;SvgCreator.WriteTransform(q[c],u)}for(var c=0;c<r.length;c++){var u=SvgCreator.GetTransform(r[c]);var v=r[c].indexOf("-vhalf")>0?2:1;u.Translate[1]+=e/v;SvgCreator.WriteTransform(r[c],u)}for(var c=0;c<s.length;c++){var p=GetGlobalById(s[c]);var u=SvgCreator.GetTransform(s[c]);var a=p.getBBox();var f=d/a.width;f=isNaN(f)?0:f;u.Scale[0]+=f;if(u.Scale[0]<0){continue}if(f!=0){u.Translate[0]=(1-u.Scale[0])*a.x}SvgCreator.WriteTransform(s[c],u)}for(var c=0;c<t.length;c++){var p=GetGlobalById(t[c]);var u=SvgCreator.GetTransform(t[c]);var a=p.getBBox();var g=e/a.height;g=isNaN(g)?0:g;u.Scale[1]+=g;if(u.Scale[1]<0){continue}if(g!=0){u.Translate[1]=(1-u.Scale[1])*a.y}SvgCreator.WriteTransform(t[c],u)}SvgCreator.UpdateSvgSize_WithDeltas(o.Id+SvgPartsEnum.SvgImage,d,e)};this.UndoSpringableResize=function(b){SvgCreator.UpdateSvgSize(b.Id+SvgPartsEnum.SvgImage,b.SvgSize);for(var a=0;a<b.Transforms.length;a++){SvgCreator.WriteTransform(b.Transforms[a].Id,b.Transforms[a].Transform)}};this.Private_VerifySafeToScaleSpringable=function(k,m,h,j,d,e){if(h<0||j<0){return false}for(var c=0;c<m.length;c++){var l=GetGlobalById(m[c]);var n=SvgCreator.GetTransform(m[c]);var a=l.getBBox();var f=d/a.width;var g=e/a.height;f=isNaN(f)?0:f;g=isNaN(g)?0:g;f=n.Scale[0]+=f;g=n.Scale[1]+=g;if(h<1&&((f*a.width*k.ScaleX)<10)){return false}if(j<1&&((g*a.height*k.ScaleY)<10)){return false}}var b=GetGlobalById(k.Id+SvgPartsEnum.SvgImage);if(d<0||e<0){if(parseInt(b.getAttribute("width"),10)+d<10){return false}if(parseInt(b.getAttribute("height"),10)+e<10){return false}}return true};this.Private_ScaleAndMove=function(k,i,j,a){var e=this.ActiveShape.Public_GetVisibleShapeDimensions();var h=e.width;var f=e.height;if(i!=1&&(i*h)<10){return}if(j!=1&&(j*f)<10){return}var b=0;var c=0;var g=k.Public_GetImaginaryOuterBox();k.ChangeScaleXY(i,j);var d=k.Public_GetImaginaryOuterBox();switch(a){case"SW":c=(g.Bottom-d.Bottom);b=(g.Left-d.Left);break;case"NW":c=(g.Top-d.Top);b=(g.Left-d.Left);break;case"NE":c=(g.Top-d.Top);b=(g.Right-d.Right);break;case"SE":c=(g.Bottom-d.Bottom);b=(g.Right-d.Right);break}k.MoveDistance(b,c);k.UpdateDrawing()}};function RotateImageAction(){this.ShapeStateBeingRotated=null;this.MouseRotateX=null;this.MouseRotateY=null;this.UndoRotateAngle=null;this.ResetRotateImageAction=function(b,a){this.ShapeStateBeingRotated=b;this.MouseRotateX=PageXtoStoryboardX(a.pageX);this.MouseRotateY=PageYtoStoryboardY(a.pageY);this.UndoRotateAngle=this.ShapeStateBeingRotated.Angle};this.CalculateRotationAngle=function(f){var b=this.ShapeStateBeingRotated.Public_GetVisibleShapeDimensions();var j=b.width;var g=b.height;var h=PageXtoStoryboardX(f.pageX);var i=PageYtoStoryboardY(f.pageY);var c=this.ShapeStateBeingRotated.Property_VisibleX()+(j/2);var d=this.ShapeStateBeingRotated.Property_VisibleY()+(g/2);var a=SbtMath.CalculateAngle(c,d,h,i,this.MouseRotateX,this.MouseRotateY);this.MouseRotateX=h;this.MouseRotateY=i;return a};this.Public_TotalAngleRotation=function(){var a=this.ShapeStateBeingRotated.Angle-this.UndoRotateAngle;a%=360;return a}};function ShapeMetaData(){this.LookForMetaData=function(k){var l=$("#"+k).find("sbtdata");if(l.length==0){return}try{var b=l.find("colorable");for(var j=0;j<b.length;j++){var q=b[j].getAttributeNS("","region");if(q.length===0){q=b[j].getAttributeNS("","Region")}var s=b[j].getAttributeNS("","secretcolor");if(s.length===0){s=b[j].getAttributeNS("","SecretColor")}var r=b[j].getAttributeNS("","replacecolor");if(r.length===0){r=b[j].getAttributeNS("","ReplaceColor")}this.Private_ExtractColors(k,s,r,q)}}catch(d){LogErrorMessage("ShapeMetaData.LookForMetaData.Colorables",d)}var h=null;try{var u=$("#"+k).children().first();if(u.prop("tagName")!="svg"){u=l.closest("svg")}h=l.attr(SbtDataEnum.AttributeGlobalImageId);var p=l.attr(SbtDataEnum.MetaData_Position);var m=l.find(SbtDataEnum.MetaData_Posable);var n=m.find(SbtDataEnum.MetaData_Poses);if(h==null&&n!=null&&n.length>0){}for(var j=0;j<n.length;j++){var o=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_Pose_Type);if(LowerCaseCompare(o,SbtDataEnum.PoseType_LibrarySwap)){var c=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_LibrarySwapPose_DefaultId);var t=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_LibrarySwapPose_StartPointId);var a=GetSafeAttributeNS(n[j],SbtDataEnum.Attribute_LibrarySwapPose_AppendToId);this.Private_GlobalLibrarySwap(u,c,t,a,h,p)}}}catch(d){try{LogErrorMessage("ShapeMetaData.LookForMetaData.Posables GUID:  "+h,d)}catch(f){LogErrorMessage("ShapeMetaData.LookForMetaData.Posables: ",d)}}};this.Private_ExtractColors=function(d,g,f,e){var h=$("#"+d);var b='[fill="'+g+'"]';var j=h.find(b);if(j.length===0){b='[fill="'+g.toLowerCase()+'"]';j=h.find(b)}if(j.length===0){b='[FILL="'+g.toLowerCase()+'"]';j=h.find(b)}for(var c=0;c<j.length;c++){var a=e+"_"+d+"_"+c;j[c].setAttributeNS(null,"fill",f);j[c].setAttributeNS(null,"id",a)}};this.Private_GlobalLibrarySwap=function(l,h,k,b,g,i){var d=MyGlobalSwapLibrary.Public_GetSvgById(h,i);if(d==null){}d=d.clone();var a=l.find("#"+b);a.children().remove();a.append(d);var f="gls_"+new Date().getTime();d.attr("id",f);RecursivelyUpdateChildrenIds(d,SbtDataEnum.GlobalLibraryId,g);var e=GetGlobalById(f);var c=e.getBBox();var j=ExtractPositionPoint(l.find("#"+k));var m=j.X-c.x;var n=j.Y-c.y;d.attr("transform","translate("+m+", "+n+")")}};var AddSvg=function(){var d=0;var g=0;var f=0;var b=function(E,p,C){var D=E;var q=D.indexOf("?>");if(q>=0){D=D.substring(q+2)}var u=$("#"+p);var A=u.parent();try{u.append(D)}catch(s){}c.CurrentShapeIndex+=1;var F=A.attr("width");var v=A.attr("height");var w="clipart_"+c.CurrentShapeIndex;u.attr("id",w);A.attr("class","ClipartLibrary");MyShapeMetaData.LookForMetaData(w);var n=GetGlobalById(w);var o=n.parentElement;var x=$("#"+w);if(x.children().first().attr("width")==null||x.children().first().attr("height")==null){x.parent().remove();return false}var h=null;try{h=n.getBBox()}catch(t){LogErrorMessage("indexBS._PerformSvgTranslationsForTabs",t)}if(C===false){if(h===null||h.x<-50||h.y<-50){x.parent().remove();return false}}var j=h.width;var i=h.height;var y=(F-4)/j;var z=(v-4)/i;var B=Math.min(y,z);n.setAttribute("transform","translate(0,0) scale("+B+")");var k=(F-((j)*B))/2;k-=(h.x*B);var l=(v-((i)*B))/2;l-=(h.y*B);n.setAttribute("transform","translate("+(k)+","+l+") scale("+B+")");var m=n.getBoundingClientRect();if(m.width>275||m.height>275){x.parent().remove();return false}var r=$("#"+w).parent().parent().attr("id");StoryboardContainer.UpdateGradientIds(x);StoryboardContainer.RemoveFilters();return true};var a=function(p,l,s,t){try{var n=MyPointers.GetSvgTop().before(p);n=MyPointers.GetSvgTop().prev();n.attr("id",l);n.attr("class","activeShape");var m=$("#"+l);m.off("mousedown").on("mousedown",ShapeSelected);m.off("mouseup").on("mouseup",HandleMouseExit);SetInitialShapeIds(m,l);var q=new SvgState(l);q.isSceneItem=NewShapeIsBackdrop;var i=GetGlobalById(l);var h=i.getBBox();newFunction(m,q);var o=SetInitalShapeScale(m,q,h);SetInitialShapeCords(m,h,s,t,o,q);var r=$("#"+l+SvgPartsEnum.Natural+" svg");var k=(r.css("filter")||EMPTY_STRING).replace("none",EMPTY_STRING).replace(/"/g,EMPTY_STRING).replace(/http[^#]*/,EMPTY_STRING).replace("[s]+",EMPTY_STRING).replace("url(",EMPTY_STRING).replace(")",EMPTY_STRING).replace("#",EMPTY_STRING);k=(k===EMPTY_STRING)?EMPTY_STRING:"url(#"+k+")";$("#"+$(n).attr("id")+SvgPartsEnum.Natural).children("svg").css("filter",k);q.FilterColorMode=k;r.css("filter",EMPTY_STRING);MyShapesState.Public_SetShapeState(l,q);MyShapesState.Public_UpdateSingleShapeAndAction(n,ShapeActionEnum.Nothing);q.Public_ResetColors();UpdateActiveDrawing();if(NewShapeIsBackdrop){StretchToFillShape(q,q.Property_VisibleX(),q.Property_VisibleY());NewShapeIsBackdrop=false;e(q,n)}if(q.ImageAttribution!=null){StoryboardContainer.UpdateImageAttributions()}}catch(j){LogErrorMessage("SvgManip.AddShape",j)}};var c=new Object();c.CurrentShapeIndex=1;c.AddSvgToTabs=function(m,s,j,h,k,n,p){this.CurrentShapeIndex++;var o="clipartPanel"+this.CurrentShapeIndex;var r="svgGroup"+this.CurrentShapeIndex;var l='<div id="'+o+'" class="ClipartItemPanel'+(k?" SceneItem":"")+'"></div>';if(m.find("div.search-more").length>0){m.find("div.search-more").after(l)}else{m.append(l)}var q=SvgCreator.CreateBlankSvg(s,j);var i=SvgCreator.CreateSvgGroup(r);q.appendChild(i);MyPointers.StagingGround.append(q);$("#"+o).draggable({addClasses:false,revert:"invalid",helper:function(){ClearActiveState();d=d+1;var t=$(this).clone();t.children().eq(0).children().eq(0).attr("id",t.children().eq(0).children().eq(0).attr("id")+"_"+d);StoryboardContainer.UpdateGradientIds(t);return t},cursorAt:{left:26,top:40},appendTo:"body",scroll:false});if(b(h,r,p)==false){$("#"+o).remove();return}$("#"+o).append(q);if(typeof(n)===FUNCTION_KEYWORD){n($("#"+o))}TabRoller.RefreshRollers_PostAdd()};function e(p,n){var l=StoryboardContainer.GetAllLayoutParts(CellConfiguration);var o=StoryboardContainer._GetLayoutPartForShape(l,p);if(o===null){return}var m=StoryboardContainer.GetShapeStatesForCell(o.Row,o.Col);var r=null;var q=-1;var t=null;var s=9999999;for(var j=0;j<m[StoryboardPartTypeEnum.StoryboardCell].length;j++){var h=m[StoryboardPartTypeEnum.StoryboardCell][j];if(h.Id==p.Id){continue}var k=$("g").index($("#"+h.Id));if(h.isSceneItem&&k>q){q=k;r=h}if(!h.isSceneItem&&k<s){s=k;t=h}}if(q!=-1){n.detach();$("#"+r.Id).after(n)}else{if(s!=9999999){n.detach();$("#"+t.Id).before(n)}}}c.AddSvgToStoryboard=function(n,p,q,h){try{this.CurrentShapeIndex++;var k=SvgPartsEnum.ShapeId+this.CurrentShapeIndex;var l="sbt_offset"+this.CurrentShapeIndex;var m=document.createElementNS("http://www.w3.org/2000/svg","g");m.setAttribute("id",k);var o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("id",l);m.appendChild(o);MyPointers.GetSvgTop().before(m);var j=$("#"+l);j.append(n);o.firstChild.setAttribute("transform","");j=$("#"+k);j.detach();a(m,k,p,q);if(h){UndoManager.register(undefined,UndoShapeAdd,[{Id:k}],undefined,"",UndoDeleteShape,[{Detached:j,NextShapeId:"SvgTop",Id:k,ShapeState:MyShapesState.Public_GetShapeStateById(k)}])}GetStoryboardSize();return j}catch(i){LogErrorMessage("SvgManip.PrepAndAddShape",i)}};return c}();function newFunction(a,b){SetInitialShapeOffset(a,b)};function UglyUploadCallback(a){if(a==null||a.length==0){return}SvgRetriever.uploadCallback(a)}var _prevent_menu_double_select_mask=0;var ClipartTab_ModuleRef=(function(){var e={};var f;var g;var h;var b;var a=function(m,j){if(m==null||m.ImageSubCategories==null){return}var p="parent-category-"+m.ImageCategoryId;var o="parent-category-a-"+m.ImageCategoryId;var n="";n+='<li id="'+p+'" '+(m.HideOnLoad?" style=display:none":"")+(j?' class="active"':"")+">";n+='  <a id="'+o+'" href="#cliplib-'+m.ImageCategoryId+'" data-toggle="tab" class="tab-link content-tab" title="'+m.HoverText+'">'+m.Title+"</a>";n+="</li>";g.before(n);var q="";q+='<div class="cliplib-pane tab-pane'+(j?" in active":"")+'" id="cliplib-'+m.ImageCategoryId+'">';q+='  <nav class="navbar navbar-default subcategories" style="box-shadow:none" role="navigation">';q+='      <div class="navbar-content">';q+='          <ul class="nav navbar-nav nav-sm subcategory-ul">';var r=[q];var k="content-wrapper-"+m.ImageCategoryId;var s=['<div class="content-wrapper" id="'+k+'">'];for(var l=0;l<m.ImageSubCategories.length;l++){var t=c(m.ImageSubCategories[l],l===0);r.push(t[0]);s.push(t[1])}r.push("</ul></div></nav>");s.push("</div></div>");h.before(r.join("")+s.join(""));$("#"+o).click(d)};var d=function(i){i.preventDefault();$(this).tab("show");if($(this).hasClass("content-tab")){$($(this).attr("href")+" nav ul.nav li.active a").trigger("click")}$(".subcategory-ul").resize();setTimeout(TabRoller.RefreshRollers_PostResize,500)};var c=function(j,i,l){var m="";var k="";m+="<li "+(i?' class="active"':"")+' id="category-'+j.ImageCategoryId+'">';m+='     <a href="javascript:void(0)" class="cliplib-'+j.ImageCategoryId+'" title="'+j.HoverText+'">'+j.Title+"</a>";m+="</li>";k+='<div id="cliplib-'+j.ImageCategoryId+'-content" class="content-list'+(i?"":" hidden")+'">';k+='     <div class="waiting">Loading...</div>';if(l){k+='     <div class="search-more"><a href="javascript:void(0)" class="1">More...</a></div>'}k+="</div>";return[m,k]};e.load=function(){f=$("#myTabContent");g=$("#uploadTab");h=$("#cliplib-upload");b=$("#clipart-filter-wrapper");var k;for(k=0;k<allCategories.length;k++){a(allCategories[k],k===0)}if(MyBrowserProperties.IsSafari5||MyBrowserProperties.IsOldIE){$("#clipart-filter-wrapper").hide();StoryboardContainer.RemoveFilters()}else{var l=$(SVGFilterDeclaration.replace(/inkscape\:/gi,EMPTY_STRING));var j=[];l.children("filter").each(function(p,t){var i=$(t);var o=i.attr("id");var q=i.attr("label");var s=i.attr("menu-tooltip");var m=!(i.attr("disabled")==="disabled");if(q==="divider"){j.push('<li role="separator" id="divider-'+o+'" class="divider"></li>');m=false}if(m===false){return}var r=q;q=MyLangMap.GetText("text-filter-label-"+r);s=MyLangMap.GetText("text-filter-tooltip-"+r);var n="";n+="<li>";n+='<a href="javascript: void (0)" class="'+o+'" title="'+s+'">';n+='<span class="MenuFilter MenuFilter'+o+'" title="'+q+'">';n+='<img height="16" width="16" src="/content/menu/blank.gif" class="'+o+'">';n+="</span> "+q+"</a>";n+="</li>";j.push(n)});b.find("ul.dropdown-menu").append(j.join(""));$(" #filters-multi-select, #filters-single-select").append(j.join(""));$("#filters-multi-select, #filters-single-select").click(function(i){if(_prevent_menu_double_select_mask==1){_prevent_menu_double_select_mask=0;return}i.preventDefault();var m=isLIHit(i.target,this);if(m==null){return false}var n=$(m).find("a");FilterColorMode((n[0].className==="color")?EMPTY_STRING:"url(#"+n[0].className+")")});$(".remove-colors").click(function(i){_prevent_menu_double_select_mask=1;i.preventDefault();WhiteOutShape()});$(".artpen-colors").click(function(i){_prevent_menu_double_select_mask=1;i.preventDefault();ArtpenShape()});$(".black-out").click(function(i){_prevent_menu_double_select_mask=1;i.preventDefault();BlackOutShape()})}SvgRetriever.getClipartContent(allCategories[0].ImageSubCategories[0].ImageCategoryId,null,null);$("#myTabContent .scroll-indicator").css("display","");$("#myTabContent .cliplib-pane nav.navbar ul.nav").click(function(n){if($(n.target).hasClass("dropdown-toggle")){return}n.preventDefault();var o=isLIHit(n.target,this);if(o==null){return false}var i=$(o).find("a");var p="#"+i[0].className+"-content";$(this).parents("div.cliplib-pane").find(".content-wrapper div.content-list").addClass("hidden");$(p).removeClass("hidden");$(this).find("li").removeClass("active");$(o).addClass("active");activeTabId=$(p).parent().attr("id");TabRoller.RefreshRollers_PostChangeTab(activeTabId);var m=i[0].className.replace("cliplib-","");SvgRetriever.getClipartContent(m,null,null)});$("#upload-btn").click(function(i){SvgRetriever.initiateUpload(null,null)})};return e}());var SvgRetriever=(function(){var c={};var d={};c.initiateUpload=function(f,e){d={node:$("#cliplib-upload-content"),onitemadded:f,oncomplete:e};ShowUploadDialog()};c.uploadCallback=function(e){AddSvg.AddSvgToTabs(d.node,MyBrowserProperties.ClipartDisplayWidth,MyBrowserProperties.ClipartDisplayHeight,e,false,d.onitemadded,true);if(typeof(d.oncomplete)==FUNCTION_KEYWORD){d.oncomplete()}};c.getClipartContent=function(e,g,f){if($("#cliplib-"+e+"-content .waiting").length>0){a(e,1,g,f)}};var a=function(e,h,g,f){$.getJSON(CreatorUrls.LibraryImages+"?svg_category_id="+e+"&page="+h+"&time="+TimeStamp).success((function(i,l,k,j){return function(m){b(i,m,k);if(l<4){a(i,l+1,k,j)}else{if(typeof(j)===FUNCTION_KEYWORD){j()}}}}(e,h,g,f)))};var b=function(e,l,k){$("#cliplib-"+e+"-content .waiting").remove();var m=$("#cliplib-"+e+"-content");e=parseInt(e);var h=((e>=18&&e<=24)||e==38||e==39||e==42||(e>=79&&e<=82)||(e>=94&&e<=110)||e==139||e==140||e==156);var g=(e>=94&&e<=110)||e==140;var j=e===154;for(var f=2;f<l.length;f++){if(g){AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidth16x9Scene,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}else{if(h){AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidthScene,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}else{if(j){AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidth16x9Scene,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}else{AddSvg.AddSvgToTabs(m,MyBrowserProperties.ClipartDisplayWidth,MyBrowserProperties.ClipartDisplayHeight,l[f],h,k,false)}}}}};return c}());var SvgSearch=function(){var d={Title:1,Content:2,More:3,};var n;var o;var m;var c=function(q,r){switch(r){case d.Title:return"search-tab-"+q+"-title";case d.Content:return"search-tab-"+q+"-content";case d.More:return"search-tab-"+q+"-more"}};var h=function(q){return m.find("li a[title='"+q+"']")};var g=function(r){var s=h(r);var q=c(s.data("SearchTabBaseId"),d.Content);return $("#"+q)};var b=function(s,t){var r="";var q="";r+='<li class="active">';r+='   <a id="'+c(s,d.Title)+'" title="'+t+'">'+t+"</a>";r+="</li>";q+='<div id="'+c(s,d.Content)+'" class="content-list">';q+='     <div class="waiting">'+MyLangMap.GetText("text-search-loading")+"</div>";q+='     <div class="search-more"><a id="'+c(s,d.More)+'">'+MyLangMap.GetText("text-search-more")+"</a></div>";q+="</div>";return[r,q]};var a=function(t){var q=$("#tab-search-results-content-container");m.find("li.active").removeClass("active");q.find(".content-list").addClass("hidden");var u="s-"+m.find("li").length;var s=b(u,t);m.append(s[0]);q.append(s[1]);var v=$("#"+c(u,d.Title));v.data("SearchTabBaseId",u);var r=$("#"+c(u,d.More));r.click(this.SearchMore);r.data("SearchString",t);r.data("Page",1);n.removeClass("hidden").find("a").trigger("click");TabRoller.RefreshRollers_PostChangeTab("tab-search-results-content-container");$(".subcategory-ul").resize();setTimeout(StoryboardContainer.JiggleSvgSize,500);return $("#"+c(u,d.Content))};function e(r){if($(r.target).hasClass("dropdown-toggle")){return}r.preventDefault();var s=isLIHit(r.target,this);if(s==null){return false}var t=$(s).find("a");$(this).find("li").removeClass("active");$(s).addClass("active");TabRoller.RefreshRollers_PostChangeTab("tab-search-results-content-container");$("#tab-search-results-content-container .content-list").addClass("hidden");var q=c(t.data("SearchTabBaseId"),d.Content);$("#"+q).removeClass("hidden")}function l(u,q){q.data("ItemsToDownload",u.length);if(u.length==0){if(q.find(".ClipartItemPanel").length==0){q.append("<div class='no-results'>"+MyLangMap.GetText("text-search-no-results")+"</div>")}else{q.append("<div class='no-results'>"+MyLangMap.GetText("text-search-no-more-results")+"</div>")}q.find(".waiting").hide();return}for(var r=0;r<u.length;r++){if(u[r].startsWith("/search")||u[r].indexOf("storyboardsearch")>0){$.ajax({type:"GET",url:u[r],success:k(q),error:function(v){}})}if(u[r].startsWith("swal:")){var s=q.data("ItemsToDownload")-1;q.data("ItemsToDownload",s);var t=u[r].substring(5);swalQueue(MyLangMap.GetText("text-search-tip"),t)}}}function k(q){return function(r){var s=q.data("ItemsToDownload")-1;q.data("ItemsToDownload",s);if(r!=null&&r.svg!=null&&r.svg!=""){AddSvg.AddSvgToTabs(q,MyBrowserProperties.ClipartDisplayWidth,MyBrowserProperties.ClipartDisplayHeight,r.svg,false,null)}if(s==0){q.find(".waiting").hide();q.find(".search-more").show()}}}var j=false;function i(r){var s=o.cleanupInput({noquotes:true}).fixedVal();if(s===EMPTY_STRING){return}s=s.toUpperCase();var t=h(s);if(t.length===0){var q=a(s);q.find(".waiting").show();q.find(".search-more").hide();try{if(j==false&&MyUserPermissions.EnableUploads==false){j=true;$("#PurchaseForPhotosForClass").modal("show")}}catch(r){LogErrorMessage("PerformSearch.P4c Popup",r)}f(s,1,function(u){l(u,q)},function(){})}else{n.find("a").trigger("click");t.trigger("click")}}this.SearchMore=function(r){var s=parseInt($(this).data("Page"))+1;$(this).data("Page",s);var t=$(this).data("SearchString");var q=g(t);q.find(".waiting").show();q.find(".search-more").hide();f(t,s,function(u){l(u,q)},function(){})};function f(t,s,q,r){$.getJSON("/search2/searchweb?page="+s+"&searchstring="+t+"&photosForClass="+ExtraSetup.PhotosForClassSearchType).success(q).error(r)}var p=new Object();p.Load=function(){n=$("#searchResultTab");o=$("#cliplib-search-txt");m=$("#tab-search-results-tab-list");$("#tab-search-results-tab-list").click(e);o.keydown(function(q){q.stopPropagation()});o.keypress(function(q){q.stopPropagation();if(q.which==13){if($(this).cleanupInput({noquotes:true}).fixedVal()!==EMPTY_STRING){$("#cliplib-search-btn").trigger("click")}}});$("#cliplib-search-btn").click(i)};return p}();function MathUtilsLibrary(){}MathUtilsLibrary.prototype.CartesianSegmentLength=function(f,e){var c=e.X-f.X;var d=e.Y-f.Y;return Math.sqrt((c*c)+(d*d))};function Point(a,b){this.X=a||0;this.Y=b||0}Point.prototype.ToString=function(){return this.X+","+this.Y};Point.prototype.Mult=function(b){var a=new Point(this.X,this.Y);a.X*=b;a.Y*=b;return a};Point.Up=Object.freeze(new Point(0,-1));Point.Down=Object.freeze(new Point(0,1));Point.Left=Object.freeze(new Point(-1,0));Point.Right=Object.freeze(new Point(1,0));Point.CubicBezierCircleUnit=Object.freeze(new Number(-0.55191502449));var SvgCloner=function(){var a=new Object();a.CloneSvg=function(g,q,n,r,j){var h=$("#"+g);var f=$("#"+q).clone();StoryboardContainer.UpdateGradientIds(f);f.attr("id",n);var e=new Array();RecursivelyFindChildrenIds(f,e);for(var k=0;k<e.length;k++){var o=e[k];var m=o.replaceAll(q,n);FindAndUpdateId(n,o,m)}f.attr("id",n);f.attr("class","");f.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();f.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",n+SvgPartsEnum.CropGroup);var p=f.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",n+SvgPartsEnum.Scale);f.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",n+SvgPartsEnum.Natural);p.attr("transform","scale(1,1)");h.children().remove();h.attr("width",r);h.attr("height",j);h.append(f);var b=GetGlobalById(n).getBBox();var s=(r-5)/b.width;var t=(j-5)/b.height;var l=Math.min(s,t);p.attr("transform","scale("+l+")");var c=(r-((b.width)*l))/2;c-=(b.x*l);var d=(j-((b.height)*l))/2;d-=(b.y*l);f.attr("transform","translate("+c+", "+d+")")};return a}();function BrowserProperties(){this.ClipartDisplayWidth=66;this.ClipartDisplayHeight=95;this.ClipartDisplayWidthScene=105;this.ClipartDisplayWidth16x9Scene=169;this.CompressionRatio=1;this.IsSafari5=false;this.IsMobile=false;this.IsIE9=false;this.IsOldIE=false;this.IsChrome=false;this.Private_DefaultFont="";this.Public_GetDefaultFont=function(){if(this.Private_DefaultFont.length>0){return this.Private_DefaultFont}this.Private_DefaultFont="'Francois One'";try{var b=window.navigator.userLanguage||window.navigator.language;if(b.indexOf("ca")!==-1||b.indexOf("da")!==-1||b.indexOf("de")!==-1||b.indexOf("en")!==-1||b.indexOf("es")!==-1||b.indexOf("fi")!==-1||b.indexOf("fr")!==-1||b.indexOf("it")!==-1||b.indexOf("nb")!==-1||b.indexOf("nl")!==-1||b.indexOf("pl")!==-1||b.indexOf("sv")!==-1||b.indexOf("se")!==-1){this.Private_DefaultFont="'Francois One'"}else{if(b.indexOf("he")!==-1){this.Private_DefaultFont="'Varela Round'"}}}catch(a){}return this.Private_DefaultFont};this.SupportsSvg=function(){try{if(document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")===false){return false}var b=navigator.userAgent;if(b.indexOf("Safari/533")>0){return false}if(b.indexOf("Safari/531")>0){return false}if(b.indexOf("MSIE 8.0")>0){return false}if(b.indexOf("Firefox/3.6")>0){return false}if(b.indexOf("Mozilla/4.0")>=0){return false}if(b.indexOf("UCBrowser")>=0||b.indexOf("UCWEB")>=0){if(Modernizr.svg==false){LogErrorMessage("Supports Svg - UCBrowser - FALSE - "+b);return false}else{if(b.indexOf("10.")||b.indexOf("9.")){LogErrorMessage("Supports Svg - UCBrowser - Manual Rejection - "+b);return false}else{LogErrorMessage("Supports Svg - UCBrowser - TRUE - "+b)}}}if(b.indexOf("MSIE 9.0")>0){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("warning-upgrade-ie9"),type:"error",confirmButtonText:MyLangMap.GetText("warning-ok-button")})}}catch(a){return false}return true};this.EnableCompression=function(){if(MyUserPermissions.UseCompression==false){return false}return this.SupportsWebWorkers()};this.SupportsWebWorkers=function(){try{return Modernizr.webworkers}catch(a){return false}};this.DetermineBrowserInfo=function(){if(navigator.userAgent.indexOf("Safari/534")>0){this.IsSafari5=true}if(navigator.userAgent.indexOf("Chrome")>0){this.IsChrome=true}if($("#ieversion span").is(".ie8")){this.IsOldIE=true}if($("#ieversion span").is(".ie9")){this.IsOldIE=true;this.IsIE9=true}this.IsMobile=this._DetermineMobile();if(this.IsMobile){$("#toggle-keyboard-controls").toggle();$("#tab-roller").css("font-size","18px")}};this._DetermineMobile=function(){if(Modernizr.touch==false){return false}var a=navigator.platform.toLowerCase();if(a.indexOf("win")>=0||a.indexOf("mac")>=0){swalQueue({title:MyLangMap.GetText("Text-Smartboard-Title"),text:MyLangMap.GetText("Text-Smartboard-Text"),type:"info",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:MyLangMap.GetText("Text-Smartboard-Option-Mouse"),cancelButtonText:MyLangMap.GetText("Text-Smartboard-Option-Touch"),closeOnConfirm:true,closeOnCancel:true},function(c){if(c){MyBrowserProperties.SetSmartBoard(false)}else{MyBrowserProperties.SetSmartBoard(true)}StoryboardContainer.JiggleSvgSize()});return false}var b=navigator.userAgent;if(/iPad/i.test(b)||/iPhone/i.test(b)||/iPod/i.test(b)||/Android/i.test(b)){return true}return window.confirm(MyLangMap.GetText("Text-Confirm-Mobile"))};this.SetSmartBoard=function(a){MyBrowserProperties.IsMobile=a;$.touchyOptions.useDelegation=a;if(a){$("#toggle-keyboard-controls").css("display","")}else{$("#toggle-keyboard-controls").css("display","none")}ValidateUILayout()}};function UserPermissions(a,b){this.IsLoggedOn=b;this.EnableAllCellOptions=a.EnableAllCellOptions;this.EnableUploads=a.EnableUploads;this.UseCompression=a.UseCompression;this.MagicToken=a.MagicToken;this.AllowNewSave=false;this.AllowEditSave=false;this.SaveMessage="";this.ModalPop="";this.PortalFolders=null;this.SelectedPortalFolder=null;this.Public_RefreshPermissions=function(h,c){try{var g="";try{g=GetQueryStringParameterByName("f")}catch(f){LogErrorMessage("Public_RefreshPermissions.folderId",f)}var d="/api_storyboardcreator/userstoryboardaccess?logresult="+h+"&magictoken="+this.MagicToken+"&time="+TimeStamp;if(g!=null&&g!=""){d+="&folderid="+g}var i=this;jQuery.ajax({type:"GET",url:d,async:true,cache:false,timeout:180*1000,error:function(m,n,l){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("Error-Save-Internet"),type:"Error",confirmButtonText:MyLangMap.GetText("warning-ok-button")});$.unblockUI();var k=new Object();try{k.message=n+" : "+l;k.stack=l.stack}catch(j){LogErrorMessage("UserPermissions.Public_RefreshPermissions_load_error",j)}LogErrorMessage("UserPermissions.Public_RefreshPermissions",k)},success:function(l,j){i.AllowNewSave=l.AllowNewSave;i.AllowEditSave=l.AllowEditSave;i.EnableUploads=l.EnableUploads;i.EnableAllCellOptions=l.EnableAllCellOptions;i.IsLoggedOn=l.LoggedOn;i.SaveMessage=l.SaveMessage;i.PortalFolders=l.PortalFolders;try{i.SelectedPortalFolder=l.SelectedPortalFolder}catch(k){LogErrorMessage("UserPermissions.Public_RefreshPermissions.selectedportalfolder",k)}i.FolderTitle=l.FolderTitle;i.NoFolderTitle=l.NoFolderTitle;i.MagicToken=l.MagicToken;try{i.ModalPop=l.ModalPop}catch(k){LogErrorMessage("UserPermissions.Public_RefreshPermissions.ModalPop",k)}c()},})}catch(f){LogErrorMessage("SvgManip.UpdateUserPermissions",f)}}};function BaseStoryboardLayout(b,a,d,c){this.LayoutType="";this._Padding=c;this._CellStroke=3;this.ContainerBorderPaddingRight=0;this.ContainerBorderPaddingBottom=this._Padding;this.WatermarkPaddingTop=25;this.Row1PaddingTop=0;this.Row1PaddingLeft=this._Padding;this.CellPaddingLeft=this._Padding;this.CellPaddingTop=this._Padding;this.CellHeight=336;this.CellWidth=372;this.TitlePaddingTop=0;this.TitleHeight=0;this.DescriptionHeight=0;this.DescriptionPaddingTop=0;this.BetweenRowPadding=0;this.TitleLayout=new BasicTextLayoutTitle();this.DescriptionLayout=new BasicTextLayoutDescription();this.Stroke="black";this.StrokeWidth="3";this.Fill="white";this.Rx="2";this.Ry="2";this.StrokeDashArray="";this.Opacity="1";this.BackGroundOffsetX=0.5;this.BackGroundOffsetY=0.5;this.DefaultDropWidth=180;this.DefaultDropHeight=180;this.HasTitle=false;this.HasDescription=false;this.UnscaledCellWidth=372;this.EnableDescription(a);this.EnableTitle(b);this.ExpandCells(d)}BaseStoryboardLayout.prototype.GetScale=function(){return this.CellWidth/372};BaseStoryboardLayout.prototype._ExtraFullColumnWidth=function(){return 0};BaseStoryboardLayout.prototype._ExtraFullRowHeight=function(){return 0};BaseStoryboardLayout.prototype.FullColumnWidth=function(){var a=this.CellPaddingLeft;a+=this.CellWidth;a+=this._ExtraFullColumnWidth();return a};BaseStoryboardLayout.prototype.FullRowHeight=function(){var a=this.TitlePaddingTop;a+=this.TitleHeight;a+=this.CellPaddingTop;a+=this.CellHeight;a+=this.DescriptionPaddingTop;a+=this.DescriptionHeight;a+=this.BetweenRowPadding;a+=this._ExtraFullRowHeight();return a};BaseStoryboardLayout.prototype.BeforeCellHeight=function(){var a=this.TitlePaddingTop;a+=this.TitleHeight;a+=this.CellPaddingTop;return a};BaseStoryboardLayout.prototype.BeforeDescriptionHeight=function(){var a=this.TitlePaddingTop;a+=this.TitleHeight;a+=this.CellPaddingTop;a+=this.CellHeight;a+=this.DescriptionPaddingTop;return a};BaseStoryboardLayout.prototype._ExpandCellsLayoutSpecific=function(a){};BaseStoryboardLayout.prototype.ExpandCells=function(a){if(a==null||isNaN(a)){return}this.CellWidth*=a;this.CellHeight*=a;this.DefaultDropWidth*=a;this.DefaultDropHeight*=a;this.CellPaddingTop*=a;this.CellPaddingLeft*=a;this.Row1PaddingTop*=a;this.Row1PaddingLeft*=a;this.ContainerBorderPaddingRight*=a;this.TitlePaddingTop*=a;this.TitleHeight*=a;this.DescriptionHeight*=a;this.DescriptionPaddingTop*=a;this.BetweenRowPadding*=a;this._ExpandCellsLayoutSpecific(a)};BaseStoryboardLayout.prototype.Activate=function(){};BaseStoryboardLayout.prototype.Deactivate=function(){};BaseStoryboardLayout.prototype._EnableTitleLayoutSpecific=function(a){};BaseStoryboardLayout.prototype.EnableTitle=function(a){if(a==null||a==this.HasTitle){return}if(a){var b=this.GetScale();this.TitlePaddingTop=b*this._Padding;this.TitleHeight=b*50;this.BetweenRowPadding=25}else{this.TitlePaddingTop=0;this.TitleHeight=0;if(this.HasDescription==false){this.BetweenRowPadding=0}}this.HasTitle=a;this._EnableTitleLayoutSpecific(a)};BaseStoryboardLayout.prototype._EnableDescriptionLayoutSpecific=function(a){};BaseStoryboardLayout.prototype.EnableDescription=function(a){if(a==null||a==this.HasDescription){return}if(a){var b=this.GetScale();this.DescriptionPaddingTop=b*this._Padding;this.DescriptionHeight=b*90;this.BetweenRowPadding=25}else{this.DescriptionPaddingTop=0;this.DescriptionHeight=0;if(this.HasTitle==false){this.BetweenRowPadding=0}}this.HasDescription=a;this._EnableDescriptionLayoutSpecific(a)};BaseStoryboardLayout.prototype.GetScale=function(){return this.CellWidth/this.UnscaledCellWidth};BaseStoryboardLayout.prototype.GetStoryboardAreaTitleLayout=function(a){return null};BaseStoryboardLayout.prototype.GetCellTitleOverrideText=function(b,a){return this.TitleLayout.DefaultText};BaseStoryboardLayout.prototype.GetLayoutLines=function(b,a){return null};BaseStoryboardLayout.prototype.GetCellPartPosition=function(b,c,a){switch(b){case StoryboardPartTypeEnum.StoryboardCell:return this._CellPosition(c,a);case StoryboardPartTypeEnum.StoryboardCellTitle:return this._CellTitlePosition(c,a);case StoryboardPartTypeEnum.StoryboardCellDescription:return this._CellDescriptionPosition(c,a);case StoryboardPartTypeEnum.StoryboardAreaTitle:return this._AreaTitlePosition(c,a);case StoryboardPartTypeEnum.StoryboardAttributionArea:return this._AttributionAreaPosition(c,a)}};BaseStoryboardLayout.prototype._CellPosition=function(c,b){var d=this.Row1PaddingLeft+(b*(this.CellPaddingLeft+this.CellWidth));var e=this.Row1PaddingTop+this.BeforeCellHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.CellHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCell);return a};BaseStoryboardLayout.prototype._CellTitlePosition=function(c,b){var d=this.Row1PaddingLeft+(b*(this.CellPaddingLeft+this.CellWidth));var e=this.Row1PaddingTop+this.TitlePaddingTop+(c*(this.FullRowHeight()));var a=new BoxPosition(this.TitleHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellTitle);return a};BaseStoryboardLayout.prototype._CellDescriptionPosition=function(c,b){var d=this.Row1PaddingLeft+(b*(this.CellPaddingLeft+this.CellWidth));var e=this.Row1PaddingTop+this.BeforeDescriptionHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellDescription);return a};BaseStoryboardLayout.prototype._AttributionAreaPosition=function(c,b){var d=this._GetStoryboardSizePreAttribution(c,b);var a=new BoxPosition(20,d.Width-(2*this._Padding),this._Padding,d.Height+this._Padding,c,b,StoryboardPartTypeEnum.StoryboardAttributionArea);return a};BaseStoryboardLayout.prototype._AreaTitlePosition=function(b,a){return null};BaseStoryboardLayout.prototype.GetAnchorPoints=function(a){a.Top=a.Y;a.NearTop=a.Y+2*this._Padding;a.MiddleY=a.Y+a.Height/2;a.NearBottom=a.Y+a.Height-(2*this._Padding);a.Bottom=a.Y+a.Height;a.Left=a.X;a.NearLeft=a.X+2*this._Padding;a.MiddleX=a.X+a.Width/2;a.NearRight=a.X+a.Width-(2*this._Padding);a.Right=a.X+a.Width;a.Center=new Point(a.MiddleX,a.MiddleY);return a};BaseStoryboardLayout.prototype.GetMinimumStoryboardHeight=function(){var a=this.Row1PaddingTop+this.FullRowHeight()+this.ContainerBorderPaddingBottom+this.WatermarkPaddingTop+20;return a};BaseStoryboardLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+this.ContainerBorderPaddingRight+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+this.WatermarkPaddingTop+this.ContainerBorderPaddingBottom+(c*(this.FullRowHeight()))-this.BetweenRowPadding;return a};BaseStoryboardLayout.prototype.GetStoryboardSize=function(g,d){var c=this._GetStoryboardSizePreAttribution(g,d);var a=GetGlobalById("ImageAttributionGroup");if(a!=null){try{var b=a.getBBox();if(b.height>0){c.Height+=2*this._Padding+b.height}}catch(f){LogErrorMessage("BaseStoryboardLayout.GetStoryboardSize",f)}}return c};BaseStoryboardLayout.prototype.GetStoryboardContentBounds=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Height=this.Row1PaddingTop+(c*(this.FullRowHeight()))-this.BetweenRowPadding;a.Width=this.Row1PaddingLeft+(b*(this.FullColumnWidth()));return a};BaseStoryboardLayout.prototype.GetWatermarkTop=function(a){var b=this.Row1PaddingTop+this.WatermarkPaddingTop+(a*this.FullRowHeight())-this.BetweenRowPadding;return b};BaseStoryboardLayout.prototype.GetLayoutConfig=function(){return null};function FrayerLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,15);this.LayoutType=StoryboardLayoutType.Frayer;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=2*this._Padding;this._ChartLabelPaddingBottom=2*this._Padding;this.BetweenRowPadding=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom-(this.CellPaddingTop/c);this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c;this.BetweenRowPadding*=c}inheritPrototype(FrayerLayout,BaseStoryboardLayout);FrayerLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};FrayerLayout.prototype._EnableDescriptionLayoutSpecific=function(a){this.BetweenRowPadding=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom-this.CellPaddingTop};FrayerLayout.prototype._EnableTitleLayoutSpecific=function(a){this.BetweenRowPadding=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom-this.CellPaddingTop};FrayerLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};FrayerLayout.prototype.GetCellTitleOverrideText=function(c,a){var b="Definitions";if(c==0&&a==1){b="Characteristics"}else{if(c==1&&a==0){b="Examples"}else{if(c==1&&a==1){b="Non-Examples"}}}return b};FrayerLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0||b!=0){return}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=this.FullColumnWidth()/2+this.CellPaddingLeft;var g=this.FullRowHeight()+this._ChartLabelPaddingTop-this.BetweenRowPadding;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,f,g,0,0,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};function HorizontalTimelineLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.TChart;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartOuterBoxWidth=3;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2);this._ChartLabelPaddingBottom=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this.CellPaddingLeft=(this._Padding*2)+this._ChartGridStrokeWidth;this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+(this._ChartGridStrokeWidth/2)+60;this.Row1PaddingLeft=this.CellPaddingLeft;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c;this.WatermarkPaddingTop=50}inheritPrototype(HorizontalTimelineLayout,BaseStoryboardLayout);HorizontalTimelineLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};HorizontalTimelineLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};HorizontalTimelineLayout.prototype.GetLayoutLines=function(h,d){var e=SvgCreator.CreateSvgGroup("t-chart");var n=this.Row1PaddingLeft-this._Padding;var o=this.Row1PaddingLeft+this._GetGap(d-1)+this.FullColumnWidth();var p=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+20;var q=p;var i="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";e.appendChild(SvgCreator.AddLine(n,p,o,q,i,"t-chart-horizontal"));for(var c=0;c<d;c++){var b=this.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellTitle,0,c);var a=this.GetAnchorPoints(b);b.X-=this._Padding;b.Width+=2*this._Padding;b.Y-=this._Padding;b.Height=this.FullRowHeight()+2*this._Padding-this.BetweenRowPadding;var f=SvgCreator.AddRect(b.X,b.Y,b.Width,b.Height,"black","none",null,null,"outerbox_"+c);f.setAttributeNS(null,"stroke-width",+this._ChartOuterBoxWidth+"px");e.appendChild(f);e.appendChild(SvgCreator.AddLine(a.MiddleX,72,a.MiddleX,150,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","timeline-connector-"+c));if(this._TimeJump(c)){var j=a.Left-0.25*this.FullColumnWidth()-10;var k=a.Left-0.25*this.FullColumnWidth()+10;var l=p+15;var m=p-15;e.appendChild(SvgCreator.AddLine(j,l,k,m,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-a"+c));e.appendChild(SvgCreator.AddLine(j+10,l,k+10,m,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-b"+c))}}return e};HorizontalTimelineLayout.prototype._TimeJump=function(a){var b=[new Date("3/22/1765"),new Date("3/5/1770"),new Date("12/16/1773"),new Date("1/1/1774"),new Date("9/5/1774"),new Date("4/18/1775"),new Date("7/4/1776"),new Date("9/19/1777"),new Date("10/19/1781"),new Date("9/3/1783")];if(a==0){return 0}var d=b[5]-b[4];var c=(b[a]-b[a-1])/d;if(c>5||c<1){return true}return false};HorizontalTimelineLayout.prototype._GetGap=function(a){var b=[new Date("3/22/1765"),new Date("3/5/1770"),new Date("12/16/1773"),new Date("1/1/1774"),new Date("9/5/1774"),new Date("4/18/1775"),new Date("7/4/1776"),new Date("9/19/1777"),new Date("10/19/1781"),new Date("9/3/1783")];if(a==0){return 0}var d=b[5]-b[4];var c=(b[a]-b[a-1])/d;if(c>5||c<1){c=1.5}return c*this.FullColumnWidth()+this._GetGap(a-1)};HorizontalTimelineLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0){return}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=this._GetGap(b)+(this.Row1PaddingLeft)+c/2;var g=this._ChartLabelPaddingTop;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,f,g,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};HorizontalTimelineLayout.prototype._CellPosition=function(c,b){var d=this._GetGap(b)+(this.Row1PaddingLeft);var e=this.Row1PaddingTop+this.BeforeCellHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.CellHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCell);return a};HorizontalTimelineLayout.prototype._CellTitlePosition=function(c,b){var d=this._GetGap(b)+(this.Row1PaddingLeft);var e=this.Row1PaddingTop+this.TitlePaddingTop+(c*(this.FullRowHeight()));var a=new BoxPosition(this.TitleHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellTitle);return a};HorizontalTimelineLayout.prototype._CellDescriptionPosition=function(c,b){var d=this._GetGap(b)+(this.Row1PaddingLeft);var e=this.Row1PaddingTop+this.BeforeDescriptionHeight()+(c*(this.FullRowHeight()));var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellDescription);return a};HorizontalTimelineLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+this._GetGap(b-1)+this.FullColumnWidth();a.Height=this.Row1PaddingTop+this.WatermarkPaddingTop+this.ContainerBorderPaddingBottom+(c*(this.FullRowHeight()))-this.BetweenRowPadding;return a};HorizontalTimelineLayout.prototype.GetStoryboardContentBounds=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Height=this.Row1PaddingTop+(c*(this.FullRowHeight()))-this.BetweenRowPadding;a.Width=this.Row1PaddingLeft+this._GetGap(b-1)+this.FullColumnWidth();return a};function LandscapePaperLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.LandscapePaper;this.CellWidth=1400;this.CellHeight=this.CellWidth*(8/10.5)}inheritPrototype(LandscapePaperLayout,BaseStoryboardLayout);LandscapePaperLayout.prototype.GetScale=function(){return this.CellHeight/800};function LandscapeLegalLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.LandscapePaper;this.CellWidth=(1400/10.5)*13.5;this.CellHeight=this.CellWidth*(8/13.5)}inheritPrototype(LandscapeLegalLayout,BaseStoryboardLayout);LandscapeLegalLayout.prototype.GetScale=function(){return this.CellHeight/800};function LandscapeTabloidLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.LandscapePaper;this.CellWidth=(1400/10.5)*16.5;this.CellHeight=this.CellWidth*(10.5/16.5)}inheritPrototype(LandscapeTabloidLayout,BaseStoryboardLayout);LandscapeTabloidLayout.prototype.GetScale=function(){return this.CellHeight/800};function LayoutFactory(){this.GetLayout=function(c,b,a,e,d){if(c==StoryboardLayoutType.StoryboardGrid){return new StoryboardGridLayout(b,a,e,d)}if(c==StoryboardLayoutType.TChart){return new TChartLayout(b,a,e,d)}if(c==StoryboardLayoutType.Frayer){return new FrayerLayout(b,a,e,d)}if(c==StoryboardLayoutType.Matrix){return new MatrixLayout(b,a,e,d)}if(c==StoryboardLayoutType.Spider){return new SpiderLayout(b,a,e,d)}if(c==StoryboardLayoutType.Timeline){return new TimelineLayout(b,a,e,d)}if(c==StoryboardLayoutType.Movie){return new MovieLayout(b,a,e,d)}if(c==StoryboardLayoutType.ParallelLabelMatrix){return new ParallelLabelMatrixLayout(b,a,e,d)}if(c==StoryboardLayoutType.Cycle){return new CycleLayout(b,a,e,d)}if(c==StoryboardLayoutType.PortraitPaper){return new PortraitPaperLayout(b,a,e,d)}if(c==StoryboardLayoutType.LandscapePaper){return new LandscapePaperLayout(b,a,e,d)}if(c==StoryboardLayoutType.PortraitLegal){return new PortraitLegalLayout(b,a,e,d)}if(c==StoryboardLayoutType.LandscapeLegal){return new LandscapeLegalLayout(b,a,e,d)}if(c==StoryboardLayoutType.PortraitTabloid){return new PortraitTabloidLayout(b,a,e,d)}if(c==StoryboardLayoutType.LandscapeTabloid){return new LandscapeTabloidLayout(b,a,e,d)}}};function MatrixLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Matrix;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._Padding+this._ChartTitleStrokeWidth);this._ChartLabelPaddingBottom=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this._ChartLabelPaddingLeft=this._ChartLabelPaddingTop;this._ChartLabelPaddingRight=this._ChartLabelPaddingBottom;this.CellPaddingLeft=(this._Padding*2)+this._ChartGridStrokeWidth;this.BetweenRowPadding=(this._Padding*2)+(this._ChartGridStrokeWidth/2);this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+(this._ChartGridStrokeWidth/2);this.Row1PaddingLeft=this._ChartLabelPaddingLeft+(this.CellWidth/c)+this._ChartLabelPaddingRight+(this._ChartGridStrokeWidth/2)+(this._Padding/2);this.WatermarkPaddingTop=50;this.BetweenRowPadding*=c;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c;this._ChartLabelPaddingLeft*=c;this._ChartLabelPaddingRight*=c;this.WatermarkPaddingTop*=c}inheritPrototype(MatrixLayout,BaseStoryboardLayout);MatrixLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a;this._ChartLabelPaddingLeft*=a;this._ChartLabelPaddingRight*=a;this.WatermarkPaddingTop*=a};MatrixLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};MatrixLayout.prototype._EnableDescriptionLayoutSpecific=function(a){this.BetweenRowPadding=(this._Padding*2)+(this._ChartGridStrokeWidth/2)};MatrixLayout.prototype._EnableTitleLayoutSpecific=function(a){this.BetweenRowPadding=(this._Padding*2)+(this._ChartGridStrokeWidth/2)};MatrixLayout.prototype.ChartLabelWidth=function(){};MatrixLayout.prototype.GetLayoutLines=function(m,a){var d=SvgCreator.CreateSvgGroup("t-chart");var p,q,r,s;var o="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";var c=this._Padding;var b=(this.FullRowHeight()*m)+this.Row1PaddingTop-this._Padding+this._ChartGridStrokeWidth;var f=this._Padding+this._ChartGridStrokeWidth/2;d.appendChild(SvgCreator.AddLine(f,c,f,b,o,"t-chart-vertical-0"));for(var e=0;e<=a;e++){p=(e*this.FullColumnWidth())+this.Row1PaddingLeft-(this.CellPaddingLeft/2);q=p;d.appendChild(SvgCreator.AddLine(p,c,q,b,o,"t-chart-vertical-"+e))}var n=this._Padding;var l=this.FullColumnWidth()*a+this.Row1PaddingLeft-this._Padding;var h=this._Padding+this._ChartGridStrokeWidth/2;d.appendChild(SvgCreator.AddLine(n,h,l,h,o,"t-chart-vertical-0"));for(var k=0;k<=m;k++){r=this.Row1PaddingTop+(k*this.FullRowHeight())-(this._Padding/2);s=r;d.appendChild(SvgCreator.AddLine(n,r,l,s,o,"t-chart-vertical-"+e+k))}return d};MatrixLayout.prototype._AreaTitlePosition=function(d,b){var e=false;if(d==-1&&b==-1){d=0;b=0;e=true}if(d!=0&&b!=0){return null}var c=this.GetStoryboardAreaTitleLayout().StrokeWidth-3;if(e){x=this._ChartLabelPaddingLeft;y=this.Row1PaddingTop+this._Padding}else{if(d==0){x=(b*this.FullColumnWidth())+(this.Row1PaddingLeft)+c/2;y=this._ChartLabelPaddingTop}else{x=this._ChartLabelPaddingLeft;y=this.Row1PaddingTop+((d)*this.FullRowHeight())+this._Padding}}var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,x,y,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};function ParallelLabelMatrixLayout(b,a,c){MatrixLayout.call(this,b,a,c,12);var d=this.GetStoryboardAreaTitleLayout();this.Col1PaddingTop=this.Row1PaddingTop-this._ChartLabelHeight+(this._Padding*1.5);this.Col1PaddingLeft=this._ChartLabelPaddingTop-(d.StrokeWidth-3);this.Row1PaddingLeft=this.Row1PaddingTop+this._Padding;this.LayoutType=StoryboardLayoutType.ParallelLabelMatrix}inheritPrototype(ParallelLabelMatrixLayout,MatrixLayout);ParallelLabelMatrixLayout.prototype._IsRowTitleCell=function(b,a){return(a===-1&&b===-1)||(b>0&&a===0)};ParallelLabelMatrixLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){var c=MatrixLayout.prototype.GetStoryboardAreaTitleLayout.call(this,b,a);if(this._IsRowTitleCell(b,a)){c.Rotation=270}return c};ParallelLabelMatrixLayout.prototype._AreaTitlePosition=function(i,d){var a=MatrixLayout.prototype._AreaTitlePosition.call(this,i,d);if(this._IsRowTitleCell(i,d)){var g=(d==-1)?0:d;var h=(i==-1)?0:i;var j=this.GetStoryboardAreaTitleLayout();var e=j.StrokeWidth-3;var b=this.CellPaddingTop+this.CellHeight+this.BetweenRowPadding;var c=this.TitleHeight+((this.TitleHeight>0)?this.CellPaddingTop:0)+this.DescriptionPaddingTop+this.DescriptionHeight;var f=this.CellHeight+c;a.Width=f-j.StrokeWidth;a.X=this.Col1PaddingLeft-(b/2)+this._ChartLabelHeight-(c/2);a.Y=this.Col1PaddingTop+((h)*this.FullRowHeight())+(this.FullRowHeight()/2)}return a};ParallelLabelMatrixLayout.prototype._ExpandCellsLayoutSpecific=function(a){MatrixLayout.prototype._ExpandCellsLayoutSpecific.call(this,a);this.Col1PaddingLeft*=a;this.Col1PaddingTop*=a};function MovieLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Movie;this.CellWidth=this.CellHeight*(16/9);this.UnscaledCellWidth=597.333}inheritPrototype(MovieLayout,BaseStoryboardLayout);MovieLayout.prototype.GetScale=function(){return this.CellHeight/336};function PortraitPaperLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.PortraitPaper;this.CellHeight=1400;this.CellWidth=this.CellHeight*(8/10.5)}inheritPrototype(PortraitPaperLayout,BaseStoryboardLayout);PortraitPaperLayout.prototype.GetScale=function(){return this.CellHeight/800};function PortraitLegalLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.PortraitPaper;this.CellHeight=(1400/10.5)*13.5;this.CellWidth=this.CellHeight*(8/13.5)}inheritPrototype(PortraitLegalLayout,BaseStoryboardLayout);PortraitLegalLayout.prototype.GetScale=function(){return this.CellHeight/800};function PortraitTabloidLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.PortraitPaper;this.CellHeight=(1400/10.5)*16.5;this.CellWidth=this.CellHeight*(10.5/16.5)}inheritPrototype(PortraitTabloidLayout,BaseStoryboardLayout);PortraitTabloidLayout.prototype.GetScale=function(){return this.CellHeight/800};function SpiderLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Spider;this.Layouts=null;this._ChartGridStrokeWidth=6;this._ChartLabelHeight=55;this.ContainerBorderPaddingRight=-2*this._Padding;this.CellPaddingLeft=4*this._Padding;this.Row1PaddingTop=2*this._Padding;this.Row1PaddingLeft=2*this._Padding;this.BetweenRowPadding=(this.TitlePaddingTop/c+this.TitleHeight/c+this.CellPaddingTop/c+this.CellHeight/c+this.DescriptionPaddingTop/c+this.DescriptionHeight/c)*0.75;this._ChartLabelHeight*=c;this.ContainerBorderPaddingRight*=c;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this.BetweenRowPadding*=c;this._InitializeCellLayouts()}inheritPrototype(SpiderLayout,BaseStoryboardLayout);SpiderLayout.prototype._ExtraFullColumnWidth=function(){return(this._Padding*2)};SpiderLayout.prototype._ExtraFullRowHeight=function(){return(this._Padding*1)};SpiderLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a};SpiderLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};SpiderLayout.prototype._EnableDescriptionLayoutSpecific=function(a){this.BetweenRowPadding=(this.TitlePaddingTop+this.TitleHeight+this.CellPaddingTop+this.CellHeight+this.DescriptionPaddingTop+this.DescriptionHeight)*0.75};SpiderLayout.prototype._EnableTitleLayoutSpecific=function(a){this.BetweenRowPadding=(this.TitlePaddingTop+this.TitleHeight+this.CellPaddingTop+this.CellHeight+this.DescriptionPaddingTop+this.DescriptionHeight)*0.75};SpiderLayout.prototype.GetLayoutLines=function(f,b){var c=SvgCreator.CreateSvgGroup("t-chart");var k;var h="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";var j=this.GetAnchorPoints(this._AreaTitlePosition(0,0));for(var d=0;d<b;d++){var a=this.GetAnchorPoints(this._CellAnchorPoint(d));var e=SvgCreator.AddRect(a.X,a.Y,a.Width,a.Height,"black","none",null,null,"outerbox_"+d);e.setAttributeNS(null,"stroke-width",this._ChartGridStrokeWidth+"px");c.appendChild(e);k=null;switch(a.CellTitle){case"6A":case"8A":case"10A":k=new Vector(a.MiddleX,j.Top,a.MiddleX,a.Bottom);break;case"6D":case"8E":case"10F":k=new Vector(a.MiddleX,j.Bottom,a.MiddleX,a.Top);break;case"6B":case"8B":case"10B":k=new Vector(j.NearRight,j.Top,a.Left,a.NearBottom);break;case"6C":case"8D":case"10E":k=new Vector(j.NearRight,j.Bottom,a.Left,a.NearTop);break;case"6F":case"8H":case"10J":k=new Vector(j.NearLeft,j.Top,a.Right,a.NearBottom);break;case"6E":case"8F":case"10G":k=new Vector(j.NearLeft,j.Bottom,a.Right,a.NearTop);break;case"8C":k=new Vector(j.Right,j.MiddleY,a.Left,j.MiddleY);break;case"8G":k=new Vector(j.Left,j.MiddleY,a.Right,j.MiddleY);break;case"10C":k=new Vector(j.Right,j.MiddleY-this._Padding/2,a.Left,a.NearBottom);break;case"10D":k=new Vector(j.Right,j.MiddleY+this._Padding/2,a.Left,a.NearTop);break;case"10I":k=new Vector(j.Left,j.MiddleY-this._Padding/2,a.Right,a.NearBottom);break;case"10H":k=new Vector(j.Left,j.MiddleY+this._Padding/2,a.Right,a.NearTop);break}if(k){c.appendChild(SvgCreator.AddLine(k.X1,k.Y1,k.X2,k.Y2,h,"t-chart-vertical-"+d))}}return c};SpiderLayout.prototype._AreaTitlePosition=function(e,b){if(e!=0||b!=0){return}var f=this.GetStoryboardAreaTitleLayout();var d=f.StrokeWidth-3;var g=this._VirtualCols(StoryboardContainer.Cols);var c=(g-1)/2;var h=this.FullColumnWidth()*c+this.Row1PaddingLeft+this._Padding;var i=this.Row1PaddingTop+this.FullRowHeight()-this.BetweenRowPadding+(this.BetweenRowPadding-this._ChartLabelHeight)/2;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-d,h,i,0,0,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};SpiderLayout.prototype._CellPosition=function(d,c){var b=this._CellAnchorPoint(c);var e=b.X+this._Padding;var f=b.Y+this.BeforeCellHeight();var a=new BoxPosition(this.CellHeight,this.CellWidth,e,f,d,c,StoryboardPartTypeEnum.StoryboardCell);return a};SpiderLayout.prototype._CellTitlePosition=function(d,c){var b=this._CellAnchorPoint(c);var e=b.X+this._Padding;var f=b.Y+this.TitlePaddingTop;var a=new BoxPosition(this.TitleHeight,this.CellWidth,e,f,d,c,StoryboardPartTypeEnum.StoryboardCellTitle);return a};SpiderLayout.prototype._CellDescriptionPosition=function(d,c){var b=this._CellAnchorPoint(c);var e=b.X+this._Padding;var f=b.Y+this.BeforeDescriptionHeight();var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,e,f,d,c,StoryboardPartTypeEnum.StoryboardCellDescription);return a};SpiderLayout.prototype._InitializeCellLayouts=function(){this.Layouts=new Object();this.Layouts["6A"]=new SpiderCellLocation("6A",1,0,0);this.Layouts["6B"]=new SpiderCellLocation("6B",2,0,0.25);this.Layouts["6C"]=new SpiderCellLocation("6C",2,1,-0.25);this.Layouts["6D"]=new SpiderCellLocation("6D",1,1,0);this.Layouts["6E"]=new SpiderCellLocation("6E",0,1,-0.25);this.Layouts["6F"]=new SpiderCellLocation("6F",0,0,0.25);this.Layouts["8A"]=new SpiderCellLocation("8A",2,0,0);this.Layouts["8B"]=new SpiderCellLocation("8B",3,0,0.25);this.Layouts["8C"]=new SpiderCellLocation("8C",4,0,0.85);this.Layouts["8D"]=new SpiderCellLocation("8D",3,1,-0.25);this.Layouts["8E"]=new SpiderCellLocation("8E",2,1,0);this.Layouts["8F"]=new SpiderCellLocation("8F",1,1,-0.25);this.Layouts["8G"]=new SpiderCellLocation("8G",0,0,0.85);this.Layouts["8H"]=new SpiderCellLocation("8H",1,0,0.25);this.Layouts["10A"]=new SpiderCellLocation("10A",2,0,0);this.Layouts["10B"]=new SpiderCellLocation("10B",3,0,0.15);this.Layouts["10C"]=new SpiderCellLocation("10C",4,0,0.3);this.Layouts["10D"]=new SpiderCellLocation("10D",4,1,-0.3);this.Layouts["10E"]=new SpiderCellLocation("10E",3,1,-0.15);this.Layouts["10F"]=new SpiderCellLocation("10F",2,1,0);this.Layouts["10G"]=new SpiderCellLocation("10G",1,1,-0.15);this.Layouts["10H"]=new SpiderCellLocation("10H",0,1,-0.3);this.Layouts["10I"]=new SpiderCellLocation("10I",0,0,0.3);this.Layouts["10J"]=new SpiderCellLocation("10J",1,0,0.15);this.Layouts[3]=["6A","6B","6F"];this.Layouts[4]=["6F","6B","6C","6E"];this.Layouts[5]=["6A","6B","6C","6E","6F"];this.Layouts[6]=["6A","6B","6C","6D","6E","6F"];this.Layouts[7]=["8A","8B","8C","8D","8F","8G","8H"];this.Layouts[8]=["8A","8B","8C","8D","8E","8F","8G","8H"];this.Layouts[9]=["10A","10B","10C","10D","10E","10G","10H","10I","10J"];this.Layouts[10]=["10A","10B","10C","10D","10E","10F","10G","10H","10I","10J"];this.Layouts[1]=["6A","6B","6F"];this.Layouts[2]=["6A","6B","6F"]};SpiderLayout.prototype.GetCellLayouts=function(){return Layouts};SpiderLayout.prototype._CellAnchorPoint=function(c){var b=this.Layouts[StoryboardContainer.Cols][c];var f=this.Layouts[b];var e=this.FullRowHeight()-this.BetweenRowPadding;var d=this._Padding*2+this.CellWidth;var g=this.Row1PaddingLeft+(f.FakeCol*this.FullColumnWidth());var h=this.Row1PaddingTop+(f.FakeRow*this.FullRowHeight())+(e*f.RowOffset);var a=new BoxPosition(e,d,g,h,0,c,StoryboardPartTypeEnum.StoryboardCellOuterBox);a.CellTitle=b;return a};SpiderLayout.prototype._VirtualCols=function(a){layoutType=parseInt(this.Layouts[a][0]);if(layoutType==6){return 3}if(layoutType==8){return 5}if(layoutType==10){return 5}return 3};SpiderLayout.prototype._VirtualRows=function(a){if(a==3){return 1}return 2};SpiderLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=new BoxPosition();c=this._VirtualRows(b);b=this._VirtualCols(b);a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+this.ContainerBorderPaddingRight+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+this.WatermarkPaddingTop+this.ContainerBorderPaddingBottom+(c*(this.FullRowHeight()))-this.BetweenRowPadding;if(c==1){a.Height+=0.6*this.BetweenRowPadding}return a};SpiderLayout.prototype.GetStoryboardContentBounds=function(c,b){c=this._VirtualRows(b);b=this._VirtualCols(b);var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+(c*this.FullRowHeight())-this.BetweenRowPadding;if(c==1){a.Height+=0.6*this.BetweenRowPadding}return a};SpiderLayout.prototype.GetWatermarkTop=function(b){if(StoryboardContainer.Cols==3){var a=this.GetStoryboardContentBounds(1,3);return a.Height+this.WatermarkPaddingTop}return this.Row1PaddingTop+this.WatermarkPaddingTop+(2*this.FullRowHeight())-this.BetweenRowPadding};function CycleLayout(b,a,c){SpiderLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.Cycle;this.IdPrefix="cycle-chart-arrow";this.ArrowStrokeWidth="6";this.DefaultColor="black";this.DefaultFill="none";this.Row1PaddingLeft=4*this._Padding;this.ContainerBorderPaddingRight=3*this._Padding;this.ContainerBorderPaddingBottom=3*this._Padding;this.Row1PaddingTop=4*this._Padding}inheritPrototype(CycleLayout,SpiderLayout);CycleLayout.prototype.IdGen=function(a,b){return this.IdPrefix+"-"+a+"-to-"+b};CycleLayout.prototype.GetLayoutLines=function(p,c){var d=SvgCreator.CreateSvgGroup("cycle-chart");var q="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";var s=this.GetAnchorPoints(this._AreaTitlePosition(0,0));for(var r=0;r<c;r++){var h=(r+1)%c;var a=this.GetAnchorPoints(this._CellAnchorPoint(r));var f=this.GetAnchorPoints(this._CellAnchorPoint(h));var o=SvgCreator.AddRect(a.X,a.Y,a.Width,a.Height,"black","none",null,null,"outerbox_"+r);o.setAttributeNS(null,"stroke-width",this._ChartGridStrokeWidth+"px");d.appendChild(o)}var b=[];for(var e=0;e<c;++e){b.push(this.GetAnchorPoints(this._CellAnchorPoint(e)))}var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].MiddleY));switch(c){case 3:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].MiddleY));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].Right,b[0].MiddleY),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Left,b[1].MiddleY),new Point(b[2].Right,b[2].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Top),new Point(b[0].Left,b[0].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 4:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].MiddleY));var l=new Point(j.X/2.5,j.Y);d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].Right,b[0].NearTop),new Point(b[1].Left,b[1].NearTop),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(l,new Point(b[1].Right,(b[1].NearBottom+b[1].MiddleY)/2),new Point(b[2].Right,(b[2].NearTop+b[2].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].Left,b[2].NearBottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(l,new Point(b[3].Left,(b[3].NearTop+b[3].MiddleY)/2),new Point(b[0].Left,(b[0].NearBottom+b[0].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 5:var n=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));var k=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[1].MiddleY));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[1].Right,(b[1].NearBottom+b[1].MiddleY)/2),new Point(b[2].Right,(b[2].NearTop+b[2].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(k,new Point(b[2].Left,b[2].NearBottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[3].Left,(b[3].NearTop+b[3].MiddleY)/2),new Point(b[4].Left,(b[4].NearBottom+b[4].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(n,new Point(b[4].MiddleX,b[4].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 6:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Right,(b[1].NearBottom+b[1].MiddleY)/2),new Point(b[2].Right,(b[2].NearTop+b[2].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Bottom),new Point(b[3].MiddleX,b[3].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].MiddleX,b[3].Bottom),new Point(b[4].MiddleX,b[4].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].Left,(b[4].NearTop+b[4].MiddleY)/2),new Point(b[5].Left,(b[5].NearBottom+b[5].MiddleY)/2),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].MiddleX,b[5].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 7:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));var k=new Point(Math.abs(s.Center.X-b[2].MiddleX),Math.abs(s.Center.Y-b[3].NearBottom));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Right,b[1].NearTop),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Bottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].Left,b[3].NearBottom),new Point(b[4].Right,b[4].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].Left,b[4].NearBottom),new Point(b[5].MiddleX,b[5].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].MiddleX,b[5].Top),new Point(b[6].Left,b[6].NearTop),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[6].MiddleX,b[6].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 8:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].Right,b[1].NearTop),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[2].MiddleX,b[2].Bottom),new Point(b[3].Right,b[3].NearBottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].MiddleX,b[3].Bottom),new Point(b[4].MiddleX,b[4].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].MiddleX,b[4].Bottom),new Point(b[5].MiddleX,b[5].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].Left,b[5].NearBottom),new Point(b[6].MiddleX,b[6].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[6].MiddleX,b[6].Top),new Point(b[7].Left,b[7].NearTop),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[7].MiddleX,b[7].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 9:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-((b[0].MiddleY+b[0].NearTop)/2)));var m=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].MiddleX,b[1].Top),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[2].Right,b[2].MiddleY),new Point(b[3].Right,b[3].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[3].MiddleX,b[3].Bottom),new Point(b[4].MiddleX,b[4].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[4].NearLeft,b[4].Bottom),new Point(b[5].NearRight,b[5].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[5].MiddleX,b[5].Bottom),new Point(b[6].MiddleX,b[6].Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[6].Left,b[6].MiddleY),new Point(b[7].Left,b[7].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[7].MiddleX,b[7].Top),new Point(b[8].MiddleX,b[8].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[8].MiddleX,b[8].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;case 10:var j=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-((b[0].MiddleY+b[0].NearTop)/2)));var m=new Point(Math.abs(s.Center.X-b[1].MiddleX),Math.abs(s.Center.Y-b[0].NearTop));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[0].MiddleX,b[0].Top),new Point(b[1].MiddleX,b[1].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[1].MiddleX,b[1].Top),new Point(b[2].MiddleX,b[2].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[2].Right,b[2].MiddleY),new Point(b[3].Right,b[3].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));for(var e=3;e<7;++e){d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(this.GetAnchorPoints(this._CellAnchorPoint(e)).MiddleX,this.GetAnchorPoints(this._CellAnchorPoint(e)).Bottom),new Point(this.GetAnchorPoints(this._CellAnchorPoint(e+1)).MiddleX,this.GetAnchorPoints(this._CellAnchorPoint(e+1)).Bottom),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)))}d.appendChild(SvgCreator.AddEllipsisArc(m,new Point(b[7].Left,b[7].MiddleY),new Point(b[8].Left,b[8].MiddleY),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[8].MiddleX,b[8].Top),new Point(b[9].MiddleX,b[9].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));d.appendChild(SvgCreator.AddEllipsisArc(j,new Point(b[9].MiddleX,b[9].Top),new Point(b[0].MiddleX,b[0].Top),this.DefaultColor,this.DefaultFill,this.ArrowStrokeWidth,this.IdGen(r,h)));break;default:break}return d};CycleLayout.prototype._OutsideEdgeCenter=function(c,e,n){var a=this.GetAnchorPoints(this._CellAnchorPoint(c));var t=this.GetAnchorPoints(this._AreaTitlePosition(0,0));var m=this.GetAnchorPoints(this._CellAnchorPoint(n));var b={left:false,right:false,top:false,bottom:false};var h={left:false,right:false,top:false,bottom:false};b=this._GetCovered(b,c,e,t,a,m);h=this._GetCovered(h,n,e,t,a,m);var k=null;var l=[];var r=null;var q=null;var g=999999999;var u=[0,0];var s=null;var o=a.Left>m.Right;var p=a.Top>m.Bottom;for(var f in b){var d=this._GetPointPreference(b,a,p,o);for(var j in h){if(!b[f]&&!h[j]){continue}var i=this._GetPointPreference(h,a,!p,!o);q=MathUtils.CartesianSegmentLength(d,i);testtitledistance=MathUtils.CartesianSegmentLength(d,t.centerPoint)+MathUtils.CartesianSegmentLength(i,t.centerPoint);if(q<g||(q==g&&testtitledistance>titleDistance)){l.source=d;l.target=i;g=q;titledistance=testtitledistance}}}return l};CycleLayout.prototype._GetPointPreference=function(b,a,e,d){for(var c in b){switch(c){case"left":return new Point(a.Left,(e)?a.NearTop:a.NearBottom);case"right":return new Point(a.Right,(e)?a.NearTop:a.NearBottom);case"top":return new Point(a.MiddleX,(d)?a.NearLeft:a.NearRight);case"bottom":return new Point(a.MiddleX,(d)?a.NearLeft:a.NearRight)}}};CycleLayout.prototype._GetCovered=function(d,b,c,g,a,e){for(var f=0;f<c;f++){var e;if(f==b){e=g;continue}else{e=this.GetAnchorPoints(this._CellAnchorPoint(f))}if(!(a.Top>e.Bottom||a.Bottom<e.Top)){if(a.X<e.X){d.right=true}else{d.left=true}}if(!(a.Right<e.Left||a.Left>e.Right)){if(a.Y>e.Y){d.top=true}else{d.bottom=true}}}return d};CycleLayout.prototype._InitializeCellLayouts=function(){this.Layouts=new Object();this.Layouts["6A"]=new SpiderCellLocation("6A",1,0,0);this.Layouts["6B"]=new SpiderCellLocation("6B",2,0,0.25);this.Layouts["6C"]=new SpiderCellLocation("6C",2,1,-0.25);this.Layouts["6D"]=new SpiderCellLocation("6D",1,1,0);this.Layouts["6E"]=new SpiderCellLocation("6E",0,1,-0.25);this.Layouts["6F"]=new SpiderCellLocation("6F",0,0,0.25);this.Layouts["8A"]=new SpiderCellLocation("8A",2,0,0);this.Layouts["8B"]=new SpiderCellLocation("8B",3,0,0.25);this.Layouts["8C"]=new SpiderCellLocation("8C",4,0,0.85);this.Layouts["8D"]=new SpiderCellLocation("8D",3,1,-0.25);this.Layouts["8E"]=new SpiderCellLocation("8E",2,1,0);this.Layouts["8F"]=new SpiderCellLocation("8F",1,1,-0.25);this.Layouts["8G"]=new SpiderCellLocation("8G",0,0,0.85);this.Layouts["8H"]=new SpiderCellLocation("8H",1,0,0.25);this.Layouts["10A"]=new SpiderCellLocation("10A",2,0,0);this.Layouts["10B"]=new SpiderCellLocation("10B",3,0,0.15);this.Layouts["10C"]=new SpiderCellLocation("10C",4,0,0.3);this.Layouts["10D"]=new SpiderCellLocation("10D",4,1,-0.3);this.Layouts["10E"]=new SpiderCellLocation("10E",3,1,-0.15);this.Layouts["10F"]=new SpiderCellLocation("10F",2,1,0);this.Layouts["10G"]=new SpiderCellLocation("10G",1,1,-0.15);this.Layouts["10H"]=new SpiderCellLocation("10H",0,1,-0.3);this.Layouts["10I"]=new SpiderCellLocation("10I",0,0,0.3);this.Layouts["10J"]=new SpiderCellLocation("10J",1,0,0.15);this.Layouts[3]=["6A","6C","6E"];this.Layouts[4]=["6F","6B","6C","6E"];this.Layouts[5]=["6A","6B","6C","6E","6F"];this.Layouts[6]=["6A","6B","6C","6D","6E","6F"];this.Layouts[7]=["8A","8B","8C","8D","8F","8G","8H"];this.Layouts[8]=["8A","8B","8C","8D","8E","8F","8G","8H"];this.Layouts[9]=["10A","10B","10C","10D","10E","10G","10H","10I","10J"];this.Layouts[10]=["10A","10B","10C","10D","10E","10F","10G","10H","10I","10J"];this.Layouts[1]=["6A","6C","6E"];this.Layouts[2]=["6A","6C","6E"]};CycleLayout.prototype._VirtualRows=function(a){return 2};CycleLayout.prototype.GetStoryboardContentBounds=function(c,b){c=this._VirtualRows(b);b=this._VirtualCols(b);var a=new BoxPosition();a.X=0;a.Y=0;a.Width=this.Row1PaddingLeft+(b*(this.FullColumnWidth()));a.Height=this.Row1PaddingTop+(c*this.FullRowHeight())-this.BetweenRowPadding;return a};function StoryboardGridLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.StoryboardGrid}inheritPrototype(StoryboardGridLayout,BaseStoryboardLayout);function TChartLayout(b,a,c){BaseStoryboardLayout.call(this,b,a,c,12);this.LayoutType=StoryboardLayoutType.TChart;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2);this._ChartLabelPaddingBottom=(this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this.CellPaddingLeft=(this._Padding*2)+this._ChartGridStrokeWidth;this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+(this._ChartGridStrokeWidth/2);this.Row1PaddingLeft=this.CellPaddingLeft;this.CellPaddingLeft*=c;this.Row1PaddingTop*=c;this.Row1PaddingLeft*=c;this._ChartLabelHeight*=c;this._ChartLabelPaddingTop*=c;this._ChartLabelPaddingBottom*=c}inheritPrototype(TChartLayout,BaseStoryboardLayout);TChartLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};TChartLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};TChartLayout.prototype.GetLayoutLines=function(d,a){var b=SvgCreator.CreateSvgGroup("t-chart");var f=this.Row1PaddingLeft;var h=this.FullColumnWidth()*a;var j=this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom;var k=j;var e="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";b.appendChild(SvgCreator.AddLine(f,j,h,k,e,"t-chart-horizontal"));for(var c=1;c<a;c++){var f=(c*this.FullColumnWidth())+this.Row1PaddingLeft/2;var h=f;var j=this._ChartLabelPaddingTop-(this._ChartTitleStrokeWidth/2);var k=(this.FullRowHeight()*d)+this._ChartLabelPaddingTop+this._ChartLabelHeight+this._ChartLabelPaddingBottom+this._ChartTitleStrokeWidth-this.BetweenRowPadding;b.appendChild(SvgCreator.AddLine(f,j,h,k,e,"t-chart-vertical-"+c))}return b};TChartLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0){return}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=(b*this.FullColumnWidth())+(this.Row1PaddingLeft)+c/2;var g=this._ChartLabelPaddingTop;var a=new BoxPosition(this._ChartLabelHeight,this.CellWidth-c,f,g,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};function TimelineLayout(b,a,d,c){BaseStoryboardLayout.call(this,b,a,d,12);this.LayoutType=StoryboardLayoutType.Timeline;this._ChartTitleStrokeWidth=6;this._ChartGridStrokeWidth=9;this._ChartOuterBoxWidth=3;this._ChartLabelHeight=55;this._ChartLabelPaddingTop=(2*this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2);this._ChartLabelPaddingBottom=(2*this._Padding-(this._CellStroke/2))+(this._ChartTitleStrokeWidth/2)+(this._ChartGridStrokeWidth/2);this.CellPaddingLeft=0;this.Row1PaddingTop=this._ChartLabelPaddingTop+this._ChartLabelPaddingBottom+this._ChartLabelHeight;this.Row1PaddingLeft=this._Padding-this._ChartOuterBoxWidth/2;this._LegendPaddingTop=30;this._LegendBoxHeight=110;this.WatermarkPaddingTop=30+this._LegendBoxHeight+this._LegendPaddingTop;this._TimeLinePaddingMultiple=16;this.BetweenRowPadding=this._Padding;this.BetweenRowPadding*=d;this.CellPaddingLeft*=d;this.Row1PaddingTop*=d;this.Row1PaddingLeft*=d;this._ChartLabelHeight*=d;this._ChartLabelPaddingTop*=d;this._ChartLabelPaddingBottom*=d;this.TimelineDates=c.TimelineDates;this._TimeUnit=this._CalculateTimeUnit()}inheritPrototype(TimelineLayout,BaseStoryboardLayout);TimelineLayout.prototype._EnableTitleLayoutSpecific;this.BetweenRowPadding=this._Padding;TimelineLayout.prototype._EnableDescriptionLayoutSpecific;this.BetweenRowPadding=this._Padding;TimelineLayout.prototype._ExtraFullColumnWidth=function(){return(this._Padding*1)};TimelineLayout.prototype._ExtraFullRowHeight=function(){return(this._Padding*1)};TimelineLayout.prototype._ExpandCellsLayoutSpecific=function(a){this._ChartLabelHeight*=a;this._ChartLabelPaddingTop*=a;this._ChartLabelPaddingBottom*=a};TimelineLayout.prototype.GetStoryboardAreaTitleLayout=function(b,a){return new TChartTitle("24")};TimelineLayout.prototype._AreaTitlePosition=function(d,b){if(d!=0||b!=0){return null}var e=this.GetStoryboardAreaTitleLayout(d,b);var c=e.StrokeWidth-3;var f=this.CellWidth*1.5;var g=this.Row1PaddingLeft+this.FullColumnWidth()+this._TimeLinePaddingMultiple*this._Padding-f/2;var h=this._ChartLabelPaddingTop;var a=new BoxPosition(this._ChartLabelHeight,f,g,h,d,b,StoryboardPartTypeEnum.StoryboardAreaTitle);return a};TimelineLayout.prototype._GetCellX=function(a){if(a%2==0){return this.Row1PaddingLeft+this._Padding+this._ChartOuterBoxWidth}else{return this.Row1PaddingLeft+this.FullColumnWidth()+(2*this._TimeLinePaddingMultiple*this._Padding)}};TimelineLayout.prototype._CellPosition=function(c,b){var d=this._GetCellX(b);var e=this.Row1PaddingTop+this.BeforeCellHeight()+this._GetGap(b,this._TimeUnit);var a=new BoxPosition(this.CellHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCell);return a};TimelineLayout.prototype._CellTitlePosition=function(c,b){var d=this._GetCellX(b);var e=this.Row1PaddingTop+this.TitlePaddingTop+this._GetGap(b,this._TimeUnit);var a=new BoxPosition(this.TitleHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellTitle);return a};TimelineLayout.prototype._CellDescriptionPosition=function(c,b){var d=this._GetCellX(b);var e=this.Row1PaddingTop+this.BeforeDescriptionHeight()+this._GetGap(b,this._TimeUnit);var a=new BoxPosition(this.DescriptionHeight,this.CellWidth,d,e,c,b,StoryboardPartTypeEnum.StoryboardCellDescription);return a};TimelineLayout.prototype._GetStoryboardSizePreAttribution=function(c,b){var a=this.GetStoryboardContentBounds(c,b);a.Height+=this.WatermarkPaddingTop;return a};TimelineLayout.prototype.GetStoryboardContentBounds=function(c,b){var a=new BoxPosition();a.X=0;a.Y=0;a.Height=this.Row1PaddingTop+this._GetGap(b-1,this._TimeUnit)+this.FullRowHeight();a.Width=2*this.FullColumnWidth()+2*this.Row1PaddingLeft+(2*this._Padding*this._TimeLinePaddingMultiple);return a};TimelineLayout.prototype.GetWatermarkTop=function(b){var a=this.GetStoryboardContentBounds(StoryboardContainer.Rows,StoryboardContainer.Cols);var c=a.Height+this.WatermarkPaddingTop;return c};TimelineLayout.prototype._CalculateTimeUnit=function(){var f=this.TimelineDates[2]-this.TimelineDates[0];var b=10;for(var d=2;d<this.TimelineDates.length;d++){var e=this.TimelineDates[d]-this.TimelineDates[d-2];var c=0;for(var a=1;a<this.TimelineDates.length;a++){if(this._TimeJump(a,e)){c++}}if(c==b){if(this._GetGap(this.TimelineDates.length-1,e)<this._GetGap(this.TimelineDates.length-1,f)){f=e}}else{if(c<b){b=c;f=e}}}if(f<=0){return 1}return f};TimelineLayout.prototype._TimeJump=function(a,d){var c=3;if(a==0){return false}var b=(this.TimelineDates[a]-this.TimelineDates[a-1])/d;if(a==1){return(b>c)}b=(this.TimelineDates[a]-this.TimelineDates[a-2])/d;if(b>c||b<1){return true}return false};TimelineLayout.prototype._GetGap=function(a,c){if(a==0){return 0}var b=(this.TimelineDates[a]-this.TimelineDates[a-1])/c;if(this._TimeJump(a,c)){b=1.5}return b*this.FullRowHeight()+this._GetGap(a-1,c)};TimelineLayout.prototype.GetLayoutLines=function(k,d){var e="font-size:16pt;font-family:'Francois One';fill:#000000; text-anchor:end;";var f="font-size:16pt;font-family:'Francois One';fill:#000000; text-anchor:start;";var h=SvgCreator.CreateSvgGroup("timeline-grids");var q=this.Row1PaddingLeft+this.FullColumnWidth()+this._TimeLinePaddingMultiple*this._Padding;var r=this.Row1PaddingTop+2.5;var s=this._GetGap(d-1,this._TimeUnit)+this.FullRowHeight()+r-this.BetweenRowPadding-3.5;var l="stroke:black; stroke-width:"+this._ChartGridStrokeWidth+"px; ";h.appendChild(SvgCreator.AddLine(q,r,q,s,l,"timeline-big-line"));h.appendChild(SvgCreator.AddLine(q-2*this._Padding,r,q+2*this._Padding,r,l,"timeline-big-line-top-cap"));h.appendChild(SvgCreator.AddLine(q-2*this._Padding,s,q+2*this._Padding,s,l,"timeline-big-line-bottom-cap"));for(var c=0;c<d;c++){var b=this.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellTitle,0,c);if(this.HasTitle==false){b=this.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,0,c)}b.X-=this._Padding;b.Width+=2*this._Padding;b.Y-=this._Padding;b.Height=this.FullRowHeight()-this.BetweenRowPadding;var a=this.GetAnchorPoints(b);var j=SvgCreator.AddRect(b.X,b.Y,b.Width,b.Height,"black","none",null,null,"outerbox_"+c);j.setAttributeNS(null,"stroke-width",+this._ChartOuterBoxWidth+"px");h.appendChild(j);if(c%2==0){var i=a.Right+((this._TimeLinePaddingMultiple-1)*this._Padding);h.appendChild(SvgCreator.AddLine(a.Right,a.MiddleY,i,a.MiddleY,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","timeline-connector-"+c));h.appendChild(SvgCreator.AddText(i-this._Padding,a.MiddleY-5,this._FormatDate(this.TimelineDates[c]),e,"date-text-"+c));h.appendChild(SvgCreator.AddText(i-this._Padding,a.MiddleY+22,this._FormatTime(this.TimelineDates[c]),e,"date-text-"+c))}else{var i=a.Left-((this._TimeLinePaddingMultiple-1)*this._Padding);h.appendChild(SvgCreator.AddLine(a.Left,a.MiddleY,i,a.MiddleY,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","timeline-connector-"+c));h.appendChild(SvgCreator.AddText(i+this._Padding,a.MiddleY-5,this._FormatDate(this.TimelineDates[c]),f,"date-text-"+c));h.appendChild(SvgCreator.AddText(i+this._Padding,a.MiddleY+22,this._FormatTime(this.TimelineDates[c]),f,"date-text-"+c))}if(this._TimeJump(c,this._TimeUnit)){var m=q-15;var n=q+15;var o=a.Top-0.25*this.FullRowHeight()+15;var p=a.Top-0.25*this.FullRowHeight()-15;h.appendChild(SvgCreator.AddLine(m,o,n,p,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-a"+c));h.appendChild(SvgCreator.AddLine(m,o+10,n,p+10,"stroke:black; stroke-width:"+this._ChartOuterBoxWidth+"px","time-jump-b"+c))}}h.appendChild(this._DrawLegend());return h};TimelineLayout.prototype._DrawLegend=function(){var i=SvgCreator.CreateSvgGroup("timeline-legend");var v=this.GetStoryboardContentBounds(StoryboardContainer.Rows,StoryboardContainer.Cols);var w="stroke:black; stroke-width:1px; ";var h="font-size:10pt;font-family:'roboto';fill:#000000; text-anchor:middle;";var b=v.Y+v.Height+this._LegendPaddingTop;var a=this.Row1PaddingLeft;var c=this.FullRowHeight()+2*this._Padding;var o=b+1.5*this._Padding+25;var l=a+this._Padding;var m=this.FullRowHeight()+l;var r=SvgCreator.AddRect(a,b,c,this._LegendBoxHeight,"black","white",null,null,"legend-box");r.setAttributeNS(null,"stroke-width","2px");i.appendChild(r);i.appendChild(SvgCreator.AddText((a+c)/2,b+20,MyLangMap.GetText("text-timeline-legend-Legend"),h.replace("10pt","14pt"),"legend-text-legend"));i.appendChild(SvgCreator.AddLine(l,o,m,o,w,"timeline-legend-width"));i.appendChild(SvgCreator.AddLine(l,o-this._Padding/2,l,o+this._Padding/2,w,"timeline-legend-left"));i.appendChild(SvgCreator.AddLine(m,o-this._Padding/2,m,o+this._Padding/2,w,"timeline-legend-right"));var d=o+50;var u=6;i.appendChild(SvgCreator.AddLine(l,d+u,l+u,d-u,w,"timeline-legend-slash1"));i.appendChild(SvgCreator.AddLine(l+u,d+u,l+2*u,d-u,w,"timeline-legend-slash2"));i.appendChild(SvgCreator.AddLine(l,d,l+2*u,d,w,"timeline-legend-slash3"));i.appendChild(SvgCreator.AddText(l+3*u,d+u,MyLangMap.GetText("text-timeline-legend-Time-Break"),h.replace("middle","start"),"legend-text"));var t=1000;var q=60*t;var k=60*q;var f=24*k;var z=365.25*f;var x=this._TimeUnit;var n="";var y=Math.floor(x/z);x-=y*z;var e=Math.floor(x/f);x-=e*f;var j=Math.floor(x/k);x-=j*k;var p=Math.floor(x/q);x-=p*q;var s=Math.floor(x/t);x-=s*t;if(y>0){n=MyLangMap.GetText("text-timeline-legend-years-and-days").replace("{years}",y).replace("{days}",e)}else{if(e>0){n=MyLangMap.GetText("text-timeline-legend-days-and-hours").replace("{hours}",j).replace("{days}",e)}else{n=MyLangMap.GetText("text-timeline-legend-hours-minutes").replace("{hours}",j).replace("{minutes}",p)}}i.appendChild(SvgCreator.AddText((l+m)/2,o+20,n,h+" font-style:italic","legend-text"));return i};TimelineLayout.prototype._FormatTime=function(a){var d=a.getHours();var e=a.getMinutes();var f=a.getSeconds();var b=d<=12?d:d%12;if(d==0&&e==0&&f==0){return""}var c="";c+=b+":";if(e<10){c+="0"}c+=e;if(f>0){c+=":";if(f<10){c+="0"}c+=f}if(d>=12){c+=" "+MyLangMap.GetText("text-timeline-legend-PM")}else{c+=" "+MyLangMap.GetText("text-timeline-legend-AM")}return c};TimelineLayout.prototype._FormatDate=function(a){var e=Math.abs(a.getFullYear());var c=" ";if(a.getFullYear()<0){c=" "+MyLangMap.GetText("text-timeline-legend-BCE")}if(a.getFullYear()<-1000&&(a.getMonth()==0&&a.getDate()==1)){return e.toLocaleString()+" "+MyLangMap.GetText("text-timeline-legend-BCE")}if($("#timeline-use-day").is(":checked")){return a.toDateString()+c}if($("#timeline-use-month").is(":checked")){try{var d=new Date(a.getTime());d.setDate(2);return d.toLocaleDateString(window.navigator.language,{month:"long"})+" "+e+c}catch(b){}}if(c==" "){c=" "+MyLangMap.GetText("text-timeline-legend-CE")}return e+c};BaseStoryboardLayout.prototype.GetLayoutConfig=function(){var a=new Object();a.TimelineDates=this.TimelineDates;return a};function AttributionArea(a){this.DefaultText="";this.DefaultFontSize=a;this.DefaultFontColor="#000000";this.DefaultFont="Roboto";this.FillColor=new ColorableBox("none","Textables","Fill");this.Stroke="none";this.StrokeWidth=0;this.RoundedCornerRadius=0;this.TextPadding=0;this.TextAlignment="start";this.AllowEditting=false;this.ForceTextOverride=true;this.Rotation=0;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardAttributionArea};function BasicTextLayoutDescription(){this.DefaultText=MyLangMap.GetText("text-click-to-edit-description");this.DefaultFontSize="12";this.DefaultFontColor="#000000";this.DefaultFont=MyBrowserProperties.Public_GetDefaultFont();this.FillColor=new ColorableBox("rgb(255, 255, 255)","Textables","Fill");this.Stroke="black";this.StrokeWidth=3;this.RoundedCornerRadius=2;this.TextPadding=5;this.TextAlignment="middle";this.AllowEditting=true;this.ForceTextOverride=false;this.Rotation=0;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellDescription};function BasicTextLayoutTitle(a){this.DefaultText=MyLangMap.GetText("text-click-to-edit-title");this.DefaultFontSize="18";this.DefaultFontColor="#000000";this.DefaultFont=MyBrowserProperties.Public_GetDefaultFont();this.FillColor=new ColorableBox("rgb(255, 255, 255)","Textables","Fill");this.Stroke="black";this.StrokeWidth=3;this.RoundedCornerRadius=2;this.TextPadding=5;this.TextAlignment="middle";this.Rotation=0;this.AllowEditting=true;this.ForceTextOverride=false;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellTitle;if(a!=null){this.DefaultText=a}};function ColorableBox(a,b,c){this.Color=a;this.ColorScheme=b;this.ColorTitle=c};function TChartTitle(a){this.DefaultText=MyLangMap.GetText("text-click-to-edit-title");this.DefaultFontSize=a;this.DefaultFontColor="#FFFFFF";this.DefaultFont=MyBrowserProperties.Public_GetDefaultFont();this.FillColor=new ColorableBox("rgb(0, 0, 0)","Textables","Fill");this.Stroke="black";this.StrokeWidth=6;this.RoundedCornerRadius=2;this.TextPadding=5;this.TextAlignment="middle";this.AllowEditting=true;this.ForceTextOverride=false;this.Rotation=0;this.StoryboardPartType=StoryboardPartTypeEnum.StoryboardAreaTitle};function Pointers(){this.CellContainer;this.CoreSvg;this.Watermark;this.SvgContainer;this.Tabs;this.BottomControls;this.HelpTopicArea;this.CoreSVG_SvgTop;this.Dialog_ChangeLayout;this.Dialog_SpiderCellCount;this.Dialog_CycleCellCount;this.Dialog_TimelineCellCount;this.Dialog_StoryboardType;this.Dialog_PurchasePopForMoreLayouts;this.Dialog_PurchasePopForMoreLayoutsOnCopy;this.Dialog_PurchasePopForMoreStoryboardLayouts;this.Dialog_PurchaseForUploads;this.Dialog_CropImage;this.Dialog_ZoomCropImage;this.Dialog_PoseImage;this.Dialog_SmartScene;this.Dialog_UploadImage;this.Dialog_Help;this.Dialog_Policies;this.Dialog_AdvancedButtons;this.Controls_UpdateColor;this.Controls_TextableControls;this.Controls_TextableControls_TextArea;this.Controls_TextableControls_ColorSelector;this.Controls_TextableControls_FontSelector;this.Controls_ShapeControls;this.Controls_MultiShapeControls;this.StagingGround;this.ResetAllPointers=function(){this.CellContainer=$("#CellDefinition");this.CoreSvg=$("#CoreSvg");this.SvgContainer=$("#svgContainer");this.BottomControls=$("#bottom-toolbar");this.Tabs=$("#WorkingArea div.clipart-library-tabs");this.Watermark=$("#watermark");this.HelpTopicArea=$("#HelpTopicArea");this.Dialog_ChangeLayout=$("#ChangeLayoutDialog");this.Dialog_SpiderCellCount=$("#ChangeCellCountSpider");this.Dialog_CycleCellCount=$("#ChangeCellCountCycle");this.Dialog_TimelineCellCount=$("#ChangeCellCountTimeline");this.Dialog_StoryboardType=$("#StoryboardTypeDialog");this.Dialog_PurchasePopForMoreLayouts=$("#PurchasePopForLayoutOptions");this.Dialog_PurchasePopForMoreLayoutsOnCopy=$("#PurchasePopForLayoutOptionsOnCopy");this.Dialog_PurchasePopForMoreStoryboardLayouts=$("#PurchasePopForStoryboardLayoutOptions");this.Dialog_CropImage=$("#CropArea");this.Dialog_ZoomCropImage=$("#ZoomCropArea");this.Dialog_MultiTextable=$("#MultiTextableModal");this.Dialog_PoseImage=$("#PoseArea");this.Dialog_SmartScene=$("#Smart-Scene-Modal");this.Dialog_UploadImage=$("#UploadArea");this.Dialog_PurchaseForUploads=$("#PurchaseForUploads");this.Dialog_Help=$("#HelpArea");this.Dialog_CellSize=$("#StoryboardCellSizeDialog");this.Dialog_Policies=$("#PoliciesDialog");this.Dialog_AdvancedButtons=$("#AdvancedButtonsDialog");this.CoreSVG_SvgTop=$("#SvgTop");this.Controls_UpdateColor=$("#ColorUpdaterBox");this.Controls_TextableControls=$("#textableControls");this.Controls_TextableControls_TextArea=$("#textableText");this.Controls_TextableControls_ColorSelector=$("#FontColorSelector");this.Controls_TextableControls_FontSelector=$("#FontSelector");this.Controls_TextableControls_TextAlignmentSelectors=$("#textableControls .MenuAlignText");this.Controls_ShapeControls=$("#controlsBox");this.Controls_MultiShapeControls=$("#MultiSelectControlsBox");this.StagingGround=$("#StagingGround")};this.GetSvgTop=function(){if(this.CoreSVG_SvgTop==null||this.CoreSVG_SvgTop.length==0){this.CoreSVG_SvgTop=$("#SvgTop");if(this.CoreSVG_SvgTop==null||this.CoreSVG_SvgTop.length==0){var a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("id","SvgTop");this.CoreSvg.append(a);this.CoreSVG_SvgTop=$("#SvgTop")}}return this.CoreSVG_SvgTop};this.ResetAllPointers()};function SbtMathLibrary(){this.DegreesFromRadians=function(a){return a*(180/Math.PI)};this.ProjectAtoB=function(c,e){var f=e.x*e.x+e.y*e.y;var d=(c.x*e.x+c.y*e.y)/f;return{x:d*e.x,y:d*e.y}};this.ProjectAtoBScale=function(c,e){var f=e.x*e.x+e.y*e.y;var d=(c.x*e.x+c.y*e.y)/f;return d};this.CosAngleBetweenVector=function(a,c){var b=Math.sqrt(a.x*a.x+a.y*a.y);var d=Math.sqrt(c.x*c.x+c.y*c.y);return(a.x*c.x+a.y*c.y)/(a.norm*c.norm)};this.CalculateAngle=function(d,e,l,m,n,o){var a=2;var j=d-n;var f=e-o;var h=Math.sqrt((j*j)+(f*f));var p=Math.asin(f/h);var b=this.DegreesFromRadians(p);var k=d-l;var g=e-m;var i=Math.sqrt((k*k)+(g*g));var q=Math.asin(g/i);var c=this.DegreesFromRadians(q);a=b-c;if(l<d){a=a*-1}return a};this.ScaleAndCenter=function(d,f,e,i,k){var a=GetGlobalById(d).getBBox();var j=(f-i)/a.width;var l=(e-k)/a.height;var h=Math.min(j,l);var b=(f-((a.width)*h))/2;b-=(a.x*h);var c=(e-((a.height)*h))/2;c-=(a.y*h);var g=new Object();g.CenterX=b;g.CenterY=c;g.Scale=h;return g};this.RotatePoint=function(d,a,e){var h=Math.sin(a);var b=Math.cos(a);var f={x:e.x-d.x,y:e.y-d.y};var g={x:f.x*b-f.y*h+d.x,y:f.x*h+f.y*b+d.y};return g}};function StoryboardContainerLibrary(){this.Private_TitleGroup="TitleGroup";this.Private_DescriptionGroup="DescriptionGroup";this.Private_AttributionGroup="ImageAttributionGroup";this.Private_StoryboardTitlesGroup="StoryboardTitlesGroup";this.Private_StoryboardLayoutLinesGroup="StoryboardLayoutLinesGroup";this.Private_LayoutType="Sbt-Layout-Type";this.Rows=1;this.Cols=3;this.MaxCols=6;this.MaxRows=4;this.CoreSvgLeft;this.CoreSvgTop;this.CoreSvgRight;this.CoreSvgBottom;this.SvgContainerPositionTop;this.SvgContainerPositionLeft;this.SvgContainerOffsetTop;this.SvgContainerOffsetLeft;this.GlobalCellCropRatio={};this.IsFreeLayoutConfiguration=function(c,a){try{if(a!=3){return false}if(c>2){return false}if(StoryboardContainer.GetLayoutType()!=StoryboardLayoutType.StoryboardGrid){return false}return true}catch(b){LogErrorMessage("SvgManip.IsFreeLayoutConfiguration",b)}};this.GetLayoutType=function(){var a=MyPointers.CoreSvg.attr(this.Private_LayoutType);if(a==null){return StoryboardLayoutType.StoryboardGrid}return a};this.SetLayoutType=function(){MyPointers.CoreSvg.attr(this.Private_LayoutType,CellConfiguration.LayoutType)};this.Initialize=function(){this.JiggleSvgSize();this.SetCoreSvgDimensions()};this.JiggleSvgSize=function(){var d=5;var h=MyPointers.Tabs.width();var b=$(window);var g=b.height()-(MyPointers.Tabs.outerHeight()+MyPointers.BottomControls.outerHeight());var a=GetGlobalById("CoreSvg").getBoundingClientRect();var f=(a.width-2)+(2*d);var e=(a.height-2)+(2*d);if(f<h&&e<g){MyPointers.SvgContainer.css("overflow","")}else{MyPointers.SvgContainer.css("overflow","auto")}var c=MyPointers.Tabs.height();MyPointers.SvgContainer.css("width",h+"px");MyPointers.SvgContainer.css("width","100%");MyPointers.SvgContainer.css("height",g+"px");MyPointers.SvgContainer.css("margin-top",c+"px");MyPointers.CoreSvg.css("margin","5px");if(e<g){MyPointers.CoreSvg.css("margin",((g-StoryboardContainer.Private_GetScrollBarWidth()-e)/2)+"px 5px")}};this.UpdateBackgroundColors=function(){MyPointers.CoreSvg.css("border","1px solid #808080;");MyPointers.CoreSvg.css("background-color","#ffffff;");MyPointers.CoreSvg.css("margin","5px")};this.RemoveFilters=function(){if(MyBrowserProperties.IsSafari5){$("filter").remove()}$("inkscape\\:perspective").remove();$("inkscape\\:path-effect").remove();$("rdf\\:rdf").remove();$("metadata").remove();var a=$("[inkscape\\:xlink\\:href]");a.removeAttr("inkscape:xlink:href")};this.UpdateGradientIds=function(d){var a=new Array();RecursivelyFindGradientChildrenIds(d,a);for(var b=0;b<a.length;b++){var e=a[b];var c=e;if(c.indexOf("_ix_")>0){c=c.substring(0,c.indexOf("_ix_"))}c=c+"_ix_"+new Date().getTime()+"_"+b;RecursivelyUpdateChildrenIds(d,e,c)}};this.GetShapeStatesForCell=function(d,a){var h=new Object();h[StoryboardPartTypeEnum.StoryboardCell]=new Array();h[StoryboardPartTypeEnum.StoryboardCellTitle]=new Array();h[StoryboardPartTypeEnum.StoryboardCellDescription]=new Array();var c=this.GetAllLayoutParts(CellConfiguration);var g=MyShapesState.Public_GetAllMovableShapeStates(false);ShapesState.Public_ZSortShapeStates(g);for(var b=0;b<g.length;b++){var f=g[b];var e=this._GetLayoutPartForShape(c,f);if(e!=null){if(e.StoryboardPartType==StoryboardPartTypeEnum.StoryboardAreaTitle){continue}if(e.StoryboardPartType==StoryboardPartTypeEnum.StoryboardAttributionArea){continue}if(e.Col==a&&e.Row==d){h[e.StoryboardPartType].push(f)}}}return h};this.Public_ChangeCellOrder=function(f){var d=this.GetAllLayoutParts(CellConfiguration);var k=MyShapesState.Public_GetAllMovableShapeStates(false);for(var b=0;b<k.length;b++){var h=k[b];var g=this._GetLayoutPartForShape(d,h);if(g!=null){if(g.StoryboardPartType==StoryboardPartTypeEnum.StoryboardAreaTitle){continue}for(var c=0;c<f.length;c++){var a=f[c];if(a.oldCol==g.Col&&a.oldRow==g.Row){var e=CellConfiguration.GetCellPartPosition(g.StoryboardPartType,a.newRow,a.newCol);h.Public_ChangeShapeLocation(g,e);break}}}}};this.ChangeCellConfiguration_MoveShapes=function(e,c){var b=this.GetAllLayoutParts(e);var h=MyShapesState.Public_GetAllMovableShapeStates(false);for(var a=0;a<h.length;a++){var g=h[a];var f=this._GetLayoutPartForShape(b,g);if(f!=null){var d=c.GetCellPartPosition(f.StoryboardPartType,f.Row,f.Col);g.Public_ChangeShapeLocation(f,d)}}};this.ChangeCellConfiguration_ScaleShapes=function(e,c,f){var b=this.GetAllLayoutParts(e);var j=MyShapesState.Public_GetAllMovableShapeStates(false);for(var a=0;a<j.length;a++){var h=j[a];var g=this._GetLayoutPartForShape(b,h);if(g!=null){var d=c.GetCellPartPosition(g.StoryboardPartType,g.Row,g.Col);h.Public_HandleCellExpansion(f,g,d)}else{h.Public_HandleCellExpansion(f,null,null)}}};this._GetLayoutPartForShape=function(f,h){try{var a=h.Public_GetImaginaryOuterBox();var g={x:(a.Left+a.Right)/2,y:(a.Top+a.Bottom)/2};for(var d=0;d<f.length;d++){var b=f[d];if(g.x>=b.X&&g.x<(b.X+b.Width)){if(g.y>=b.Y&&g.y<(b.Y+b.Height)){return b}}}}catch(c){LogErrorMessage("StoryboardContainerLibrary._GetLayoutPartForShape",c)}return null};this.CleanupAndVerifyLoadedSvg=function(){var a=$("#"+MyIdGenerator.GenerateCellId(0,0));if(a.length==0){this.Private_UpdateOldCellIds();this.Private_MoveAllArtUp()}};this.CalculateRowsAndCols=function(){this.Rows=1;this.Cols=1;for(var b=1;b<100;b++){var a=$("#"+MyIdGenerator.GenerateCellId(0,b));if(a.length>0){this.Cols=b+1}else{break}}for(var c=1;c<100;c++){var a=$("#"+MyIdGenerator.GenerateCellId(c,0));if(a.length>0){this.Rows=c+1}else{break}}while(this.Rows>StoryboardContainer.MaxRows){AddExtraLayoutCells(true,false)}while(this.Cols>StoryboardContainer.MaxCols){AddExtraLayoutCells(false,true)}};this.SetCoreSvgDimensions=function(){var a=GetGlobalById("CoreSvg").getBoundingClientRect();var e=(a.width-2);var d=(a.height-2);this.CoreSvgLeft=a.left;this.CoreSvgTop=a.top;if(this.CoreSvgLeft<0||e>MyPointers.SvgContainer.width()){this.CoreSvgLeft=5}if(this.CoreSvgTop<0||d>MyPointers.SvgContainer.height()){this.CoreSvgTop=MyPointers.Tabs.height()+5}this.CoreSvgRight=e+this.CoreSvgLeft;this.CoreSvgBottom=d+this.CoreSvgTop;var c=MyPointers.SvgContainer.position();this.SvgContainerPositionTop=c.top;this.SvgContainerPositionLeft=c.left;var b=MyPointers.SvgContainer.offset();this.SvgContainerOffsetTop=b.top;this.SvgContainerOffsetLeft=b.left};this.getCellInformation=function(h,j){h=((h>0)?h:0);j=((j>0)?j:0);var d=CellConfiguration.CellWidth-(CellConfiguration.BackGroundOffsetX*2);var c=CellConfiguration.CellHeight-(CellConfiguration.BackGroundOffsetY*2);var b=$("[id^=cell_]");var f,g;for(var e=0;e<b.length;e++){var a=$(b[e]);cellX=parseFloat(a.attr("x"));cellY=parseFloat(a.attr("y"));cellWidth=parseFloat(a.attr("width"));cellHeight=parseFloat(a.attr("height"));if(h>=cellX&&h<=(cellWidth+cellX)){if(j>=cellY&&j<=(cellHeight+cellY)){f=cellX;g=cellY}}}if(f==null){return null}return{cellX:f,cellY:g,cellWidth:cellWidth,cellHeight:cellHeight,desiredWidth:d,desiredHeight:c}};this.DetermineBackDropCords=function(k,l,n,a,f){if(a==null){return null}var h=k.Public_GetImaginaryOuterBox();var b=h.Bottom-h.Top;var c=h.Right-h.Left;var j;var m;var o;if(k.Angle!=0||f){j=Math.min(a.desiredWidth/c,a.desiredHeight/b);m=j*k.ScaleX;o=j*k.ScaleY}else{m=a.desiredWidth/c*k.ScaleX;o=a.desiredHeight/b*k.ScaleY}var g=k.IsSpringable()&&k.SpringableState.CanResizeVertical()&&k.SpringableState.CanResizeHorizontal();if(!g){k.SetScale(m,o);h=k.Public_GetImaginaryOuterBox()}var d,e;if(f){d=a.cellX+a.cellWidth/2-(h.Left+h.Right)/2;e=a.cellY+a.cellHeight/2-(h.Top+h.Bottom)/2}else{d=a.cellX-h.Left;e=a.cellY-h.Top}moveAndScale=new MoveAndScale();moveAndScale.MoveToX=k.X+d;moveAndScale.MoveToY=k.Y+e;if(!g){k.MoveTo(moveAndScale.MoveToX,moveAndScale.MoveToY)}moveAndScale.ScaleX=m;moveAndScale.ScaleY=o;return moveAndScale};this.DetermineBackDropCordsForSpringObject=function(f,a,d){if(a==null){return null}var e=f.Public_GetImaginaryOuterBox();var b,c;if(d){b=a.cellX+a.cellWidth/2-(e.Left+e.Right)/2;c=a.cellY+a.cellHeight/2-(e.Top+e.Bottom)/2}else{b=a.cellX-e.Left;c=a.cellY-e.Top}f.X+=b;f.Y+=c};this.CreateRowsAndCells=function(b,a){this.Private_RemoveOutOfBoundsContent(b,a);this.Private_RemoveOldCellsAndRows(b,a);this.Private_AddRowsAndCells(b,a);this.Rows=b;this.Cols=a;this.Private_RefreshStoryboardContainer();UndoManager.clear()};this.Private_ClearCells=function(){MyPointers.CellContainer.children("rect").remove();$("#"+this.Private_TitleGroup).remove();$("#"+this.Private_DescriptionGroup).remove();this.ClearStoryboardTitlesAndLines()};this.Public_ResetLayout=function(){this.Private_ClearCells();this.Private_AddRowsAndCells(this.Rows,this.Cols);this.Private_RefreshStoryboardContainer()};this.ChangeCellCellLayout=function(){this.Public_ResetLayout();this.Private_RemoveOutOfBoundsContent(this.Rows,this.Cols)};this.ExpandCells=function(a,b){this.Private_ClearCells();this.Private_AddRowsAndCells(this.Rows,this.Cols);if(b!==false){this.Private_RefreshStoryboardContainer()}};this.Private_RefreshStoryboardContainer=function(a){if(CellPickerHelper.Props!=void 0&&CellPickerHelper.Props.CoreSVGRegion.state){return}this.Private_MoveWatermarkText(this.Rows,this.Cols);this.Private_UpdateStoryboardFrame();if(a!==false){this.Private_DrawLayoutLines(this.Rows,this.Cols)}this.JiggleSvgSize();this.SetCoreSvgDimensions()};this.Private_DrawLayoutLines=function(c,b){var a=this.Private_GetAreaGroup(this.Private_StoryboardLayoutLinesGroup);a.append(CellConfiguration.GetLayoutLines(c,b))};this.Private_MoveWatermarkText=function(){var a=CellConfiguration.GetWatermarkTop(this.Rows);MyPointers.Watermark.attr("y",a)};this.Private_UpdateStoryboardFrame=function(){var a=CellConfiguration.GetStoryboardSize(this.Rows,this.Cols);MyPointers.CoreSvg.attr("height",a.Height);MyPointers.CoreSvg.attr("width",a.Width)};this.UpdateImageAttributions=function(){var c="";var d=MyShapesState.Public_GetImageAttributions();for(var e in d){if(d.hasOwnProperty(e)){c+=d[e].Title+" ("+d[e].ImageUrl+") - "+d[e].Author+" - "+MyLangMap.GetText("Text-Image-Attributions-License")+" "+d[e].License+"\r\n"}}var a=this.Private_GetAreaGroup(this.Private_AttributionGroup);a.children().remove();if(c.length>0){SbtSummerNoteHelper.ResetToDefaults();c=MyLangMap.GetText("Text-Image-Attributions-Section")+"\r\n"+c;var b=new AttributionArea(8);this.Private_AddTextable(MyIdGenerator.GenerateAttibutionAreaId(),this.Rows,this.Cols,b,a,c);if(UseSummerNote){SbtSummerNoteHelper.ResetToDefaults()}}this.Private_RefreshStoryboardContainer(false)};this.GetAllLayoutParts=function(e){var b=[];for(var d=0;d<this.Rows;d++){for(var a=0;a<this.Cols;a++){var c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,d,a);c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCell;c.Row=d;c.Col=a;b.push(c);if(e.HasTitle){c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellTitle,d,a);c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellTitle;c.Row=d;c.Col=a;b.push(c)}if(e.HasDescription){c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCellDescription,d,a);c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardCellDescription;c.Row=d;c.Col=a;b.push(c)}c=e.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardAreaTitle,d,a);if(c==null){continue}c.StoryboardPartType=StoryboardPartTypeEnum.StoryboardAreaTitle;c.Row=d;c.Col=a;b.push(c)}}return b};this.Private_AddRowsAndCells=function(f,d){SbtSummerNoteHelper.ResetToDefaults();GlobalCellCropRatio={};for(var e=0;e<f;e++){for(var a=0;a<d;a++){var b=$("#"+MyIdGenerator.GenerateCellId(e,a));GlobalCellCropRatio[MyIdGenerator.GenerateCellId(e,a)]={A1:0,A2:1,A3:0,B1:0,B2:1,B3:0};if(b.length==0){this.Private_CreateCell(e,a)}this.Private_AddTextable(MyIdGenerator.GenerateStoryboardTitleId(e,a),e,a,CellConfiguration.GetStoryboardAreaTitleLayout(e,a),this.Private_GetAreaGroup(this.Private_StoryboardTitlesGroup))}}this.Private_AddTextable(MyIdGenerator.GenerateStoryboardTitleId(-1,-1),-1,-1,CellConfiguration.GetStoryboardAreaTitleLayout(-1,-1),this.Private_GetAreaGroup(this.Private_StoryboardTitlesGroup))};this.Private_RemoveOldCellsAndRows=function(d,b){for(var c=this.Rows-1;c>=d;c--){for(var a=0;a<this.Cols;a++){this.Private_RemoveCellAndTitleBlocks(c,a)}}for(var c=0;c<d;c++){for(var a=this.Cols-1;a>=b;a--){this.Private_RemoveCellAndTitleBlocks(c,a)}}this.ClearStoryboardTitlesAndLines()};this.ClearStoryboardTitlesAndLines=function(){this.Private_GetAreaGroup(this.Private_StoryboardLayoutLinesGroup).remove();this.Private_GetAreaGroup(this.Private_StoryboardTitlesGroup).remove()};this.Private_RemoveCellAndTitleBlocks=function(d,b){var a=$("#"+MyIdGenerator.GenerateCellId(d,b));var e=$("#"+MyIdGenerator.GenerateTitleCellId(d,b));var c=$("#"+MyIdGenerator.GenerateDescriptionCellId(d,b));if(a.length>0){a.remove()}if(e.length>0){e.remove()}if(c.length>0){c.remove()}};this.Public_FindOutOfBoundContent=function(g,b){var f=CellConfiguration.GetStoryboardContentBounds(g,b);var k=[];var j=MyShapesState.Public_GetAllMovableShapeStates(false);for(var d=0;d<j.length;d++){var h=j[d];if(h===null){continue}if(Math.floor(h.Y)>=Math.floor(f.Height)||Math.floor(h.X)>=Math.floor(f.Width)){k.push(h.Id)}if(h.Y<0){try{var a=h.GetBBox();if(h.Y+a.height<0){k.push(h.Id)}}catch(c){LogErrorMessage("StoryboardContainerLibrary.Public_FindOutOfBoundContent.NegativeY",c)}}}return k};this.Private_RemoveOutOfBoundsContent=function(b,a){ClearActiveState();var d=this.Public_FindOutOfBoundContent(b,a);for(i=0;i<d.length;i++){var c=d[i];MyShapesState.Public_RemoveShapeStateById(c);$("#"+c).remove()}};this.Private_CreateCell=function(c,b){var a=CellConfiguration.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,c,b);var d=SvgCreator.AddRect(a.X,a.Y,a.Width,a.Height,CellConfiguration.Stroke,CellConfiguration.Fill,CellConfiguration.StrokeDashArray,CellConfiguration.Opacity);d.setAttributeNS(null,"stroke-width",CellConfiguration.StrokeWidth);d.setAttributeNS(null,"rx",CellConfiguration.Rx);d.setAttributeNS(null,"ry",CellConfiguration.Ry);d.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(c,b));MyPointers.CellContainer.append(d);if(CellConfiguration.HasTitle){this.Private_AddTextable(MyIdGenerator.GenerateTitleCellId(c,b),c,b,CellConfiguration.TitleLayout,this.Private_GetAreaGroup(this.Private_TitleGroup),CellConfiguration.GetCellTitleOverrideText(c,b))}if(CellConfiguration.HasDescription){this.Private_AddTextable(MyIdGenerator.GenerateDescriptionCellId(c,b),c,b,CellConfiguration.DescriptionLayout,this.Private_GetAreaGroup(this.Private_DescriptionGroup))}};this.Private_MoveAllArtUp=function(){var c=MyShapesState.Public_GetAllMovableShapeStates(false);for(var a=0;a<c.length;a++){var b=c[a];if(b===null){continue}b.Y-=10;b.UpdateDrawing()}};this.Private_UpdateOldCellIds=function(){var g=CellConfiguration.Row1PaddingTop+CellConfiguration.CellPaddingTop;var h=CellConfiguration.FullRowHeight()+CellConfiguration.CellPaddingTop;var a=$("#CellDefinition").children()[0];var b=$("#CellDefinition").children()[1];var c=$("#CellDefinition").children()[2];var d=$("#Cell4");var e=$("#Cell5");var f=$("#Cell6");a.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(0,0));b.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(0,1));c.setAttributeNS(null,"id",MyIdGenerator.GenerateCellId(0,2));a.setAttributeNS(null,"y",g);b.setAttributeNS(null,"y",g);c.setAttributeNS(null,"y",g);if(d.length>0){d.attr("id",MyIdGenerator.GenerateCellId(1,0));d.attr("y",h)}if(e.length>0){e.attr("id",MyIdGenerator.GenerateCellId(1,1));e.attr("y",h)}if(f.length>0){f.attr("id",MyIdGenerator.GenerateCellId(1,2));f.attr("y",h)}};this.Private_AddTextable=function(b,j,c,t,a,g){if(t==null){return}var h=CellConfiguration.GetCellPartPosition(t.StoryboardPartType,j,c);if(h==null){return}var m=b;var r=m+SvgPartsEnum.Scale;var o=m+SvgPartsEnum.Natural;var p=t.FillColor.ColorScheme+"_"+m+"_outer";var s=m+"_text";var l=SvgCreator.CreateSvgGroup(m);var q=SvgCreator.CreateSvgGroup(r);var n=SvgCreator.CreateSvgGroup(o);var f=SvgCreator.AddRect(0,0,h.Width,h.Height,t.Stroke,t.FillColor.Color,null,CellConfiguration.Opacity,p);f.setAttributeNS(null,"stroke-width",t.StrokeWidth);f.setAttributeNS(null,"rx",t.RoundedCornerRadius);f.setAttributeNS(null,"ry",t.RoundedCornerRadius);var u=t.TextPadding;var v=SvgCreator.AddRect(u,u,h.Width-(2*u),h.Height-(2*u),null,"none",null,CellConfiguration.Opacity,s);var d=SvgCreator.CreateMetadata();d.appendChild(SvgCreator.CreateTextableMetadata(s));d.appendChild(SvgCreator.CreateColorableMetadata(t.FillColor.Color,t.FillColor.Color,t.FillColor.ColorScheme,t.FillColor.ColorTitle));l.appendChild(d);l.appendChild(q);q.appendChild(n);n.appendChild(f);n.appendChild(v);a.append(l);var e=MyShapesState.Public_GetShapeStateById(m);var k=new SvgState(m);k.TextState.D[0].Text=g||t.DefaultText;k.TextState.D[0].DefaultText=t.DefaultText;k.TextState.D[0].Font=t.DefaultFont;k.TextState.D[0].FontSize=t.DefaultFontSize;k.TextState.D[0].FontColor=t.DefaultFontColor;k.TextState.D[0].TextAlignment=t.TextAlignment||"middle";k.Angle=t.Rotation||0;if(UseQuill||UseSummerNote){if(k.TextState.D[0].Text.indexOf("\n")>=0){k.TextState.Public_ConvertToQuill()}else{k.TextState.Public_GenerateQuillForOneLiner(k.TextState.D[0].Text,k.TextState.D[0].FontSize,k.TextState.D[0].TextAlignment,k.TextState.D[0].Font,k.TextState.D[0].FontColor)}}k.Movable=false;if(e!=null){if(e.TextState.D[0].Text==k.TextState.D[0].DefaultText||t.ForceTextOverride){e.TextState.D[0].Text=k.TextState.D[0].Text}if(b.indexOf("attribution")<=0){k.TextState.CopyFontStyles(e.TextState.D[0]);k.ColorableState.Public_Copy(e.ColorableState)}}MyShapesState.Public_SetShapeState(m,k);k.MoveTo(h.X,h.Y);k.UpdateDrawing();if(t.AllowEditting){$(l).attr("class","activeShape");$(l).off("mousedown").on("mousedown",ShapeSelected);$(l).off("mouseup").on("mouseup",HandleMouseExit)}else{$(l).css("cursor","default")}};this.Private_GetAreaGroup=function(b){var a=$("#"+b);if(a.length==0){a=SvgCreator.CreateSvgGroup(b);MyPointers.CellContainer.append(a);a=$("#"+b)}return a};this.Private_GetScrollBarWidth=function(){var a=$("<div>").css({visibility:"hidden",width:100,overflow:"scroll"}).appendTo("body"),b=$("<div>").css({width:"100%"}).appendTo(a).outerWidth();a.remove();return 100-b}};function SvgCreatorLibrary(a){this.NameSpace_Svg="http://www.w3.org/2000/svg";this.NameSpace_Xlink="http://www.w3.org/1999/xlink";this.AddCircle=function(h,i,e,g,c,d,b){var f=document.createElementNS(this.NameSpace_Svg,"circle");f.setAttributeNS(null,"cx",h);f.setAttributeNS(null,"cy",i);f.setAttributeNS(null,"r",e);f.setAttributeNS(null,"fill",c);f.setAttributeNS(null,"stroke",g);f.setAttribute("id",d);f.setAttribute("class",b);return f};this.UpdateCircle=function(b,c,d){b.attr("cx",c);b.attr("cy",d)};this.UpdateCircleDom=function(b,c,d){b.setAttributeNS(null,"cx",c);b.setAttributeNS(null,"cy",d)};this.AddCircle=function(h,i,e,g,c,d,b){var f=document.createElementNS(this.NameSpace_Svg,"circle");f.setAttributeNS(null,"cx",h);f.setAttributeNS(null,"cy",i);f.setAttributeNS(null,"r",e);f.setAttributeNS(null,"fill",c);f.setAttributeNS(null,"stroke",g);f.setAttribute("id",d);f.setAttribute("class",b);return f};this.UpdateCircle=function(b,c,d){b.attr("cx",c);b.attr("cy",d)};this.AddEllipse=function(k,l,f,g,i,c,j,e,d,b){var h=document.createElementNS(this.NameSpace_Svg,"ellipse");h.setAttributeNS(null,"cx",k);h.setAttributeNS(null,"cy",l);h.setAttributeNS(null,"rx",f);h.setAttributeNS(null,"ry",g);h.setAttributeNS(null,"fill",c);h.setAttributeNS(null,"stroke",i);h.setAttributeNS(null,"stroke-dasharray",j);h.setAttributeNS(null,"opacity",e);h.setAttribute("id",d);h.setAttribute("class",b);return h};this.UpdateEllipse=function(b,e,f,c,d){b.attr("cx",e);b.attr("cy",f);b.attr("rx",c);b.attr("ry",d)};this.AddRect=function(j,k,i,c,g,b,h,e,d){j=isNaN(j)?10:j;k=isNaN(k)?10:k;i=isNaN(i)?20:i;c=isNaN(c)?20:c;var f=document.createElementNS(this.NameSpace_Svg,"rect");f.setAttributeNS(null,"x",j);f.setAttributeNS(null,"y",k);f.setAttributeNS(null,"width",i);f.setAttributeNS(null,"height",c);f.setAttributeNS(null,"fill",b);if(g!=null){f.setAttributeNS(null,"stroke",g)}if(h!=null){f.setAttributeNS(null,"stroke-dasharray",h)}if(e!=null){f.setAttributeNS(null,"opacity",e)}f.setAttributeNS(null,"id",d);return f};this.UpdateRectangle=function(c,e,f,d,b){c.attr("x",e);c.attr("y",f);c.attr("width",d);c.attr("height",b)};this.UpdateRectangleDom=function(c,e,f,d,b){c.setAttributeNS(null,"x",e);c.setAttributeNS(null,"y",f);c.setAttributeNS(null,"width",d);c.setAttributeNS(null,"height",b)};this.AddLine=function(e,g,f,h,d,b){var c=document.createElementNS(this.NameSpace_Svg,"line");c.setAttributeNS(null,"x1",e);c.setAttributeNS(null,"y1",g);c.setAttributeNS(null,"x2",f);c.setAttributeNS(null,"y2",h);c.setAttributeNS(null,"style",d);c.setAttributeNS(null,"id",b);return c};this.UpdateLine=function(b,c,e,d,f){b.attr("x1",c);b.attr("x2",d);b.attr("y1",e);b.attr("y2",f)};this.UpdateLineDom=function(b,c,e,d,f){b.setAttributeNS(null,"x1",c);b.setAttributeNS(null,"x2",d);b.setAttributeNS(null,"y1",e);b.setAttributeNS(null,"y2",f)};this.AddPolygon=function(g,k,c,l,m,f,e,b){var j=document.createElementNS(this.NameSpace_Svg,"polygon");var d;var h="";for(d=0;d<g.length;d++){h=h+" "+g[d].x+","+g[d].y}j.setAttributeNS(null,"points",h);j.setAttributeNS(null,"fill",c);if(k!=null){j.setAttributeNS(null,"stroke",k)}if(l!=null){j.setAttributeNS(null,"stroke-dasharray",l)}if(m!=null){j.setAttributeNS(null,"stroke-width",m)}if(f!=null){j.setAttributeNS(null,"opacity",f)}j.setAttributeNS(null,"id",e);if(b!=null){j.setAttribute("class",b)}return j};this.UpdatePolygon=function(e,c){var b;var d="";for(b=0;b<c.length;b++){d=d+" "+c[b].x+","+c[b].y}e.attr("points",d)};this.AddEllipsisArc=function(i,k,e,b,f,l,g){var h="0";var m="1";var c=["M",k.X,k.Y,"A",i.X,i.Y,0,h,m,e.X,e.Y].join(" ");b=b||"black";f=f||"none";l=l||"3";var j=document.createElementNS(this.NameSpace_Svg,"path");j.setAttributeNS(null,"d",c);j.setAttributeNS(null,"fill",f);j.setAttributeNS(null,"stroke",b);j.setAttributeNS(null,"stroke-width",l);j.setAttributeNS(null,"id",g);return j};this.AddCubicBezier=function(p,n,i,m,b,j,q,k){var l="0";var r="1";var c=p.X+n.X;var f=p.Y+n.Y;var e=i.X+m.X;var g=i.Y+m.Y;var h=["M",p.X,p.Y,"C",c,f,e,g,i.X,i.Y].join(" ");b=b||"black";j=j||"none";q=q||"3";var o=document.createElementNS(this.NameSpace_Svg,"path");o.setAttributeNS(null,"d",h);o.setAttributeNS(null,"fill",j);o.setAttributeNS(null,"stroke",b);o.setAttributeNS(null,"stroke-width",q);o.setAttributeNS(null,"id",k);return o};this.AddTriangle=function(c,g,b){var e=[];c.foreach(function(h){e.Add(h.ToString())});var d=e.join(" ");var f=document.createElementNS(this.NameSpace_Svg,"polygon");f.setAttributeNS(null,"points",d);f.setAttributeNS(null,"style",g);f.setAttributeNS(null,"id",b);return f};this.CreateBlankSvg=function(e,b,c){var d=document.createElementNS(this.NameSpace_Svg,"svg");d.setAttribute("width",e);d.setAttribute("height",b);if(c){d.setAttribute("id",c)}return d};this.CreateSvgGroup=function(c){var b=document.createElementNS(this.NameSpace_Svg,"g");b.setAttributeNS(null,"id",c);return b};this.CreateDefs=function(c){var b=document.createElementNS(this.NameSpace_Svg,"defs");b.setAttributeNS(null,"id",c);return b};this.CreateClipPath=function(c){var b=document.createElementNS(this.NameSpace_Svg,"clipPath");b.setAttributeNS(null,"id",c);return b};this.CreateUse=function(b,c){var d=document.createElementNS(this.NameSpace_Svg,"use");d.setAttributeNS(null,"id",b);d.setAttributeNS(this.NameSpace_Xlink,"xlink:href","#"+c);return d};this.CreateTextableMetadata=function(c){var b=document.createElement("textable");b.setAttribute("textarea",c);return b};this.CreateColorableMetadata=function(d,e,c,f){var b=document.createElement("Colorable");b.setAttribute("ReplaceColor",d);b.setAttribute("SecretColor",e);b.setAttribute("region",c);b.setAttribute("SpecialTitle",f);return b};this.CreateMetadata=function(){return document.createElement("SBTData")};this.AddText=function(g,h,f,e,c){var d=document.createElementNS(this.NameSpace_Svg,"text");d.setAttributeNS(null,"x",g);d.setAttributeNS(null,"y",h);d.setAttributeNS(null,"style",e);d.setAttributeNS(null,"class","DisableSelection");d.setAttributeNS(null,"unselectable","on");var b=document.createTextNode(f);d.appendChild(b);return d};this.GetSvgSize=function(d){var f=new Object();try{var b=$("#"+d);f.Width=b.attr("width").ExtractNumber();f.Height=b.attr("height").ExtractNumber();var g=b[0].getAttribute("viewBox");if(g==null){g=b[0].getAttribute("viewbox")}}catch(c){LogErrorMessage("SvgCreatorLibrary.GetSvgSize",c)}try{f.ViewBox=new Object();if(g!=null){g=g.replace(","," ").replace("  "," ");g=g.split(" ");f.ViewBox.MinX=g[0].ExtractNumber();f.ViewBox.MinY=g[1].ExtractNumber();f.ViewBox.Width=g[2].ExtractNumber();f.ViewBox.Height=g[3].ExtractNumber()}}catch(c){LogErrorMessage("SvgCreatorLibrary.GetSvgSize2 viewbox: "+g,c)}return f;return f};this.UpdateSvgSize=function(c,d){if(d.Width<5||d.Height<5||d.ViewBox.Height<5||d.ViewBox.Width<5){return}var b=$("#"+c);b.attr("width",d.Width+"px");b.attr("height",d.Height+"px");if(d.ViewBox!=null){b[0].setAttributeNS(null,"viewBox",d.ViewBox.MinX+" "+d.ViewBox.MinY+" "+d.ViewBox.Width+" "+d.ViewBox.Height)}};this.UpdateSvgSize_WithDeltas=function(g,c,b){try{var h=this.GetSvgSize(g);if(c!=0){var i=h.Width+c;if(i>5){h.Width=i}}if(b!=0){var f=h.Height+b;if(f>5){h.Height=f}}if(h.ViewBox!=null){if((h.ViewBox.Width+c)>5){h.ViewBox.Width=h.ViewBox.Width+c}if((h.ViewBox.Height+b)>5){h.ViewBox.Height=h.ViewBox.Height+b}}this.UpdateSvgSize(g,h)}catch(d){LogErrorMessage("SvgCreatorLibrary.UpdateSvgSize_WithDeltas",d)}};this.WriteTransform=function(c,g){try{var d=GetGlobalById(c);this._SetDefaultTransformValues(g,"Translate",[0,0]);this._SetDefaultTransformValues(g,"Rotate",[0,0,0]);this._SetDefaultTransformValues(g,"Scale",[1,1]);var f="translate("+g.Translate[0]+", "+g.Translate[1]+") ";f+="rotate("+g.Rotate[0]+", "+g.Rotate[1]+", "+g.Rotate[2]+") ";f+="scale("+g.Scale[0]+", "+g.Scale[1]+") ";d.setAttributeNS(null,"transform",f)}catch(b){}};this._SetDefaultTransformValues=function(f,d,b){try{if(f[d]==null){f[d]=[]}if(f[d].length==0){f[d].push(b[0])}if(f[d].length==1){f[d].push(b[1])}if(f[d].length==2&&b.length==3){f[d].push(b[2])}}catch(c){}};this.GetTransform=function(c){try{var d=GetGlobalById(c);var f=d.getAttribute("transform");f=(f==null||f=="")?"translate(0,0) rotate(0,0,0), scale(1,1)":f;var g=new Object();g.Translate=this._ExtractTransformValues(f,"translate",[0,0]);g.Rotate=this._ExtractTransformValues(f,"rotate",[0,0,0]);g.Scale=this._ExtractTransformValues(f,"scale",[1,1]);if(isNaN(g.Translate[0])){}return g}catch(b){}};this._ExtractTransformValues=function(h,g,b){try{var f=h.indexOf(g);if(f<0){return b}var j=h.substring(f+g.length,h.indexOf(")",f));j=SplitParenthesisNumeric(j);if(j.length<b.length){for(var d=j.length;d<b.length;d++){j.push(b[d])}}return j}catch(c){}return b}};function LangMap(){this._LangmapDictionary=new Object();this.Private_LoadLangmap=function(){this._LangmapDictionary["Tilt-Head-Front--30"]="Full head tilt to the left - Great for sleeping, confusion and questioning";this._LangmapDictionary["Tilt-Head-Front--25"]=this._LangmapDictionary["Tilt-Head-Front--30"];this._LangmapDictionary["Tilt-Head-Front--20"]=this._LangmapDictionary["Tilt-Head-Front--30"];this._LangmapDictionary["Tilt-Head-Front--15"]="Semi head tilt to the left - Great for explaining, listening and showing intrigue";this._LangmapDictionary["Tilt-Head-Front--10"]="Semi head tilt to the left - Great for explaining, listening and showing intrigue";this._LangmapDictionary["Tilt-Head-Front-0"]="Forward Facing - Great for most poses including speaking, eating and living life. ";this._LangmapDictionary["Tilt-Head-Front-10"]="Semi head tilt to the right - Great for explaining, listening and showing intrigue ";this._LangmapDictionary["Tilt-Head-Front-15"]="Semi head tilt to the right - Great for explaining, listening and showing intrigue ";this._LangmapDictionary["Tilt-Head-Front-30"]="Full head tilt to the right - Great for sleeping, confusion and questioning";this._LangmapDictionary["Tilt-Head-Front-20"]=this._LangmapDictionary["Tilt-Head-Front-30"];this._LangmapDictionary["Tilt-Head-Front-25"]=this._LangmapDictionary["Tilt-Head-Front-30"];this._LangmapDictionary["Tilt-Head-Back--30"]=this._LangmapDictionary["Tilt-Head-Front--30"];this._LangmapDictionary["Tilt-Head-Back--25"]=this._LangmapDictionary["Tilt-Head-Front--30"];this._LangmapDictionary["Tilt-Head-Back--20"]=this._LangmapDictionary["Tilt-Head-Front--30"];this._LangmapDictionary["Tilt-Head-Back--15"]=this._LangmapDictionary["Tilt-Head-Front--15"];this._LangmapDictionary["Tilt-Head-Back-0"]=this._LangmapDictionary["Tilt-Head-Front-0"];this._LangmapDictionary["Tilt-Head-Back-15"]=this._LangmapDictionary["Tilt-Head-Front-15"];this._LangmapDictionary["Tilt-Head-Back-30"]=this._LangmapDictionary["Tilt-Head-Front-30"];this._LangmapDictionary["Tilt-Head-Back-20"]=this._LangmapDictionary["Tilt-Head-Front-30"];this._LangmapDictionary["Tilt-Head-Back-25"]=this._LangmapDictionary["Tilt-Head-Front-30"];this._LangmapDictionary["Tilt-Head-Side--30"]="Head Tilt Up  Great for lookup up at the sky or showing thought.";this._LangmapDictionary["Tilt-Head-Side--25"]="Head Tilt Up  Great for lookup up at the sky or showing thought.";this._LangmapDictionary["Tilt-Head-Side--20"]="Head Tilt Up  Great for lookup up at the sky or showing thought.";this._LangmapDictionary["Tilt-Head-Side--15"]="Head Tilt Up  Great for lookup up at the sky or showing thought.";this._LangmapDictionary["Tilt-Head-Side-0"]="Forward Facing - Great for most poses including speaking, eating and living life. ";this._LangmapDictionary["Tilt-Head-Side-5"]="Head Tilt Down  Great for looking down or showing someone is ashamed.";this._LangmapDictionary["Tilt-Head-Side-10"]="Head Tilt Down  Great for looking down or showing someone is ashamed.";this._LangmapDictionary["Tilt-Head-Side-15"]="Head Tilt Down  Great for looking down or showing someone is ashamed.";this._LangmapDictionary["Tilt-Head-Side-30"]="Head Tilt Down  Great for looking down or showing someone is ashamed.";this._LangmapDictionary["Tilt-Head-Side-20"]="Head Tilt Down  Great for looking down or showing someone is ashamed.";this._LangmapDictionary["Tilt-Head-Side-25"]="Head Tilt Down  Great for looking down or showing someone is ashamed.";this._LangmapDictionary["Gls-Female-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Female-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Female-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Female-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Female-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Female-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Female-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Female-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Female-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Female-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Female-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Gls-Female-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Gls-Female2-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Female2-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Female2-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Female2-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Female2-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Female2-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Female2-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Female2-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Female2-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Female2-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Female2-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Gls-Female2-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Gls-Female2-Face-Crazy-Happy"]="Happy";this._LangmapDictionary["Gls-Female2-Face-Crazy-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Male-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Male-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Male-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Male-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Male-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Male-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Male-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Male-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Male-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Male-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Male-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Gls-Male-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Gls-Male-Face-Crazy-Happy"]="Happy";this._LangmapDictionary["Gls-Male-Face-Crazy-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Basic-Male-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Basic-Male-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Basic-Male-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Basic-Male-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Basic-Male-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Basic-Male-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Basic-Male-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Basic-Male-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Basic-Male-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Basic-Male-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Basic-Male-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Gls-Basic-Male-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Gls-Basic-Female-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Basic-Female-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Basic-Female-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Basic-Female-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Basic-Female-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Basic-Female-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Basic-Female-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Basic-Female-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Basic-Female-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Basic-Female-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Basic-Female-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Gls-Basic-Female-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Gls-Indian-Male-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Indian-Male-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Indian-Male-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Indian-Male-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Indian-Male-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Indian-Male-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Indian-Male-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Indian-Male-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Indian-Male-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Indian-Male-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Indian-Male-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Gls-Indian-Male-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Gls-Indian-Female-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Indian-Female-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Indian-Female-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Indian-Female-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Indian-Female-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Indian-Female-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Indian-Female-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Indian-Female-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Indian-Female-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Indian-Female-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Indian-Female-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Gls-Indian-Female-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Gls-Kid-Female-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Kid-Female-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Kid-Female-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Kid-Female-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Kid-Female-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Kid-Female-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Kid-Female-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Kid-Female-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Kid-Female-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Kid-Female-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Kid-Male-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Kid-Male-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Kid-Male-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Kid-Male-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Kid-Male-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Kid-Male-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Kid-Male-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Kid-Male-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Kid-Male-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Kid-Male-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Gls-Asian-Face-Happy"]="Happy";this._LangmapDictionary["Gls-Asian-Face-VerySad"]="Crying";this._LangmapDictionary["Gls-Asian-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Gls-Asian-Face-Wink"]="Wink";this._LangmapDictionary["Gls-Asian-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Gls-Asian-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Gls-Asian-Face-Sad"]="Sad";this._LangmapDictionary["Gls-Asian-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Gls-Asian-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Gls-Asian-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Cls-Face-Happy"]="Happy";this._LangmapDictionary["Cls-Face-VerySad"]="Crying";this._LangmapDictionary["Cls-Face-Unsure"]="Unsure or Confused";this._LangmapDictionary["Cls-Face-Wink"]="Wink";this._LangmapDictionary["Cls-Face-EyesClosed"]="Sleeping or Concentrating";this._LangmapDictionary["Cls-Face-MouthOpen"]="Talking or Eating";this._LangmapDictionary["Cls-Face-Sad"]="Sad";this._LangmapDictionary["Cls-Face-Mad"]="Mad or Angry";this._LangmapDictionary["Cls-Face-Smug"]="Smug or Cheeky";this._LangmapDictionary["Cls-Face-Shocked"]="Shocked or Surprised";this._LangmapDictionary["Cls-Face-Crazy-Angry"]="Crazy Smile";this._LangmapDictionary["Cls-Face-Crazy-Smile"]="Scary Crazy Angry Face";this._LangmapDictionary["Cls-LA-Down"]="Arms Down - Great for showing people at ease, relaxed or resting";this._LangmapDictionary["Cls-LA-Hips"]="Arms on Hips - Great for showing attitudes like anger and determination ";this._LangmapDictionary["Cls-LA-Hold"]="Arm Up - Great for holding or carrying items and waving";this._LangmapDictionary["Cls-LA-Across"]="Arm Across Chest - Great for carrying, showing emotion and sleeping";this._LangmapDictionary["Cls-LA-Face"]="Hand on Face - Great for eating, shouting, and showing surprise";this._LangmapDictionary["Cls-LA-Collar"]="Hand on Collar - Great for showing flirtation or prepping for a date";this._LangmapDictionary["Cls-LA-Salute"]="Salute - Great for military style poses";this._LangmapDictionary["Cls-LA-Serve"]="Hand Raised - Great for throwing, reaching and serving";this._LangmapDictionary["Cls-LA-Spread"]="Arms Spread - Great for showing characters flying or super excited!";this._LangmapDictionary["Cls-RA-Down"]="Arms Down - Great for showing people at ease, relaxed or resting";this._LangmapDictionary["Cls-RA-Hips"]="Arms on Hips - Great for showing attitudes like anger and determination ";this._LangmapDictionary["Cls-RA-Hold"]="Arm Up - Great for holding or carrying items and waving";this._LangmapDictionary["Cls-RA-Across"]="Arm Across Chest - Great for carrying, showing emotion and sleeping";this._LangmapDictionary["Cls-RA-Shake"]="Hand Out- Great for shaking hands or holding items";this._LangmapDictionary["Cls-RA-Face"]="Hand on Face - Great for eating, shouting and showing surprise";this._LangmapDictionary["Cls-RA-Collar"]="Hand on Collar - Great for showing flirtation or prepping for a date";this._LangmapDictionary["Cls-RA-Salute"]="Salute - Great for military style poses";this._LangmapDictionary["Cls-RA-Serve"]="Hand Raised with Racket - Great for the perfect serve!";this._LangmapDictionary["Cls-RA-Spread"]="Arms Spread - Great for showing characters flying or super excited!";this._LangmapDictionary["Cls-L-Stand"]="Standing - Great for most basic poses";this._LangmapDictionary["Cls-L-Nervous"]="Nervous - Great for showing unease, insecurity, or needing to visit the bathroom";this._LangmapDictionary["Cls-L-Walk"]="Walking - Great for walking, running or dancing";this._LangmapDictionary["Cls-L-Sit"]="Sitting - Great for sitting, no really - great for sitting";this._LangmapDictionary["Cls-L-Kneel"]="Kneeling - Great for praying, begging and showing desperation";this._LangmapDictionary["Cls-L-Attitude"]="Attitude - Great for showing a bit of confidence and pomp"};this.Public_GetText=function(a){if(this._LangmapDictionary[a]==null){DebugLine("Missing Langmap: "+a);return""}return this._LangmapDictionary[a]};this.Private_LoadLangmap()};var StoryboardCreatorLibrary=function(){var a=new Object();a.ParseAndUpdateIds=function(b,g,d){if(d==null||d==""){return[]}var h=d.split(",");var f=[];for(var c=0;c<h.length;c++){var j=h[c].trim();var e=g+j;FindAndUpdateId(b,j,e);f.push(e)}return f};return a}();var DrawMenuMask=false;var EPS_ANGLE=4;$(document).ready(function(){try{initProperties()}catch(a){}if(MyBrowserProperties==null||MyBrowserProperties.SupportsSvg()==false){window.location.href="/storyboardcreator/upgradebrowser";return}$.blockUI();PopulateEvents();ClipartTab_ModuleRef.load();$(".subcategory-ul").tabdrop({text:MyLangMap.GetText("Text-More")});SvgSearch.Load();StoryboardContainer.Initialize();ValidateUILayout();setTimeout(function(){if(svgContainerPath==null||svgContainerPath==""){$.unblockUI()}TabRoller.RefreshRollers_PostResize()},1000);if(UseQuill){InitQuill();try{if(quill==null){LogErrorMessage("document.Ready. Init Quill -  quill is null")}}catch(a){LogErrorMessage(".Ready.Init Quill, quill is null with error",a)}}Date.prototype.toJSON=(function(){return this.getTime()})});var MouseDown=false;var SearchResultsDiv="";var NewShapeIsBackdrop=false;var warnOnExit=false;var saveAndContinue=false;var UndoManager;var LogUndo=false;var telemetry_ItemAdded=0;var skipNextDrag=false;var MyPointers,MyBrowserProperties,SvgCreator,StoryboardContainer,SbtMath,MainControls,MyMultiSelectState,MyShapeMetaData,MyColors,MyColorWheels,MyShapesState,MyTitlesState,MyMoveShapeAction,MyCroppedImage,MyPosableControlsBox,MySmartSceneDialog,MyResizeActions,MyRotateAction,MySvgForCategories,MyGlobalSwapLibrary,MyCharacterSwapLibrary,MyUserPermissions,MyCharacterPosistionLibrary,CellConfiguration,MyIdGenerator,MyLayoutFactory,MathUtils,MyGroupAction;function initProperties(){SpecialSignOut=null;if(typeof a==="undefined"){var a=0}MyIdGenerator=new IdGenerator();MyBrowserProperties=new BrowserProperties();CellConfiguration=new StoryboardGridLayout();MyPointers=new Pointers();MyUserPermissions=new UserPermissions(InitialUserPermissions,a);SvgCreator=new SvgCreatorLibrary();StoryboardContainer=new StoryboardContainerLibrary();SbtMath=new SbtMathLibrary();MainControls=new MainControlsBox();MyMultiSelectState=new MultiSelectState();MyShapeMetaData=new ShapeMetaData();MyColors=new SbtColors();MyColorWheels=new ColorWheels();MyShapesState=new ShapesState();MyTitlesState=new ShapesState();MyMoveShapeAction=new MoveShapeAction();MyGroupAction=new GroupAction();MyResizeActions=new ResizeImageAction();MyRotateAction=new RotateImageAction();window.setTimeout(function(){MyGlobalSwapLibrary=new GlobalSwapLibrary()},1);if(UseAdvancedLoad){MyCharacterSwapLibrary=new CharacterSwapLibrary(null)}else{MyCharacterSwapLibrary=new CharacterSwapLibrary(CharacterSwapLibraryJson)}MySvgForCategories=new Object();MyCharacterPosistionLibrary=new CharacterPosistionLibrary();MyLayoutFactory=new LayoutFactory();MathUtils=new MathUtilsLibrary();MainWindowControls.Init()}"use strict";function ValidateUILayout(){if(!MyBrowserProperties.IsMobile){if(!$("body").hasClass("compact-nav")){$("body").addClass("compact-nav");StoryboardContainer.Initialize()}}else{if(!$("body").hasClass("mobile-nav")){$("body").addClass("mobile-nav");StoryboardContainer.Initialize()}}}function PopulateEvents(){MyBrowserProperties.DetermineBrowserInfo();$(window).resize(HandleWindowResize);window.onbeforeunload=closeEditorWarning;if(UseAdvancedLoad){GetAndPopulateShateState(PopulateEvents_PostLoad)}else{PopulateShapeStateFromLoad(PopulateEvents_PostLoad)}}function PopulateEvents_PostLoad(){ConfigureDialogs();UndoManager=new UndoManager();UndoManager.setCallback(function(){if(UndoManager.hasUndo()){$("#undo-btn").prop("disabled",false)}else{$("#undo-btn").prop("disabled",true)}if(UndoManager.hasRedo()){$("#redo-btn").prop("disabled",false)}else{$("#redo-btn").prop("disabled",true)}});SetEventHandlersOnCoreSvg();SetEventHandlersOnSvgContainer();SetEventHandlersOnSvgControlBox();$(document).keydown(HandleKeyDown);StoryboardContainer.Initialize();if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=true}MyPointers.Dialog_PoseImage.on("hidden.bs.modal",HandlePoseDialogClose);MyPointers.Dialog_SmartScene.on("hidden.bs.modal",HandleSmartSceneDialogClose);ResetSaveWarning();SaveHelper.MarkAsChanged(false);if(StoryboardSetup.EnableAutoSave){setInterval(SaveHelper.AutoSave,10*60*1000)}setInterval(SaveHelper.LocalSave,60*1000)}function PreventSelection(){$("body").on("selectstart",function(a){if(!$(a.target).is("input, textarea")){return false}})}function ConfigureDialogs(){try{PopulateUploadDialog()}catch(a){LogErrorMessage("SvgManip.ConfigureDialogs",a)}}function SetEventHandlersOnCoreSvg(){try{MyPointers.CoreSvg.mousedown(HandleCoreSvgClick);MyPointers.CoreSvg.mousemove($.throttle(50,SvgMouseMove));MyPointers.CoreSvg.mouseup(HandleMouseExit);MyPointers.CoreSvg.mouseleave(HandleMouseLeaveSvg);MyPointers.SvgContainer.mousedown(HandleSvgContainerClick)}catch(a){LogErrorMessage("SvgManip.SetEventHandlersOnCoreSvg",a)}}function SetEventHandlersOnSvgContainer(){try{MyPointers.SvgContainer.droppable({drop:HandleDrop});MyPointers.SvgContainer.mouseup(HandleMouseExit);MyPointers.SvgContainer.mouseleave(HandleMouseLeaveDiv);MyPointers.SvgContainer.scroll($.throttle(50,OnScrollSvgContainer))}catch(a){LogErrorMessage("SvgManip.SetEventHandlersOnSvgContainer",a)}}function ObjectDrop(b){try{b.preventDefault()}catch(a){LogErrorMessage("SvgManip.dragEndEvent",a)}}function HandleDrop(d,k){try{d.stopPropagation();var c=k.draggable.children().eq(0).children().eq(0).attr("id");var f=$("#"+c).children().length;if(f<1){return}ClearActiveState();warnOnExit=true;StoryboardContainer.SetCoreSvgDimensions();var a=GetGlobalById("CoreSvg").getBoundingClientRect();var j=(a.width-2);var h=(a.height-2);var m=PageXtoStoryboardX(d.pageX);var n=PageYtoStoryboardY(d.pageY);if((m<0||m>j)&&(n<0||n>h)){return}m=Math.min(Math.max(m,0),j-25);n=Math.min(Math.max(n,0),h-50);var g=$("#"+c).clone();StoryboardContainer.UpdateGradientIds(g);if(k.draggable.hasClass("SceneItem")){NewShapeIsBackdrop=true}try{if(StoryboardContainer.GetLayoutType()==StoryboardLayoutType.LandscapePaper||StoryboardContainer.GetLayoutType()==StoryboardLayoutType.PortraitPaper){NewShapeIsBackdrop=false}}catch(d){LogErrorMessage("svgmanip.handledrop.isPaper",d)}AddSvg.AddSvgToStoryboard(g,m,n,true,k.draggable.hasClass("SceneItem"));if(window.MenuTelemetryId!=null&&window.MenuTelemetryId!=""){var l="/storyboardcreator/addmenutelemetry";var b;if(telemetry_ItemAdded++<3){b={Guid:window.MenuTelemetryId,Key:"Item"+telemetry_ItemAdded,Value:Date.now()-MenuTelemetryStart}}else{b={Guid:window.MenuTelemetryId,Key:"TotalItems",Value:telemetry_ItemAdded}}$.ajax({type:"POST",url:l,data:b,timeout:300*1000,success:function(e){if(e.success!==true){LogErrorMessage("StoryboardCreator - StoryboardAddMenuTelemetry Ajax call error: "+e.Error);return}},error:function(o,p,e){LogErrorMessage("StoryboardCreator - StoryboardAddMenuTelemetry Ajax call failed: "+p,e)}})}}catch(d){LogErrorMessage("SvgManip.HandleDrop",d)}}function ConfigureTouchEvents(){}function formatListText(a){var d=/\s/;var c=/[\r\n]/;var g=a.getSelection();var j=a.val();var b,h=false,f;if(g.length===0){for(b=g.start-2;b<g.start;b++){if(j.substr(b,3)==="\n"+BULLET_STRING+"\n"){a.setSelection(b,b+3).replaceSelectedText("").focus();h=true}}if(!h){var b=g.start-1,l=g.start-1,k=g.start;while(b>=0){if(c.test(j[b])){l=b+1;break}b=b-1}if(b===-1){l=0}b=g.start;while(b<=j.length){if(c.test(j[b])){k=b;break}b=b+1}if(b===j.length+1){k=j.length}a.setSelection(l,k);var e=a.getSelection();if(e.text.startsWith(BULLET_STRING)){a.replaceSelectedText(e.text.substr(1,e.text.length-1)).setSelection(g.start-1).focus()}else{a.surroundSelectedText(BULLET_STRING,EMPTY_STRING).setSelection(g.start+1).focus()}}}else{var b=g.start-1,l=g.start-1,k=g.end;while(b>=0){if(c.test(j[b])){l=b+1;break}b=b-1}if(b===-1){l=0}b=g.end;while(b<=j.length){if(c.test(j[b])){k=b;break}b=b+1}if(b===j.length+1){k=j.length}a.setSelection(l,k);var e=a.getSelection();if(e.text.startsWith(BULLET_STRING)){f="\n"+e.text.replace(new RegExp("\n"+BULLET_STRING,"g"),"\n");f=f.substr(2,f.length-1);a.replaceSelectedText(f).setSelection(e.start,e.start+f.length).focus()}else{f=e.text.replace(/\r\n/g,"\n").replace(/\n/g,"\n"+BULLET_STRING);a.replaceSelectedText(BULLET_STRING+f+"").setSelection(e.start,e.start+f.length+1).focus()}}}function SetEventHandlersOnSvgControlBox(){try{MyPointers.Controls_TextableControls_TextArea.keyup(SetTextableText);MyPointers.Controls_TextableControls_TextArea.bind("cut paste",function(){setTimeout(function(){SetTextableText()},100)});try{textableTextArea=GetGlobalById("textableText");textableTextArea.oninput=SetTextableText}catch(a){}$("#sizeSelector").change(UpdateFontSize);MyPointers.Controls_TextableControls_TextAlignmentSelectors.click(function(b){b.stopPropagation();var c="middle";if(this.className.split(" ").indexOf("start")>-1){c="start"}else{if(this.className.split(" ").indexOf("middle")>-1){c="middle"}else{if(this.className.split(" ").indexOf("end")>-1){c="end"}}}UpdateTextAlignment(c)});$("#textableControlsTable td.MenuAddList").click(function(b){formatListText($("#textableText"));SetTextableText()});InitializeFontSelector();$("#flipVerticalButton").click(FlipVertical);$("#flipHorizontalButton").click(FlipHorizontal);$("#flipHorizontalButton2").click(FlipHorizontal);$("#rotateLeftButton").click(RotateLeft);$("#rotateRightButton").click(RotateRight);$("#bringForwardButton").click(BringShapeForward);$("#bringForwardButton2").click(BringShapeForward);$("#bringToFrontButton").click(BringShapeToFront);$("#sendBackwardsButton").click(SendShapeBackwards);$("#sendBackwardsButton2").click(SendShapeBackwards);$("#sendToBackButton").click(SendShapeToBack);$("#lockButton").click(LockSelected);$("#unlockButton").click(UnlockSelected);$("#copyShapeButton").click(CopyHelper.CopyShape);$("#copyShapeButton2").click(CopyHelper.CopyShape);$("#stretchToFillButton").click(StretchToFill);$("#stretchToFillProportionalButton").click(StretchToFill_Proportional);$("#UnGroupObject").click(MyGroupAction.UnGroup);$("#CropInnerMenuStandard").click({CropType:CropTypeEnum.Standard},CropShapeChange);$("#CropInnerMenuAdvanced").click({CropType:CropTypeEnum.Advanced},CropShapeChange);$("#CropInnerMenuCircle").click({CropType:CropTypeEnum.Circle},CropShapeChange);$("#cropShapeButton").click({CropType:CropTypeEnum.Standard},CropShape);$("#cropShapeButton2").click({CropType:CropTypeEnum.Standard},CropShape);$("#zoomCropShapeButton").click(ZoomCropShape);$("#multiTextableMenuButton").click(MultiTextableShape);$("#deleteShapeButton").click(DeleteShape);$("#deleteShapeButton2").click(DeleteShape);$("#poseShapeButton, #poseShapeButton2").click(PoseShape);$("#editItemOptionsButton").click(SmartImageOptions);$("#editSceneButton").click(SmartSceneShape);$("#artpen-out-button-single-select").click(ArtpenShape);$("#poseSpeaking").click(InstaPoseClosure(InstaPoseEnum.Speaking));$("#poseSad").click(InstaPoseClosure(InstaPoseEnum.Sad));$("#poseAngry").click(InstaPoseClosure(InstaPoseEnum.Angry));$("#poseWalking").click(InstaPoseClosure(InstaPoseEnum.Walking));$("#poseSitting").click(InstaPoseClosure(InstaPoseEnum.Sit));$("#multiFlipVerticalButton").click(FlipVertical);$("#multiFlipHorizontalButton").click(FlipHorizontal);$("#multiRotateLeftButton").click(RotateLeft);$("#multiRotateRightButton").click(RotateRight);$("#multiCopyShapeButton").click(CopyHelper.CopyShape);$("#multiDeleteShapeButton").click(DeleteShape);$("#multi-select-align-left").click(AlignHelper.AlignLeft);$("#multi-select-align-right").click(AlignHelper.AlignRight);$("#multi-select-align-center").click(AlignHelper.AlignCenter);$("#multi-select-align-horizontal-dist").click(AlignHelper.HorizontalDistribution);$("#multi-select-align-top").click(AlignHelper.AlignTop);$("#multi-select-align-middle").click(AlignHelper.AlignMiddle);$("#multi-select-align-bottom").click(AlignHelper.AlignBottom);$("#multi-select-align-vertical-dist").click(AlignHelper.VerticalDistribution);$("#GroupObject").click(MyGroupAction.MakeGroup);$("#multiSelectControlsBoxTable .colorfilterrow td.MenuFilter img, #controlsBoxTable .colorfilterrow td.MenuFilter img").click(function(b){FilterColorMode((this.className==="color")?EMPTY_STRING:"url(#"+this.className+")")});AddSpanishKeyboard();$("#showSpanishKeyboard").click(function(){$("#spanish-keypad").toggle()})}catch(a){LogErrorMessage("SvgManip.SetEventHandlersOnSvgControlBox",a)}}function ShowUploadDialog(){try{ClearActiveState();CheckForUploadAccessPreRefresh(true)}catch(a){LogErrorMessage("SvgManip.ShowUploadDialog",a)}}function PopulateUploadDialog(){try{var c=MyLangMap.GetText("button-upload-multiple-files");if(MyBrowserProperties.IsSafari5){c=MyLangMap.GetText("button-upload-single-file");var b=$("#SafariUploadWarning");b.show()}$("#fine-uploader").fineUploader({request:{endpoint:CreatorUrls.SaveEndPoint,customHeaders:{Accept:"application/json"},},cors:{expected:true,},validation:{allowedExtensions:["jpeg","jpg","gif","png","bmp","wmf","svg"],sizeLimit:1024*1024*3},text:{uploadButton:c},}).on("complete",function(d,f,e,g){if(g.success==true){UglyUploadCallback(g.svg)}else{alert(g.errorMessage)}})}catch(a){LogErrorMessage("SvgManip.PopulateUploadDialog",a)}}function CheckForUploadAccessPreRefresh(b){try{if(MyUserPermissions.EnableUploads){MyPointers.Dialog_UploadImage.modal();return}MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForUploadAccessPostRefresh(b)})}catch(a){LogErrorMessage("SvgManip.CheckForUploadAccessPreRefresh",a)}}function CheckForUploadAccessPostRefresh(b){try{if(MyUserPermissions.EnableUploads){MyPointers.Dialog_UploadImage.modal();return}if(MyUserPermissions.IsLoggedOn==false){if(b){HandleLoginCloseFunction=function(){CheckForUploadAccessPreRefresh(false)};showLogonDialog();return}}MyPointers.Dialog_PurchaseForUploads.modal()}catch(a){LogErrorMessage("SvgManip.CheckForUploadAccessPostRefresh",a)}}function _LoadFromUrl(){if(ExtraSetup.LoadFrom==null){return}var a={userName:ExtraSetup.LoadFrom.UserName,url_title:ExtraSetup.LoadFrom.UrlTitle,revision:ExtraSetup.LoadFrom.Revision};$.ajax({type:"POST",timeout:60*1000,url:"/api_storyboardcreator/getstoryboardmetadata",data:a,success:GetAndPopulateShateState_Success,error:GetAndPopulateShateState_Failure,cache:false})}function GetAndPopulateShateState(a){localDB.CheckUser(IsUserLoggedOn,function(b,c){var d=ExtraSetup.LoadFrom==null?"":ExtraSetup.LoadFrom.UrlTitle;if(b&&c===d){swalQueue({title:MyLangMap.GetText("warning-found-unsaved-version-title"),text:MyLangMap.GetText("warning-found-unsaved-version-text"),type:"warning",confirmButtonText:MyLangMap.GetText("warning-restore-button"),cancelButtonClass:"btn-danger",cancelButtonText:MyLangMap.GetText("warning-discard-button"),showCancelButton:true,},function(e){if(e){localDB.Load(IsUserLoggedOn,function(g){var f=JSON.parse(g);f.svg=f.Svg;f.ShapeStateJson=f.ShapeStates;f.LayoutConfig=f.LayoutConfig;GetAndPopulateShateState_LocalDb(f);a()})}else{localDB.Delete(IsUserLoggedOn);_LoadFromUrl();a()}StoryboardContainer.JiggleSvgSize()});return}else{_LoadFromUrl();a()}})}function GetAndPopulateShateState_Failure(a,h,f){var j=GetQueryStringParameterByName("try")||1;var b=(h||"")+" / "+(f||"");try{var d={message:" ("+b+") ExtraSetup : "+ExtraSetup.LoadFrom.UserName+" "+ExtraSetup.LoadFrom.UrlTitle+"\n"+a.getAllResponseHeaders(),callstack:""};LogErrorMessage("GetAndPopulateShateState_Failure ("+a.status+") - Try + "+j,d)}catch(c){LogErrorMessage("GetAndPopulateShateState_Failure - Failure logging failed! ",c)}if(j<5){j=Number(j)+1;var k=window.location.origin+window.location.pathname+"?try="+j;window.location=k}else{try{var g=MyLangMap.GetTextLineBreaks((h==="timeout")?"Error-Load-Time-Out":"Error-Load-Error");swalQueue({title:"Loading Failed",text:g,type:"error",confirmButtonText:MyLangMap.GetText("warning-ok-button")},function(){window.location="/my-account"})}catch(c){alert("Loading failed; please check your internet connection");LogErrorMessage("GetAndPopulateShateState_Failure - Fallback failure alert",c)}}return}function GetAndPopulateShateState_Success(a){GetAndPopulateShateState_Core(a,function(){$.ajax({type:"GET",timeout:120*1000,url:CreatorUrls.LoadSaved+"?sanitizeSvg=true&url="+svgContainerPath,contentType:"application/json",dataType:"json",success:LoadCoreSvg,error:LoadCoreSvgFail,cache:false})})}function GetAndPopulateShateState_LocalDb(a){GetAndPopulateShateState_Core(a,function(){LoadCoreSvg(a)})}function GetAndPopulateShateState_Core(b,a){try{if(b.Success==false){HandleLoadFailure(false);swalQueue({title:"Load Failed",text:b.ErrorMessage,type:"error",confirmButtonText:MyLangMap.GetText("warning-ok-button")});LogErrorMessage("SvgManip.GetAndPopulateShateState_Core",{message:b.ErrorMessag,stack:""});return}ExtraSetup.ShapeStateJson=b.ShapeStateJson;ExtraSetup.LayoutConfig=JSON.parse(b.LayoutConfig);if(b.CharacterSwapLibrary==null||b.CharacterSwapLibrary==""){ExtraSetup.CharacterSwapLibrary=null}else{ExtraSetup.CharacterSwapLibrary=JSON.parse(b.CharacterSwapLibrary)}if(b.SvgPath){ExtraSetup.SvgPath=b.SvgPath}MyShapesState.Public_LoadShapeStatesFromJson(b.ShapeStateJson);MyCharacterSwapLibrary=new CharacterSwapLibrary(ExtraSetup.CharacterSwapLibrary);a()}catch(c){LogErrorMessage("SvgManip.GetAndPopulateShateState_Core",c)}}function PopulateShapeStateFromLoad(b){try{if(svgContainerPath==null||svgContainerPath==""){return}if(shapeStateJson.length==0||shapeStateJson==null){LogErrorMessage("SvgManip.PopulateShapeStateFromLoad: Completely empty shapeState")}else{MyShapesState.Public_LoadShapeStatesFromJson(shapeStateJson)}$.ajax({type:"GET",timeout:120*1000,url:CreatorUrls.LoadSaved+"?sanitizeSvg=true&url="+svgContainerPath,contentType:"application/json",dataType:"json",success:LoadCoreSvg,error:LoadCoreSvgFail,cache:false})}catch(a){LogErrorMessage("SvgManip.PopulateShapeStateFromLoad",a)}b()}function HandleLoadFailure(b){try{MyShapesState.Private_ClearUnusedShapes();$("#save-choices-btn").click(function(){SaveHelper.SaveStoryboard(false,true,false)});$("#UrlTitle").val("");$("#EditUserName").val("");if(StoryboardSetup!=null){StoryboardSetup.EnableAutoSave=false}}catch(a){}$.unblockUI();if(b){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("warning-load-failed"),type:"error",confirmButtonText:MyLangMap.GetText("warning-ok-button")})}return}function LoadCoreSvgFail(a,g,f){if((a.status==200||a.status=="200")&&a.responseText!=""){return}try{var b=(g||"")+" / "+(f||"");var d={message:" ("+b+") ExtraSetup : "+ExtraSetup.LoadFrom.UserName+" "+ExtraSetup.LoadFrom.UrlTitle+"\n"+a.getAllResponseHeaders(),callstack:""};LogErrorMessage("LoadCoreSvgFail ("+a.status+") - Try + "+tryNumber,d)}catch(c){LogErrorMessage("LoadCoreSvgFail - Failure logging failed! ",c)}HandleLoadFailure(true)}function LoadCoreSvg(b){try{if(b.svg.length==0){try{var d={message:" (data is empty) ExtraSetup : "+ExtraSetup.LoadFrom.UserName+" "+ExtraSetup.LoadFrom.UrlTitle+"\n"+b.getAllResponseHeaders(),callstack:""};LogErrorMessage("LoadCoreSvg ("+b.status+") - Try + "+u,d)}catch(c){LogErrorMessage("LoadCoreSvg - Failure logging failed! ",c)}MyShapesState.Private_ClearUnusedShapes();$.unblockUI();var u=GetQueryStringParameterByName("try")||1;if(u<5){u=Number(u)+1;var v=window.location.origin+window.location.pathname+"?try="+u;window.location=v;return}HandleLoadFailure(true);return}b.svg=b.svg.replace(/y="Infinity"/gi,'y="50"');MyPointers.CoreSvg.remove();MyPointers.SvgContainer.append(InjectSvgFilters(b.svg));MyPointers.ResetAllPointers();SetEventHandlersOnCoreSvg();var j=$("#c_title_R0C0").length>0;var h=$("#c_descr_R0C0").length>0;var o=StoryboardContainer.GetLayoutType();if(o==StoryboardLayoutType.Frayer){$("#addcell-btn").prop("disabled",true)}if(o==StoryboardLayoutType.Movie){SwapSceneCategory(true)}if(o===StoryboardLayoutType.PortraitPaper||o===StoryboardLayoutType.LandscapePaper||o===StoryboardLayoutType.PortraitLegal||o===StoryboardLayoutType.LandscapeLegal||o===StoryboardLayoutType.PortraitTabloid||o===StoryboardLayoutType.LandscapeTabloid){ShowBothSceneCategories()}if(o==StoryboardLayoutType.Timeline){$("#addcell-btn").html('<i class="icon isbt-addcell"></i> '+MyLangMap.GetText("button-timeline-dates"));var n=new Object();n.TimelineDates=[];if(ExtraSetup.LayoutConfig==null||ExtraSetup.LayoutConfig.TimelineDates==null){StoryboardContainer.CalculateRowsAndCols();for(var k=0;k<StoryboardContainer.Cols;k++){n.TimelineDates.push(new Date(2000,k,1))}LogErrorMessage("Timeline lost dates");swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("warning-timeline-lost-dates"),type:"error",confirmButtonText:MyLangMap.GetText("warning-ok-button")})}else{for(var k=0;k<ExtraSetup.LayoutConfig.TimelineDates.length;k++){n.TimelineDates.push(new Date(ExtraSetup.LayoutConfig.TimelineDates[k]))}}ExtraSetup.LayoutConfig=n;TimelineDateManager.PreparePopup(n.TimelineDates)}CellConfiguration=MyLayoutFactory.GetLayout(o,j,h,1,ExtraSetup.LayoutConfig);if(b.GlobalCellCropRatio!==void 0){StoryboardContainer.GlobalCellCropRatio=JSON.parse(b.GlobalCellCropRatio)}var p=AddSvg.CurrentShapeIndex;var t=[];var s=MyShapesState.Public_GetAllShapeStates();for(var k=0;k<s.length;k++){var r=s[k];try{var l=r.Id;if(l.indexOf(SvgPartsEnum.ShapeId)>=0){var q=l.replace(SvgPartsEnum.ShapeId,"");p=Math.max(p,q)}var m=$("#"+l);if(m.length==0){t.push(l);continue}m.off("mousedown").on("mousedown",ShapeSelected);m.off("mouseup").on("mouseup",HandleMouseExit);var r=new SvgState(l);r.PopulateFromJson(MyShapesState.Public_GetShapeStateById(l));r.UpdateDrawing(true);MyShapesState.Public_SetShapeState(l,r)}catch(c){LogErrorMessage("SvgManip.LoadCoreSvg",c)}}for(k=0;k<t.length;k++){MyShapesState.Public_RemoveShapeStateById(t[k])}StoryboardContainer.CleanupAndVerifyLoadedSvg();var g=$("#cell_R0C0");if(g!=null&&g.length>0){var a=g.attr("width");var f=a/CellConfiguration.CellWidth;CellConfiguration.ExpandCells(f);StoryboardContainer.CalculateRowsAndCols();StoryboardContainer.ExpandCells(f);if($("#dataTable").attr("previousValue")){$("#cell-size-slider").slider("setValue",f);$("#cell-size-slider").data("previousValue",f)}}FindOrphans();AddSvg.CurrentShapeIndex=p+1;StoryboardContainer.UpdateBackgroundColors();StoryboardContainer.UpdateImageAttributions();StoryboardContainer.JiggleSvgSize();CheckForLayoutAccessOnStoryboardCopy(StoryboardContainer.Rows,StoryboardContainer.Cols,true);MyPointers.Watermark.text(WatermarkCopy);MyPointers.Watermark.css("font-family","roboto");setTimeout(UpdateTextSpace,500);setTimeout(ClearActiveState,500);if(UseSummerNote){SbtSummerNoteHelper.InitSummerNoteIfNeeded()}$.unblockUI()}catch(c){LogErrorMessage("SvgManip.LoadCoreSvg",c);$.unblockUI()}}function RegexIndexOf(a,c,d){var b=a.substring(d||0).search(c);return(b>=0)?(b+(d||0)):b}function InjectSvgFilters(a){var e=a.indexOf("<svg")+1;var c=a.indexOf(">",e)+1;var d=RegexIndexOf(a,/>([\s])*<defs/,e)+1;var b=-1;if(d===c){b=RegexIndexOf(a,/<\/defs>([\s])*<g\s/,d)+7;return[a.slice(0,c),SVGFilterDeclaration,a.slice(b)].join("")}return[a.slice(0,c),SVGFilterDeclaration,a.slice(c)].join("")}function UpdateTextSpace(){var b=MyShapesState.Public_GetAllShapeStates();for(var a=0;a<b.length;a++){b[a].UpdateDrawing(true)}}function OnScrollSvgContainer(){try{UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.OnScrollSvgContainer",a)}}function HandleWindowResize(a){try{TabRoller.RefreshRollers_PostResize();StoryboardContainer.JiggleSvgSize();StoryboardContainer.SetCoreSvgDimensions();CellPickerHelper.UpdateIfNeeded();UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.HandleWindowResize",a)}}function closeEditorWarning(a){try{if(warnOnExit==true){return"Did you mean to leave? If you do you will lose your storyboard!  You might want to hit save."}}catch(a){LogErrorMessage("SvgManip.closeEditorWarning",a)}}function HandleKeyDown(b){try{if(b.ctrlKey||b.metaKey){switch(b.keyCode){case 65:selectAllShapes();b.stopPropagation();b.preventDefault();return;case 90:if(b.metaKey&&b.shiftKey){Redo()}else{Undo()}b.stopPropagation();b.preventDefault();return;case 89:Redo();b.stopPropagation();b.preventDefault();return;case 75:SaveStoryboard(false,true);b.stopPropagation();b.preventDefault();return}if(!$(b.target).is("input, textarea")){if(b.which===65){return false}}}if(MyShapesState.Property_SelectedCount()==0){return}if($("#textableText").is(":focus")||$(b.target).is(".ql-editor")||$(b.target).is(".note-editable")){return}if(UnmovableShapeSelected()){return}var a=false;switch(b.keyCode){case 46:DeleteShape();return;case 37:if(b.shiftKey){QuickRotate(-10)}else{QuickShapeMove(-5,0)}a=true;break;case 38:if(b.shiftKey){QuickShapeScale(1.1)}else{QuickShapeMove(0,-5)}a=true;break;case 39:if(b.shiftKey){QuickRotate(10)}else{QuickShapeMove(5,0)}a=true;break;case 40:if(b.shiftKey){QuickShapeScale(0.9)}else{QuickShapeMove(0,5)}a=true;break}if(a){UpdateActiveDrawing();b.stopPropagation();b.preventDefault()}}catch(b){LogErrorMessage("SvgManip.HandleKeyDown",b)}}function HandleCoreSvgClick(a){try{ClearActiveState();MyMultiSelectState.Public_StartMultiSelect(a);MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.MultiSelecting);a.stopPropagation()}catch(a){LogErrorMessage("SvgManip.HandleCoreSvgClick",a)}}function HandleSvgContainerClick(a){try{ClearActiveState();MyMultiSelectState.Public_StartMultiSelect(a);MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.MultiSelecting);a.stopPropagation()}catch(a){LogErrorMessage("SvgManip.HandleSvgContainerClick",a)}}function HandleMouseLeaveSvg(){}function HandleMouseLeaveDiv(){HandleMouseExit()}function HandleMouseLeave(a){}function HandleMouseExit(){try{var a=MyShapesState.Property_GetCurrentShapeAction()}catch(b){LogErrorMessage("SvgManip.HandleMouseExit.a",b)}if(a==ShapeActionEnum.MultiSelecting){MyMultiSelectState.Public_CompleteSelection();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected)}try{var c=MyShapesState.Public_GetFirstSelectedShapeState();if(c==null){LogUndo=false}}catch(b){LogErrorMessage("SvgManip.HandleMouseExit.b",b)}try{if(LogUndo){LogUndo=false;if(a==ShapeActionEnum.Rotating){HandleMouseStopRotating()}if(a==ShapeActionEnum.Move&&MyMoveShapeAction.UndoMoveX!=null&&MyMoveShapeAction.UndoMoveY!=null){HandleShapeStopMove()}if(a==ShapeActionEnum.Resize&&MyResizeActions!=null){HandleShapeStopResizing()}}MouseDown=false;ClearShapeEvents()}catch(b){LogErrorMessage("SvgManip.HandleMouseExit.c",b)}}function StartDrag(a,b){try{ClearActiveState()}catch(a){LogErrorMessage("SvgManip.StartDrag",a)}}function SvgMouseMove(b){try{var c=false;var d=b.pageX;var f=b.pageY;var a=MyShapesState.Property_GetCurrentShapeAction();if(StoryboardContainer.CoreSvgLeft<0){StoryboardContainer.SetCoreSvgDimensions()}if(MyShapesState.Property_SelectedCount()==0){if(a==ShapeActionEnum.MultiSelecting){MyMultiSelectState.Public_DrawSelectionArea(b)}return}if(d<StoryboardContainer.CoreSvgLeft||d>StoryboardContainer.CoreSvgRight||f<StoryboardContainer.CoreSvgTop||f>StoryboardContainer.CoreSvgBottom){HandleMouseExit();return}if(a==ShapeActionEnum.Nothing){return}else{if(a==ShapeActionEnum.Selected||a==ShapeActionEnum.SelectedControlsHidden){if(MouseDown){MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Move);HandleShapeMove(b);c=true}}else{if(a==ShapeActionEnum.Move){HandleShapeMove(b);c=true}else{if(a==ShapeActionEnum.Resize){ResizeShape(b);c=true}else{if(a==ShapeActionEnum.Rotating){RotateShape(b);c=true}}}}}if(c){b.stopPropagation();HideControlsMenu();return}}catch(b){LogErrorMessage("SvgManip.SvgMouseMove",b)}}function ShapeSelected(a){try{if(CheckForActiveDialogs()){return}a.stopPropagation();var c=$(this);var b=false;if(a.ctrlKey||a.shiftKey){b=true}if(MyShapesState.Public_ShapeSelected(c)){if(MyShapesState.Property_SelectedCount()>1){b=true}}if(b){MultipleShapeSelected(a,c)}else{SingleShapeSelected(c)}MouseDown=true;MyMoveShapeAction.Public_UpdateMouseMoveOffsets(a.pageX,a.pageY);DrawControlsMenu();UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.ShapeSelected",a)}}function MultipleShapeSelected(c,d){try{var a=MyShapesState.Public_ShapeSelected(d);var b=false;if(c.ctrlKey||c.shiftKey){b=true}if(a===true&&b===false){MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.SelectedControlsHidden);HideControlsMenu();return}if(a){MyShapesState.Public_UnselectShape(d);var f=MyShapesState.Public_GetShapeStateByShape(d);f.UpdateDrawing()}else{MyShapesState.Public_SelectShape(d);var f=MyShapesState.Public_GetShapeStateByShape(d)}MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected)}catch(c){LogErrorMessage("SvgManip.MultipleShapeSelected",c)}}function SingleShapeSelected(k){try{var a=ShapeActionEnum.Selected;var c=MyShapesState.Property_GetCurrentShapeAction();var g=false;var j=true;var d=MyShapesState.Property_SelectedCount();if(MyShapesState.Property_SelectedCount()>0){var b=MyShapesState.Public_GetFirstSelectedShape();if(b.attr("id")==k.attr("id")){j==false;if(c!=ShapeActionEnum.SelectedControlsHidden){a=ShapeActionEnum.SelectedControlsHidden;g=true;j=false}}}if(g){HideControlsMenu()}if(j){ClearActiveState()}MyShapesState.Public_UpdateSingleShapeAndAction(k,a);MyShapesState.Public_GetFirstSelectedShapeState().SetActive(true)}catch(f){LogErrorMessage("SvgManip.SingleShapeSelected",f);try{var h="SvgManip.SingleShapeSelected: ";if(k==null||k.length==0){h+="selected shape is null"}else{h+="selected shape id: "+k.attr("id")}LogErrorMessage(h)}catch(f){}try{LogErrorMessage("SvgManip.SingleShapeSelected: count of selected shapes: "+MyShapesState.Property_SelectedCount());LogErrorMessage("SvgManip.SingleShapeSelected: initial count of selected shapes: "+d)}catch(f){}}}function ClearShapeEvents(){try{if(MyShapesState.Property_GetCurrentShapeAction()!=ShapeActionEnum.SelectedControlsHidden){MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected)}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.ClearShapeEvents",a)}}function ClearActiveState(){try{$("[id$=selection_box]").remove();MyMoveShapeAction.Public_ClearAction();MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu()}catch(a){LogErrorMessage("SvgManip.ClearActiveState",a)}}function UpdateActiveDrawing(){try{var c=MyShapesState.Public_GetAllSelectedShapeStates();if(c.length==0){return}for(var b=0;b<c.length;b++){if((c[b]!=null)&&(typeof(c[b])!="undefined")){c[b].UpdateDrawing()}}DrawControlsMenu()}catch(a){LogErrorMessage("SvgManip.UpdateActiveDrawing",a)}}function HandleMultiSelectDrag(a){}function HideControlsMenu(){try{MainControls.HideControlsBox()}catch(a){LogErrorMessage("SvgManip.HideControlsMenu",a)}}function ShowHelpDialog(){try{ClearActiveState();MyPointers.Dialog_Help.modal();if($("#append-help-here").children().length==0){$("#append-help-here").load("/modal_help/storyboardcreatormodal")}}catch(a){LogErrorMessage("SvgManip.ShowHelpDialog",a)}}function ToggleFullScreen(){if((document.fullScreenElement&&document.fullScreenElement!==null)||(!document.mozFullScreen&&!document.webkitIsFullScreen)){if(document.documentElement.requestFullScreen){document.documentElement.requestFullScreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullScreen){document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}}$("#fullscreen-span").hide();$("#normalview-span").show()}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}$("#fullscreen-span").show();$("#normalview-span").hide()}}function ChangeStoryboardTypeDialog(){try{ClearActiveState();MyPointers.Dialog_StoryboardType.modal()}catch(a){LogErrorMessage("SvgManip.ChangeStoryboardTypeDialog",a)}}function CloseBasicDialog(a){try{$("#"+a).modal("hide")}catch(b){LogErrorMessage("SvgManip.CloseBasicDialog",b)}}function CloseChangeStoryboardTypeDialog(){try{MyPointers.Dialog_StoryboardType.modal("hide")}catch(a){LogErrorMessage("SvgManip.CloseChangeStoryboardTypeDialog",a)}}function ChangeLayoutDialog(){try{ClearActiveState();if(StoryboardContainer.GetLayoutType()==StoryboardLayoutType.Spider){MyPointers.Dialog_SpiderCellCount.modal()}else{if(StoryboardContainer.GetLayoutType()==StoryboardLayoutType.Cycle){MyPointers.Dialog_CycleCellCount.modal()}else{if(StoryboardContainer.GetLayoutType()==StoryboardLayoutType.Timeline){TimelineDateManager.PreparePopup(CellConfiguration.TimelineDates);MyPointers.Dialog_TimelineCellCount.modal()}else{PrepareChangeLayoutDialog();MyPointers.Dialog_ChangeLayout.modal()}}}}catch(a){LogErrorMessage("SvgManip.ChangeLayoutDialog",a)}}function DrawControlsMenu(){try{var a=MyShapesState.Property_GetCurrentShapeAction();if(a==ShapeActionEnum.Move||a==ShapeActionEnum.Resize||a==ShapeActionEnum.Rotating||a==ShapeActionEnum.SelectedControlsHidden){return}var c=MyShapesState.Public_GetFirstSelectedShapeState();if(c==null||c.virtualSelected){return}if(DrawMenuMask&&GetGlobalById("controlsBox").style.display!="none"){return}else{if(!DrawMenuMask){DrawMenuMask=true;setTimeout(function(){DrawMenuMask=false},500)}}MainControls.DrawMainControlsBox()}catch(b){LogErrorMessage("SvgManip.DrawControlsMenu",b);ClearActiveState()}}function CheckForActiveDialogs(){try{var b="isOpen";if(MyPointers.Dialog_ChangeLayout.hasClass("in")){return true}if(MyPointers.Dialog_CropImage.hasClass("in")){return true}if(MyPointers.Dialog_PoseImage.hasClass("in")){return true}if(MyPointers.Dialog_Help.hasClass("in")){return true}if(MyPointers.Dialog_PurchasePopForMoreLayouts.hasClass("in")){return true}if(MyPointers.Dialog_PurchasePopForMoreLayoutsOnCopy.hasClass("in")){return true}if(MyPointers.Dialog_PurchasePopForMoreStoryboardLayouts.hasClass("in")){return true}if(MyPointers.Dialog_PurchaseForUploads.hasClass("in")){return true}if(MyPointers.Dialog_UploadImage.hasClass("in")){return true}if(MyPointers.Dialog_CellSize.hasClass("in")){return true}if(MyPointers.Dialog_SpiderCellCount.hasClass("in")){return true}if(MyPointers.Dialog_CycleCellCount.hasClass("in")){return true}if(MyPointers.Dialog_TimelineCellCount.hasClass("in")){return true}if(MyPointers.Dialog_Policies.hasClass("in")){return true}if(MyPointers.Dialog_AdvancedButtons.hasClass("in")){return true}return false}catch(a){LogErrorMessage("SvgManip.CheckForActiveDialogs",a)}}function PageXtoStoryboardX(a){return a-StoryboardContainer.CoreSvgLeft+MyPointers.SvgContainer.scrollLeft()}function StoryboardXtoPageX(a){return a-MyPointers.SvgContainer.scrollLeft()+StoryboardContainer.CoreSvgLeft}function PageYtoStoryboardY(a){return a-StoryboardContainer.CoreSvgTop+MyPointers.SvgContainer.scrollTop()}function StoryboardYtoPageY(a){return a-MyPointers.SvgContainer.scrollTop()+StoryboardContainer.CoreSvgTop}function StretchToFill(){StretchHelper(StoryboardContainer.DetermineBackDropCords,false,false)}function StretchToFill_Proportional(){StretchHelper(StoryboardContainer.DetermineBackDropCords,false,true)}function StretchHelper(s,p,g){try{var r=MyShapesState.Public_GetFirstSelectedShapeState();var a=MyShapesState.Public_GetFirstSelectedShape();var q=a.attr("id");var m=a.prev();var n=m.attr("id");var l={X:r.X,Y:r.Y,ScaleX:r.ScaleX,ScaleY:r.ScaleY};var j=n;if(p){a.detach();$("#CellDefinition").after(a);j="CellDefinition"}var b=r.Public_GetImaginaryOuterBox();var d={x:(b.Left+b.Right)/2,y:(b.Top+b.Bottom)/2};var c=StoryboardContainer.getCellInformation(d.x,d.y);var h=s(r,d.x,d.y,c,g);if(h==null){return}if(r.IsSpringable()&&r.SpringableState.CanResizeVertical()&&r.SpringableState.CanResizeHorizontal()){var t=new Array();var o=new Array();t.push({Id:r.Id,Transforms:r.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(r.Id+SvgPartsEnum.SvgImage),MoveX:l.X,MoveY:l.Y,UseClipping:r.UseClipping,ClipHeight:r.ClipHeight,ClipWidth:r.ClipWidth,IsSpringable:true});MyResizeActions.Private_ScaleAndMoveSpringable(r,h.ScaleX,h.ScaleY);StoryboardContainer.DetermineBackDropCordsForSpringObject(r,c,g);o.push({Id:r.Id,Transforms:r.SpringableState.GetSpringStateTransforms(),SvgSize:SvgCreator.GetSvgSize(r.Id+SvgPartsEnum.SvgImage),UseClipping:r.UseClipping,ClipHeight:r.ClipHeight,ClipWidth:r.ClipWidth,MoveX:r.X,MoveY:r.Y,IsSpringable:true});UndoManager.register(undefined,UndoShapeResizeWithMove,t,"",undefined,UndoShapeResizeWithMove,o,"")}else{var k={X:r.X,Y:r.Y,ScaleX:r.ScaleX,ScaleY:r.ScaleY};UndoManager.register(undefined,UndoStretchToFill,[q,n,l],"",undefined,UndoStretchToFill,[q,j,k],"")}UpdateActiveDrawing()}catch(f){LogErrorMessage("SvgManip.StretchToFill",f)}}function UndoStretchToFill(d,c,b){try{var g=$("#"+d).detach();$("#"+c).after(g);var f=MyShapesState.Public_GetShapeStateById(d);f.SetScale(b.ScaleX,b.ScaleY);f.MoveTo(b.X,b.Y);MyShapesState.Public_SelectShape(g);UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoStretchToFill",a)}}function StretchToFillShape(d,f,g){try{var a=StoryboardContainer.getCellInformation(f,g);var c=StoryboardContainer.DetermineBackDropCords(d,f,g,a,false);if(c==null){return}SendShapeToBack();UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.StretchToFillShape",b)}}function SetInitialShapeCords(d,a,j,k,f,g){try{var h=a.width;var c=a.height;if(!NewShapeIsBackdrop){j-=(h*f/2);k-=(c*f/2)}g.MoveTo(j,k)}catch(b){LogErrorMessage("SvgManip.SetInitialShapeCords",b)}}function SetInitialShapeIds(c,b){try{c.children().first().children().first().children().first().attr("id",b+SvgPartsEnum.SvgImage);c.children().first().children().first().attr("id",b+SvgPartsEnum.Natural);c.children().first().attr("id",b+SvgPartsEnum.Scale)}catch(a){LogErrorMessage("SvgManip.SetInitialShapeIds",a)}}function SetInitalShapeScale(d,l,a){try{var g=CellConfiguration.DefaultDropWidth;var f=CellConfiguration.DefaultDropHeight;var m=a.width;var c=a.height;var h=(g)/m;var j=(f)/c;var k=Math.min(h,j);k=Math.min(k,1);l.SetScale(k,k);return k}catch(b){LogErrorMessage("SvgManip.SetInitalShapeScale",b)}}function SetInitialShapeOffset(d,h){try{var c=d.attr("id");var a=GetGlobalById(c).getBBox();var f=a.x;var g=a.y;h.SetNaturalOffset(f,g)}catch(b){LogErrorMessage("SvgManip.SetInitialShapeOffset",b)}}function StartRotate(c){try{var b=c.currentTarget.id;var d=$("#"+b).parent().parent().attr("id");var a=MyShapesState.Public_GetShapeStateById(d);MyRotateAction.ResetRotateImageAction(a,c);LogUndo=true;MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Rotating)}catch(c){LogErrorMessage("SvgManip.StartRotate",c)}c.stopPropagation()}function RotateShape(a){try{var c=MyRotateAction.CalculateRotationAngle(a);var d=MyShapesState.Public_GetAllSelectedShapeStates();for(var b=0;b<d.length;b++){d[b].RotateShape(c)}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.RotateShape",a)}}function HandleMouseStopRotating(){try{var a=MyRotateAction.Public_TotalAngleRotation();var f=MyShapesState.Public_GetAllSelectedShapeStates();var h=new Array();var d=new Array();for(var c=0;c<f.length;c++){var g=f[c];h.push({Id:g.Id,Angle:a*-1});d.push({Id:g.Id,Angle:a})}UndoManager.register(undefined,UndoShapeRotate,h,"",undefined,UndoShapeRotate,d,"");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.HandleMouseStopRotating",b)}}function StopRotate(a){}function StartResize(c){try{LogUndo=true;var d=this.id.toLowerCase();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Resize);var a=$("#"+d).parent().parent();var b=MyShapesState.Public_GetShapeStateByShape(a);MyResizeActions.Public_StartResize(b,d);c.stopPropagation()}catch(c){LogErrorMessage("SvgManip.StartResize",c)}}function ResizeShape(a){try{MyResizeActions.Public_ResizeShapes(a)}catch(a){LogErrorMessage("SvgManip.ResizeShape",a)}}function HandleShapeStopResizing(){try{MyResizeActions.Public_StopResizing()}catch(a){LogErrorMessage("SvgManip.HandleShapeStopResizing",a)}}function StopResize(){}function UnmovableShapeSelected(){var a=MyShapesState.Public_GetAllSelectedShapeStates();if(a.length==1){if(a[0].Movable==false){return true}}return false}function HandleShapeMove(a){try{var f=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(UnmovableShapeSelected()){return}if(MyMoveShapeAction.UndoMoveX==null){LogUndo=true;MyMoveShapeAction.Public_UpdateUndos(MyMoveShapeAction.MouseMoveOffsetX,MyMoveShapeAction.MouseMoveOffsetY)}var c=a.pageX-MyMoveShapeAction.MouseMoveOffsetX;var d=a.pageY-MyMoveShapeAction.MouseMoveOffsetY;MyMoveShapeAction.Public_UpdateMouseMoveOffsets(a.pageX,a.pageY);for(var b=0;b<f.length;b++){f[b].MoveDistance(c,d)}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.HandleShapeMove",a)}}function HandleShapeStopMove(){try{var a=MyMoveShapeAction.MouseMoveOffsetX-MyMoveShapeAction.UndoMoveX;var b=MyMoveShapeAction.MouseMoveOffsetY-MyMoveShapeAction.UndoMoveY;MyMoveShapeAction.Public_UpdateUndos(null,null);if(a!=0||b!=0){var g=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);var h=new Array();var f=new Array();for(var d=0;d<g.length;d++){h.push({Id:g[d].Id,X:(a*-1),Y:(b*-1)});f.push({Id:g[d].Id,X:a,Y:b})}UndoManager.register(undefined,UndoShapeMoveArray,h,"",undefined,UndoShapeMoveArray,f,"")}}catch(c){LogErrorMessage("SvgManip.HandleShapeStopMove",c)}}var slider_is_initialized=false;function ShowChangeCellSize(){try{CloseModal(MyPointers.Dialog_AdvancedButtons);MyPointers.Dialog_CellSize.modal();MyPointers.Dialog_CellSize.one("shown.bs.modal",function(){if(!slider_is_initialized){AddSlider();slider_is_initialized=true}})}catch(a){LogErrorMessage("SvgManip.ShowChangeCellSize",a)}}function ExpandCells(e,f,d){ClearActiveState();if(cellSlider){$("#cell-size-slider").data("previousValue",f);var c=$("#cell-size-slider").slider("setValue",f)}var a=(e*CellConfiguration.CellWidth)/CellConfiguration.UnscaledCellWidth;var b=MyLayoutFactory.GetLayout(StoryboardContainer.GetLayoutType(),CellConfiguration.HasTitle,CellConfiguration.HasDescription,a,CellConfiguration.GetLayoutConfig());StoryboardContainer.ChangeCellConfiguration_ScaleShapes(CellConfiguration,b,e);CellConfiguration.ExpandCells(e);StoryboardContainer.ExpandCells(e,d);StoryboardContainer.UpdateImageAttributions();if(HasGridLines()){AddGridLines()}}var cellSlider=null;function AddSlider(){$("#cell-size-slider").data("previousValue",1);cellSlider=$("#cell-size-slider").slider({value:1,formater:function(a){return parseInt(a*100)+"%"}});$("#cell-size-slider").on("slide",HandleCellSizeSlide);$("#cell-size-slider").on("slideStop",HandleCellSizeSlide)}function HandleCellSizeSlide(e,c){var b=$("#cell-size-slider").slider("getValue");var d=$(this).data("previousValue");var a=b/d;var f=d/b;if(f==1){return}ExpandCells(a,b);UndoManager.register(undefined,ExpandCells,[f,d],undefined,"",ExpandCells,[a,b])}function SmartImageOptions(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();MyPosableControlsBox=new PosableControlsBox(a,PosableTypeEnum.SmartItem)}catch(b){LogErrorMessage("SvgManip.SmartImageOptions",b)}}function PoseShape(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();MyPosableControlsBox=new PosableControlsBox(a,PosableTypeEnum.Character)}catch(b){LogErrorMessage("SvgManip.PoseShape",b)}}function InstaPoseClosure(a){return function(){var b=MyShapesState.Public_GetFirstSelectedShapeState();var e=b.Position;var f=b.Public_GetPoseGroupList();var g=b.Public_GetPreviousPoseList();var d=b.Public_GetPose(a);var c=b.Public_GetSafePoseArray(d);b.Public_BulkUpdatePoseGroups(c);b.Public_SetPreviousPoseList(d);UndoManager.register(undefined,UndoPose,[b.Id,f,g,e],"",undefined,UndoPose,[b.Id,b.Public_GetPoseGroupList(),b.Public_GetPreviousPoseList(),e],"")}}function HandlePoseDialogClose(b){var a=MyShapesState.Public_GetFirstSelectedShapeState();var h=MyPosableControlsBox.Public_UndoInfo;var d=a.Position;var c=a.Public_GetPoseGroupList();var f=a.Public_GetPreviousPoseList();var g=a.Id;if(MyPosableControlsBox.Public_IsCancel==false){UndoManager.register(undefined,UndoPose,[g,h.UndoActivePoseList,h.UndoPreviousPoseList,h.UndoPosition],"",undefined,UndoPose,[g,c,f,d],"")}else{UndoPose(g,h.UndoActivePoseList,h.UndoPreviousPoseList,h.UndoPosition)}}function CancelPose(a){MyPosableControlsBox.Public_IsCancel=true;MyPointers.Dialog_PoseImage.modal("hide")}function UndoPose(c,a,f,d){try{var g=MyShapesState.Public_GetShapeStateById(c);g.ChangeCharacterPosition(d);g.Public_SetPreviousPoseList(f);g.Public_BulkUpdatePoseGroups(g.Public_GetSafePoseArray(f));g.Public_BulkUpdatePoseGroups(g.Public_GetSafePoseArray(a))}catch(b){LogErrorMessage("SvgManip.UndoTextAlignment",b)}}function SmartSceneShape(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();MySmartSceneDialog=new SmartSceneDialog(a)}catch(b){LogErrorMessage("SvgManip.SmartSceneShape",b)}}function HandleSmartSceneDialogClose(b){DrawControlsMenu();var a=MyShapesState.Public_GetFirstSelectedShapeState();var d=a.SmartSceneState.GetSelectedSceneOptions();var c=null;if(a.Property_IsColorable()){c=a.ColorableState.Public_GetColorStyles()}var f=a.Id;if(MySmartSceneDialog.CancelButtonPressed==false){UndoManager.register(undefined,UndoSmartScene,[f,MySmartSceneDialog.UndoInfo_Colors,MySmartSceneDialog.UndoInfo_SelectedSceneOptions],"",undefined,UndoSmartScene,[f,c,d],"")}else{UndoSmartScene(f,MySmartSceneDialog.UndoInfo_Colors,MySmartSceneDialog.UndoInfo_SelectedSceneOptions)}}function CancelSmartScene(a){MySmartSceneDialog.CancelButtonPressed=true;MyPointers.Dialog_SmartScene.modal("hide")}function UndoSmartScene(c,a,d){try{var f=MyShapesState.Public_GetShapeStateById(c);if(a!=null){f.ColorableState.Public_CopyColorStyles(a)}f.SmartSceneState.SetSelectedSceneOptions(d)}catch(b){LogErrorMessage("SvgManip.UndoSmartScene",b)}}function ChangeCropBoxTitle(a){switch(a){case CropTypeEnum.Standard:$("#CropBoxTitle").html("Standard Crop");break;case CropTypeEnum.Advanced:$("#CropBoxTitle").html("Advanced Crop");break;case CropTypeEnum.Circle:$("#CropBoxTitle").html("Circular Crop");break}}function GroupActiveCellObject(a){var b=StoryboardContainer.GetAllLayoutParts(CellConfiguration);var e=StoryboardContainer._GetLayoutPartForShape(b,a);var d=StoryboardContainer.GetShapeStatesForCell(e.Row,e.Col);var c=d[StoryboardPartTypeEnum.StoryboardCell];if(c.length>1){c=MyGroupAction.MakeGroupFromSelectedObjects(c,true)}else{if(c.length>0){c=c[0]}else{return}}return c}function CropShapeChange(b){var a=MyShapesState.Public_GetFirstSelectedShapeState();ChangeCropBoxTitle(b.data.CropType);CropHelper.ChangeCropMode(a,b.data.CropType)}function ZoomCropShape(b){var a=MyShapesState.Public_GetFirstSelectedShapeState();if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=false}if(ZoomCropHelper.ShowCropDialog(a)){HideControlsMenu()}}function CropShape(c){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=false}var b=c&&c.data?c.data.CropType:a.CropType;if(b==CropTypeEnum.ZoomCrop){a=GroupActiveCellObject(a)}ChangeCropBoxTitle(b);CropHelper.ShowCropDialog(a,b)}catch(c){LogErrorMessage("SvgManip.CropShape",c)}}function MultiTextableShape(b){try{var a=MyShapesState.Public_GetFirstSelectedShapeState();HideControlsMenu();if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=false}MultiTextableHelper.ShowMultipleDialog(a)}catch(b){LogErrorMessage("SvgManip.MultiTextableShape",b)}}function RemoveCrop(){try{if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=true}MyCroppedImage.RemoveCrop()}catch(a){LogErrorMessage("SvgManip.RemoveCrop",a)}}function CancelCrop(){try{if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=true}MyCroppedImage.CancelCrop()}catch(a){LogErrorMessage("SvgManip.CancelCrop",a)}}function HandleCropSelection(){try{if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=true}MyCroppedImage.UpdateCrop()}catch(a){LogErrorMessage("SvgManip.HandleCropSelection",a)}}function selectAllShapes(){var a=$("#SvgTop");while(1){a=a.prev();if(a.attr("id")==undefined){break}if(a.attr("id").substring(0,3)=="sbt"){MyShapesState.Public_SelectShape(a)}}UpdateActiveDrawing()}function FindTopMostSVG_in_SelectedGroup(a){var b=$("#SvgTop");while(1){b=b.prev();if(b.attr("id")==undefined||b.attr("id")=="SvgTop"){return null}if(b.attr("id").substring(0,3)=="sbt"){for(i=0;i<a.length;i++){if(a[i].Id==b.attr("id")){return a[i].Id}}}}}function BringShapeForward(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.next();var d=c.attr("id");var f=a.attr("id");if(d=="SvgTop"){return}a.detach();c.after(a);UndoManager.register(undefined,UndoShapeIndexBefore,[f,d],"",undefined,UndoShapeIndexAfter,[f,d],"")}catch(b){LogErrorMessage("SvgManip.BringShapeForward",b)}}function BringShapeToFront(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.next();var d=c.attr("id");var f=a.attr("id");a.detach();MyPointers.GetSvgTop().before(a);UndoManager.register(undefined,UndoShapeIndexBefore,[f,d],"",undefined,UndoShapeIndexBefore,[f,"SvgTop"],"")}catch(b){LogErrorMessage("SvgManip.BringShapeToFront",b)}}function SendShapeBackwards(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.prev();var d=c.attr("id");var f=a.attr("id");if(c.attr("id")=="CellDefinition"){return}a.detach();c.before(a);UndoManager.register(undefined,UndoShapeIndexAfter,[f,d],"",undefined,UndoShapeIndexBefore,[f,d],"")}catch(b){LogErrorMessage("SvgManip.SendShapeBackwards",b)}}function SendShapeToBack(){try{var a=MyShapesState.Public_GetFirstSelectedShape();var c=a.prev();var d=c.attr("id");var f=a.attr("id");a.detach();$("#CellDefinition").after(a);UndoManager.register(undefined,UndoShapeIndexAfter,[f,d],"",undefined,UndoShapeIndexAfter,[f,"CellDefinition"],"")}catch(b){LogErrorMessage("SvgManip.SendShapeToBack",b)}}function DeleteShape(){try{if(MyShapesState.Property_SelectedCount==0){return}var l=MyShapesState.Public_GetAllSelectedMovableShapeStates(false);var m=new Array();var k=new Array();for(var f=0;f<l.length;f++){var b=l[f];var g=b.Id;var a=$("#"+g);var h=a.next();var j=h.attr("id");m.push({Detached:a,NextShapeId:j,Id:g,ShapeState:MyShapesState.Public_GetShapeStateById(g)});k.push({Id:g});MyShapesState.Public_RemoveShapeStateById(g);var c=$("#"+g).detach()}UndoManager.register(undefined,UndoDeleteShape,m,"",undefined,UndoShapeAdd,k,"");MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();StoryboardContainer.UpdateImageAttributions()}catch(d){LogErrorMessage("SvgManip.DeleteShape",d)}}function DeleteAll(a){try{if(confirm(MyLangMap.GetText("warning-clear-all"))==false){return}var c=MyShapesState.Public_GetAllShapeStates();for(shapeId in MyShapesState.Private_ShapeStates){var b=MyShapesState.Public_GetShapeStateById(shapeId);if(b==null){continue}$("#"+b.Id).remove();MyShapesState.Public_RemoveShapeStateById(shapeId)}MyShapesState.Public_ResetShapeStates();MyShapesState.Public_ClearAllSelectedShapes();StoryboardContainer.Public_ResetLayout();UndoManager.clear();ClearActiveState()}catch(a){LogErrorMessage("SvgManip.DeleteAll",a)}}function RotateLeft(){try{QuickRotate(-90)}catch(a){LogErrorMessage("SvgManip.RotateLeft",a)}}function RotateRight(){try{QuickRotate(90)}catch(a){LogErrorMessage("SvgManip.RotateRight",a)}}function QuickRotate(a){try{var h=new Array();var d=new Array();var f=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(f.length===0){return}for(var c=0;c<f.length;c++){var g=f[c];g.RotateShape(a);h.push({Id:g.Id,Angle:a*-1});d.push({Id:g.Id,Angle:a})}UndoManager.register(undefined,UndoShapeRotate,h,"",undefined,UndoShapeRotate,d,"");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.QuickRotate",b)}}function FlipVertical(){try{var f=new Array();var c=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(c.length===0){return}for(var b=0;b<c.length;b++){var d=c[b];d.FlipShapeVertical();f.push({Id:d.Id})}UpdateActiveDrawing();UndoManager.register(undefined,UndoFlipVertical,f,"",undefined,UndoFlipVertical,f,"")}catch(a){LogErrorMessage("SvgManip.FlipVertical",a)}}function FlipHorizontal(){try{var f=new Array();var c=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(c.length===0){return}for(var b=0;b<c.length;b++){var d=c[b];d.FlipShapeHorizontal();f.push({Id:d.Id})}UpdateActiveDrawing();UndoManager.register(undefined,UndoFlipHorizontal,f,"",undefined,UndoFlipHorizontal,f,"")}catch(a){LogErrorMessage("SvgManip.FlipHorizontal",a)}}function FilterColorMode(c){try{if(c=="url(#)"){return}var h=new Array();var d=new Array();var f=MyShapesState.Public_GetAllSelectedMovableShapeStates(false);if(f.length===0){return}for(var b=0;b<f.length;b++){var g=f[b];h.push({Id:g.Id,Mode:g.FilterColorMode});g.FilterColorMode=c;d.push({Id:g.Id,Mode:g.FilterColorMode})}UpdateActiveDrawing();UndoManager.register(undefined,UndoFilterColorMode,h,"",undefined,UndoFilterColorMode,d,"")}catch(a){LogErrorMessage("SvgManip.FilterColorMode",a)}}function UndoFilterColorMode(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=arguments[b].Mode;var f=MyShapesState.Public_GetShapeStateById(c);f.FilterColorMode=d;MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFilterColorMode",a)}}function LockSelected(){SetLockState(true)}function UnlockSelected(){SetLockState(false)}function SetLockState(c){try{var h=new Array();var d=new Array();var f=MyShapesState.Public_GetAllSelectedShapeStates();if(f.length===0){return}for(var b=0;b<f.length;b++){var g=f[b];h.push({Id:g.Id,Mode:g.IsLocked});g.SetLockState(c);d.push({Id:g.Id,Mode:g.IsLocked})}UpdateActiveDrawing();UndoManager.register(undefined,UndoSetLockState,h,"",undefined,UndoSetLockState,d,"")}catch(a){LogErrorMessage("SvgManip.SetLockState",a)}}function UndoSetLockState(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=arguments[b].Mode;var f=MyShapesState.Public_GetShapeStateById(c);f.SetLockState(d);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoSetLockState",a)}}function QuickShapeScale(k){try{var l=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);var m=new Array();var j=new Array();if(l.length==0){return}for(var c=0;c<l.length;c++){var a=l[c];var g=a.ScaleX;var h=a.ScaleY;a.ChangeScale(k);var d=a.ScaleX;var f=a.ScaleY;m.push({Id:a.Id,ScaleX:g,ScaleY:h});j.push({Id:a.Id,ScaleX:d,ScaleY:f})}UndoManager.register(undefined,UndoShapeResize,m,"",undefined,UndoShapeResize,j,"");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.QuickShapeScale",b)}}function QuickShapeMove(g,h){try{var f=new Array();var c=new Array();var d=MyShapesState.Public_GetAllSelectedMovableShapeStates(true);if(d.length==0){return}for(var b=0;b<d.length;b++){d[b].MoveDistance(g,h);f.push({Id:d[b].Id,X:(g*-1),Y:(h*-1)});c.push({Id:d[b].Id,X:g,Y:h})}UndoManager.register(undefined,UndoShapeMoveArray,f,"",undefined,UndoShapeMoveArray,c,"");UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.QuickShapeMove",a)}}function InitializeFontSelector(){try{var b=["Coustard","Creepster","Francois One","Germania One","Komika Text","Lobster Two","Lora","Montserrat Alternates","OpenDyslexic","Roboto",];var d=["Coustard","Creepster","Francois One","Germania One","Komika","Lobster Two","Lora","Montserrat","Open Dyslexic","Roboto",];for(var c=0;c<ExtraFonts.length;c++){b.push(ExtraFonts[c].Css);d.push(ExtraFonts[c].Name)}if(UseQuill==false&&UseSummerNote==false){MyPointers.Controls_TextableControls_FontSelector.fontSelector({hide_fallbacks:true,initial:"Courier New,Courier New,Courier,monospace",selected:FontSelectionChange,fonts:b,PrettyFonts:d,})}}catch(a){LogErrorMessage("SvgManip.InitializeFontSelector",a)}}function FontSelectionChange(f){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}var c=d.GetFontFace();SetFontSelection(f,d.Id);$("#textableText").focus();var b=d.GetFontFace();UndoManager.register(undefined,UndoFontFaceChange,[d.Id,c],"",undefined,UndoFontFaceChange,[d.Id,b],"");UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.FontSelectionChange",a)}}function SetFontSelection(b,d){try{var c=MyShapesState.Public_GetShapeStateById(d);if(c==null){return}c.SetFontFace(b);c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.SetFontSelection",a)}}function UpdateFontColor(a){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}var c=d.GetSavedFontColor();if(c==a.toHexString()){return}UndoManager.register(undefined,UndoFontColor,[d.Id,c],"",undefined,UndoFontColor,[d.Id,a.toHexString()],"");d.SetFontColor(a.toHexString(),false);d.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.UpdateFontColor",b)}}function PreviewUpdateFontColor(a){try{var c=MyShapesState.Public_GetFirstSelectedShapeState();if(c==null){return}c.SetFontColor(a.toHexString(),true);c.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.PreviewUpdateFontColor",b)}}function UpdateFontColorHidden(a){try{var b=MyShapesState.Public_GetFirstSelectedShapeState();if(b==null){return}b.ResetFontColor();b.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UpdateFontColorHidden",a)}}function UpdateFontSize(a){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}a.stopPropagation();var b=$("#sizeSelector").val();var c=d.GetFontSize();if(c==b){return}UndoManager.register(undefined,UndoFontSize,[d.Id,c],"",undefined,UndoFontSize,[d.Id,b],"");d.SetFontSize(b);UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UpdateFontSize",a)}}function UpdateTextAlignment(a){try{var f=MyShapesState.Public_GetFirstSelectedShapeState();if(f==null){return}var c=a;var d=f.GetTextAlignment();if(d==c){return}UndoManager.register(undefined,UndoTextAlignment,[f.Id,d],"",undefined,UndoTextAlignment,[f.Id,c],"");f.SetTextAlignment(c);MyPointers.Controls_TextableControls_TextAlignmentSelectors.removeClass("active");MyPointers.Controls_TextableControls_TextAlignmentSelectors.filter("."+c).addClass("active");UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.UpdateTextAlignment",b)}}function SetTextableText_Quill(f,g,h,j,k){try{var n=MyShapesState.Public_GetFirstSelectedShapeState();if(n==null){return}var l=quill.getContents().ops;if(SbtLib.DeepCompareEquality(n.TextState.Public_GetQuillDeltas(),l)==false){var m=n.TextState.Public_GetQuillDeltas();n.TextState.Public_SetQuillDeltas(l);UndoManager.register(undefined,UndoTextChangeQuill,[n.Id,m],"",undefined,UndoTextChangeQuill,[n.Id,l],"");UpdateActiveDrawing();n.SetText(quill.getText());quill.history.clear();SbtQuillHelper.HandleWhiteText()}}catch(k){LogErrorMessage("SvgManip.SetTextableText",k)}}function SetTextableText(a){try{var d=MyShapesState.Public_GetFirstSelectedShapeState();if(d==null){return}if(a!=null){a.stopPropagation()}var b=$("#textableText").val();var c=d.GetText();if(c!=b){d.SetText(b);UndoManager.register(undefined,UndoTextChange,[d.Id,c],"",undefined,UndoTextChange,[d.Id,b],"");UpdateActiveDrawing()}}catch(a){LogErrorMessage("SvgManip.SetTextableText",a)}}function Undo(a){try{if(CheckForActiveDialogs()){return}UndoManager.undo()}catch(a){LogErrorMessage("SvgManip.Undo",a)}}function Redo(a){try{UndoManager.redo()}catch(a){LogErrorMessage("SvgManip.Redo",a)}}function TouchyShapeSelected(g,h,a,d){try{if(CheckForActiveDialogs()){return}var b=ShapeActionEnum.Selected;a.attr("id");if(MyShapesState.Property_SelectedCount()>0){var c=MyShapesState.Public_GetFirstSelectedShape();if(c.attr("id")==$(this).attr("id")){return}}ClearActiveState();MyShapesState.Public_UpdateSingleShapeAndAction(a,b);MyShapesState.Public_GetFirstSelectedShapeState();UpdateActiveDrawing();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing)}catch(f){LogErrorMessage("SvgManip.TouchyShapeSelected",f)}}var _TouchyRotateStarted=false;function HandleTouchyRotate(h,j,a,f){try{if(CheckForActiveDialogs()){return}if(MyShapesState.Property_SelectedCount()==0){return}if(f.startPoint==null){return}if(f.movePoint==null){return}var k=MyShapesState.Public_GetFirstSelectedShapeState();var c=PageXtoStoryboardX(f.movePoint.x);var d=PageYtoStoryboardY(f.movePoint.Y);switch(j){case"start":_TouchyRotateStarted=true;HideControlsMenu();MyRotateAction.ResetRotateImageAction(k,{pageX:f.movePoint.x,pageY:f.movePoint.y});LogUndo=true;k.UpdateDrawing();break;case"move":if(!_TouchyRotateStarted){return}var b=MyRotateAction.CalculateRotationAngle({pageX:f.movePoint.x,pageY:f.movePoint.y});k.RotateShape(b);k.UpdateDrawing();break;case"end":if(!_TouchyRotateStarted){return}_TouchyRotateStarted=false;HandleMouseStopRotating();DrawControlsMenu();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing);break}}catch(g){LogErrorMessage("SvgManip.HandleTouchyRotate",g)}}var _TouchyDragStarted=false;function HandleTouchyDrag(g,h,a,b){try{if(CheckForActiveDialogs()){return}if(MyShapesState.Property_SelectedCount()==0){return}if(skipNextDrag){skipNextDrag=false;return}var j=MyShapesState.Public_GetFirstSelectedShapeState();var c=b.movePoint.x-b.lastMovePoint.x;var d=b.movePoint.y-b.lastMovePoint.y;switch(h){case"start":_TouchyDragStarted=true;HideControlsMenu();MyMoveShapeAction.Public_ClearAction();LogUndo=true;MyMoveShapeAction.Public_UpdateUndos(0,0);MyMoveShapeAction.Public_UpdateMouseMoveOffsets(c,d);j.MoveDistance(c,d);j.UpdateDrawing();break;case"move":if(!_TouchyDragStarted){return}MyMoveShapeAction.Public_UpdateMouseMoveOffsets(c+MyMoveShapeAction.MouseMoveOffsetX,d+MyMoveShapeAction.MouseMoveOffsetY);j.MoveDistance(c,d);j.UpdateDrawing();break;case"end":if(!_TouchyDragStarted){return}_TouchyDragStarted=false;HandleShapeStopMove();DrawControlsMenu();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing);break}}catch(f){LogErrorMessage("SvgManip.HandleTouchyDrag",f)}}var _TouchyPinchStarted=false;function HandleTouchyPinch(d,f,a,b){try{if(CheckForActiveDialogs()){return}if(MyShapesState.Property_SelectedCount()==0){return}var g=MyShapesState.Public_GetFirstSelectedShapeState();switch(f){case"start":_TouchyPinchStarted=true;HideControlsMenu();MyResizeActions.Public_StartResize(g,g.Id);break;case"move":if(!_TouchyPinchStarted){return}MyResizeActions.ResizeViaPinch(b);break;case"end":if(!_TouchyPinchStarted){return}_TouchyPinchStarted=false;HandleShapeStopResizing();DrawControlsMenu();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Nothing);break}}catch(c){LogErrorMessage("SvgManip.HandleTouchyPinch",c)}}function ColorableHelper_GetRegionFromId(b){try{var c=b.replace("ColorSelector_","");var c=c.replace("div_","");c=c.substring(0,c.indexOf("_"));return c}catch(a){LogErrorMessage("SvgManip.ColorableHelper_GetRegionFromId",a)}}function UndoColorChange(c,d,a){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var f=MyShapesState.Public_GetShapeStateById(c);MyShapesState.Public_SelectShape($("#"+c));f.Public_SetColorForRegion(d,a,false,true,false);f.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.UndoColorChange",b)}}function UpdateColorRegionFromColorPicker(a){try{var c=ColorableHelper_GetRegionFromId(this.id);var d=a.toRgbString();var f=MyShapesState.Public_GetFirstSelectedShapeState();if(f!=null){f.Public_SetColorForRegion(c,d,false,false,true)}}catch(b){LogErrorMessage("SvgManip.UpdateColorRegionFromColorPicker",b)}}function UpdateColorRegionFromColorPickerPreview(a){try{var c=ColorableHelper_GetRegionFromId(this.id);var d=a.toRgbString();var f=MyShapesState.Public_GetFirstSelectedShapeState();if(f!=null){f.Public_SetColorForRegion(c,d,true,false,false)}}catch(b){LogErrorMessage("SvgManip.UpdateColorRegionFromColorPickerPreview",b)}}function UpdateColorRegionFromColorPickerHide(a){try{var c=MyShapesState.Public_GetFirstSelectedShapeState();var b=ColorableHelper_GetRegionFromId(this.id);if(c!=null){c.Public_SetColorForRegion(b,c.Public_GetColorForRegion(b),true,false,false)}}catch(a){LogErrorMessage("SvgManip.UpdateColorRegionFromColorPickerHide",a)}}function UpdateColorRegion(a){try{var f=MyShapesState.Public_GetFirstSelectedShapeState();var d=$("#"+a.target.id);var c=d.css("background-color");var b=ColorableHelper_GetRegionFromId(a.target.id);f.Public_SetColorForRegion(b,c,false,true,true)}catch(a){LogErrorMessage("SvgManip.UpdateColorRegion",a)}}function WhiteOutShape(){BlankOutShape("rgb(255, 255, 255)","#fff",WhiteOutShape)}function BlackOutShape(){BlankOutShape("rgb(0, 0, 0)","#000",BlackOutShape)}function getcolorValues(a){if(a===""){return}if(a.toLowerCase()==="transparent"){return[0,0,0,0]}if(a[0]==="#"){if(a.length<7){a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]+(a.length>4?a[4]+a[4]:"")}return[parseInt(a.substr(1,2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16),a.length>7?parseInt(a.substr(7,2),16)/255:1]}if(a.indexOf("rgb")===-1){var c=document.body.appendChild(document.createElement("fictum"));var b="rgb(1, 2, 3)";c.style.color=b;if(c.style.color!==b){return}c.style.color=a;if(c.style.color===b||c.style.color===""){return}a=getComputedStyle(c).color;document.body.removeChild(c)}if(a.indexOf("rgb")===0){if(a.indexOf("rgba")===-1){a+=",1"}return a.match(/[\.\d]+/g).map(function(d){return +d})}}function colorValues(a){var c=getcolorValues(a);var b=0;if(c!=undefined){b=Math.round((c[0]*0.2126+c[1]*0.7152+c[2]*0.0722))}return Math.round(Math.sqrt(b/255)*255)}function ApplyArtPen(l){var d=colorValues("#000000"),e=colorValues("#ffffff");var k=["path","polygon","rect","ellipse","circle","line"];for(var c=0;c<k.length;c++){var b=l.getElementsByTagName(k[c]);for(var a=0;a<b.length;a++){if(b[a].getAttributeNS(null,"fill")==null||b[a].getAttributeNS(null,"fill")=="none"||b[a].getAttributeNS(null,"fill").substr(0,3)=="url"){continue}if(b[a].getAttributeNS(null,"stroke")==null){continue}var g=b[a].getAttributeNS(null,"stroke-width");var f=b[a].getAttributeNS(null,"stroke");b[a].setAttributeNS(null,"stroke-width",4);b[a].setAttributeNS(null,"stroke","rgb(12,12,12)");var m=colorValues(b[a].getAttributeNS(null,"fill"));var h=b[a].getAttributeNS(null,"fill");h=((h==null||h=="")?"#000":h);b[a].setAttributeNS(null,"old_fill",h);b[a].setAttributeNS(null,"fill","rgb("+m+","+m+","+m+")");b[a].setAttributeNS(null,"old_strokewidth",g);b[a].setAttributeNS(null,"old_stroke",f)}}}function ArtpenShape(){try{MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var h=MyShapesState.Public_GetAllSelectedShapeStates();if(h.length==0){return}var m=[];for(var k=0;k<h.length;k++){var a=h[k];var j=GetGlobalById(a.Id);var g=a.Public_GetColorRegions();var l=[];if(g!=null){for(var d=0;d<g.length;d++){if(g[d]==""){continue}l.push({Region:g[d],Color:a.Public_GetColorForRegion(g[d])});var b=a.Public_GetColorForRegion(g[d]);var n=colorValues(b);a.Public_SetColorForRegion(g[d],"rgb("+n+","+n+","+n+")",false,false,false)}}var f=a.FilterColorMode;a.FilterColorMode="url(#grayscale)";ApplyArtPen(document.getElementById(a.Id+SvgPartsEnum.Natural));m.push({id:a.Id,undoColors:l,preFilterColorMode:f})}UndoManager.register(undefined,UndoBlankOut,[m],"",undefined,ArtpenShape,[null,m],"");DrawControlsMenu();UpdateActiveDrawing()}catch(c){LogErrorMessage("SvgManip.ArtpenShape",c)}}function BlankOutShape(h,c,f){try{MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var j=MyShapesState.Public_GetAllSelectedShapeStates();if(j.length==0){return}var n=[];for(var l=0;l<j.length;l++){var a=j[l];var g=a.Public_GetColorRegions();var m=[];if(g!=null){for(var d=0;d<g.length;d++){if(g[d]==""){continue}m.push({Region:g[d],Color:a.Public_GetColorForRegion(g[d])});a.Public_SetColorForRegion(g[d],h,false,false,false)}}var k=$("#"+a.Id+SvgPartsEnum.Scale);FadeToBlankOut(k,c);n.push({id:a.Id,undoColors:m})}UndoManager.register(undefined,UndoBlankOut,[n],"",undefined,f,[null,n],"");DrawControlsMenu()}catch(b){LogErrorMessage("SvgManip.BlankOutShape",b)}}function FadeToBlankOut(h,c){try{var g=false;if(h.attr("fill")=="#FFFFFC"||h.attr("fill")=="none"){g=true}if(h.is("g")||h.is("svg")||h.is("defs")){g=true}if(g==false){var d=h.attr("fill");d=((d==null||d=="")?"#000":d);if(h.attr("opacity")!=null){var f=h.attr("opacity");h.attr("old_opacity",f);h.attr("opacity",1)}h.attr("old_fill",d);h.attr("fill",c)}for(var b=0;b<h.children().length;b++){FadeToBlankOut($(h.children()[b]),c)}}catch(a){LogErrorMessage("SvgManip.FadeToBlankOut",a)}}function UndoBlankOut(g){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var f=0;f<g.length;f++){var c=MyShapesState.Public_GetShapeStateById(g[f].id);MyShapesState.Public_SelectShape($("#"+g[f].id));var d=$("#"+g[f].id);UndoFadeToBlankOutHelper(d);for(var b=0;b<g[f].undoColors.length;b++){c.Public_SetColorForRegion(g[f].undoColors[b].Region,g[f].undoColors[b].Color,false,false,false)}if(g[f].preFilterColorMode!=null&&g[f].preFilterColorMode!="undefined"){c.FilterColorMode=g[f].preFilterColorMode}c.UpdateDrawing()}DrawControlsMenu()}catch(a){LogErrorMessage("SvgManip.UndoFadeToWhiteOut",a)}}function UndoFadeToBlankOutHelper(c){try{if(c.attr("old_fill")!=null&&c.attr("old_fill")!=""){c.attr("fill",c.attr("old_fill"));c.attr("old_fill","")}if(c.attr("old_opacity")!=null&&c.attr("old_opacity")!=""){c.attr("opacity",c.attr("old_opacity"));c.attr("old_opacity","")}if(c.attr("old_stroke")!=null&&c.attr("old_stroke")!=""){c.attr("stroke",c.attr("old_stroke"));c.attr("old_stroke","")}if(c.attr("old_strokewidth")!=null&&c.attr("old_strokewidth")!=""){c.attr("stroke-width",c.attr("old_strokewidth"));c.attr("old_strokewidth","")}for(var b=0;b<c.children().length;b++){UndoFadeToBlankOutHelper($(c.children()[b]))}}catch(a){LogErrorMessage("SvgManip.UndoFadeToBlankOutHelper",a)}}function UndoDeleteShape(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);var h=true;for(var g=0;g<arguments.length+1;g++){if(h===false){break}h=false;for(var d=0;d<arguments.length;d++){var f=arguments[d].Id;var k=arguments[d].ShapeState;var a=arguments[d].NextShapeId;var b=arguments[d].Detached;if(b.parent().length===0){$("#"+a).before(b);if(b.parent().length>0){MyShapesState.Public_SetShapeState(f,k);MyShapesState.Public_SelectShape($("#"+f))}else{h=true}}}}StoryboardContainer.UpdateImageAttributions();UpdateActiveDrawing()}catch(c){LogErrorMessage("SvgManip.UndoDeleteShape",c)}}function UndoShapeAdd(){try{MyShapesState.Public_ClearAllSelectedShapes();for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;if(arguments[b].content){if(arguments[b].content.cell_title_id){var d=MyShapesState.Public_GetShapeStateById(arguments[b].content.cell_title_id);d.TextState.CopyFontStyles(arguments[b].content.cell_title_txt.Public_GetFontStyles());d.ColorableState.Public_CopyColorStyles(arguments[b].content.cell_title_color.Public_GetColorStyles());d.UpdateDrawing()}if(arguments[b].content.cell_description_id){var d=MyShapesState.Public_GetShapeStateById(arguments[b].content.cell_description_id);d.TextState.CopyFontStyles(arguments[b].content.cell_description_txt.Public_GetFontStyles());d.ColorableState.Public_CopyColorStyles(arguments[b].content.cell_description_color.Public_GetColorStyles());d.UpdateDrawing()}}else{$("#"+c).detach();MyShapesState.Public_RemoveShapeStateById(c)}}HideControlsMenu();StoryboardContainer.UpdateImageAttributions()}catch(a){LogErrorMessage("SvgManip.UndoShapeAdd",a)}}function UndoShapeIndexBefore(c,b){try{var d=$("#"+c).detach();$("#"+b).before(d)}catch(a){LogErrorMessage("SvgManip.UndoShapeIndexBefore",a)}}function UndoShapeIndexAfter(c,b){try{var d=$("#"+c).detach();$("#"+b).after(d)}catch(a){LogErrorMessage("SvgManip.UndoShapeIndexAfter",a)}}function UndoTextChange(b,d){try{var c=MyShapesState.Public_GetShapeStateById(b);c.SetText(d);$("#textableText").val(d);c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UndoTextChange",a)}}function UndoTextChangeQuill(c,a){try{var d=MyShapesState.Public_GetShapeStateById(c);if(d==null){LogErrorMessage("SvgManip.UndoTextChangeQuill - ShapeState is Null - ID: "+c);return}d.TextState.Public_SetQuillDeltas(a);quill.setContents(a);if(quill.getLength()==1){SbtQuillHelper.ResetToDefaults()}d.UpdateDrawing();d.SetText(quill.getText())}catch(b){LogErrorMessage("SvgManip.UndoTextChangeQuill",b)}}function UndoFontFaceChange(c,b){try{var d=MyShapesState.Public_GetShapeStateById(c);SetFontSelection(b,c);d.UpdateDrawing();UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFontFaceChange",a)}}function UndoFontColor(c,a){try{var d=MyShapesState.Public_GetShapeStateById(c);d.SetFontColor(a);MyPointers.Controls_TextableControls_ColorSelector.spectrum("set",a);d.UpdateDrawing()}catch(b){LogErrorMessage("SvgManip.UndoFontColor",b)}}function UndoFontSize(b,d){try{var c=MyShapesState.Public_GetShapeStateById(b);c.SetFontSize(d);$("#sizeSelector").val(d);c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFontSize",a)}}function UndoTextAlignment(b,d){try{var c=MyShapesState.Public_GetShapeStateById(b);c.SetTextAlignment(d);MyPointers.Controls_TextableControls_TextAlignmentSelectors.removeClass("active");MyPointers.Controls_TextableControls_TextAlignmentSelectors.filter("."+d).addClass("active");c.UpdateDrawing()}catch(a){LogErrorMessage("SvgManip.UndoTextAlignment",a)}}function UndoFlipVertical(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=MyShapesState.Public_GetShapeStateById(c);d.FlipShapeVertical();MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFlipVertical",a)}}function UndoFlipHorizontal(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=MyShapesState.Public_GetShapeStateById(c);d.FlipShapeHorizontal();MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoFlipHorizontal",a)}}function UndoShapeRotate(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var c=0;c<arguments.length;c++){var d=arguments[c].Id;var a=arguments[c].Angle;var f=MyShapesState.Public_GetShapeStateById(d);f.RotateShape(a);MyShapesState.Public_SelectShape($("#"+d))}UpdateActiveDrawing()}catch(b){LogErrorMessage("SvgManip.UndoShapeRotate",b)}}function UndoShapeMoveArray(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var f=arguments[b].X;var g=arguments[b].Y;var d=MyShapesState.Public_GetShapeStateById(c);d.MoveDistance(f,g);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoShapeMoveArray",a)}}function UndoShapeResize(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=arguments[b].ScaleX;var f=arguments[b].ScaleY;var g=MyShapesState.Public_GetShapeStateById(c);g.SetScale(d,f);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoShapeResize",a)}}function UndoShapeResizeWithMove(){try{MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Property_SetCurrentShapeAction(ShapeActionEnum.Selected);for(var b=0;b<arguments.length;b++){var c=arguments[b].Id;var d=MyShapesState.Public_GetShapeStateById(c);if(arguments[b].IsSpringable){if(arguments[b].UseClipping){d.ClipHeight=arguments[b].ClipHeight;d.ClipWidth=arguments[b].ClipWidth}MyResizeActions.UndoSpringableResize(arguments[b])}else{d.SetScale(arguments[b].ScaleX,arguments[b].ScaleY)}d.MoveTo(arguments[b].MoveX,arguments[b].MoveY);MyShapesState.Public_SelectShape($("#"+c))}UpdateActiveDrawing()}catch(a){LogErrorMessage("SvgManip.UndoShapeResizeWithMove",a)}}function UndoCrop(j,l,c,d,b,a,f,g,m,n){try{var k=MyShapesState.Public_GetShapeStateById(j);k.UseClipping=l;k.ClipX=c;k.ClipY=d;k.ClipWidth=b;k.ClipHeight=a;k.CropType=g;k.CropPolygonPointJson=JSON.stringify(f);k.CropPolygonPoint=JSON.parse(k.CropPolygonPointJson);k.X=m;k.Y=n;k.UpdateCropping();k.UpdateDrawing()}catch(h){LogErrorMessage("SvgManip.UndoCrop",h)}}var _SaveWarningNextHandler;var _SaveWarningTimeOut;function ResetSaveWarning(){if(_SaveWarningTimeOut!=null){clearTimeout(_SaveWarningTimeOut)}_SaveWarningTimeOut=setInterval(ShowSaveWarning,15*60*1000);_SaveWarningNextHandler=SaveWarning15Minutes}function ShowSaveWarning(){if(_SaveWarningNextHandler!=null){_SaveWarningNextHandler()}}function SaveWarning15Minutes(){try{var b=MyLangMap.GetText("warning-please-save-15");if(StoryboardSetup.EnableAutoSave==false){b+="\r\n\r\n"+MyLangMap.GetText("warning-please-save-auto-save")}swalQueue({title:MyLangMap.GetText("warning-please-save"),text:b,type:"info",confirmButtonText:MyLangMap.GetText("warning-ok-button")});_SaveWarningNextHandler=SaveWarning30Minutes}catch(a){LogErrorMessage("SvgManip.SaveWarning15Minutes",a)}}function SaveWarning30Minutes(){try{var b=MyLangMap.GetText("warning-please-save-30");if(StoryboardSetup.EnableAutoSave==false){b+="\r\n\r\n"+MyLangMap.GetText("warning-please-save-auto-save")}swalQueue({title:MyLangMap.GetText("warning-please-save"),text:b,type:"warning",confirmButtonText:MyLangMap.GetText("warning-ok-button")});_SaveWarningNextHandler=SaveWarning45Minutes}catch(a){LogErrorMessage("SvgManip.SaveWarning30Minutes",a)}}function SaveWarning45Minutes(){try{var b=MyLangMap.GetText("warning-please-save-45");if(StoryboardSetup.EnableAutoSave==false){b+="\r\n\r\n"+MyLangMap.GetText("warning-please-save-auto-save")}swalQueue({title:MyLangMap.GetText("warning-please-save"),text:b,type:"error",confirmButtonText:MyLangMap.GetText("warning-ok-button")});_SaveWarningNextHandler=null}catch(a){LogErrorMessage("SvgManip.SaveWarning45Minutes",a)}}function FindOrphans(){try{var a=MyPointers.CoreSvg.children();var d=0;for(var f=0;f<a.length;f++){try{var c=a[f];var g=c.getAttribute("id");if(g==null||g.indexOf(SvgPartsEnum.ShapeId)<0){continue}if(MyShapesState.Public_GetShapeStateById(g)==undefined){var h=$("#"+g);h.off("mousedown").on("mousedown",ShapeSelected);h.off("mouseup").on("mouseup",HandleMouseExit);var j=new SvgState(g);j.Public_RecreateFromOrphan();MyShapesState.Public_SetShapeState(g,j);d++}}catch(b){DebugLine("Find Orphans [item]: "+b)}}if(d>0){LogOrphans(d);swalQueue({title:"Issues Found",text:MyLangMap.GetTextLineBreaks("warning-load-failed-orphans"),type:"error",confirmButtonText:MyLangMap.GetText("warning-ok-button")});LogErrorMessage("SvgManip.FindOrphans",{message:d,stack:""})}}catch(b){LogErrorMessage("SvgManip.Orphans",b)}}function GetStoryboardSize(){try{var g=MyShapesState.Public_GetAllShapeStates().length;if(g<30){return}if(g>30){var f=GetGlobalById("CoreSvg");var d=(new XMLSerializer()).serializeToString(f);var c=d.length;if(c>3750000){var b=MyLangMap.GetTextLineBreaks("warning-storyboard-too-big");b=b.replace("{totalShapes}",g);b=b.replace("{totalSize}",c);swalQueue({title:"",text:b,type:"warning",confirmButtonText:MyLangMap.GetText("warning-ok-button")})}}}catch(a){LogErrorMessage("GetStoryboardSize",a)}}function ShowAdvancedButtons(){var b=CellConfiguration.HasTitle;var a=CellConfiguration.HasDescription;$("#title-caps-btn").prop("disabled",!b);$("#title-emphasis-btn").prop("disabled",!b);$("#advanced-title-text-size").prop("disabled",!b);$("#description-emphasis-btn").prop("disabled",!a);$("#advanced-description-text-size").prop("disabled",!a);MyPointers.Dialog_AdvancedButtons.modal()}function ToggleGridLines(){CloseModal(MyPointers.Dialog_AdvancedButtons);if(HasGridLines()){$("#gridlines-btn").toggleClass("btn-default").toggleClass("btn-danger");RemoveGridLines()}else{$("#gridlines-btn").toggleClass("btn-default").toggleClass("btn-danger");AddGridLines()}}function HasGridLines(){return MyPointers.CoreSVG_SvgTop.children().length>0}function AddGridLines(){RemoveGridLines();var c="Gray";var d="gainsboro";var j=10;for(var k=0;k<StoryboardContainer.Rows;k++){for(var b=0;b<StoryboardContainer.Cols;b++){var a=CellConfiguration.GetCellPartPosition(StoryboardPartTypeEnum.StoryboardCell,k,b);var e=a.Height/j;var f=a.Width/j;for(var g=1;g<j;g++){var h="grid_"+k+"_"+b+"_";var m=a.X+(g*f);var n=a.Y+(g*e);var l=(g==5?1.5:0.5);MyPointers.CoreSVG_SvgTop.append(SvgCreator.AddLine(m,a.Y,m,a.Y+a.Height,"stroke:"+c+"; stroke-width:"+l+";",h+"_a"));MyPointers.CoreSVG_SvgTop.append(SvgCreator.AddLine(m,a.Y,m,a.Y+a.Height,"stroke:"+d+" ; stroke-dasharray: 5,5; stroke-width:"+l+";",h+"_a"));MyPointers.CoreSVG_SvgTop.append(SvgCreator.AddLine(a.X,n,a.X+a.Width,n,"stroke:"+c+" ; stroke-width:"+l+";",h+"_c"));MyPointers.CoreSVG_SvgTop.append(SvgCreator.AddLine(a.X,n,a.X+a.Width,n,"stroke:"+d+" ; stroke-dasharray: 5,5; stroke-width:"+l+";",h+"_c"))}}}}function RemoveGridLines(){MyPointers.CoreSVG_SvgTop.children().remove()}function AddKeypadSymbol(b){if(UseQuill){SbtQuillHelper.JamText(b)}else{if(UseSummerNote){SbtSummerNoteHelper.JamText(b)}else{var a=$("#textableText");$.keypad.insertValue(a,b);SetTextableText();a.focus()}}}function Silhoutte(a){var b=$("#"+a);FadeToSilhoutte(b)}function FadeToSilhoutte(c){var b=false;if(c.attr("fill")=="white"||c.attr("fill")=="#FFF"||c.attr("fill")=="#FFFFFF"||c.attr("fill")=="#FFFFFC"){b=true}if(c.attr("fill")=="none"){b=true}if(b==false){if(c.attr("fill")=="white"){c.attr("stroke","black")}c.attr("fill","black")}for(var a=0;a<c.children().length;a++){FadeToSilhoutte($(c.children()[a]))}}function AddExtraLayoutCells(b,a){if(b){if(StoryboardContainer.MaxRows==10){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("warning-limit-rows"),type:"info",confirmButtonText:MyLangMap.GetText("warning-ok-button")});return}StoryboardContainer.MaxRows++}if(a){if(StoryboardContainer.MaxCols==10){swalQueue({title:"",text:MyLangMap.GetTextLineBreaks("warning-limit-cols"),type:"info",confirmButtonText:MyLangMap.GetText("warning-ok-button")});return}StoryboardContainer.MaxCols++}UpdateChangeCellCountSelector()}function UpdateChangeCellCountSelector(){var c=$("#LayoutButtonHolder");var f=parseInt(MyPointers.Dialog_ChangeLayout.attr("rows"));var e=parseInt(MyPointers.Dialog_ChangeLayout.attr("cols"));StoryboardContainer.MaxRows=Math.max(StoryboardContainer.MaxRows,StoryboardContainer.Rows);StoryboardContainer.MaxCols=Math.max(StoryboardContainer.MaxCols,StoryboardContainer.Cols);c.css("width",(StoryboardContainer.MaxCols*60)+"px");c.children().remove();for(var d=1;d<=StoryboardContainer.MaxRows;d++){for(var a=1;a<=StoryboardContainer.MaxCols;a++){var b="ChangeLayoutButton ";if(d<=StoryboardContainer.Rows&&a<=StoryboardContainer.Cols){b+="used "}if(d<=f&&a<=e){b+=" added"}c.append("<a id='changelayoutcell_"+d+""+a+"' class='"+b+"' onclick='ConfigureStoryboardCells("+d+","+a+")'>"+a+" x "+d+"</a> ")}c.append("<br>")}}function PrepareChangeLayoutDialog(){try{UpdateChangeCellCountSelector();$("#change-cell-count-too-many").hide();$("#change-cell-lose-content").hide();var b,c;MyPointers.Dialog_ChangeLayout.find("a.ChangeLayoutButton").removeClass("used added");for(b=0;b<StoryboardContainer.Rows;b++){for(c=0;c<StoryboardContainer.Cols;c++){$("#changelayoutcell_"+(b+1)+(c+1)).addClass("used added")}}MyPointers.Dialog_ChangeLayout.attr("rows",StoryboardContainer.Rows.toString()).attr("cols",StoryboardContainer.Cols.toString())}catch(a){LogErrorMessage("SvgManip.PrepareChangeLayoutDialog",a)}}function ConfigureStoryboardCells(g,a){try{var d,f;MyPointers.Dialog_ChangeLayout.attr("rows",g.toString()).attr("cols",a.toString());MyPointers.Dialog_ChangeLayout.find("a.ChangeLayoutButton").removeClass("added");for(d=0;d<g;d++){for(f=0;f<a;f++){$("#changelayoutcell_"+(d+1)+(f+1)).addClass("added")}}var b=MyPointers.Dialog_ChangeLayout.find("a.ChangeLayoutButton.used:not(.added)").length;$("#change-cell-count-too-many-message").text(b+" ");$("#change-cell-lose-content").hide();if(b>0){$("#change-cell-lose-content").show()}$("#change-cell-count-too-many").hide();if(g*a>24){$("#change-cell-count-too-many").show()}}catch(c){LogErrorMessage("SvgManip.ConfigureStoryboardCells",c)}}function CancelChangeLayout(){MyPointers.Dialog_ChangeLayout.modal("hide")}function ConfirmChangeLayout(){try{var c=parseInt(MyPointers.Dialog_ChangeLayout.attr("rows"));var a=parseInt(MyPointers.Dialog_ChangeLayout.attr("cols"));MyPointers.Dialog_ChangeLayout.modal("hide");if((c===StoryboardContainer.Rows)&&(a===StoryboardContainer.Cols)){return}CheckForLayoutAccessPreRefresh(c,a,true)}catch(b){LogErrorMessage("SvgManip.ConfirmChangeLayout",b)}}function ChangeLayoutPostAccessCheck(c,a){try{if((c<StoryboardContainer.Rows||a<StoryboardContainer.Cols)&&StoryboardContainer.Public_FindOutOfBoundContent(c,a).length>0){if(confirm(MyLangMap.GetText("warning-shrinking-storyboard"))==false){return}}StoryboardContainer.CreateRowsAndCells(c,a);StoryboardContainer.UpdateImageAttributions();if(HasGridLines()){AddGridLines()}}catch(b){LogErrorMessage("SvgManip.ChangeLayoutPostAccessCheck",b)}}function CheckForLayoutAccessPreRefresh(d,a,c){try{if(StoryboardContainer.IsFreeLayoutConfiguration(d,a)){ChangeLayoutPostAccessCheck(d,a);return}if(MyUserPermissions.EnableAllCellOptions){ChangeLayoutPostAccessCheck(d,a);return}MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForLayoutAccessPostRefresh(d,a,c)})}catch(b){LogErrorMessage("SvgManip.CheckForLayoutAccessOnLayoutChange",b)}}function CheckForLayoutAccessPostRefresh(d,a,c){try{if(MyUserPermissions.EnableAllCellOptions){ChangeLayoutPostAccessCheck(d,a);return}if(MyUserPermissions.IsLoggedOn==false){if(c){HandleLoginCloseFunction=function(){CheckForLayoutAccessPreRefresh(d,a,false)};showLogonDialog();return}}MyPointers.Dialog_PurchasePopForMoreLayouts.modal()}catch(b){LogErrorMessage("SvgManip.CheckForUploadAccessPostRefresh",b)}}function CheckForLayoutAccessOnStoryboardCopy(d,a,c){try{if(StoryboardContainer.IsFreeLayoutConfiguration(d,a)){return}if(MyUserPermissions.EnableAllCellOptions){return}MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForLayoutAccessOnCopyPostRefresh(d,a,c)})}catch(b){LogErrorMessage("SvgManip.CheckForLayoutAccessOnStoryboardCopy",b)}}function CheckForLayoutAccessOnCopyPostRefresh(d,a,c){try{if(MyUserPermissions.EnableAllCellOptions){ChangeLayoutPostAccessCheck(d,a);return}if(MyUserPermissions.IsLoggedOn==false){if(c){HandleLoginCloseFunction=function(){CheckForLayoutAccessOnStoryboardCopy(d,a,false)};showLogonDialog();return}}MyPointers.Dialog_PurchasePopForMoreLayoutsOnCopy.modal()}catch(b){LogErrorMessage("SvgManip.CheckForLayoutAccessOnCopyPostRefresh",b)}}function ChangeCellLayoutType(d,c,b){try{if(d==null){d=StoryboardContainer.GetLayoutType()}if(d==StoryboardLayoutType.StoryboardGrid||MyUserPermissions.EnableAllCellOptions){ChangeCellLayoutTypePostCheck(d,c,b);return}CheckForChangeCellLayoutTypePreRefresh(d,c,b,true)}catch(a){LogErrorMessage("SvgManip.ChangeCellLayoutType",a)}}function CheckForChangeCellLayoutTypePreRefresh(d,c,b,f){try{MyUserPermissions.Public_RefreshPermissions(false,function(){CheckForChangeCellLayoutTypePostRefresh(d,c,b,f)})}catch(a){LogErrorMessage("SvgManip.CheckForChangeCellLayoutTypePreRefresh",a)}}function CheckForChangeCellLayoutTypePostRefresh(d,c,b,f){try{if(MyUserPermissions.EnableAllCellOptions){ChangeCellLayoutTypePostCheck(d,c,b);return}if(MyUserPermissions.IsLoggedOn==false){if(f){HandleLoginCloseFunction=function(){CheckForChangeCellLayoutTypePreRefresh(d,c,b,false)};showLogonDialog();return}}MyPointers.Dialog_PurchasePopForMoreStoryboardLayouts.modal()}catch(a){LogErrorMessage("SvgManip.CheckForUploadAccessPostRefresh",a)}}function ChangeCellLayoutTypePostCheck(e,b,a){StoryboardContainer.SetCoreSvgDimensions();var f=null;var d=CellConfiguration.HasTitle;var c=CellConfiguration.HasDescription;var h=StoryboardContainer.GetLayoutType();e=e||h;b=(b!=null)?b:d;a=(a!=null)?a:c;var j=CellConfiguration.GetScale();if(VerifyChangeCellLayout(e,h)==false){return}if(e==StoryboardLayoutType.Frayer&&(CellConfiguration.LayoutType==StoryboardLayoutType.Spider||CellConfiguration.LayoutType==StoryboardLayoutType.Cycle)){var k=MyLayoutFactory.GetLayout(StoryboardLayoutType.StoryboardGrid,b,a,j,f);SwapCellConfigurations(k);if(VerifyChangeCellLayout(e)==false){return}}$("#addcell-btn").html('<span style="background:none" aria-hidden="true" class="icon isbt-addcell"></span> '+MyLangMap.GetText("button-add-cells"));$("#addcell-btn").prop("disabled",false);if(e==StoryboardLayoutType.Frayer){ChangeLayoutToFrayerPreSetup()}if(e==StoryboardLayoutType.Timeline){j=ChangeLayoutToTimelinePreSetup(j);f=new Object();f.TimelineDates=TimelineDateManager.GetSelectedDates(StoryboardContainer.Cols)}if(e==StoryboardLayoutType.Spider||e==StoryboardLayoutType.Cycle){j=ChangeLayoutToSpiderPreSetup(j)}var g=MyLayoutFactory.GetLayout(e,b,a,j,f);SwapCellConfigurations(g);if(HasGridLines()){AddGridLines()}MyPointers.Dialog_StoryboardType.modal("hide");if(e==StoryboardLayoutType.Timeline&&h!=StoryboardLayoutType.Timeline){ChangeLayoutDialog()}if(e==StoryboardLayoutType.Movie&&h!=StoryboardLayoutType.Movie){SwapSceneCategory(true)}if(h==StoryboardLayoutType.Movie&&e!=StoryboardLayoutType.Movie){SwapSceneCategory(false)}if(e===StoryboardLayoutType.PortraitPaper||e===StoryboardLayoutType.LandscapePaper||e===StoryboardLayoutType.PortraitLegal||e===StoryboardLayoutType.LandscapeLegal||e===StoryboardLayoutType.PortraitTabloid||e===StoryboardLayoutType.LandscapeTabloid){ShowBothSceneCategories()}UndoManager.register(undefined,ChangeCellLayoutType,[h,d,c],undefined,"",ChangeCellLayoutType,[e,b,a])}function SwapCellConfigurations(a){StoryboardContainer.ChangeCellConfiguration_MoveShapes(CellConfiguration,a);CellConfiguration=a;StoryboardContainer.ChangeCellCellLayout();StoryboardContainer.SetLayoutType();StoryboardContainer.UpdateImageAttributions()}function ChangeLayoutToFrayerPreSetup(){StoryboardContainer.CreateRowsAndCells(2,2);$("#addcell-btn").prop("disabled",true)}function ChangeLayoutToTimelinePreSetup(a){a=ChangeLayoutFlattenAndShrink(a);$("#addcell-btn").html('<i class="icon isbt-addcell"></i> '+MyLangMap.GetText("button-timeline-dates"));return a}function ChangeLayoutToSpiderPreSetup(a){return ChangeLayoutFlattenAndShrink(a)}function SwapSceneCategory(e){var c=$("#parent-category-14");var d=$("#parent-category-a-14");var a=$("#parent-category-96");var b=$("#parent-category-a-96");if(e){b.trigger("click");c.hide();a.show()}else{d.trigger("click");c.show();a.hide()}}function ShowBothSceneCategories(){var b=$("#parent-category-14");var a=$("#parent-category-96");b.show();a.show()}function ChangeLayoutFlattenAndShrink(e){if(e==1){e=316/372;ExpandCells(e,e,false)}if(StoryboardContainer.Rows>1){var c=StoryboardContainer.Cols;var f=Math.min(10,StoryboardContainer.Rows*StoryboardContainer.Cols);StoryboardContainer.CreateRowsAndCells(StoryboardContainer.Rows,f);var b=[];for(var d=1;d<StoryboardContainer.Rows;d++){for(var a=0;a<c;a++){b.push({oldCol:a,oldRow:d,newCol:(d*c)+a,newRow:0})}}MoveCellHelper.RearrangeCells(b);StoryboardContainer.CreateRowsAndCells(1,f)}if(StoryboardContainer.Cols<3){StoryboardContainer.CreateRowsAndCells(1,3)}return e}function VerifyChangeCellLayout(a,b){if(a==StoryboardLayoutType.Frayer){if(StoryboardContainer.Public_FindOutOfBoundContent(2,2).length>0){return confirm("Changing to a Frayer Model will make your storyboard 2x2.\r\n\r\nYou will lose all content outside of the window.  Are you sure you want to change layout type?")}}if(a==StoryboardLayoutType.Spider){if(StoryboardContainer.Rows*StoryboardContainer.Cols>10){return confirm("Changing to a Spider Map will remove cells in excess of 10.  Are you sure you want to do this?")}}if(a==StoryboardLayoutType.Cycle){if(StoryboardContainer.Rows*StoryboardContainer.Cols>10){return confirm("Changing to a Cycle will remove cells in excess of 10.  Are you sure you want to do this?")}}if(a==StoryboardLayoutType.Timeline){if(StoryboardContainer.Rows*StoryboardContainer.Cols>10){return confirm("Changing to a Timeline remove cells in excess of 10.  Are you sure you want to do this?")}}if(b==StoryboardLayoutType.Movie&&a!=b){return confirm("Changing from a 16x9 layout may cause items to be out of the cell.  Are you sure you want to do this?")}return true}function ChangeCellCountForSpider(a,b){if(a<StoryboardContainer.Cols){if(confirm("Reducing the amount of cells in a Spider Map may result in losing content.  There is no undo.\r\nAre you sure you want to remove cells?")==false){return}}var c=MyLayoutFactory.GetLayout(StoryboardLayoutType.StoryboardGrid,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(c);StoryboardContainer.CreateRowsAndCells(1,a);var c=MyLayoutFactory.GetLayout(StoryboardLayoutType.Spider,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(c);CloseBasicDialog("ChangeCellCountSpider")}function ChangeCellCountForCycle(a){if(a<StoryboardContainer.Cols){if(confirm("Reducing the amount of cells in a Cycle Map may result in losing content.  There is no undo.\r\nAre you sure you want to remove cells?")==false){return}}var b=MyLayoutFactory.GetLayout(StoryboardLayoutType.StoryboardGrid,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(b);StoryboardContainer.CreateRowsAndCells(1,a);var b=MyLayoutFactory.GetLayout(StoryboardLayoutType.Cycle,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),null);SwapCellConfigurations(b);CloseBasicDialog("ChangeCellCountCycle")}function ChangeDatesForTimeline(){if(TimelineDateManager.Cols<StoryboardContainer.Cols){if(confirm("Reducing the amount of cells in a Timeline may result in losing content.  There is no undo.\r\nAre you sure you want to remove cells?")==false){return}}StoryboardContainer.Cols=TimelineDateManager.Cols;var a=new Object();a.TimelineDates=a.TimelineDates=TimelineDateManager.GetSelectedDates(StoryboardContainer.Cols);var b=MyLayoutFactory.GetLayout(StoryboardLayoutType.Timeline,CellConfiguration.HasTitle,CellConfiguration.HasDescription,CellConfiguration.GetScale(),a);SwapCellConfigurations(b);CloseBasicDialog("ChangeCellCountTimeline")}function HideKeyboard(){$("#textableText").toggle();$("#expandKeyboard").toggle();$("#collapseKeyboard").toggle()}function CloseModal(b){try{if(b.hasClass("in")){b.modal("toggle")}}catch(a){LogErrorMessage("SvgManip.CloseModal",a)}}function ClearSelections(){try{if(window.getSelection){if(window.getSelection().empty){window.getSelection().empty()}else{if(window.getSelection().removeAllRanges){window.getSelection().removeAllRanges()}}}else{if(document.selection){document.selection.empty()}}}catch(a){LogErrorMessage("SvgManip.ClearSelections",a)}}function ShowDimensions(){var c=$("#storyboard-container-outer-div");var g=MyPointers.Tabs.width();var f=window.innerHeight-(MyPointers.Tabs.outerHeight()+MyPointers.BottomControls.outerHeight());var a=GetGlobalById("CoreSvg").getBoundingClientRect();var e=(a.width-2);var d=(a.height-2);var b="Window width: "+g+"\r\n";b+="Window height: "+f+"\r\n";b+="\r\n";b+="Wrapper Width: "+c.width()+"\r\n";b+="Wrapper Height: "+c.height()+"\r\n";b+="\r\n";b+="svgContainer width: "+MyPointers.SvgContainer.width()+"\r\n";b+="svgContainer height: "+MyPointers.SvgContainer.height()+"\r\n";b+="\r\n";b+="svg Width: "+e+"\r\n";b+="svg Height: "+d+"\r\n";b+="\r\n";b+="svg Margin: "+MyPointers.CoreSvg.css("margin")+"\r\n";b+="svg Overflow: "+MyPointers.CoreSvg.css("overflow")+"\r\n";alert(b)};function IdGenerator(){this.GenerateDescriptionCellId=function(b,a){return"c_descr_R"+b+"C"+a};this.GenerateTitleCellId=function(b,a){return"c_title_R"+b+"C"+a};this.GenerateCellId=function(b,a){return"cell_R"+b+"C"+a};this.GenerateStoryboardTitleId=function(b,a){return"c_storyboardTitle_"+b+"_"+a};this.GenerateAttibutionAreaId=function(){return"c_attribution_area"};this.GenerateCellOverlayId=function(c,a,b){return"cell-overlay-r"+c+"c"+a+"p"+b}};window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction;window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange;var localDB;$(function(){localDB={db:null,initialized:null,isSupported:function(){if(this.initialized==null){try{this.init()}catch(a){}}return window.indexedDB&&this.initialized},init:function(){if(this.initialized===null){this.initialized=true;try{if(window.indexedDB){try{this.getDatabase()}catch(a){this.clearDatabase();this.getDatabase()}return}initialized=false}catch(a){initialized=false;LogErrorMessage("Failed to init local db",a)}}},getDatabase:function(b){b=b||function(){};try{if(this.isSupported()){var f=this;var d="StoryboardDB";var g=1;var c=window.indexedDB.open(d,g);c.onerror=function(e){b(null)};c.onsuccess=function(e){f.db=c.result;b(f.db)};c.onupgradeneeded=function(h){var e=h.target.result;if(h.oldVersion<1){e.createObjectStore("Storyboard",{keyPath:"userId"})}};c.onerror=function(e){b(null)};c.onblocked=function(e){b(null)}}else{b(null)}}catch(a){LogErrorMessage("LocalDbHelper.getDatabase",a);b(null)}},clearDatabase:function(b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(c){var d=c.deleteObjectStore("Storyboard");d.onsuccess=function(e){b(true)};d.onfailure=function(e){b(false)};d.onerror=function(e){b(false)}})}else{b(false)}}catch(a){LogErrorMessage("LocalDbHelper.clearDatabase",a);b(false)}},Save:function(f,d,a,c){c=c||function(){};try{if(this.isSupported()){this.getDatabase(function(e){var g=e.transaction(["Storyboard"],"readwrite").objectStore("Storyboard").put({userId:f,storyboard_name:d,content:a,});g.onsuccess=function(h){c(true)};g.onfailure=function(h){c(false)};g.onerror=function(h){c(false)}})}else{c(false)}}catch(b){LogErrorMessage("LocalDbHelper.Save",b);c(false)}},CheckUser:function(c,b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(d){var e=d.transaction(["Storyboard"]).objectStore("Storyboard").get(c);e.onsuccess=function(f){if(f.target.result===void 0){b(false,null)}else{b(true,f.target.result.storyboard_name)}};e.onfailure=function(f){b(false,null)};e.onerror=function(f){b(false,null)}})}else{b(false,null)}}catch(a){LogErrorMessage("LocalDbHelper.CheckUser",a);b(false,null)}},Load:function(c,b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(d){var e=d.transaction(["Storyboard"]).objectStore("Storyboard").get(c);e.onsuccess=function(f){(f.target.result===void 0)?b(null):b(f.target.result.content)};e.onfailure=function(f){b(null)};e.onerror=function(f){b(null)}})}else{b(null)}}catch(a){LogErrorMessage("LocalDbHelper.Load",a);b(null)}},Delete:function(c,b){b=b||function(){};try{if(this.isSupported()){this.getDatabase(function(d){var e=d.transaction(["Storyboard"],"readwrite").objectStore("Storyboard")["delete"](c);e.onsuccess=function(f){b(true)};e.onfailure=function(f){b(false)};e.onerror=function(f){b(false)}})}else{b(false)}}catch(a){LogErrorMessage("LocalDbHelper.Delete",a);b(false)}}};localDB.init()});self.addEventListener("message",function(b){var a=b.data;switch(a.cmd){case"Save":localDB.Save(a.userId,a.storyboard_name,a.content);self.postMessage({cmd:"Save"});break;case"Load":localDB.Load(function(e,d,c){self.postMessage({cmd:"Load",userId:e,storyboard_name:d,content:c})});break;default:}},false);var CropHelper=function(){var f=new Object();var r=new Object();r.CropType=CropTypeEnum.Standard;r.CroppedImageCopyId="CroppedImageCopy";r.OriginalShapeId="";r.CropLeft=0;r.CropTop=0;r.CropHeight=0;r.CropWidth=0;r.CropRatio=1;r.CropViewScale;r.ClipScale;r.ImageWidth=0;r.ImageHeight=0;r.CropAction="";r.ResizePageX=0;r.ResizePageY=0;r.CropResizeDirection="";r.CircleSizeRatio=1;r.move_delta={x:0,y:0};r.rotate_center={x:0,y:0};r.rotate_alpha=0;r.scale={x:1,y:1};r.CellPosition={};r.CropPolygonPoint=[{x:0,x:0},{x:150,y:0},{x:150,y:100},{x:0,y:100}];r.CropPolygonPointSelectedID="";r.EllipseCX=75;r.EllipseCY=50;r.EllipseRX=75;r.EllipseRY=50;function x(){r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY}function o(z){return function(A){CropHelper.PrepareShapePostModal(z)}}function s(z){StoryboardContainer.UpdateGradientIds(z);z.attr("id",r.CroppedImageCopyId);z.attr("class","");z.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();z.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",r.CroppedImageCopyId+SvgPartsEnum.CropGroup);var A=z.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",r.CroppedImageCopyId+SvgPartsEnum.Scale);z.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",r.CroppedImageCopyId+SvgPartsEnum.Natural)}function j(z){var C=z.UseClipping;z.UseClipping=false;var B=z.Public_GetImaginaryOuterBox();z.UseClipping=C;var A=f.GetMoveVectorForRotatedObject(z);return{W:B.Right-B.Left,H:B.Bottom-B.Top,X:B.Left-A.x,Y:B.Top-A.y}}f.PrepareShapePostModal=function(A){var F=$("#CropAreaSvg");var E=$("#"+A.Id).clone();StoryboardContainer.UpdateGradientIds(E);r.CropAction="";r.OriginalShapeId=A.Id;s(E);F.children().remove();var G=j(A);var O=StoryboardContainer.GetAllLayoutParts(CellConfiguration);r.CellPosition=StoryboardContainer._GetLayoutPartForShape(O,A);var V=r.CellPosition?StoryboardContainer.GetShapeStatesForCell(r.CellPosition.Row,r.CellPosition.Col):null;var C=A.Public_GetImaginaryOuterBox();var D=GetGlobalById(A.Id).getBBox();r.FlipHorizontal=A.FlipHorizontal;r.FlipVertical=A.FlipVertical;r.move_delta={x:A.X,y:A.Y};r.rotate_center={x:D.width/2,y:D.height/2};r.rotate_alpha=A.Angle;r.scale={x:A.ScaleX,y:A.ScaleY};if(V){for(var N=0;N<V[StoryboardPartTypeEnum.StoryboardCell].length;N++){var z=V[StoryboardPartTypeEnum.StoryboardCell][N];if(z.Id!=A.Id){var W=$("#"+z.Id).clone();W.attr("opacity","0.4");F.append(W)}}}F.append(E);var P=GetGlobalById(r.CroppedImageCopyId+SvgPartsEnum.Scale).getBBox();r.ImageWidth=P.width;r.ImageHeight=P.height;r.CropViewScale=1;r.CropLeft=0;r.CropTop=0;r.CropWidth=P.width;r.CropHeight=P.height;r.CropRatio=r.CropHeight/r.CropWidth;r.CropPolygonPoint=[{x:0,y:0},{x:0,y:P.height},{x:P.width,y:P.height},{x:P.width,y:0}];r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY;if(A.UseClipping&&A.CropType==r.CropType){switch(A.CropType){case CropTypeEnum.Circle:case CropTypeEnum.Standard:r.CropLeft=A.ClipX;r.CropTop=A.ClipY;r.CropWidth=A.ClipWidth;r.CropHeight=A.ClipHeight;if(A.CropType==CropTypeEnum.Circle){x()}break;case CropTypeEnum.Advanced:if(A.CropPolygonPoint){for(N=0;N<A.CropPolygonPoint.length;N++){r.CropPolygonPoint[N]={x:A.CropPolygonPoint[N].x,y:A.CropPolygonPoint[N].y}}}break}}var L=G.X-10;var M=G.Y-10;var K=G.W+20;var H=G.H+20;document.getElementById("CropAreaSvg").setAttribute("viewBox",L+" "+M+" "+K+" "+H);var J=Math.round($(window).width()*8/10);var I=Math.round($(window).height()*8/10)-130;var Q=J>I?I:J;var S=Q,R=Q;if(r.CropType==CropTypeEnum.Standard){if(K<H){S=Q*K/H}else{R=Q*H/K}}$("#CropModalDialog").css("width",Math.max(S+50,350));$("#CropModalDialog").css("height",R);$("#CropModalDialog").css("min-width",550);$(".crop-window-wrapper").css("width",S);$(".crop-window-wrapper").css("height",R);var X=20;F.attr("width",S-X);F.attr("height",R-X);var U=F.attr("width")/K;var T=F.attr("height")/H;F.mousemove(k());F.mouseleave(v());F.mouseup(v());F.mousedown(t());F.css("cursor","hand");r.CropViewScale=U<T?U:T;r.CircleSizeRatio=A.ScaleX<A.ScaleY?1/A.ScaleX:1/A.ScaleY;r.CircleSizeRatio/=r.CropViewScale;d()};function d(){var z=$("#croppedImageCopy_ClipArea");if(z!==null||z.length>0){z.detach()}z=SvgCreator.CreateSvgGroup("croppedImageCopy_ClipArea");$("#"+r.CroppedImageCopyId+SvgPartsEnum.Scale).append(z);switch(r.CropType){case CropTypeEnum.Standard:z.appendChild(SvgCreator.AddRect(r.CropLeft,r.CropTop,r.CropWidth,r.CropHeight,"black","red","4,4",".25","CropAreaBox"));break;case CropTypeEnum.Advanced:z.appendChild(SvgCreator.AddPolygon(r.CropPolygonPoint,"black","red","4,4","1",".25","CropAreaBoxAdvanced",null));break;case CropTypeEnum.Circle:z.appendChild(SvgCreator.AddEllipse(r.EllipseCX,r.EllipseCY,r.EllipseRX,r.EllipseRY,"black","red","4,4",".25","CropAreaEllipse"));z.appendChild(SvgCreator.AddRect(r.CropLeft,r.CropTop,r.CropWidth,r.CropHeight,"black","red","4,4",".25","CropAreaBox"));break}if(MyBrowserProperties.IsMobile){c(z)}else{b(z)}}function c(E){var B=$("#CropAreaBox");var K="#AAA393";var D="#6285C7";if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){var B=$("#CropAreaBox");B.css("border-width",5);var G=r.CropLeft;var J=r.CropWidth+r.CropLeft;var L=r.CropTop;var A=r.CropHeight+r.CropTop;E.appendChild(SvgCreator.AddCircle(G,L,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"ResizeNW"));E.appendChild(SvgCreator.AddCircle(J,L,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"ResizeNE"));E.appendChild(SvgCreator.AddCircle(G,A,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"ResizeNE"));E.appendChild(SvgCreator.AddCircle(J,A,circleSize,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"ResizeNW"));var z=D;D=K;K=z;var H=(G+J)/2;var I=(L+A)/2;E.appendChild(SvgCreator.AddCircle(H,L,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_N,"ResizeV"));E.appendChild(SvgCreator.AddCircle(H,A,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_S,"ResizeV"));E.appendChild(SvgCreator.AddCircle(G,I,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_W,"ResizeH"));E.appendChild(SvgCreator.AddCircle(J,I,circleSize-2,K,D,r.CroppedImageCopyId+SvgPartsEnum.Selector_E,"ResizeH"));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_N,m(ResizeEnum.N));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_S,m(ResizeEnum.S));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_E,m(ResizeEnum.E));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_W,m(ResizeEnum.W));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,m(ResizeEnum.NE));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,m(ResizeEnum.NW));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,m(ResizeEnum.SE));q(r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,m(ResizeEnum.SW));q("CropAreaBox",l())}if(r.CropType==CropTypeEnum.Advanced){var F;var z=D;D=K;K=z;var C=$("#CropAreaBoxAdvanced");C.css("border-width",5);for(F=0;F<r.CropPolygonPoint.length;F++){E.appendChild(SvgCreator.AddCircle(r.CropPolygonPoint[F].x,r.CropPolygonPoint[F].y,circleSize,K,D,r.CroppedImageCopyId+"_advan_circle"+F,"MoveObject"));q(r.CroppedImageCopyId+"_advan_circle"+F,m(ResizeEnum.NSEW,F))}q("CropAreaBoxAdvanced",l())}}function q(z,A){$("#"+z).bind("touchy-drag",A)}function g(B,z){var A="";switch(B){case ResizeEnum.NE:z+=45;z%=360;break;case ResizeEnum.SW:z+=225;z%=360;break;case ResizeEnum.SE:z+=135;z%=360;break;case ResizeEnum.NW:z+=315;z%=360;break;case ResizeEnum.W:z+=270;z%=360;break;case ResizeEnum.N:z%=360;break;case ResizeEnum.S:z+=180;z%=360;break;case ResizeEnum.E:z+=90;z%=360;break}if(Math.abs(z-90)<EPS_ANGLE||Math.abs(z-270)<EPS_ANGLE){return"H"}if(Math.abs(z)<EPS_ANGLE||Math.abs(z-180)<EPS_ANGLE){return"V"}A="NE";if(z>=90&&z<180){A="NW"}else{if(z>=180&&z<270){A="NE"}else{if(z>=270){A="NW"}}}return A}function b(D){var B=5*r.CircleSizeRatio;var J="#AAA393";var C="#6285C7";if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){var F=r.CropLeft;var I=r.CropWidth+r.CropLeft;var K=r.CropTop;var A=r.CropHeight+r.CropTop;D.appendChild(SvgCreator.AddCircle(F,K,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,"Resize".concat(g(ResizeEnum.NW,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(I,K,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,"Resize".concat(g(ResizeEnum.NE,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(F,A,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,"Resize".concat(g(ResizeEnum.SW,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(I,A,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,"Resize".concat(g(ResizeEnum.SE,r.rotate_alpha))));var z=C;C=J;J=z;var G=(F+I)/2;var H=(K+A)/2;D.appendChild(SvgCreator.AddCircle(G,K,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_N,"Resize".concat(g(ResizeEnum.N,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(G,A,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_S,"Resize".concat(g(ResizeEnum.S,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(F,H,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_W,"Resize".concat(g(ResizeEnum.W,r.rotate_alpha))));D.appendChild(SvgCreator.AddCircle(I,H,B,J,C,r.CroppedImageCopyId+SvgPartsEnum.Selector_E,"Resize".concat(g(ResizeEnum.E,r.rotate_alpha))));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_N,u(ResizeEnum.N));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_S,u(ResizeEnum.S));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_E,u(ResizeEnum.E));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_W,u(ResizeEnum.W));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_NE,u(ResizeEnum.NE));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_NW,u(ResizeEnum.NW));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_SE,u(ResizeEnum.SE));p(r.CroppedImageCopyId+SvgPartsEnum.Selector_SW,u(ResizeEnum.SW))}if(r.CropType==CropTypeEnum.Advanced){var E;for(E=0;E<r.CropPolygonPoint.length;E++){D.appendChild(SvgCreator.AddCircle(r.CropPolygonPoint[E].x,r.CropPolygonPoint[E].y,B,J,C,r.CroppedImageCopyId+"_advan_circle"+E,"MoveObject"));p(r.CroppedImageCopyId+"_advan_circle"+E,u(ResizeEnum.NSEW,E))}}}function p(z,A){$("#"+z).mousedown(A)}function y(){if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){var A=$("#CropAreaBox");var K=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_NW);var J=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_NE);var O=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_SW);var N=$("#"+r.CroppedImageCopyId+SvgPartsEnum.Selector_SE);var I=$("#"+r.CroppedImageCopyId+"_n_circle ");var M=$("#"+r.CroppedImageCopyId+"_s_circle ");var Q=$("#"+r.CroppedImageCopyId+"_w_circle ");var E=$("#"+r.CroppedImageCopyId+"_e_circle ");var F=r.CropLeft;var L=r.CropWidth+r.CropLeft;var P=r.CropTop;var z=r.CropHeight+r.CropTop;var G=(F+L)/2;var H=(P+z)/2;SvgCreator.UpdateRectangle(A,r.CropLeft,r.CropTop,r.CropWidth,r.CropHeight);SvgCreator.UpdateCircle(K,F,P);SvgCreator.UpdateCircle(J,L,P);SvgCreator.UpdateCircle(O,F,z);SvgCreator.UpdateCircle(N,L,z);SvgCreator.UpdateCircle(I,G,P);SvgCreator.UpdateCircle(M,G,z);SvgCreator.UpdateCircle(Q,F,H);SvgCreator.UpdateCircle(E,L,H);if(r.CropType==CropTypeEnum.Circle){var C=$("#CropAreaEllipse");r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY;SvgCreator.UpdateEllipse(C,r.EllipseCX,r.EllipseCY,r.EllipseRX,r.EllipseRY)}}if(r.CropType==CropTypeEnum.Advanced){var B=$("#CropAreaBoxAdvanced");SvgCreator.UpdatePolygon(B,r.CropPolygonPoint);for(i=0;i<r.CropPolygonPoint.length;i++){var D=$("#"+r.CroppedImageCopyId+"_advan_circle"+i);SvgCreator.UpdateCircle(D,r.CropPolygonPoint[i].x,r.CropPolygonPoint[i].y)}}}function w(A,B){if(r.CropType==CropTypeEnum.Standard||r.CropType==CropTypeEnum.Circle){switch(r.CropResizeDirection){case ResizeEnum.W:case ResizeEnum.NW:case ResizeEnum.SW:r.CropLeft+=A;r.CropWidth-=A;break;case ResizeEnum.E:case ResizeEnum.NE:case ResizeEnum.SE:r.CropWidth+=A;break}switch(r.CropResizeDirection){case ResizeEnum.N:case ResizeEnum.NW:case ResizeEnum.NE:r.CropTop+=B;r.CropHeight-=B;break;case ResizeEnum.S:case ResizeEnum.SW:case ResizeEnum.SE:r.CropHeight+=B;break}if(r.CropType==CropTypeEnum.Circle){r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY}}if(r.CropType==CropTypeEnum.Advanced){if(r.CropPolygonPoint.length>=4){var z=(r.CropPolygonPointSelectedID+2)%4;a=r.CropPolygonPointSelectedID;if(Math.abs(r.CropPolygonPoint[a].x-r.CropPolygonPoint[z].x+A)+Math.abs(r.CropPolygonPoint[a].y-r.CropPolygonPoint[z].y+B)<30){return}}r.CropPolygonPoint[r.CropPolygonPointSelectedID].x+=A;r.CropPolygonPoint[r.CropPolygonPointSelectedID].y+=B}y()}function n(z,A){var B;switch(r.CropType){case CropTypeEnum.Standard:case CropTypeEnum.Circle:r.CropTop+=A;r.CropLeft+=z;if(r.CropType==CropTypeEnum.Standard){}if(r.CropType==CropTypeEnum.Circle){r.EllipseRX=r.CropWidth/2;r.EllipseRY=r.CropHeight/2;r.EllipseCX=r.CropLeft+r.EllipseRX;r.EllipseCY=r.CropTop+r.EllipseRY}break;case CropTypeEnum.Advanced:var E=9999;var F=9999;var C=0;var D=0;for(B=0;B<r.CropPolygonPoint.length;B++){E=Math.min(E,r.CropPolygonPoint[B].x);F=Math.min(F,r.CropPolygonPoint[B].y);C=Math.max(C,r.CropPolygonPoint[B].x);D=Math.max(D,r.CropPolygonPoint[B].y)}for(B=0;B<r.CropPolygonPoint.length;B++){r.CropPolygonPoint[B].x+=z;r.CropPolygonPoint[B].y+=A}break}y()}function m(A,z){return function(F,G,B,C){if(G!="move"){return}r.CropResizeDirection=A;r.CropPolygonPointSelectedID=z;if(r.CropResizeDirection==null||r.CropResizeDirection==undefined){return}var D=C.movePoint.x-C.lastMovePoint.x;var E=C.movePoint.y-C.lastMovePoint.y;w(D,E)}}function l(z){return function(E,F,A,B){if(F!="move"){return}var C=B.movePoint.x-B.lastMovePoint.x;var D=B.movePoint.y-B.lastMovePoint.y;n(C,D)}}function u(A,z){return function(B){var C={x:B.pageX/r.CropViewScale,y:B.pageY/r.CropViewScale};var D=e(C);r.CropAction="Resize";r.ResizePageX=D.x;r.ResizePageY=D.y;r.CropResizeDirection=A;r.CropPolygonPointSelectedID=z;B.stopPropagation()}}function t(){return function(z){r.CropAction="Move";var A={x:z.pageX/r.CropViewScale,y:z.pageY/r.CropViewScale};var B=e(A);r.ResizePageX=B.x;r.ResizePageY=B.y;z.stopPropagation()}}function k(){return function(z){if(r.CropAction==""){return}var A={x:z.pageX/r.CropViewScale,y:z.pageY/r.CropViewScale};var B=e(A);deltaX=B.x-r.ResizePageX;deltaY=B.y-r.ResizePageY;if(r.FlipHorizontal===true){deltaX*=-1}if(r.FlipVertical===true){deltaY*=-1}r.ResizePageX=B.x;r.ResizePageY=B.y;if(r.CropAction=="Resize"){w(deltaX,deltaY)}else{if(r.CropAction=="Move"){n(deltaX,deltaY)}}}}function v(){return function(){r.CropAction=""}}function h(){var z=MyShapesState.Public_GetFirstSelectedShapeState();if(z===null){z=MyShapesState.Public_GetShapeStateById(r.OriginalShapeId)}return z}f.ChangeCropMode=function(z,A){r.CropType=A;this.PrepareShapePostModal(z)};f.ShowCropDialog=function(z,B){MyPointers.Dialog_CropImage.one("shown.bs.modal",o(z));r.CropType=B;var A=$("#CropAreaSvg");A.children().remove();MyPointers.Dialog_CropImage.modal()};f.RemoveCrop=function(){var z=h();var A=z.X;var B=z.Y;f.UpdateRotatedObjectPosition(z,false);z.UseClipping=false;z.UpdateDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[z.Id,true,z.ClipX,z.ClipY,z.ClipWidth,z.ClipHeight,JSON.parse(JSON.stringify(z.CropPolygonPoint)),z.CropType,A,B],"",undefined,UndoCrop,[z.Id,z.UseClipping,z.ClipX,z.ClipY,z.ClipWidth,z.ClipHeight,JSON.parse(JSON.stringify(z.CropPolygonPoint)),z.CropType,z.X,z.Y],"")};f.CancelCrop=function(){MyPointers.Dialog_CropImage.modal("hide");var z=h();z.UpdateDrawing()};function e(A){var z={x:A.x-r.move_delta.x,y:A.y-r.move_delta.y};z={x:z.x-r.rotate_center.x,y:z.y-r.rotate_center.y};z={x:z.x*Math.cos(-r.rotate_alpha*Math.PI/180)-z.y*Math.sin(-r.rotate_alpha*Math.PI/180),y:z.x*Math.sin(-r.rotate_alpha*Math.PI/180)+z.y*Math.cos(-r.rotate_alpha*Math.PI/180)};z={x:z.x+r.rotate_center.x,y:z.y+r.rotate_center.y};z={x:z.x/r.scale.x,y:z.y/r.scale.y};return z}f.GetMoveVectorForRotatedObject=function(z){var E=z.GetPivotPoint(true);var F=z.GetPivotPoint();var A=z.Angle*Math.PI/180;var B=SbtMath.RotatePoint(E,A,F);var D=SbtMath.RotatePoint(B,-A,E);return{x:D.x-E.x,y:D.y-E.y}};f.UpdateRotatedObjectPosition=function(z,B){var A=f.GetMoveVectorForRotatedObject(z);if(B){z.X+=A.x;z.Y+=A.y}else{z.X-=A.x;z.Y-=A.y}};f.UpdateCrop=function(){if(MyBrowserProperties.IsMobile){$.touchyOptions.useDelegation=true}var z=h();var I=z.UseClipping;var H=z.CropType;var G=JSON.parse(JSON.stringify(z.CropPolygonPoint));var E=z.ClipX;var F=z.ClipY;var D=z.ClipWidth;var C=z.ClipHeight;var J=z.X;var K=z.Y;f.UpdateRotatedObjectPosition(z,false);z.UseClipping=true;z.CropType=r.CropType;var B;var A=z.GetBBox(false);switch(r.CropType){case CropTypeEnum.Standard:z.ClipX=Math.max(0,r.CropLeft);z.ClipY=Math.max(0,r.CropTop);z.ClipWidth=r.CropLeft+r.CropWidth>r.ImageWidth?r.ImageWidth-r.CropLeft:r.CropWidth;z.ClipHeight=r.CropTop+r.CropHeight>r.ImageHeight?r.ImageHeight-r.CropTop:r.CropHeight;break;case CropTypeEnum.Circle:z.ClipX=r.CropLeft;z.ClipY=r.CropTop;z.ClipWidth=r.CropWidth;z.ClipHeight=r.CropHeight;break;case CropTypeEnum.Advanced:z.ClipX=A.width;z.ClipY=A.height;z.ClipWidth=0;z.ClipHeight=0;for(B=0;B<r.CropPolygonPoint.length;B++){z.CropPolygonPoint[B].x=r.CropPolygonPoint[B].x;z.CropPolygonPoint[B].y=r.CropPolygonPoint[B].y}z.Public_update_ClipRegionByAdvancedCrop();break}z.CropPolygonPointJson=JSON.stringify(z.CropPolygonPoint);if(z.ClipWidth<10){z.ClipWidth=10}if(z.ClipHeight<10){z.ClipHeight=10}f.UpdateRotatedObjectPosition(z,true);UpdateActiveDrawing();UpdateActiveDrawing();MyPointers.Dialog_CropImage.modal("hide");UndoManager.register(undefined,UndoCrop,[z.Id,I,E,F,D,C,G,H,J,K],"",undefined,UndoCrop,[z.Id,z.UseClipping,z.ClipX,z.ClipY,z.ClipWidth,z.ClipHeight,JSON.parse(JSON.stringify(z.CropPolygonPoint)),z.CropType,z.X,z.Y],"")};return f}();$(window).resize(function(){if($("#CropArea").is(":visible")){var b=MyShapesState.Public_GetFirstSelectedShapeState();CropHelper.PrepareShapePostModal(b)}});var OpacitySliderOldValue=null;var OpacityHelper=function(){var d=new Object();d.initControls=function(){var e=$("#opacity-slider").slider({value:1,formater:function(f){return parseInt(f)+"%"}});$("#opacity-slider").on("slide",a);$("#opacity-slider").on("slideStart",b);$("#opacity-slider").on("slideStop",c);$("#opacity-slider").data("previousValue",1)};function b(){OpacitySliderOldValue=$("#opacity-slider").data("previousValue");a()}function a(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=$("#opacity-slider").slider("getValue");OpacityHelper.setOpacity(e,f);return f}function c(){var e=MyShapesState.Public_GetFirstSelectedShapeState();var f=a();UndoManager.register(undefined,OpacityHelper.setOpacity,[e,OpacitySliderOldValue],undefined,"",OpacityHelper.setOpacity,[e,f])}d.setOpacity=function(e,f){e.opacity=f/100;UpdateActiveDrawing()};d.setSliderValue=function(e){if($("#opacity-slider").length>0){$("#opacity-slider").slider("setValue",e);$("#opacity-slider").data("previousValue",e)}};return d}();var MultiTextableHelper=function(){var b=new Object();var e=new Object();e.MultiTextImageCopyId="MultiTextableImageCopy";e.OriginalShape;b.Props=e;var a=null;function c(f){e.OriginalShape=f;var p=$("#multiTextableSvg");var g=$("#"+f.Id).clone();StoryboardContainer.UpdateGradientIds(g);g.attr("id",e.MultiTextImageCopyId);g.attr("class","");g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").remove();g.find("[id^='"+e.OriginalShape.Id+"_text']").remove();g.find("[id$='"+SvgPartsEnum.CropGroup+"']").removeAttr("clip-path").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.CropGroup);var q=g.find("[id$='"+SvgPartsEnum.Scale+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Scale);g.find("[id$='"+SvgPartsEnum.Natural+"']").attr("id",e.MultiTextImageCopyId+SvgPartsEnum.Natural);p.children().remove();p.append(g);var h=GetGlobalById(e.MultiTextImageCopyId).getBBox();p.attr("width",h.width+24);p.attr("height",h.height+24);if(!a){a=new SvgState(e.MultiTextImageCopyId)}var m=f.TextState.D[f.TextState.CurrentId]._QuillDeltas;a.Id=e.MultiTextImageCopyId;a.NaturalOffsetX=f.NaturalOffsetX;a.NaturalOffsetY=f.NaturalOffsetY;a.X=12;a.Y=12;a.CopyShapeState(f);if(m==null){a.TextState.D[a.TextState.CurrentId]._QuillDeltas=null}a.virtualSelected=true;MyShapesState.Public_SetShapeState(a.Id,a);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SelectShape($("#"+e.MultiTextImageCopyId));HideControlsMenu();var o="",l;for(l=0;l<a.TextState.D.length;l++){var n=l+1;o+="<li>                    <a id='multitextable_textarea"+l+"' class='multitextable_textareacls' selid='"+l+"'>                        <span class='sprite-sbt sprite-sbt-Bring-Forward'>                        </span>                        <img height='16' width='16' src='/content/menu/blank.gif'>                        Text Area "+n+"                    </a>        </li>"}GetGlobalById("MultiTextable-menu-select-id").innerHTML=o;$(".multitextable_textareacls").click(function(){var u=this.getAttribute("selid")*1+1;var s;$("#MultiTextable-header-title").html("Text Area "+u);for(s=0;s<a.TextState.D.length;s++){var t=e.MultiTextImageCopyId+"_TextBoxArea"+s;if(u-1==s){$("#"+t).attr("style","stroke-dasharray:1,1; stroke: black; stroke-width: 0.5; ")}else{$("#"+t).attr("style","")}}a.TextState.CurrentId=this.getAttribute("selid");MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,150,140,a)});var k=(parseInt(a.TextState.CurrentId)+1);$("#MultiTextable-header-title").html("Text Area "+k);$("#textableControls").removeClass("ControlsBox");var r=$("#textableControls").detach();$("#MultiTextable-content").append(r);for(l=0;l<a.TextState.D.length;l++){g.find("#"+e.OriginalShape.Id+"_TextBoxArea"+l).attr("id",e.MultiTextImageCopyId+"_TextBoxArea"+l)}$("#"+e.MultiTextImageCopyId+"_TextBoxArea"+a.TextState.CurrentId).attr("style","stroke-dasharray:1,1; stroke: black; stroke-width: 0.5; ");a.UpdateDrawing(true);g.find("[id$='"+SvgPartsEnum.SelectionBox+"'], [id$='_defs']").hide();MainControls.TextControls.PrepTextControls(MyPointers.Controls_TextableControls,150,140,a);$("#MultiTextableModal").on("hidden.bs.modal",function(){MyShapesState.Public_RemoveShapeStateById(e.MultiTextImageCopyId)})}function d(f){return function(g){c(f)}}b.ShowMultipleDialog=function(f){MyPointers.Dialog_MultiTextable.one("shown.bs.modal",d(f));var g=$("#multiTextableSvg");g.children().remove();MyPointers.Dialog_MultiTextable.modal()};b.Cancel=function(){MyPointers.Dialog_MultiTextable.modal("hide")};b.Update=function(){e.OriginalShape.CopyTextState(a.TextState);e.OriginalShape.UpdateDrawing(true);MyPointers.Dialog_MultiTextable.modal("hide")};return b}();(function(a){function b(e){this.ok=false;if(e.charAt(0)=="#"){e=e.substr(1,6)}e=e.replace(/ /g,"");e=e.toLowerCase();var k={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var g in k){if(e==g){e=k[g]}}var d=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(i){return[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(i){return[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(i){return[parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16)]}}];for(var f=0;f<d.length;f++){var j=d[f].re;var h=d[f].process;var c=j.exec(e);if(c){channels=h(c);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var m=this.r.toString(16);var l=this.g.toString(16);var i=this.b.toString(16);if(m.length==1){m="0"+m}if(l.length==1){l="0"+l}if(i.length==1){i="0"+i}return"#"+m+l+i};this.getHelpXML=function(){var o=new Array();for(var p=0;p<d.length;p++){var m=d[p].example;for(var q=0;q<m.length;q++){o[o.length]=m[q]}}for(var u in k){o[o.length]=u}var v=document.createElement("ul");v.setAttribute("id","rgbcolor-examples");for(var p=0;p<o.length;p++){try{var s=document.createElement("li");var r=new b(o[p]);var n=document.createElement("div");n.style.cssText="margin: 3px; border: 1px solid black; background:"+r.toHex()+"; color:"+r.toHex();n.appendChild(document.createTextNode("test"));var t=document.createTextNode(" "+o[p]+" -> "+r.toRGB()+" -> "+r.toHex());s.appendChild(n);s.appendChild(t);v.appendChild(s)}catch(l){}}return v}}if(typeof define!=="undefined"&&define.amd){define(function(){return b})}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}}a.RGBColor=b}(typeof window!=="undefined"?window:this));(function(b,a){if(typeof define!=="undefined"&&define.amd){define("canvgModule",["rgbcolor","stackblur"],a)}else{if(typeof module!=="undefined"&&module.exports){module.exports=a(require("rgbcolor"),require("stackblur"))}}b.canvg=a(b.RGBColor,b.stackBlur)}(typeof window!=="undefined"?window:this,function(m,n){var c=function(y,u,t){if(y==null&&u==null&&t==null){var x=document.querySelectorAll("svg");for(var r=0;r<x.length;r++){var w=x[r];var o=document.createElement("canvas");o.width=w.clientWidth;o.height=w.clientHeight;w.parentNode.insertBefore(o,w);w.parentNode.removeChild(w);var q=document.createElement("div");q.appendChild(w);c(o,q.innerHTML)}return}if(typeof y=="string"){y=document.getElementById(y)}if(y.svg!=null){y.svg.stop()}var v=b(t||{});if(!(y.childNodes.length==1&&y.childNodes[0].nodeName=="OBJECT")){y.svg=v}var p=y.getContext("2d");if(typeof u.documentElement!="undefined"){v.loadXmlDoc(p,u)}else{if(u.substr(0,1)=="<"){v.loadXml(p,u)}else{v.load(p,u)}}};var h;if(typeof Element.prototype.matches!="undefined"){h=function(o,p){return o.matches(p)}}else{if(typeof Element.prototype.webkitMatchesSelector!="undefined"){h=function(o,p){return o.webkitMatchesSelector(p)}}else{if(typeof Element.prototype.mozMatchesSelector!="undefined"){h=function(o,p){return o.mozMatchesSelector(p)}}else{if(typeof Element.prototype.msMatchesSelector!="undefined"){h=function(o,p){return o.msMatchesSelector(p)}}else{if(typeof Element.prototype.oMatchesSelector!="undefined"){h=function(o,p){return o.oMatchesSelector(p)}}else{if(typeof jQuery==="function"||typeof Zepto==="function"){h=function(o,p){return $(o).is(p)}}if(typeof h==="undefined"){h=Sizzle.matchesSelector}}}}}}var a=/(\[[^\]]+\])/g;var g=/(#[^\s\+>~\.\[:]+)/g;var d=/(\.[^\s\+>~\.\[:]+)/g;var l=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi;var k=/(:[\w-]+\([^\)]*\))/gi;var j=/(:[^\s\+>~\.\[:]+)/g;var e=/([^\s\+>~\.\[:]+)/g;function f(p){var q=[0,0,0];var o=function(s,t){var r=p.match(s);if(r==null){return}q[t]+=r.length;p=p.replace(s," ")};p=p.replace(/:not\(([^\)]*)\)/g,"     $1 ");p=p.replace(/{[\s\S]*/gm," ");o(a,1);o(g,0);o(d,1);o(l,2);o(k,1);o(j,1);p=p.replace(/[\*\s\+>~]/g," ");p=p.replace(/[#\.]/g," ");o(e,2);return q.join("")}function b(o){var p={opts:o};p.FRAMERATE=30;p.MAX_VIRTUAL_PIXELS=30000;p.log=function(r){};if(p.opts.log==true&&typeof console!="undefined"){p.log=function(r){console.log(r)}}p.init=function(r){var s=0;p.UniqueId=function(){s++;return"canvg"+s};p.Definitions={};p.Styles={};p.StylesSpecificity={};p.Animations=[];p.Images=[];p.ctx=r;p.ViewPort=new (function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[]};this.SetCurrent=function(u,t){this.viewPorts.push({width:u,height:t})};this.RemoveCurrent=function(){this.viewPorts.pop()};this.Current=function(){return this.viewPorts[this.viewPorts.length-1]};this.width=function(){return this.Current().width};this.height=function(){return this.Current().height};this.ComputeSize=function(t){if(t!=null&&typeof t=="number"){return t}if(t=="x"){return this.width()}if(t=="y"){return this.height()}return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}})};p.init();p.ImagesLoaded=function(){for(var r=0;r<p.Images.length;r++){if(!p.Images[r].loaded){return false}}return true};p.trim=function(r){return r.replace(/^\s+|\s+$/g,"")};p.compressSpaces=function(r){return r.replace(/[\s\r\t\n]+/gm," ")};p.ajax=function(s){var r;if(window.XMLHttpRequest){r=new XMLHttpRequest()}else{r=new ActiveXObject("Microsoft.XMLHTTP")}if(r){r.open("GET",s,false);r.send(null);return r.responseText}return null};p.parseXml=function(u){if(typeof Windows!="undefined"&&typeof Windows.Data!="undefined"&&typeof Windows.Data.Xml!="undefined"){var v=new Windows.Data.Xml.Dom.XmlDocument();var t=new Windows.Data.Xml.Dom.XmlLoadSettings();t.prohibitDtd=false;v.loadXml(u,t);return v}else{if(window.DOMParser){try{var s=new DOMParser();return s.parseFromString(u,"image/svg+xml")}catch(r){s=new DOMParser();return s.parseFromString(u,"text/xml")}}else{u=u.replace(/<!DOCTYPE svg[^>]*>/,"");var v=new ActiveXObject("Microsoft.XMLDOM");v.async="false";v.loadXML(u);return v}}};p.Property=function(r,s){this.name=r;this.value=s};p.Property.prototype.getValue=function(){return this.value};p.Property.prototype.hasValue=function(){return(this.value!=null&&this.value!=="")};p.Property.prototype.numValue=function(){if(!this.hasValue()){return 0}var r=parseFloat(this.value);if((this.value+"").match(/%$/)){r=r/100}return r};p.Property.prototype.valueOrDefault=function(r){if(this.hasValue()){return this.value}return r};p.Property.prototype.numValueOrDefault=function(r){if(this.hasValue()){return this.numValue()}return r};p.Property.prototype.addOpacity=function(t){var s=this.value;if(t.value!=null&&t.value!=""&&typeof this.value=="string"){var r=new m(this.value);if(r.ok){s="rgba("+r.r+", "+r.g+", "+r.b+", "+t.numValue()+")"}}return new p.Property(this.name,s)};p.Property.prototype.getDefinition=function(){var r=this.value.match(/#([^\)'"]+)/);if(r){r=r[1]}if(!r){r=this.value}return p.Definitions[r]};p.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0};p.Property.prototype.getFillStyleDefinition=function(s,t){var r=this.getDefinition();if(r!=null&&r.createGradient){return r.createGradient(p.ctx,s,t)}if(r!=null&&r.createPattern){if(r.getHrefAttribute().hasValue()){var u=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition();if(u.hasValue()){r.attribute("patternTransform",true).value=u.value}}return r.createPattern(p.ctx,s)}return null};p.Property.prototype.getDPI=function(r){return 96};p.Property.prototype.getEM=function(t){var r=12;var s=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);if(s.hasValue()){r=s.toPixels(t)}return r};p.Property.prototype.getUnits=function(){var r=this.value+"";return r.replace(/[0-9\.\-]/g,"")};p.Property.prototype.toPixels=function(v,t){if(!this.hasValue()){return 0}var u=this.value+"";if(u.match(/em$/)){return this.numValue()*this.getEM(v)}if(u.match(/ex$/)){return this.numValue()*this.getEM(v)/2}if(u.match(/px$/)){return this.numValue()}if(u.match(/pt$/)){return this.numValue()*this.getDPI(v)*(1/72)}if(u.match(/pc$/)){return this.numValue()*15}if(u.match(/cm$/)){return this.numValue()*this.getDPI(v)/2.54}if(u.match(/mm$/)){return this.numValue()*this.getDPI(v)/25.4}if(u.match(/in$/)){return this.numValue()*this.getDPI(v)}if(u.match(/%$/)){return this.numValue()*p.ViewPort.ComputeSize(v)}var r=this.numValue();if(t&&r<1){return r*p.ViewPort.ComputeSize(v)}return r};p.Property.prototype.toMilliseconds=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/s$/)){return this.numValue()*1000}if(r.match(/ms$/)){return this.numValue()}return this.numValue()};p.Property.prototype.toRadians=function(){if(!this.hasValue()){return 0}var r=this.value+"";if(r.match(/deg$/)){return this.numValue()*(Math.PI/180)}if(r.match(/grad$/)){return this.numValue()*(Math.PI/200)}if(r.match(/rad$/)){return this.numValue()}return this.numValue()*(Math.PI/180)};var q={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};p.Property.prototype.toTextBaseline=function(){if(!this.hasValue()){return null}return q[this.value]};p.Font=new (function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(v,w,x,u,t,y){var s=y!=null?this.Parse(y):this.CreateFont("","","","","",p.ctx.font);return{fontFamily:t||s.fontFamily,fontSize:u||s.fontSize,fontStyle:v||s.fontStyle,fontWeight:x||s.fontWeight,fontVariant:w||s.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var r=this;this.Parse=function(x){var u={};var t=p.trim(p.compressSpaces(x||"")).split(" ");var y={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var v="";for(var w=0;w<t.length;w++){if(!y.fontStyle&&r.Styles.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontStyle=t[w]}y.fontStyle=true}else{if(!y.fontVariant&&r.Variants.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontVariant=t[w]}y.fontStyle=y.fontVariant=true}else{if(!y.fontWeight&&r.Weights.indexOf(t[w])!=-1){if(t[w]!="inherit"){u.fontWeight=t[w]}y.fontStyle=y.fontVariant=y.fontWeight=true}else{if(!y.fontSize){if(t[w]!="inherit"){u.fontSize=t[w].split("/")[0]}y.fontStyle=y.fontVariant=y.fontWeight=y.fontSize=true}else{if(t[w]!="inherit"){v+=t[w]}}}}}}if(v!=""){u.fontFamily=v}return u}});p.ToNumberArray=function(u){var r=p.trim(p.compressSpaces((u||"").replace(/,/g," "))).split(" ");for(var t=0;t<r.length;t++){r[t]=parseFloat(r[t])}return r};p.Point=function(r,s){this.x=r;this.y=s};p.Point.prototype.angleTo=function(r){return Math.atan2(r.y-this.y,r.x-this.x)};p.Point.prototype.applyTransform=function(r){var s=this.x*r[0]+this.y*r[2]+r[4];var t=this.x*r[1]+this.y*r[3]+r[5];this.x=s;this.y=t};p.CreatePoint=function(t){var r=p.ToNumberArray(t);return new p.Point(r[0],r[1])};p.CreatePath=function(v){var r=p.ToNumberArray(v);var u=[];for(var t=0;t<r.length;t+=2){u.push(new p.Point(r[t],r[t+1]))}return u};p.BoundingBox=function(r,t,s,u){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(v,w){if(v!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=v;this.x2=v}if(v<this.x1){this.x1=v}if(v>this.x2){this.x2=v}}if(w!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=w;this.y2=w}if(w<this.y1){this.y1=w}if(w>this.y2){this.y2=w}}};this.addX=function(v){this.addPoint(v,null)};this.addY=function(v){this.addPoint(null,v)};this.addBoundingBox=function(v){this.addPoint(v.x1,v.y1);this.addPoint(v.x2,v.y2)};this.addQuadraticCurve=function(z,A,B,C,D,E){var v=z+2/3*(B-z);var w=A+2/3*(C-A);var x=v+1/3*(D-z);var y=w+1/3*(E-A);this.addBezierCurve(z,A,v,x,w,y,D,E)};this.addBezierCurve=function(B,C,E,F,H,I,K,L){var A=[B,C],D=[E,F],G=[H,I],J=[K,L];this.addPoint(A[0],A[1]);this.addPoint(J[0],J[1]);for(i=0;i<=1;i++){var z=function(P){return Math.pow(1-P,3)*A[i]+3*Math.pow(1-P,2)*P*D[i]+3*(1-P)*Math.pow(P,2)*G[i]+Math.pow(P,3)*J[i]};var w=6*A[i]-12*D[i]+6*G[i];var v=-3*A[i]+9*D[i]-9*G[i]+3*J[i];var y=3*D[i]-3*A[i];if(v==0){if(w==0){continue}var M=-y/w;if(0<M&&M<1){if(i==0){this.addX(z(M))}if(i==1){this.addY(z(M))}}continue}var x=Math.pow(w,2)-4*y*v;if(x<0){continue}var N=(-w+Math.sqrt(x))/(2*v);if(0<N&&N<1){if(i==0){this.addX(z(N))}if(i==1){this.addY(z(N))}}var O=(-w-Math.sqrt(x))/(2*v);if(0<O&&O<1){if(i==0){this.addX(z(O))}if(i==1){this.addY(z(O))}}}};this.isPointInBox=function(v,w){return(this.x1<=v&&v<=this.x2&&this.y1<=w&&w<=this.y2)};this.addPoint(r,t);this.addPoint(s,u)};p.Transform=function(A){var w=this;this.Type={};this.Type.translate=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.translate(this.p.x||0,this.p.y||0)};this.unapply=function(s){s.translate(-1*this.p.x||0,-1*this.p.y||0)};this.applyToPoint=function(s){s.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}};this.Type.rotate=function(B){var v=p.ToNumberArray(B);this.angle=new p.Property("angle",v[0]);this.cx=v[1]||0;this.cy=v[2]||0;this.apply=function(s){s.translate(this.cx,this.cy);s.rotate(this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.unapply=function(s){s.translate(this.cx,this.cy);s.rotate(-1*this.angle.toRadians());s.translate(-this.cx,-this.cy)};this.applyToPoint=function(C){var s=this.angle.toRadians();C.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);C.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]);C.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}};this.Type.scale=function(v){this.p=p.CreatePoint(v);this.apply=function(s){s.scale(this.p.x||1,this.p.y||this.p.x||1)};this.unapply=function(s){s.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)};this.applyToPoint=function(s){s.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}};this.Type.matrix=function(v){this.m=p.ToNumberArray(v);this.apply=function(s){s.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])};this.unapply=function(D){var s=this.m[0];var B=this.m[2];var C=this.m[4];var E=this.m[1];var G=this.m[3];var H=this.m[5];var I=0;var J=0;var K=1;var F=1/(s*(G*K-H*J)-B*(E*K-H*I)+C*(E*J-G*I));D.transform(F*(G*K-H*J),F*(H*I-E*K),F*(C*J-B*K),F*(s*K-C*I),F*(B*H-C*G),F*(C*E-s*H))};this.applyToPoint=function(s){s.applyTransform(this.m)}};this.Type.SkewBase=function(v){this.base=w.Type.matrix;this.base(v);this.angle=new p.Property("angle",v)};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(v){this.base=w.Type.SkewBase;this.base(v);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(s){for(var v=0;v<this.transforms.length;v++){this.transforms[v].apply(s)}};this.unapply=function(s){for(var v=this.transforms.length-1;v>=0;v--){this.transforms[v].unapply(s)}};this.applyToPoint=function(v){for(var s=0;s<this.transforms.length;s++){this.transforms[s].applyToPoint(v)}};var r=p.trim(p.compressSpaces(A)).replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var t=0;t<r.length;t++){var z=p.trim(r[t].split("(")[0]);var u=r[t].split("(")[1].replace(")","");var y=this.Type[z];if(typeof y!="undefined"){var x=new y(u);x.type=z;this.transforms.push(x)}}};p.AspectRatio=function(t,s,G,v,w,u,y,z,A,B){s=p.compressSpaces(s);s=s.replace(/^defer\s/,"");var r=s.split(" ")[0]||"xMidYMid";var x=s.split(" ")[1]||"meet";var E=G/v;var F=w/u;var D=Math.min(E,F);var C=Math.max(E,F);if(x=="meet"){v*=D;u*=D}if(x=="slice"){v*=C;u*=C}A=new p.Property("refX",A);B=new p.Property("refY",B);if(A.hasValue()&&B.hasValue()){t.translate(-D*A.toPixels("x"),-D*B.toPixels("y"))}else{if(r.match(/^xMid/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G/2-v/2,0)}if(r.match(/YMid$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w/2-u/2)}if(r.match(/^xMax/)&&((x=="meet"&&D==F)||(x=="slice"&&C==F))){t.translate(G-v,0)}if(r.match(/YMax$/)&&((x=="meet"&&D==E)||(x=="slice"&&C==E))){t.translate(0,w-u)}}if(r=="none"){t.scale(E,F)}else{if(x=="meet"){t.scale(D,D)}else{if(x=="slice"){t.scale(C,C)}}}t.translate(y==null?0:-y,z==null?0:-z)};p.Element={};p.EmptyProperty=new p.Property("EMPTY","");p.Element.ElementBase=function(w){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(F,E){var D=this.attributes[F];if(D!=null){return D}if(E==true){D=new p.Property(F,"");this.attributes[F]=D}return D||p.EmptyProperty};this.getHrefAttribute=function(){for(var D in this.attributes){if(D=="href"||D.match(/:href$/)){return this.attributes[D]}}return p.EmptyProperty};this.style=function(F,E,J){var I=this.styles[F];if(I!=null){return I}var D=this.attribute(F);if(D!=null&&D.hasValue()){this.styles[F]=D;return D}if(J!=true){var G=this.parent;if(G!=null){var H=G.style(F);if(H!=null&&H.hasValue()){return H}}}if(E==true){I=new p.Property(F,"");this.styles[F]=I}return I||p.EmptyProperty};this.render=function(D){if(this.style("display").value=="none"){return}if(this.style("visibility").value=="hidden"){return}D.save();if(this.style("mask").hasValue()){var F=this.style("mask").getDefinition();if(F!=null){F.apply(D,this)}}else{if(this.style("filter").hasValue()){var E=this.style("filter").getDefinition();if(E!=null){E.apply(D,this)}}else{this.setContext(D);this.renderChildren(D);this.clearContext(D)}}D.restore()};this.setContext=function(D){};this.clearContext=function(D){};this.renderChildren=function(D){for(var E=0;E<this.children.length;E++){this.children[E].render(D)}};this.addChild=function(E,F){var D=E;if(F){D=p.CreateElement(E)}D.parent=this;if(D.type!="title"){this.children.push(D)}};this.addStylesFromStyleDefinition=function(){for(var F in p.Styles){if(F[0]!="@"&&h(w,F)){var H=p.Styles[F];var G=p.StylesSpecificity[F];if(H!=null){for(var E in H){var D=this.stylesSpecificity[E];if(typeof D=="undefined"){D="000"}if(G>D){this.styles[E]=H[E];this.stylesSpecificity[E]=G}}}}}};var r=new RegExp("^[A-Z-]+$");var y=function(D){if(r.test(D)){return D.toLowerCase()}return D};if(w!=null&&w.nodeType==1){for(var u=0;u<w.attributes.length;u++){var s=w.attributes[u];var x=y(s.nodeName);this.attributes[x]=new p.Property(x,s.value)}this.addStylesFromStyleDefinition();if(this.attribute("style").hasValue()){var A=this.attribute("style").value.split(";");for(var u=0;u<A.length;u++){if(p.trim(A[u])!=""){var z=A[u].split(":");var v=p.trim(z[0]);var C=p.trim(z[1]);this.styles[v]=new p.Property(v,C)}}}if(this.attribute("id").hasValue()){if(p.Definitions[this.attribute("id").value]==null){p.Definitions[this.attribute("id").value]=this}}for(var u=0;u<w.childNodes.length;u++){var t=w.childNodes[u];if(t.nodeType==1){this.addChild(t,true)}if(this.captureTextNodes&&(t.nodeType==3||t.nodeType==4)){var B=t.value||t.text||t.textContent||"";if(p.compressSpaces(B)!=""){this.addChild(new p.Element.tspan(t),false)}}}}};p.Element.RenderedElementBase=function(r){this.base=p.Element.ElementBase;this.base(r);this.setContext=function(t){if(this.style("fill").isUrlDefinition()){var v=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));if(v!=null){t.fillStyle=v}}else{if(this.style("fill").hasValue()){var u=this.style("fill");if(u.value=="currentColor"){u.value=this.style("color").value}if(u.value!="inherit"){t.fillStyle=(u.value=="none"?"rgba(0,0,0,0)":u.value)}}}if(this.style("fill-opacity").hasValue()){var u=new p.Property("fill",t.fillStyle);u=u.addOpacity(this.style("fill-opacity"));t.fillStyle=u.value}if(this.style("stroke").isUrlDefinition()){var v=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));if(v!=null){t.strokeStyle=v}}else{if(this.style("stroke").hasValue()){var z=this.style("stroke");if(z.value=="currentColor"){z.value=this.style("color").value}if(z.value!="inherit"){t.strokeStyle=(z.value=="none"?"rgba(0,0,0,0)":z.value)}}}if(this.style("stroke-opacity").hasValue()){var z=new p.Property("stroke",t.strokeStyle);z=z.addOpacity(this.style("stroke-opacity"));t.strokeStyle=z.value}if(this.style("stroke-width").hasValue()){var x=this.style("stroke-width").toPixels();t.lineWidth=x==0?0.001:x}if(this.style("stroke-linecap").hasValue()){t.lineCap=this.style("stroke-linecap").value}if(this.style("stroke-linejoin").hasValue()){t.lineJoin=this.style("stroke-linejoin").value}if(this.style("stroke-miterlimit").hasValue()){t.miterLimit=this.style("stroke-miterlimit").value}if(this.style("stroke-dasharray").hasValue()&&this.style("stroke-dasharray").value!="none"){var w=p.ToNumberArray(this.style("stroke-dasharray").value);if(typeof t.setLineDash!="undefined"){t.setLineDash(w)}else{if(typeof t.webkitLineDash!="undefined"){t.webkitLineDash=w}else{if(typeof t.mozDash!="undefined"&&!(w.length==1&&w[0]==0)){t.mozDash=w}}}var y=this.style("stroke-dashoffset").numValueOrDefault(1);if(typeof t.lineDashOffset!="undefined"){t.lineDashOffset=y}else{if(typeof t.webkitLineDashOffset!="undefined"){t.webkitLineDashOffset=y}else{if(typeof t.mozDashOffset!="undefined"){t.mozDashOffset=y}}}}if(typeof t.font!="undefined"){t.font=p.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()}if(this.style("transform",false,true).hasValue()){var A=new p.Transform(this.style("transform",false,true).value);A.apply(t)}if(this.style("clip-path",false,true).hasValue()){var s=this.style("clip-path",false,true).getDefinition();if(s!=null){s.apply(t)}}if(this.style("opacity").hasValue()){t.globalAlpha=this.style("opacity").numValue()}}};p.Element.RenderedElementBase.prototype=new p.Element.ElementBase;p.Element.PathElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.path=function(s){if(s!=null){s.beginPath()}return new p.BoundingBox()};this.renderChildren=function(s){this.path(s);p.Mouse.checkPath(this,s);if(s.fillStyle!=""){if(this.style("fill-rule").valueOrDefault("inherit")!="inherit"){s.fill(this.style("fill-rule").value)}else{s.fill()}}if(s.strokeStyle!=""){s.stroke()}var v=this.getMarkers();if(v!=null){if(this.style("marker-start").isUrlDefinition()){var u=this.style("marker-start").getDefinition();u.render(s,v[0][0],v[0][1])}if(this.style("marker-mid").isUrlDefinition()){var u=this.style("marker-mid").getDefinition();for(var t=1;t<v.length-1;t++){u.render(s,v[t][0],v[t][1])}}if(this.style("marker-end").isUrlDefinition()){var u=this.style("marker-end").getDefinition();u.render(s,v[v.length-1][0],v[v.length-1][1])}}};this.getBoundingBox=function(){return this.path()};this.getMarkers=function(){return null}};p.Element.PathElementBase.prototype=new p.Element.RenderedElementBase;p.Element.svg=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.baseClearContext=this.clearContext;this.clearContext=function(s){this.baseClearContext(s);p.ViewPort.RemoveCurrent()};this.baseSetContext=this.setContext;this.setContext=function(s){s.strokeStyle="rgba(0,0,0,0)";s.lineCap="butt";s.lineJoin="miter";s.miterLimit=4;if(typeof s.font!="undefined"&&typeof window.getComputedStyle!="undefined"){s.font=window.getComputedStyle(s.canvas).getPropertyValue("font")}this.baseSetContext(s);if(!this.attribute("x").hasValue()){this.attribute("x",true).value=0}if(!this.attribute("y").hasValue()){this.attribute("y",true).value=0}s.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var z=p.ViewPort.width();var t=p.ViewPort.height();if(!this.attribute("width").hasValue()){this.attribute("width",true).value="100%"}if(!this.attribute("height").hasValue()){this.attribute("height",true).value="100%"}if(typeof this.root=="undefined"){z=this.attribute("width").toPixels("x");t=this.attribute("height").toPixels("y");var A=0;var B=0;if(this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){A=-this.attribute("refX").toPixels("x");B=-this.attribute("refY").toPixels("y")}if(this.attribute("overflow").valueOrDefault("hidden")!="visible"){s.beginPath();s.moveTo(A,B);s.lineTo(z,B);s.lineTo(z,t);s.lineTo(A,t);s.closePath();s.clip()}}p.ViewPort.SetCurrent(z,t);if(this.attribute("viewBox").hasValue()){var w=p.ToNumberArray(this.attribute("viewBox").value);var u=w[0];var v=w[1];z=w[2];t=w[3];p.AspectRatio(s,this.attribute("preserveAspectRatio").value,p.ViewPort.width(),z,p.ViewPort.height(),t,u,v,this.attribute("refX").value,this.attribute("refY").value);p.ViewPort.RemoveCurrent();p.ViewPort.SetCurrent(w[2],w[3])}}};p.Element.svg.prototype=new p.Element.RenderedElementBase;p.Element.rect=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var t=this.attribute("height").toPixels("y");var u=this.attribute("rx").toPixels("x");var v=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()){v=u}if(this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()){u=v}u=Math.min(u,w/2);v=Math.min(v,t/2);if(s!=null){s.beginPath();s.moveTo(z+u,A);s.lineTo(z+w-u,A);s.quadraticCurveTo(z+w,A,z+w,A+v);s.lineTo(z+w,A+t-v);s.quadraticCurveTo(z+w,A+t,z+w-u,A+t);s.lineTo(z+u,A+t);s.quadraticCurveTo(z,A+t,z,A+t-v);s.lineTo(z,A+v);s.quadraticCurveTo(z,A,z+u,A);s.closePath()}return new p.BoundingBox(z,A,z+w,A+t)}};p.Element.rect.prototype=new p.Element.PathElementBase;p.Element.circle=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");var v=this.attribute("r").toPixels();if(s!=null){s.beginPath();s.arc(t,u,v,0,Math.PI*2,true);s.closePath()}return new p.BoundingBox(t-v,u-v,t+v,u+v)}};p.Element.circle.prototype=new p.Element.PathElementBase;p.Element.ellipse=function(r){this.base=p.Element.PathElementBase;this.base(r);this.path=function(s){var v=4*((Math.sqrt(2)-1)/3);var w=this.attribute("rx").toPixels("x");var x=this.attribute("ry").toPixels("y");var t=this.attribute("cx").toPixels("x");var u=this.attribute("cy").toPixels("y");if(s!=null){s.beginPath();s.moveTo(t,u-x);s.bezierCurveTo(t+(v*w),u-x,t+w,u-(v*x),t+w,u);s.bezierCurveTo(t+w,u+(v*x),t+(v*w),u+x,t,u+x);s.bezierCurveTo(t-(v*w),u+x,t-w,u+(v*x),t-w,u);s.bezierCurveTo(t-w,u-(v*x),t-(v*w),u-x,t,u-x);s.closePath()}return new p.BoundingBox(t-w,u-x,t+w,u+x)}};p.Element.ellipse.prototype=new p.Element.PathElementBase;p.Element.line=function(r){this.base=p.Element.PathElementBase;this.base(r);this.getPoints=function(){return[new p.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new p.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]};this.path=function(s){var t=this.getPoints();if(s!=null){s.beginPath();s.moveTo(t[0].x,t[0].y);s.lineTo(t[1].x,t[1].y)}return new p.BoundingBox(t[0].x,t[0].y,t[1].x,t[1].y)};this.getMarkers=function(){var t=this.getPoints();var s=t[0].angleTo(t[1]);return[[t[0],s],[t[1],s]]}};p.Element.line.prototype=new p.Element.PathElementBase;p.Element.polyline=function(r){this.base=p.Element.PathElementBase;this.base(r);this.points=p.CreatePath(this.attribute("points").value);this.path=function(t){var s=new p.BoundingBox(this.points[0].x,this.points[0].y);if(t!=null){t.beginPath();t.moveTo(this.points[0].x,this.points[0].y)}for(var u=1;u<this.points.length;u++){s.addPoint(this.points[u].x,this.points[u].y);if(t!=null){t.lineTo(this.points[u].x,this.points[u].y)}}return s};this.getMarkers=function(){var t=[];for(var s=0;s<this.points.length-1;s++){t.push([this.points[s],this.points[s].angleTo(this.points[s+1])])}if(t.length>0){t.push([this.points[this.points.length-1],t[t.length-1][1]])}return t}};p.Element.polyline.prototype=new p.Element.PathElementBase;p.Element.polygon=function(r){this.base=p.Element.polyline;this.base(r);this.basePath=this.path;this.path=function(t){var s=this.basePath(t);if(t!=null){t.lineTo(this.points[0].x,this.points[0].y);t.closePath()}return s}};p.Element.polygon.prototype=new p.Element.polyline;p.Element.path=function(t){this.base=p.Element.PathElementBase;this.base(t);var r=this.attribute("d").value;r=r.replace(/,/gm," ");for(var s=0;s<2;s++){r=r.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2")}r=r.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");r=r.replace(/([0-9])([+\-])/gm,"$1 $2");for(var s=0;s<2;s++){r=r.replace(/(\.[0-9]*)(\.)/gm,"$1 $2")}r=r.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");r=p.compressSpaces(r);r=p.trim(r);this.PathParser=new (function(u){this.tokens=u.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new p.Point(0,0);this.control=new p.Point(0,0);this.current=new p.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var v=new p.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(v)};this.getAsControlPoint=function(){var v=this.getPoint();this.control=v;return v};this.getAsCurrentPoint=function(){var v=this.getPoint();this.current=v;return v};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var v=new p.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return v};this.makeAbsolute=function(v){if(this.isRelativeCommand()){v.x+=this.current.x;v.y+=this.current.y}return v};this.addMarker=function(w,v,x){if(x!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(x)}this.addMarkerAngle(w,v==null?null:v.angleTo(w))};this.addMarkerAngle=function(w,v){this.points.push(w);this.angles.push(v)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var v=0;v<this.angles.length;v++){if(this.angles[v]==null){for(var w=v+1;w<this.angles.length;w++){if(this.angles[w]!=null){this.angles[v]=this.angles[w];break}}}}return this.angles}})(r);this.path=function(G){var R=this.PathParser;R.reset();var A=new p.BoundingBox();if(G!=null){G.beginPath()}while(!R.isEnd()){R.nextCommand();switch(R.command){case"M":case"m":var P=R.getAsCurrentPoint();R.addMarker(P);A.addPoint(P.x,P.y);if(G!=null){G.moveTo(P.x,P.y)}R.start=R.current;while(!R.isCommandOrEnd()){var P=R.getAsCurrentPoint();R.addMarker(P,R.start);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"L":case"l":while(!R.isCommandOrEnd()){var B=R.current;var P=R.getAsCurrentPoint();R.addMarker(P,B);A.addPoint(P.x,P.y);if(G!=null){G.lineTo(P.x,P.y)}}break;case"H":case"h":while(!R.isCommandOrEnd()){var O=new p.Point((R.isRelativeCommand()?R.current.x:0)+R.getScalar(),R.current.y);R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"V":case"v":while(!R.isCommandOrEnd()){var O=new p.Point(R.current.x,(R.isRelativeCommand()?R.current.y:0)+R.getScalar());R.addMarker(O,R.current);R.current=O;A.addPoint(R.current.x,R.current.y);if(G!=null){G.lineTo(R.current.x,R.current.y)}}break;case"C":case"c":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"S":case"s":while(!R.isCommandOrEnd()){var H=R.current;var Q=R.getReflectedControlPoint();var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,Q);A.addBezierCurve(H.x,H.y,Q.x,Q.y,D.x,D.y,E.x,E.y);if(G!=null){G.bezierCurveTo(Q.x,Q.y,D.x,D.y,E.x,E.y)}}break;case"Q":case"q":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getAsControlPoint();var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"T":case"t":while(!R.isCommandOrEnd()){var H=R.current;var D=R.getReflectedControlPoint();R.control=D;var E=R.getAsCurrentPoint();R.addMarker(E,D,D);A.addQuadraticCurve(H.x,H.y,D.x,D.y,E.x,E.y);if(G!=null){G.quadraticCurveTo(D.x,D.y,E.x,E.y)}}break;case"A":case"a":while(!R.isCommandOrEnd()){var H=R.current;var T=R.getScalar();var U=R.getScalar();var ab=R.getScalar()*(Math.PI/180);var M=R.getScalar();var W=R.getScalar();var E=R.getAsCurrentPoint();var I=new p.Point(Math.cos(ab)*(H.x-E.x)/2+Math.sin(ab)*(H.y-E.y)/2,-Math.sin(ab)*(H.x-E.x)/2+Math.cos(ab)*(H.y-E.y)/2);var L=Math.pow(I.x,2)/Math.pow(T,2)+Math.pow(I.y,2)/Math.pow(U,2);if(L>1){T*=Math.sqrt(L);U*=Math.sqrt(L)}var V=(M==W?-1:1)*Math.sqrt(((Math.pow(T,2)*Math.pow(U,2))-(Math.pow(T,2)*Math.pow(I.y,2))-(Math.pow(U,2)*Math.pow(I.x,2)))/(Math.pow(T,2)*Math.pow(I.y,2)+Math.pow(U,2)*Math.pow(I.x,2)));if(isNaN(V)){V=0}var F=new p.Point(V*T*I.y/U,V*-U*I.x/T);var C=new p.Point((H.x+E.x)/2+Math.cos(ab)*F.x-Math.sin(ab)*F.y,(H.y+E.y)/2+Math.sin(ab)*F.x+Math.cos(ab)*F.y);var N=function(u){return Math.sqrt(Math.pow(u[0],2)+Math.pow(u[1],2))};var S=function(ac,ad){return(ac[0]*ad[0]+ac[1]*ad[1])/(N(ac)*N(ad))};var w=function(ac,ad){return(ac[0]*ad[1]<ac[1]*ad[0]?-1:1)*Math.acos(S(ac,ad))};var x=w([1,0],[(I.x-F.x)/T,(I.y-F.y)/U]);var Z=[(I.x-F.x)/T,(I.y-F.y)/U];var aa=[(-I.x-F.x)/T,(-I.y-F.y)/U];var y=w(Z,aa);if(S(Z,aa)<=-1){y=Math.PI}if(S(Z,aa)>=1){y=0}var J=1-W?1:-1;var z=x+J*(y/2);var K=new p.Point(C.x+T*Math.cos(z),C.y+U*Math.sin(z));R.addMarkerAngle(K,z-J*Math.PI/2);R.addMarkerAngle(E,z-J*Math.PI);A.addPoint(E.x,E.y);if(G!=null){var S=T>U?T:U;var X=T>U?1:T/U;var Y=T>U?U/T:1;G.translate(C.x,C.y);G.rotate(ab);G.scale(X,Y);G.arc(0,0,S,x,x+y,1-W);G.scale(1/X,1/Y);G.rotate(-ab);G.translate(-C.x,-C.y)}}break;case"Z":case"z":if(G!=null){G.closePath()}R.current=R.start}}return A};this.getMarkers=function(){var x=this.PathParser.getMarkerPoints();var u=this.PathParser.getMarkerAngles();var w=[];for(var v=0;v<x.length;v++){w.push([x[v],u[v]])}return w}};p.Element.path.prototype=new p.Element.PathElementBase;p.Element.pattern=function(r){this.base=p.Element.ElementBase;this.base(r);this.createPattern=function(u,v){var B=this.attribute("width").toPixels("x",true);var w=this.attribute("height").toPixels("y",true);var A=new p.Element.svg();A.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);A.attributes.width=new p.Property("width",B+"px");A.attributes.height=new p.Property("height",w+"px");A.attributes.transform=new p.Property("transform",this.attribute("patternTransform").value);A.children=this.children;var s=document.createElement("canvas");s.width=B;s.height=w;var t=s.getContext("2d");if(this.attribute("x").hasValue()&&this.attribute("y").hasValue()){t.translate(this.attribute("x").toPixels("x",true),this.attribute("y").toPixels("y",true))}for(var C=-1;C<=1;C++){for(var D=-1;D<=1;D++){t.save();A.attributes.x=new p.Property("x",C*s.width);A.attributes.y=new p.Property("y",D*s.height);A.render(t);t.restore()}}var z=u.createPattern(s,"repeat");return z}};p.Element.pattern.prototype=new p.Element.ElementBase;p.Element.marker=function(r){this.base=p.Element.ElementBase;this.base(r);this.baseRender=this.render;this.render=function(t,u,s){t.translate(u.x,u.y);if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(s)}if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(t.lineWidth,t.lineWidth)}t.save();var v=new p.Element.svg();v.attributes.viewBox=new p.Property("viewBox",this.attribute("viewBox").value);v.attributes.refX=new p.Property("refX",this.attribute("refX").value);v.attributes.refY=new p.Property("refY",this.attribute("refY").value);v.attributes.width=new p.Property("width",this.attribute("markerWidth").value);v.attributes.height=new p.Property("height",this.attribute("markerHeight").value);v.attributes.fill=new p.Property("fill",this.attribute("fill").valueOrDefault("black"));v.attributes.stroke=new p.Property("stroke",this.attribute("stroke").valueOrDefault("none"));v.children=this.children;v.render(t);t.restore();if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){t.scale(1/t.lineWidth,1/t.lineWidth)}if(this.attribute("orient").valueOrDefault("auto")=="auto"){t.rotate(-s)}t.translate(-u.x,-u.y)}};p.Element.marker.prototype=new p.Element.ElementBase;p.Element.defs=function(r){this.base=p.Element.ElementBase;this.base(r);this.render=function(s){}};p.Element.defs.prototype=new p.Element.ElementBase;p.Element.GradientBase=function(t){this.base=p.Element.ElementBase;this.base(t);this.stops=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="stop"){this.stops.push(r)}}this.getGradient=function(){};this.gradientUnits=function(){return this.attribute("gradientUnits").valueOrDefault("objectBoundingBox")};this.attributesToInherit=["gradientUnits"];this.inheritStopContainer=function(w){for(var v=0;v<this.attributesToInherit.length;v++){var u=this.attributesToInherit[v];if(!this.attribute(u).hasValue()&&w.attribute(u).hasValue()){this.attribute(u,true).value=w.attribute(u).value}}};this.createGradient=function(w,x,B){var E=this;if(this.getHrefAttribute().hasValue()){E=this.getHrefAttribute().getDefinition();this.inheritStopContainer(E)}var u=function(H){if(B.hasValue()){var I=new p.Property("color",H);return I.addOpacity(B).value}return H};var y=this.getGradient(w,x);if(y==null){return u(E.stops[E.stops.length-1].color)}for(var A=0;A<E.stops.length;A++){y.addColorStop(E.stops[A].offset,u(E.stops[A].color))}if(this.attribute("gradientTransform").hasValue()){var D=p.ViewPort.viewPorts[0];var C=new p.Element.rect();C.attributes.x=new p.Property("x",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.y=new p.Property("y",-p.MAX_VIRTUAL_PIXELS/3);C.attributes.width=new p.Property("width",p.MAX_VIRTUAL_PIXELS);C.attributes.height=new p.Property("height",p.MAX_VIRTUAL_PIXELS);var z=new p.Element.g();z.attributes.transform=new p.Property("transform",this.attribute("gradientTransform").value);z.children=[C];var G=new p.Element.svg();G.attributes.x=new p.Property("x",0);G.attributes.y=new p.Property("y",0);G.attributes.width=new p.Property("width",D.width);G.attributes.height=new p.Property("height",D.height);G.children=[z];var v=document.createElement("canvas");v.width=D.width;v.height=D.height;var F=v.getContext("2d");F.fillStyle=y;G.render(F);return F.createPattern(v,"no-repeat")}return y}};p.Element.GradientBase.prototype=new p.Element.ElementBase;p.Element.linearGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("x1");this.attributesToInherit.push("y1");this.attributesToInherit.push("x2");this.attributesToInherit.push("y2");this.getGradient=function(t,u){var s=this.gradientUnits()=="objectBoundingBox"?u.getBoundingBox():null;if(!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()){this.attribute("x1",true).value=0;this.attribute("y1",true).value=0;this.attribute("x2",true).value=1;this.attribute("y2",true).value=0}var v=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"));var x=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"));var w=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"));var y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y"));if(v==w&&x==y){return null}return t.createLinearGradient(v,x,w,y)}};p.Element.linearGradient.prototype=new p.Element.GradientBase;p.Element.radialGradient=function(r){this.base=p.Element.GradientBase;this.base(r);this.attributesToInherit.push("cx");this.attributesToInherit.push("cy");this.attributesToInherit.push("r");this.attributesToInherit.push("fx");this.attributesToInherit.push("fy");this.getGradient=function(t,w){var s=w.getBoundingBox();if(!this.attribute("cx").hasValue()){this.attribute("cx",true).value="50%"}if(!this.attribute("cy").hasValue()){this.attribute("cy",true).value="50%"}if(!this.attribute("r").hasValue()){this.attribute("r",true).value="50%"}var u=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"));var v=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"));var x=u;var y=v;if(this.attribute("fx").hasValue()){x=(this.gradientUnits()=="objectBoundingBox"?s.x()+s.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"))}if(this.attribute("fy").hasValue()){y=(this.gradientUnits()=="objectBoundingBox"?s.y()+s.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"))}var z=(this.gradientUnits()=="objectBoundingBox"?(s.width()+s.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return t.createRadialGradient(x,y,0,u,v,z)}};p.Element.radialGradient.prototype=new p.Element.GradientBase;p.Element.stop=function(r){this.base=p.Element.ElementBase;this.base(r);this.offset=this.attribute("offset").numValue();if(this.offset<0){this.offset=0}if(this.offset>1){this.offset=1}var s=this.style("stop-color",true);if(s.value===""){s.value="#000"}if(this.style("stop-opacity").hasValue()){s=s.addOpacity(this.style("stop-opacity"))}this.color=s.value};p.Element.stop.prototype=new p.Element.ElementBase;p.Element.AnimateBase=function(r){this.base=p.Element.ElementBase;this.base(r);p.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var t=this.attribute("attributeType").value;var s=this.attribute("attributeName").value;if(t=="CSS"){return this.parent.style(s,true)}return this.parent.attribute(s,true)};this.initialValue=null;this.initialUnits="";this.removed=false;this.calcValue=function(){return""};this.update=function(s){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits()}if(this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite"){this.duration=0}else{if(this.attribute("fill").valueOrDefault("remove")=="freeze"&&!this.frozen){this.frozen=true;this.parent.animationFrozen=true;this.parent.animationFrozenValue=this.getProperty().value}else{if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed){this.removed=true;this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue;return true}}}return false}this.duration=this.duration+s;var v=false;if(this.begin<this.duration){var t=this.calcValue();if(this.attribute("type").hasValue()){var u=this.attribute("type").value;t=u+"("+t+")"}this.getProperty().value=t;v=true}return v};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");if(this.values.hasValue()){this.values.value=this.values.value.split(";")}this.progress=function(){var u={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var t=u.progress*(this.values.value.length-1);var s=Math.floor(t),v=Math.ceil(t);u.from=new p.Property("from",parseFloat(this.values.value[s]));u.to=new p.Property("to",parseFloat(this.values.value[v]));u.progress=(t-s)/(v-s)}else{u.from=this.from;u.to=this.to}return u}};p.Element.AnimateBase.prototype=new p.Element.ElementBase;p.Element.animate=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var t=this.progress();var s=t.from.numValue()+(t.to.numValue()-t.from.numValue())*t.progress;return s+this.initialUnits}};p.Element.animate.prototype=new p.Element.AnimateBase;p.Element.animateColor=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var t=new m(v.from.value);var x=new m(v.to.value);if(t.ok&&x.ok){var w=t.r+(x.r-t.r)*v.progress;var u=t.g+(x.g-t.g)*v.progress;var s=t.b+(x.b-t.b)*v.progress;return"rgb("+parseInt(w,10)+","+parseInt(u,10)+","+parseInt(s,10)+")"}return this.attribute("from").value}};p.Element.animateColor.prototype=new p.Element.AnimateBase;p.Element.animateTransform=function(r){this.base=p.Element.AnimateBase;this.base(r);this.calcValue=function(){var v=this.progress();var s=p.ToNumberArray(v.from.value);var w=p.ToNumberArray(v.to.value);var u="";for(var t=0;t<s.length;t++){u+=s[t]+(w[t]-s[t])*v.progress+" "}return u}};p.Element.animateTransform.prototype=new p.Element.animate;p.Element.font=function(t){this.base=p.Element.ElementBase;this.base(t);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var s=0;s<this.children.length;s++){var r=this.children[s];if(r.type=="font-face"){this.fontFace=r;if(r.style("font-family").hasValue()){p.Definitions[r.style("font-family").value]=this}}else{if(r.type=="missing-glyph"){this.missingGlyph=r}else{if(r.type=="glyph"){if(r.arabicForm!=""){this.isRTL=true;this.isArabic=true;if(typeof this.glyphs[r.unicode]=="undefined"){this.glyphs[r.unicode]=[]}this.glyphs[r.unicode][r.arabicForm]=r}else{this.glyphs[r.unicode]=r}}}}}};p.Element.font.prototype=new p.Element.ElementBase;p.Element.fontface=function(r){this.base=p.Element.ElementBase;this.base(r);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;this.unitsPerEm=this.attribute("units-per-em").numValue()};p.Element.fontface.prototype=new p.Element.ElementBase;p.Element.missingglyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=0};p.Element.missingglyph.prototype=new p.Element.path;p.Element.glyph=function(r){this.base=p.Element.path;this.base(r);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value};p.Element.glyph.prototype=new p.Element.path;p.Element.text=function(r){this.captureTextNodes=true;this.base=p.Element.RenderedElementBase;this.base(r);this.baseSetContext=this.setContext;this.setContext=function(s){this.baseSetContext(s);var t=this.style("dominant-baseline").toTextBaseline();if(t==null){t=this.style("alignment-baseline").toTextBaseline()}if(t!=null){s.textBaseline=t}};this.getBoundingBox=function(){var t=this.attribute("x").toPixels("x");var u=this.attribute("y").toPixels("y");var s=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);return new p.BoundingBox(t,u-s,t+Math.floor(s*2/3)*this.children[0].getText().length,u)};this.renderChildren=function(s){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");if(this.attribute("dx").hasValue()){this.x+=this.attribute("dx").toPixels("x")}if(this.attribute("dy").hasValue()){this.y+=this.attribute("dy").toPixels("y")}this.x+=this.getAnchorDelta(s,this,0);for(var t=0;t<this.children.length;t++){this.renderChild(s,this,this,t)}};this.getAnchorDelta=function(t,v,w){var x=this.style("text-anchor").valueOrDefault("start");if(x!="start"){var y=0;for(var u=w;u<v.children.length;u++){var s=v.children[u];if(u>w&&s.attribute("x").hasValue()){break}y+=s.measureTextRecursive(t)}return -1*(x=="end"?y:y/2)}return 0};this.renderChild=function(t,w,v,u){var s=v.children[u];if(s.attribute("x").hasValue()){s.x=s.attribute("x").toPixels("x")+w.getAnchorDelta(t,v,u);if(s.attribute("dx").hasValue()){s.x+=s.attribute("dx").toPixels("x")}}else{if(s.attribute("dx").hasValue()){w.x+=s.attribute("dx").toPixels("x")}s.x=w.x}w.x=s.x+s.measureText(t);if(s.attribute("y").hasValue()){s.y=s.attribute("y").toPixels("y");if(s.attribute("dy").hasValue()){s.y+=s.attribute("dy").toPixels("y")}}else{if(s.attribute("dy").hasValue()){w.y+=s.attribute("dy").toPixels("y")}s.y=w.y}w.y=s.y;s.render(t);for(var u=0;u<s.children.length;u++){w.renderChild(t,w,s,u)}}};p.Element.text.prototype=new p.Element.RenderedElementBase;p.Element.TextElementBase=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getGlyph=function(u,x,w){var t=x[w];var v=null;if(u.isArabic){var s="isolated";if((w==0||x[w-1]==" ")&&w<x.length-2&&x[w+1]!=" "){s="terminal"}if(w>0&&x[w-1]!=" "&&w<x.length-2&&x[w+1]!=" "){s="medial"}if(w>0&&x[w-1]!=" "&&(w==x.length-1||x[w+1]==" ")){s="initial"}if(typeof u.glyphs[t]!="undefined"){v=u.glyphs[t][s];if(v==null&&u.glyphs[t].type=="glyph"){v=u.glyphs[t]}}}else{v=u.glyphs[t]}if(v==null){v=u.missingGlyph}return v};this.renderChildren=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var w=this.parent.style("font-style").valueOrDefault(p.Font.Parse(p.ctx.font).fontStyle);var B=this.getText();if(t.isRTL){B=B.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var y=0;y<B.length;y++){var x=this.getGlyph(t,B,y);var A=v/t.fontFace.unitsPerEm;s.translate(this.x,this.y);s.scale(A,-A);var z=s.lineWidth;s.lineWidth=s.lineWidth*t.fontFace.unitsPerEm/v;if(w=="italic"){s.transform(1,0,0.4,1,0,0)}x.render(s);if(w=="italic"){s.transform(1,0,-0.4,1,0,0)}s.lineWidth=z;s.scale(1/A,-1/A);s.translate(-this.x,-this.y);this.x+=v*(x.horizAdvX||t.horizAdvX)/t.fontFace.unitsPerEm;if(typeof u[y]!="undefined"&&!isNaN(u[y])){this.x+=u[y]}}return}if(s.fillStyle!=""){s.fillText(p.compressSpaces(this.getText()),this.x,this.y)}if(s.strokeStyle!=""){s.strokeText(p.compressSpaces(this.getText()),this.x,this.y)}};this.getText=function(){};this.measureTextRecursive=function(s){var u=this.measureText(s);for(var t=0;t<this.children.length;t++){u+=this.children[t].measureTextRecursive(s)}return u};this.measureText=function(s){var t=this.parent.style("font-family").getDefinition();if(t!=null){var v=this.parent.style("font-size").numValueOrDefault(p.Font.Parse(p.ctx.font).fontSize);var y=0;var z=this.getText();if(t.isRTL){z=z.split("").reverse().join("")}var u=p.ToNumberArray(this.parent.attribute("dx").value);for(var x=0;x<z.length;x++){var w=this.getGlyph(t,z,x);y+=(w.horizAdvX||t.horizAdvX)*v/t.fontFace.unitsPerEm;if(typeof u[x]!="undefined"&&!isNaN(u[x])){y+=u[x]}}return y}var A=p.compressSpaces(this.getText());if(!s.measureText){return A.length*10}s.save();this.setContext(s);var B=s.measureText(A).width;s.restore();return B}};p.Element.TextElementBase.prototype=new p.Element.RenderedElementBase;p.Element.tspan=function(r){this.captureTextNodes=true;this.base=p.Element.TextElementBase;this.base(r);this.text=p.compressSpaces(r.value||r.text||r.textContent||"");this.getText=function(){if(this.children.length>0){return""}return this.text}};p.Element.tspan.prototype=new p.Element.TextElementBase;p.Element.tref=function(r){this.base=p.Element.TextElementBase;this.base(r);this.getText=function(){var s=this.getHrefAttribute().getDefinition();if(s!=null){return s.children[0].getText()}}};p.Element.tref.prototype=new p.Element.TextElementBase;p.Element.a=function(s){this.base=p.Element.TextElementBase;this.base(s);this.hasText=s.childNodes.length>0;for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType!=3){this.hasText=false}}this.text=this.hasText?s.childNodes[0].value:"";this.getText=function(){return this.text};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(t){if(this.hasText){this.baseRenderChildren(t);var u=new p.Property("fontSize",p.Font.Parse(p.ctx.font).fontSize);p.Mouse.checkBoundingBox(this,new p.BoundingBox(this.x,this.y-u.toPixels("y"),this.x+this.measureText(t),this.y))}else{if(this.children.length>0){var v=new p.Element.g();v.children=this.children;v.parent=this;v.render(t)}}};this.onclick=function(){window.open(this.getHrefAttribute().value)};this.onmousemove=function(){p.ctx.canvas.style.cursor="pointer"}};p.Element.a.prototype=new p.Element.TextElementBase;p.Element.image=function(t){this.base=p.Element.RenderedElementBase;this.base(t);var r=this.getHrefAttribute().value;if(r==""){return}var s=r.match(/\.svg$/);p.Images.push(this);this.loaded=false;if(!s){this.img=document.createElement("img");if(p.opts.useCORS==true){this.img.crossOrigin="Anonymous"}var u=this;this.img.onload=function(){u.loaded=true};this.img.onerror=function(){p.log('ERROR: image "'+r+'" not found');u.loaded=true};this.img.src=r}else{this.img=p.ajax(r);this.loaded=true}this.renderChildren=function(v){var A=this.attribute("x").toPixels("x");var B=this.attribute("y").toPixels("y");var z=this.attribute("width").toPixels("x");var w=this.attribute("height").toPixels("y");if(z==0||w==0){return}v.save();if(s){v.drawSvg(this.img,A,B,z,w)}else{v.translate(A,B);p.AspectRatio(v,this.attribute("preserveAspectRatio").value,z,this.img.width,w,this.img.height,0,0);v.drawImage(this.img,0,0)}v.restore()};this.getBoundingBox=function(){var z=this.attribute("x").toPixels("x");var A=this.attribute("y").toPixels("y");var w=this.attribute("width").toPixels("x");var v=this.attribute("height").toPixels("y");return new p.BoundingBox(z,A,z+w,A+v)}};p.Element.image.prototype=new p.Element.RenderedElementBase;p.Element.g=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.getBoundingBox=function(){var s=new p.BoundingBox();for(var t=0;t<this.children.length;t++){s.addBoundingBox(this.children[t].getBoundingBox())}return s}};p.Element.g.prototype=new p.Element.RenderedElementBase;p.Element.symbol=function(r){this.base=p.Element.RenderedElementBase;this.base(r);this.render=function(s){}};p.Element.symbol.prototype=new p.Element.RenderedElementBase;p.Element.style=function(H){this.base=p.Element.ElementBase;this.base(H);var r="";for(var D=0;D<H.childNodes.length;D++){r+=H.childNodes[D].data}r=r.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");r=p.compressSpaces(r);var w=r.split("}");for(var D=0;D<w.length;D++){if(p.trim(w[D])!=""){var v=w[D].split("{");var u=v[0].split(",");var x=v[1].split(";");for(var E=0;E<u.length;E++){var t=p.trim(u[E]);if(t!=""){var J=p.Styles[t]||{};for(var F=0;F<x.length;F++){var I=x[F].indexOf(":");var G=x[F].substr(0,I);var P=x[F].substr(I+1,x[F].length-I);if(G!=null&&P!=null){J[p.trim(G)]=new p.Property(p.trim(G),p.trim(P))}}p.Styles[t]=J;p.StylesSpecificity[t]=f(t);if(t=="@font-face"){var B=J["font-family"].value.replace(/"/g,"");var L=J.src.value.split(",");for(var K=0;K<L.length;K++){if(L[K].indexOf('format("svg")')>0){var O=L[K].indexOf("url");var N=L[K].indexOf(")",O);var M=L[K].substr(O+5,N-O-6);var y=p.parseXml(p.ajax(M));var C=y.getElementsByTagName("font");for(var z=0;z<C.length;z++){var A=p.CreateElement(C[z]);p.Definitions[B]=A}}}}}}}}};p.Element.style.prototype=new p.Element.ElementBase;p.Element.use=function(s){this.base=p.Element.RenderedElementBase;this.base(s);this.baseSetContext=this.setContext;this.setContext=function(t){this.baseSetContext(t);if(this.attribute("x").hasValue()){t.translate(this.attribute("x").toPixels("x"),0)}if(this.attribute("y").hasValue()){t.translate(0,this.attribute("y").toPixels("y"))}};var r=this.getHrefAttribute().getDefinition();this.path=function(t){if(r!=null){r.path(t)}};this.getBoundingBox=function(){if(r!=null){return r.getBoundingBox()}};this.renderChildren=function(t){if(r!=null){var v=r;if(r.type=="symbol"){v=new p.Element.svg();v.type="svg";v.attributes.viewBox=new p.Property("viewBox",r.attribute("viewBox").value);v.attributes.preserveAspectRatio=new p.Property("preserveAspectRatio",r.attribute("preserveAspectRatio").value);v.attributes.overflow=new p.Property("overflow",r.attribute("overflow").value);v.children=r.children}if(v.type=="svg"){if(this.attribute("width").hasValue()){v.attributes.width=new p.Property("width",this.attribute("width").value)}if(this.attribute("height").hasValue()){v.attributes.height=new p.Property("height",this.attribute("height").value)}}var u=v.parent;v.parent=null;v.render(t);v.parent=u}}};p.Element.use.prototype=new p.Element.RenderedElementBase;p.Element.mask=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(v,w){var F=this.attribute("x").toPixels("x");var G=this.attribute("y").toPixels("y");var E=this.attribute("width").toPixels("x");var z=this.attribute("height").toPixels("y");if(E==0&&z==0){var s=new p.BoundingBox();for(var A=0;A<this.children.length;A++){s.addBoundingBox(this.children[A].getBoundingBox())}var F=Math.floor(s.x1);var G=Math.floor(s.y1);var E=Math.floor(s.width());var z=Math.floor(s.height())}var B=w.attribute("mask").value;w.attribute("mask").value="";var u=document.createElement("canvas");u.width=F+E;u.height=G+z;var C=u.getContext("2d");this.renderChildren(C);var t=document.createElement("canvas");t.width=F+E;t.height=G+z;var D=t.getContext("2d");w.render(D);D.globalCompositeOperation="destination-in";D.fillStyle=C.createPattern(u,"no-repeat");D.fillRect(0,0,F+E,G+z);v.fillStyle=D.createPattern(t,"no-repeat");v.fillRect(0,0,F+E,G+z);w.attribute("mask").value=B};this.render=function(s){}};p.Element.mask.prototype=new p.Element.ElementBase;p.Element.clipPath=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(t){var v=CanvasRenderingContext2D.prototype.beginPath;CanvasRenderingContext2D.prototype.beginPath=function(){};var w=CanvasRenderingContext2D.prototype.closePath;CanvasRenderingContext2D.prototype.closePath=function(){};v.call(t);for(var u=0;u<this.children.length;u++){var s=this.children[u];if(typeof s.path!="undefined"){var x=null;if(s.style("transform",false,true).hasValue()){x=new p.Transform(s.style("transform",false,true).value);x.apply(t)}s.path(t);CanvasRenderingContext2D.prototype.closePath=w;if(x){x.unapply(t)}}}w.call(t);t.clip();CanvasRenderingContext2D.prototype.beginPath=v;CanvasRenderingContext2D.prototype.closePath=w};this.render=function(s){}};p.Element.clipPath.prototype=new p.Element.ElementBase;p.Element.filter=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(u,w){var s=w.getBoundingBox();var G=Math.floor(s.x1);var H=Math.floor(s.y1);var F=Math.floor(s.width());var A=Math.floor(s.height());var z=w.style("filter").value;w.style("filter").value="";var C=0,D=0;for(var B=0;B<this.children.length;B++){var v=this.children[B].extraFilterDistance||0;C=Math.max(C,v);D=Math.max(D,v)}var t=document.createElement("canvas");t.width=F+2*C;t.height=A+2*D;var E=t.getContext("2d");E.translate(-G+C,-H+D);w.render(E);for(var B=0;B<this.children.length;B++){if(typeof this.children[B].apply=="function"){this.children[B].apply(E,0,0,F+2*C,A+2*D)}}u.drawImage(t,0,0,F+2*C,A+2*D,G-C,H-D,F+2*C,A+2*D);w.style("filter",true).value=z};this.render=function(s){}};p.Element.filter.prototype=new p.Element.ElementBase;p.Element.feMorphology=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feMorphology.prototype=new p.Element.ElementBase;p.Element.feComposite=function(r){this.base=p.Element.ElementBase;this.base(r);this.apply=function(s,v,w,u,t){}};p.Element.feComposite.prototype=new p.Element.ElementBase;p.Element.feColorMatrix=function(y){this.base=p.Element.ElementBase;this.base(y);var x=p.ToNumberArray(this.attribute("values").value);switch(this.attribute("type").valueOrDefault("matrix")){case"saturate":var z=x[0];x=[0.213+0.787*z,0.715-0.715*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715+0.285*z,0.072-0.072*z,0,0,0.213-0.213*z,0.715-0.715*z,0.072+0.9280000000000001*z,0,0,0,0,0,1,0,0,0,0,0,1];break;case"hueRotate":var r=x[0]*Math.PI/180;var t=function(s,A,B){return s+Math.cos(r)*A+Math.sin(r)*B};x=[t(0.213,0.787,-0.213),t(0.715,-0.715,-0.715),t(0.072,-0.072,0.9280000000000001),0,0,t(0.213,-0.213,0.143),t(0.715,0.285,0.14),t(0.072,-0.072,-0.283),0,0,t(0.213,-0.213,-0.787),t(0.715,-0.715,0.715),t(0.072,0.9280000000000001,0.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case"luminanceToAlpha":x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0,1];break}function u(A,D,E,C,s,B){return A[E*C*4+D*4+B]}function v(A,E,F,D,s,B,C){A[F*D*4+E*4+B]=C}function w(s,B){var A=x[s];return A*(A<0?B-255:B)}this.apply=function(B,H,I,G,D){var F=B.getImageData(0,0,G,D);for(var I=0;I<D;I++){for(var H=0;H<G;H++){var E=u(F.data,H,I,G,D,0);var C=u(F.data,H,I,G,D,1);var A=u(F.data,H,I,G,D,2);var s=u(F.data,H,I,G,D,3);v(F.data,H,I,G,D,0,w(0,E)+w(1,C)+w(2,A)+w(3,s)+w(4,1));v(F.data,H,I,G,D,1,w(5,E)+w(6,C)+w(7,A)+w(8,s)+w(9,1));v(F.data,H,I,G,D,2,w(10,E)+w(11,C)+w(12,A)+w(13,s)+w(14,1));v(F.data,H,I,G,D,3,w(15,E)+w(16,C)+w(17,A)+w(18,s)+w(19,1))}}B.clearRect(0,0,G,D);B.putImageData(F,0,0)}};p.Element.feColorMatrix.prototype=new p.Element.ElementBase;p.Element.feGaussianBlur=function(r){this.base=p.Element.ElementBase;this.base(r);this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(s,v,w,u,t){if(typeof n.canvasRGBA=="undefined"){p.log("ERROR: StackBlur.js must be included for blur to work");return}s.canvas.id=p.UniqueId();s.canvas.style.display="none";document.body.appendChild(s.canvas);n.canvasRGBA(s.canvas.id,v,w,u,t,this.blurRadius);document.body.removeChild(s.canvas)}};p.Element.feGaussianBlur.prototype=new p.Element.ElementBase;p.Element.title=function(r){};p.Element.title.prototype=new p.Element.ElementBase;p.Element.desc=function(r){};p.Element.desc.prototype=new p.Element.ElementBase;p.Element.MISSING=function(r){p.log("ERROR: Element '"+r.nodeName+"' not yet implemented.")};p.Element.MISSING.prototype=new p.Element.ElementBase;p.CreateElement=function(t){var r=t.nodeName.replace(/^[^:]+:/,"");r=r.replace(/\-/g,"");var s=null;if(typeof p.Element[r]!="undefined"){s=new p.Element[r](t)}else{s=new p.Element.MISSING(t)}s.type=t.nodeName;return s};p.load=function(r,s){p.loadXml(r,p.ajax(s))};p.loadXml=function(r,s){p.loadXmlDoc(r,p.parseXml(s))};p.loadXmlDoc=function(r,s){p.init(r);var w=function(z){var y=r.canvas;while(y){z.x-=y.offsetLeft;z.y-=y.offsetTop;y=y.offsetParent}if(window.scrollX){z.x+=window.scrollX}if(window.scrollY){z.y+=window.scrollY}return z};if(p.opts.ignoreMouse!=true){r.canvas.onclick=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onclick(z.x,z.y)};r.canvas.onmousemove=function(y){var z=w(new p.Point(y!=null?y.clientX:event.clientX,y!=null?y.clientY:event.clientY));p.Mouse.onmousemove(z.x,z.y)}}var u=p.CreateElement(s.documentElement);u.root=true;u.addStylesFromStyleDefinition();var v=true;var t=function(){p.ViewPort.Clear();if(r.canvas.parentNode){p.ViewPort.SetCurrent(r.canvas.parentNode.clientWidth,r.canvas.parentNode.clientHeight)}if(p.opts.ignoreDimensions!=true){if(u.style("width").hasValue()){r.canvas.width=u.style("width").toPixels("x");r.canvas.style.width=r.canvas.width+"px"}if(u.style("height").hasValue()){r.canvas.height=u.style("height").toPixels("y");r.canvas.style.height=r.canvas.height+"px"}}var z=r.canvas.clientWidth||r.canvas.width;var y=r.canvas.clientHeight||r.canvas.height;if(p.opts.ignoreDimensions==true&&u.style("width").hasValue()&&u.style("height").hasValue()){z=u.style("width").toPixels("x");y=u.style("height").toPixels("y")}p.ViewPort.SetCurrent(z,y);if(p.opts.offsetX!=null){u.attribute("x",true).value=p.opts.offsetX}if(p.opts.offsetY!=null){u.attribute("y",true).value=p.opts.offsetY}if(p.opts.scaleWidth!=null||p.opts.scaleHeight!=null){var B=null,C=null,A=p.ToNumberArray(u.attribute("viewBox").value);if(p.opts.scaleWidth!=null){if(u.attribute("width").hasValue()){B=u.attribute("width").toPixels("x")/p.opts.scaleWidth}else{if(!isNaN(A[2])){B=A[2]/p.opts.scaleWidth}}}if(p.opts.scaleHeight!=null){if(u.attribute("height").hasValue()){C=u.attribute("height").toPixels("y")/p.opts.scaleHeight}else{if(!isNaN(A[3])){C=A[3]/p.opts.scaleHeight}}}if(B==null){B=C}if(C==null){C=B}u.attribute("width",true).value=p.opts.scaleWidth;u.attribute("height",true).value=p.opts.scaleHeight;u.style("transform",true,true).value+=" scale("+(1/B)+","+(1/C)+")"}if(p.opts.ignoreClear!=true){r.clearRect(0,0,z,y)}u.render(r);if(v){v=false;if(typeof p.opts.renderCallback=="function"){p.opts.renderCallback(s)}}};var x=true;if(p.ImagesLoaded()){x=false;t()}p.intervalID=setInterval(function(){var z=false;if(x&&p.ImagesLoaded()){x=false;z=true}if(p.opts.ignoreMouse!=true){z=z|p.Mouse.hasEvents()}if(p.opts.ignoreAnimation!=true){for(var y=0;y<p.Animations.length;y++){z=z|p.Animations[y].update(1000/p.FRAMERATE)}}if(typeof p.opts.forceRedraw=="function"){if(p.opts.forceRedraw()==true){z=true}}if(z){t();p.Mouse.runEvents()}},1000/p.FRAMERATE)};p.stop=function(){if(p.intervalID){clearInterval(p.intervalID)}};p.Mouse=new (function(){this.events=[];this.hasEvents=function(){return this.events.length!=0};this.onclick=function(r,s){this.events.push({type:"onclick",x:r,y:s,run:function(t){if(t.onclick){t.onclick()}}})};this.onmousemove=function(r,s){this.events.push({type:"onmousemove",x:r,y:s,run:function(t){if(t.onmousemove){t.onmousemove()}}})};this.eventElements=[];this.checkPath=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInPath&&r.isPointInPath(s.x,s.y)){this.eventElements[u]=t}}};this.checkBoundingBox=function(t,r){for(var u=0;u<this.events.length;u++){var s=this.events[u];if(r.isPointInBox(s.x,s.y)){this.eventElements[u]=t}}};this.runEvents=function(){p.ctx.canvas.style.cursor="";for(var t=0;t<this.events.length;t++){var r=this.events[t];var s=this.eventElements[t];while(s){r.run(s);s=s.parent}}this.events=[];this.eventElements=[]}});return p}if(typeof CanvasRenderingContext2D!="undefined"){CanvasRenderingContext2D.prototype.drawSvg=function(w,r,t,q,p,u){var o={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:r,offsetY:t,scaleWidth:q,scaleHeight:p};for(var v in u){if(u.hasOwnProperty(v)){o[v]=u[v]}}c(this.canvas,w,o)}}return c}));(function(b){var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function d(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3]/255;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}function j(m){var n=m.data;var o=m.width*m.height*4;for(var l=0;l<o;l+=4){var k=n[l+3];if(k!=0){k=255/k;n[l]*=k;n[l+1]*=k;n[l+2]*=k}}}function i(p,m,r,k){var q=document.getElementById(p);var s=q.naturalWidth;var o=q.naturalHeight;var l=document.getElementById(m);l.style.width=s+"px";l.style.height=o+"px";l.width=s;l.height=o;var n=l.getContext("2d");n.clearRect(0,0,s,o);n.drawImage(q,0,0);if(isNaN(r)||r<1){return}if(k){h(m,0,0,s,o,r)}else{g(m,0,0,s,o,r)}}function h(D,Z,aa,ac,A,P){if(isNaN(P)||P<1){return}P|=0;var r=document.getElementById(D);var s=r.getContext("2d");var E;try{try{E=s.getImageData(Z,aa,ac,A)}catch(u){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");E=s.getImageData(Z,aa,ac,A)}catch(u){alert("Cannot access local image");throw new Error("unable to access local image data: "+u);return}}}catch(u){alert("Cannot access image");throw new Error("unable to access image data: "+u)}d(E);var K=E.data;var ae,af,C,G,ah,ag,ai,O,z,q,m,N,w,o,l,M,v,n,k,L,J,I,H,R;var t=P+P+1;var ab=ac<<2;var ad=ac-1;var B=A-1;var Q=P+1;var Y=Q*(Q+1)/2;var X=new a();var T=X;for(C=1;C<t;C++){T=T.next=new a();if(C==Q){var U=T}}T.next=X;var V=null;var W=null;ai=ag=0;var F=c[P];var S=e[P];for(af=0;af<A;af++){M=v=n=k=O=z=q=m=0;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}for(C=1;C<Q;C++){G=ag+((ad<C?ad:C)<<2);O+=(T.r=(L=K[G]))*(R=Q-C);z+=(T.g=(J=K[G+1]))*R;q+=(T.b=(I=K[G+2]))*R;m+=(T.a=(H=K[G+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next}V=X;W=U;for(ae=0;ae<ac;ae++){K[ag]=(O*F)>>S;K[ag+1]=(z*F)>>S;K[ag+2]=(q*F)>>S;K[ag+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ai+((G=ae+P+1)<ad?G:ad))<<2;M+=(V.r=K[G]);v+=(V.g=K[G+1]);n+=(V.b=K[G+2]);k+=(V.a=K[G+3]);O+=M;z+=v;q+=n;m+=k;V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=4}ai+=ac}for(ae=0;ae<ac;ae++){v=n=k=M=z=q=m=O=0;ag=ae<<2;N=Q*(L=K[ag]);w=Q*(J=K[ag+1]);o=Q*(I=K[ag+2]);l=Q*(H=K[ag+3]);O+=Y*L;z+=Y*J;q+=Y*I;m+=Y*H;T=X;for(C=0;C<Q;C++){T.r=L;T.g=J;T.b=I;T.a=H;T=T.next}ah=ac;for(C=1;C<=P;C++){ag=(ah+ae)<<2;O+=(T.r=(L=K[ag]))*(R=Q-C);z+=(T.g=(J=K[ag+1]))*R;q+=(T.b=(I=K[ag+2]))*R;m+=(T.a=(H=K[ag+3]))*R;M+=L;v+=J;n+=I;k+=H;T=T.next;if(C<B){ah+=ac}}ag=ae;V=X;W=U;for(af=0;af<A;af++){G=ag<<2;K[G]=(O*F)>>S;K[G+1]=(z*F)>>S;K[G+2]=(q*F)>>S;K[G+3]=(m*F)>>S;O-=N;z-=w;q-=o;m-=l;N-=V.r;w-=V.g;o-=V.b;l-=V.a;G=(ae+(((G=af+Q)<B?G:B)*ac))<<2;O+=(M+=(V.r=K[G]));z+=(v+=(V.g=K[G+1]));q+=(n+=(V.b=K[G+2]));m+=(k+=(V.a=K[G+3]));V=V.next;N+=(L=W.r);w+=(J=W.g);o+=(I=W.b);l+=(H=W.a);M-=L;v-=J;n-=I;k-=H;W=W.next;ag+=ac}}j(E);s.putImageData(E,Z,aa)}function g(A,V,W,Y,v,L){if(isNaN(L)||L<1){return}L|=0;var n=document.getElementById(A);var o=n.getContext("2d");var B;try{try{B=o.getImageData(V,W,Y,v)}catch(r){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");B=o.getImageData(V,W,Y,v)}catch(r){alert("Cannot access local image");throw new Error("unable to access local image data: "+r);return}}}catch(r){alert("Cannot access image");throw new Error("unable to access image data: "+r)}var G=B.data;var aa,ab,z,D,ad,ac,ae,K,u,m,J,t,l,I,s,k,H,F,E,N;var q=L+L+1;var X=Y<<2;var Z=Y-1;var w=v-1;var M=L+1;var U=M*(M+1)/2;var T=new a();var P=T;for(z=1;z<q;z++){P=P.next=new a();if(z==M){var Q=P}}P.next=T;var R=null;var S=null;ae=ac=0;var C=c[L];var O=e[L];for(ab=0;ab<v;ab++){I=s=k=K=u=m=0;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}for(z=1;z<M;z++){D=ac+((Z<z?Z:z)<<2);K+=(P.r=(H=G[D]))*(N=M-z);u+=(P.g=(F=G[D+1]))*N;m+=(P.b=(E=G[D+2]))*N;I+=H;s+=F;k+=E;P=P.next}R=T;S=Q;for(aa=0;aa<Y;aa++){G[ac]=(K*C)>>O;G[ac+1]=(u*C)>>O;G[ac+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(ae+((D=aa+L+1)<Z?D:Z))<<2;I+=(R.r=G[D]);s+=(R.g=G[D+1]);k+=(R.b=G[D+2]);K+=I;u+=s;m+=k;R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=4}ae+=Y}for(aa=0;aa<Y;aa++){s=k=I=u=m=K=0;ac=aa<<2;J=M*(H=G[ac]);t=M*(F=G[ac+1]);l=M*(E=G[ac+2]);K+=U*H;u+=U*F;m+=U*E;P=T;for(z=0;z<M;z++){P.r=H;P.g=F;P.b=E;P=P.next}ad=Y;for(z=1;z<=L;z++){ac=(ad+aa)<<2;K+=(P.r=(H=G[ac]))*(N=M-z);u+=(P.g=(F=G[ac+1]))*N;m+=(P.b=(E=G[ac+2]))*N;I+=H;s+=F;k+=E;P=P.next;if(z<w){ad+=Y}}ac=aa;R=T;S=Q;for(ab=0;ab<v;ab++){D=ac<<2;G[D]=(K*C)>>O;G[D+1]=(u*C)>>O;G[D+2]=(m*C)>>O;K-=J;u-=t;m-=l;J-=R.r;t-=R.g;l-=R.b;D=(aa+(((D=ab+M)<w?D:w)*Y))<<2;K+=(I+=(R.r=G[D]));u+=(s+=(R.g=G[D+1]));m+=(k+=(R.b=G[D+2]));R=R.next;J+=(H=S.r);t+=(F=S.g);l+=(E=S.b);I-=H;s-=F;k-=E;S=S.next;ac+=Y}}o.putImageData(B,V,W)}function a(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}var f={image:i,canvasRGBA:h,canvasRGB:g};if(typeof define!=="undefined"&&define.amd){define(function(){return f})}else{if(typeof module!=="undefined"&&module.exports){module.exports=f}}b.stackBlur=f}(typeof window!=="undefined"?window:this));function GroupAction(){var a=1;this.MakeGroup=function(b){var c=ShapesState.Public_ZSortShapeStates(MyShapesState.Public_GetAllSelectedShapeStates());if(c.length<=1){return}MyGroupAction.MakeGroupFromSelectedObjects(c)};this.MakeGroupFromSelectedObjects=function(q,n){var u=new Array();var o=new Array();var d=new Array();var f;var t=null;var k=null;var b=null;var p=null;var h=FindTopMostSVG_in_SelectedGroup(q);var j=$("#"+h).next();for(f=0;f<q.length;f++){var c=q[f].Public_GetImaginaryOuterBox();if(f==0||t>c.Top){t=c.Top}if(f==0||k>c.Left){k=c.Left}if(f==0||p<c.Right){p=c.Right}if(f==0||b<c.Bottom){b=c.Bottom}}var w=p-k;var v=b-t;var r=SvgCreator.CreateBlankSvg(w,v);r.setAttribute("viewBox",0+" "+0+" "+w+" "+v);var e=SvgCreator.CreateSvgGroup("natural"+a);e.appendChild(r);var s=$(r);for(var f=0;f<q.length;f++){q[f].nextShapeId=$("#"+q[f].Id).next().attr("id")}AttachChildrenShapesToParent(q,s,k,t);var l=AddSvg.AddSvgToStoryboard(e,0,0,true);j.before(l);var m=MyShapesState.Public_GetShapeStateByShape(l);m.X=k;m.Y=t;m.ScaleX=1;m.ScaleY=1;m.NaturalOffsetX=0;m.NaturalOffsetY=0;m.UseClipping=true;m.ClipX=0;m.ClipY=0;m.ClipWidth=w;m.ClipHeight=v;m.isGroupObject=true;for(f=0;f<q.length;f++){m.groupShapeStates.push(q[f])}MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();MyShapesState.Public_SelectShape(l);UpdateActiveDrawing();UndoManager.register(undefined,DisassembleShapes,[{childShapeStates:q,parentShapeState:m,parentShape:l}],"",undefined,AssembleShapes,[{childShapeStates:q,parentShapeState:m,parentShape:l,LastSVGId:h}],"");return m};this.ApplyParentStateToChild=function(f,e){var b=f.Private_GetSelectionBoxArea(0);var c={x:e.CenterX,y:e.CenterY};var d={x:f.X*e.Sx,y:f.Y*e.Sy};d={x:d.x+b.CenterX*e.Sx-c.x,y:d.y+b.CenterY*e.Sy-c.y};d={x:d.x*Math.cos(e.Angle*Math.PI/180)-d.y*Math.sin(e.Angle*Math.PI/180),y:d.x*Math.sin(e.Angle*Math.PI/180)+d.y*Math.cos(e.Angle*Math.PI/180)};d={x:d.x-b.CenterX*e.Sx+c.x,y:d.y-b.CenterY*e.Sy+c.y};f.X=d.x+e.fX;f.Y=d.y+e.fY};this.ApplyParentClippingToChild=function(e,l,d){if(!l.UseClipping){return}if(l.CropType!=CropTypeEnum.Advanced){return}var b=e.Private_GetSelectionBoxArea(0);var c={x:b.CenterX,y:b.CenterY};e.CropPolygonPoint=[];var h=null,k=null,g=null,j=null;for(i=0;i<l.CropPolygonPoint.length;i++){var f={x:l.CropPolygonPoint[i].x,y:l.CropPolygonPoint[i].y};f=l.ConvertCoordinateToStage(f,d,true);f=e.ConvertCoordinateToOrigin(f,c,true);e.CropPolygonPoint.push(f)}e.UseClipping=l.UseClipping;e.CropType=l.CropType;e.Public_update_ClipRegionByAdvancedCrop()};this.MinimizeAdvancedCropRegion=function(n){if(!n.UseClipping||n.CropType!=CropTypeEnum.Advanced){return false}var d=new ConvexHullGrahamScan();var f;var m=n.Private_GetElement(SvgPartsEnum.Scale);var l=m.getBBox();var k={Left:l.x,Right:l.x+l.width,Top:l.y,Bottom:l.y+l.height};if(checkPolygonInnerPoint({x:k.Left,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Left,k.Top)}if(checkPolygonInnerPoint({x:k.Left,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Left,k.Bottom)}if(checkPolygonInnerPoint({x:k.Right,y:k.Top},n.CropPolygonPoint)){d.addPoint(k.Right,k.Top)}if(checkPolygonInnerPoint({x:k.Right,y:k.Bottom},n.CropPolygonPoint)){d.addPoint(k.Right,k.Bottom)}for(f=0;f<n.CropPolygonPoint.length;f++){var b=n.CropPolygonPoint[f];var c=n.CropPolygonPoint[(f+1)%n.CropPolygonPoint.length];var g=new Array();g[0]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Top,k.Left,k.Bottom);g[1]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Left,k.Bottom,k.Right,k.Bottom);g[2]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Bottom,k.Right,k.Top);g[3]=checkLineIntersection(b.x,b.y,c.x,c.y,k.Right,k.Top,k.Left,k.Top);if(checkRectangleInnerPoint(b,k)){d.addPoint(b.x,b.y)}for(var h=0;h<4;h++){if(g[h].intersect){d.addPoint(g[h].x,g[h].y)}}}var e=d.getHull();if(e.length>=3){n.CropPolygonPoint=new Array();for(f=0;f<e.length;f++){n.CropPolygonPoint.push({x:e[f].x,y:e[f].y})}n.Public_update_ClipRegionByAdvancedCrop();n.CropPolygonPointJson=JSON.stringify(n.CropPolygonPoint);return true}else{n.CropType=CropTypeEnum.Standard;n.ClipWidth=0;n.ClipHeight=0;n.X=-1000;return false}};this.UnGroup=function(d,o){if(!o||o==undefined){o=MyShapesState.Public_GetFirstSelectedShapeState()}if(!o.isGroupObject){return}o.FlipHorizontal=false;o.FlipVertical=false;var k=o.getCropParam();o.Public_convert_RectangleToAdvanced();var g=$("#"+o.Id).next().attr("id");var b=o.Private_GetSelectionBoxArea(0);var q=[],m=[];var h={CenterX:b.CenterX,CenterY:b.CenterY,fX:o.X,fY:o.Y,Sx:o.ScaleX,Sy:o.ScaleY,flipH:o.FlipHorizontal,flipV:o.FlipVertical,Angle:o.Angle,FilterColorMode:o.FilterColorMode};var c={x:b.CenterX,y:b.CenterY};var f;DetachChildrenShapesFromParent(o,true);MyShapesState.Public_ClearAllSelectedShapes();HideControlsMenu();for(f=0;f<o.groupShapeStates.length;f++){var p=o.groupShapeStates[f].getCropParam();MyGroupAction.ApplyParentStateToChild(o.groupShapeStates[f],h);o.groupShapeStates[f].Angle+=h.Angle;o.groupShapeStates[f].ScaleX*=h.Sx;o.groupShapeStates[f].ScaleY*=h.Sy;o.groupShapeStates[f].opacity*=o.opacity;if(h.FilterColorMode){o.groupShapeStates[f].FilterColorMode=h.FilterColorMode}o.groupShapeStates[f].UpdateDrawing();if(o.FlipVertical){o.groupShapeStates[f].FlipVertical=!o.groupShapeStates[f].FlipVertical}if(o.FlipHorizontal){o.groupShapeStates[f].FlipHorizontal=!o.groupShapeStates[f].FlipHorizontal}MyShapesState.Public_SelectShape($("#"+o.groupShapeStates[f].Id));MyGroupAction.ApplyParentClippingToChild(o.groupShapeStates[f],o,c);MyGroupAction.MinimizeAdvancedCropRegion(o.groupShapeStates[f]);var l=o.groupShapeStates[f].getCropParam();q.push(p);m.push(l)}var j=o.getCropParam();var n=$("#"+o.Id).detach();MyShapesState.Public_RemoveShapeStateById(o.Id);UpdateActiveDrawing();UndoManager.register(undefined,AssembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:q,ParentParam:k,LastSVGId:g}],"",undefined,DisassembleWithOriginalChildren,[{childShapeStates:o.groupShapeStates,parentShapeState:o,parentShape:n,ChildParams:m,ParentParam:j}],"")};this.CheckGroupObject=function(){var b=MyShapesState.Public_GetFirstSelectedShapeState();return b.isGroupObject}}function DetachChildrenShapesFromParent(e,g){var b;var d=$("#"+e.Id).next();var a=$("#"+e.Id+SvgPartsEnum.SvgImage);a.children("g").each(function(){var j=this.getAttribute("id");var h=$(this).detach();h.on("mousedown",ShapeSelected);h.on("mouseup",HandleMouseExit);d.before(h)});if(!g){var c;for(c=e.groupShapeStates.length-1;c>=0;c--){var f=$("#"+e.groupShapeStates[c].Id);if($("#"+e.groupShapeStates[c].nextShapeId).length){$("#"+e.groupShapeStates[c].nextShapeId).before(f)}}}for(b=0;b<e.groupShapeStates.length;b++){MyShapesState.Public_SetShapeState(e.groupShapeStates[b].Id,e.groupShapeStates[b])}}function DisassembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var c=arguments[0].parentShape;var d=arguments[0].parentShapeState;var f=arguments[1];var b;DetachChildrenShapesFromParent(d,f);MyShapesState.Public_ClearAllSelectedShapes();for(b=0;b<a.length;b++){var e=a[b];e.X+=d.X;e.Y+=d.Y;MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}$("#"+d.Id).remove();MyShapesState.Public_RemoveShapeStateById(d.Id)}function AttachChildrenShapesToParent(a,b,d,e,h){var c;for(c=0;c<a.length;c++){var g=a[c];if(!h){g.X-=d;g.Y-=e}g.UpdateDrawing();var f=$("#"+g.Id);f.find("[id$='"+SvgPartsEnum.SelectionBox+"']").remove();f.off("mousedown");f.off("mouseup");b.append(f);MyShapesState.Public_RemoveShapeStateById(g.Id)}}function AssembleShapes(){if(arguments.length<1){return}var a=arguments[0].childShapeStates;var d=arguments[0].parentShape;var e=arguments[0].parentShapeState;var c=arguments[0].LastSVGId;var f=arguments[1];$("#"+c).before(d);var b=$("#"+e.Id+SvgPartsEnum.SvgImage);AttachChildrenShapesToParent(a,b,e.X,e.Y,f);d=$("#"+e.Id);d.on("mousedown",ShapeSelected);d.on("mouseup",HandleMouseExit);MyShapesState.Public_ClearAllSelectedShapes();MyShapesState.Public_SetShapeState(e.Id,e);MyShapesState.Public_SelectShape($("#"+e.Id));e.UpdateDrawing()}function AssembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;for(c=0;c<b.length;c++){b[c].setCropParam(a[c])}AssembleShapes(arguments[0],true);f.setCropParam(d);f.UpdateDrawing()}function DisassembleWithOriginalChildren(){if(arguments.length<1){return}var b=arguments[0].childShapeStates;var e=arguments[0].parentShape;var f=arguments[0].parentShapeState;var a=arguments[0].ChildParams;var d=arguments[0].ParentParam;var c;f.setCropParam(d);DisassembleShapes(arguments[0],true);for(c=0;c<b.length;c++){b[c].setCropParam(a[c]);b[c].UpdateDrawing()}};